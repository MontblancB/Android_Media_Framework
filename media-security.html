<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Prevent Flash of Incorrect Theme (FOIT) -->
    <script>
    (function(){var t=localStorage.getItem('android-media-framework-theme');if(t)document.documentElement.setAttribute('data-theme',t);else if(window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches)document.documentElement.setAttribute('data-theme','light');})();
    </script>
    <title>ë¯¸ë””ì–´ ë³´ì•ˆ ê°€ì´ë“œ - Android Media Framework</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">â† Android Media Framework</a>
    </nav>
    <div class="container">
        <header>
            <h1 class="page-title">ë¯¸ë””ì–´ ë³´ì•ˆ ê°€ì´ë“œ</h1>
            <p class="page-subtitle">Android ë¯¸ë””ì–´ í”„ë ˆì„ì›Œí¬ì˜ ë³´ì•ˆ ëª¨ë¸ê³¼ DRM í†µí•©</p>
        </header>

        <!-- Section 1: ê°œìš” -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">01</span>ë¯¸ë””ì–´ ë³´ì•ˆ ê°œìš”</h2>
            <p>ë¯¸ë””ì–´ ë³´ì•ˆì€ <strong>ì½˜í…ì¸  ë³´í˜¸</strong>ì™€ <strong>ì‹œìŠ¤í…œ ë³´ì•ˆ</strong> ë‘ ê°€ì§€ ì¸¡ë©´ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. í”„ë¦¬ë¯¸ì—„ ì½˜í…ì¸ ì˜ ë¶ˆë²• ë³µì œ ë°©ì§€ì™€ ë™ì‹œì— ì•…ì„± ë¯¸ë””ì–´ íŒŒì¼ë¡œë¶€í„° ì‹œìŠ¤í…œì„ ë³´í˜¸í•´ì•¼ í•©ë‹ˆë‹¤.</p>

            <h3>1.1 ë³´ì•ˆ ì•„í‚¤í…ì²˜</h3>
            <div class="mermaid">
flowchart TB
    subgraph REE["Rich Execution Environment (Android)"]
        APP[Media App]
        MC[MediaCodec]
        DRM[MediaDrm API]
    end

    subgraph TEE["Trusted Execution Environment"]
        OEM[OEMCrypto]
        SD[Secure Decoder]
        KS[Key Storage]
    end

    subgraph HW["Secure Hardware"]
        SB[Secure Buffer]
        HDCP[HDCP Output]
    end

    APP --> MC
    APP --> DRM
    DRM --> OEM
    MC --> SD
    OEM --> KS
    SD --> SB
    SB --> HDCP

            </div>
        </section>

        <!-- Section 2: ê¶Œí•œ ëª¨ë¸ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">02</span>ë¯¸ë””ì–´ ê¶Œí•œ ëª¨ë¸</h2>

            <h3>2.1 ì£¼ìš” ë¯¸ë””ì–´ ê¶Œí•œ</h3>
            <table>
                <thead>
                    <tr><th>ê¶Œí•œ</th><th>ìš©ë„</th><th>ë³´í˜¸ ìˆ˜ì¤€</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>RECORD_AUDIO</code></td><td>ë§ˆì´í¬ ì ‘ê·¼</td><td>dangerous</td></tr>
                    <tr><td><code>CAMERA</code></td><td>ì¹´ë©”ë¼ ì ‘ê·¼</td><td>dangerous</td></tr>
                    <tr><td><code>READ_MEDIA_AUDIO</code></td><td>ì˜¤ë””ì˜¤ íŒŒì¼ ì½ê¸°</td><td>dangerous</td></tr>
                    <tr><td><code>READ_MEDIA_VIDEO</code></td><td>ë¹„ë””ì˜¤ íŒŒì¼ ì½ê¸°</td><td>dangerous</td></tr>
                    <tr><td><code>MODIFY_AUDIO_SETTINGS</code></td><td>ì˜¤ë””ì˜¤ ì„¤ì • ë³€ê²½</td><td>normal</td></tr>
                </tbody>
            </table>

            <h3>2.2 Scoped Storage (Android 10+)</h3>
            <pre><code>// MediaStoreë¥¼ í†µí•œ ì•ˆì „í•œ ë¯¸ë””ì–´ ì ‘ê·¼
val collection = MediaStore.Video.Media.getContentUri(MediaStore.VOLUME_EXTERNAL)

val projection = arrayOf(
    MediaStore.Video.Media._ID,
    MediaStore.Video.Media.DISPLAY_NAME
)

contentResolver.query(collection, projection, null, null, null)?.use { cursor ->
    while (cursor.moveToNext()) {
        val id = cursor.getLong(0)
        val uri = ContentUris.withAppendedId(collection, id)
        // ì•ˆì „í•˜ê²Œ ë¯¸ë””ì–´ ì ‘ê·¼
    }
}</code></pre>
        </section>

        <!-- Section 3: Secure Buffer -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">03</span>Secure Buffer ì²˜ë¦¬</h2>

            <h3>3.1 Secure Buffer íë¦„</h3>
            <div class="mermaid">
sequenceDiagram
    participant App
    participant MediaCodec
    participant TEE
    participant SecureMemory
    participant Display

    App->>MediaCodec: queueSecureInputBuffer()
    MediaCodec->>TEE: Decrypt in TEE
    TEE->>SecureMemory: Store decrypted frame
    Note over SecureMemory: Protected memory region
    SecureMemory->>Display: Direct render (HDCP)
    Note over Display: Never exposed to REE
            </div>

            <h3>3.2 Secure ì½”ë± ì„¤ì •</h3>
            <pre><code>// Secure ë””ì½”ë” ì„ íƒ
val codecName = MediaCodecList(MediaCodecList.ALL_CODECS)
    .codecInfos
    .filter { !it.isEncoder }
    .filter { it.supportedTypes.contains("video/avc") }
    .firstOrNull {
        it.getCapabilitiesForType("video/avc")
            .isFeatureSupported(CodecCapabilities.FEATURE_SecurePlayback)
    }?.name

// Secure Surface ì„¤ì •
val format = MediaFormat.createVideoFormat("video/avc", width, height)
mediaCodec.configure(format, secureSurface, mediaCrypto, 0)</code></pre>
        </section>

        <!-- Section 4: TEE ì—°ë™ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">04</span>TEE (Trusted Execution Environment)</h2>

            <h3>4.1 TEE êµ¬ì¡°</h3>
            <table>
                <thead>
                    <tr><th>êµ¬ì„±ìš”ì†Œ</th><th>ì—­í• </th><th>ìœ„ì¹˜</th></tr>
                </thead>
                <tbody>
                    <tr><td><strong>Trustlet</strong></td><td>TEE ë‚´ ì‹¤í–‰ ì•±</td><td>Secure World</td></tr>
                    <tr><td><strong>OEMCrypto</strong></td><td>DRM ë³µí˜¸í™”</td><td>Secure World</td></tr>
                    <tr><td><strong>Keymaster</strong></td><td>í‚¤ ê´€ë¦¬</td><td>Secure World</td></tr>
                    <tr><td><strong>Secure Decoder</strong></td><td>ë³´ì•ˆ ë””ì½”ë”©</td><td>Secure World</td></tr>
                </tbody>
            </table>

            <h3>4.2 OEMCrypto API</h3>
            <pre><code>// OEMCrypto ì£¼ìš” í•¨ìˆ˜ (Widevine L1)
OEMCrypto_Initialize()           // ì´ˆê¸°í™”
OEMCrypto_OpenSession()          // ì„¸ì…˜ ì—´ê¸°
OEMCrypto_GenerateDerivedKeys()  // í‚¤ ìœ ë„
OEMCrypto_DecryptCENC()          // CENC ë³µí˜¸í™”
OEMCrypto_CloseSession()         // ì„¸ì…˜ ì¢…ë£Œ</code></pre>
        </section>

        <!-- Section 5: DRM ë ˆë²¨ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">05</span>DRM ë³´ì•ˆ ë ˆë²¨</h2>

            <h3>5.1 Widevine ë ˆë²¨ ë¹„êµ</h3>
            <table>
                <thead>
                    <tr><th>í•­ëª©</th><th>L1</th><th>L2</th><th>L3</th></tr>
                </thead>
                <tbody>
                    <tr><td><strong>ë³µí˜¸í™”</strong></td><td>TEE ë‚´ë¶€</td><td>TEE ë‚´ë¶€</td><td>ì†Œí”„íŠ¸ì›¨ì–´</td></tr>
                    <tr><td><strong>ë””ì½”ë”©</strong></td><td>TEE ë‚´ë¶€</td><td>REE</td><td>REE</td></tr>
                    <tr><td><strong>ìµœëŒ€ í•´ìƒë„</strong></td><td>4K HDR</td><td>SD/720p</td><td>SD</td></tr>
                    <tr><td><strong>í•˜ë“œì›¨ì–´ ìš”êµ¬</strong></td><td>TEE + Secure Path</td><td>TEE</td><td>ì—†ìŒ</td></tr>
                    <tr><td><strong>ì¸ì¦ ë‚œì´ë„</strong></td><td>ë†’ìŒ</td><td>ì¤‘ê°„</td><td>ë‚®ìŒ</td></tr>
                </tbody>
            </table>

            <h3>5.2 ë ˆë²¨ í™•ì¸ ì½”ë“œ</h3>
            <pre><code>val mediaDrm = MediaDrm(WIDEVINE_UUID)
val securityLevel = mediaDrm.getPropertyString("securityLevel")
// "L1", "L2", or "L3"

val hdcpLevel = mediaDrm.getPropertyString("hdcpLevel")
// "HDCP_V1", "HDCP_V2_2", etc.</code></pre>
        </section>

        <!-- Section 6: ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">06</span>ë³´ì•ˆ ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>

            <h3>ì½˜í…ì¸  ë³´í˜¸</h3>
            <ul class="checklist">
                <li><input type="checkbox"> DRM ë¼ì´ì„ ìŠ¤ ì„œë²„ HTTPS í†µì‹ </li>
                <li><input type="checkbox"> Secure Buffer ì‚¬ìš© (L1 ì½˜í…ì¸ )</li>
                <li><input type="checkbox"> HDCP ì¶œë ¥ ë³´í˜¸</li>
                <li><input type="checkbox"> í™”ë©´ ìº¡ì²˜ ë°©ì§€ (FLAG_SECURE)</li>
            </ul>

            <h3>ì‹œìŠ¤í…œ ë³´ì•ˆ</h3>
            <ul class="checklist">
                <li><input type="checkbox"> ì…ë ¥ íŒŒì¼ ìœ íš¨ì„± ê²€ì¦</li>
                <li><input type="checkbox"> ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ë°©ì§€</li>
                <li><input type="checkbox"> ê¶Œí•œ ìµœì†Œí™” ì›ì¹™</li>
                <li><input type="checkbox"> SELinux ì •ì±… ì ìš©</li>
            </ul>
        </section>

        <!-- Section 7: ì¼ë°˜ì ì¸ ë¯¸ë””ì–´ ë³´ì•ˆ ì·¨ì•½ì  -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">07</span>ì¼ë°˜ì ì¸ ë¯¸ë””ì–´ ë³´ì•ˆ ì·¨ì•½ì </h2>

            <h3>7.1 ì½”ë± ì·¨ì•½ì  ìœ í˜•</h3>
            <table>
                <thead>
                    <tr><th>ì·¨ì•½ì  ìœ í˜•</th><th>ì„¤ëª…</th><th>ì˜í–¥</th><th>ëŒ€ì‘</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ë²„í¼ ì˜¤ë²„í”Œë¡œìš°</strong></td>
                        <td>ì˜ëª»ëœ í¬ê¸° ê³„ì‚°ìœ¼ë¡œ ë²„í¼ ì´ˆê³¼ ì“°ê¸°</td>
                        <td>ì½”ë“œ ì‹¤í–‰, í¬ë˜ì‹œ</td>
                        <td>ê²½ê³„ ê²€ì‚¬, ASAN í…ŒìŠ¤íŠ¸</td>
                    </tr>
                    <tr>
                        <td><strong>ì •ìˆ˜ ì˜¤ë²„í”Œë¡œìš°</strong></td>
                        <td>í•´ìƒë„/í¬ê¸° ê³„ì‚° ì‹œ ì˜¤ë²„í”Œë¡œìš°</td>
                        <td>ë©”ëª¨ë¦¬ ì†ìƒ</td>
                        <td>SafeInt ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©</td>
                    </tr>
                    <tr>
                        <td><strong>í™ ì†ìƒ</strong></td>
                        <td>Use-after-free, Double-free</td>
                        <td>ì½”ë“œ ì‹¤í–‰</td>
                        <td>ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°, HWASAN</td>
                    </tr>
                    <tr>
                        <td><strong>í¬ë§· ë¬¸ìì—´</strong></td>
                        <td>ë©”íƒ€ë°ì´í„°ì˜ í¬ë§· ë¬¸ìì—´ ì£¼ì…</td>
                        <td>ì •ë³´ ìœ ì¶œ, í¬ë˜ì‹œ</td>
                        <td>í¬ë§· ë¬¸ìì—´ ê³ ì •</td>
                    </tr>
                </tbody>
            </table>

            <h3>7.2 ì£¼ìš” ë¯¸ë””ì–´ CVE ì‚¬ë¡€</h3>

            <h4 style="color: #94a3b8; margin: 20px 0 12px 0; font-size: 1.1rem;">ğŸ“œ ì—­ì‚¬ì ì¸ ë¯¸ë””ì–´ ì·¨ì•½ì  (2015-2016)</h4>
            <div class="info-box warning">
                <ul>
                    <li><strong>Stagefright (2015)</strong>: MMSë¡œ ì•…ì„± MP4 ì „ì†¡ ì‹œ ì›ê²© ì½”ë“œ ì‹¤í–‰. MPEG4 íŒŒì„œì˜ ì •ìˆ˜ ì˜¤ë²„í”Œë¡œìš°.</li>
                    <li><strong>libstagefright (2016)</strong>: HEVC íŒŒì„œ í™ ì˜¤ë²„í”Œë¡œìš°. ì•…ì„± ë™ì˜ìƒ ì¬ìƒ ì‹œ íŠ¸ë¦¬ê±°.</li>
                    <li><strong>Mediaserver ì·¨ì•½ì ë“¤</strong>: ë‹¤ì–‘í•œ ì»¨í…Œì´ë„ˆ/ì½”ë± íŒŒì„œì˜ ë©”ëª¨ë¦¬ ì•ˆì „ì„± ë¬¸ì œ.</li>
                </ul>
                <p><em>ì´ëŸ¬í•œ ì·¨ì•½ì ë“¤ë¡œ ì¸í•´ Android 7.0ë¶€í„° ë¯¸ë””ì–´ ìŠ¤íƒì´ ìƒŒë“œë°•ìŠ¤í™”ë˜ê³  í”„ë¡œì„¸ìŠ¤ ë¶„ë¦¬ê°€ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</em></p>
            </div>

            <h4 style="color: #ef4444; margin: 30px 0 12px 0; font-size: 1.1rem;">ğŸš¨ ìµœì‹  ë³´ì•ˆ ì·¨ì•½ì  (2023-2024)</h4>
            <div class="info-box" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1)); border-left: 4px solid #ef4444;">
                <strong>ê³ ìœ„í—˜ CVE (Critical/High)</strong>
                <table style="margin-top: 12px; width: 100%;">
                    <thead>
                        <tr style="background: rgba(239, 68, 68, 0.2);">
                            <th>CVE ID</th>
                            <th>ì‹¬ê°ë„</th>
                            <th>ì˜í–¥</th>
                            <th>íŒ¨ì¹˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>CVE-2024-0039</strong></td>
                            <td><span style="color: #ef4444; font-weight: bold;">Critical</span></td>
                            <td>MediaCodec ì›ê²© ì½”ë“œ ì‹¤í–‰<br><small>ì•…ì„± ë¯¸ë””ì–´ íŒŒì¼ ì¬ìƒ ì‹œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ ê°€ëŠ¥</small></td>
                            <td>Android 14 QPR1<br>(2024ë…„ 2ì›”)</td>
                        </tr>
                        <tr>
                            <td><strong>CVE-2024-43093</strong></td>
                            <td><span style="color: #f59e0b; font-weight: bold;">High</span></td>
                            <td>libstagefright ê¶Œí•œ ìƒìŠ¹<br><small>ë¡œì»¬ ê³µê²©ìê°€ ì‹œìŠ¤í…œ ê¶Œí•œ íšë“ ê°€ëŠ¥</small></td>
                            <td>2024-09 ë³´ì•ˆ íŒ¨ì¹˜</td>
                        </tr>
                        <tr>
                            <td><strong>CVE-2023-21400</strong></td>
                            <td><span style="color: #f59e0b; font-weight: bold;">High</span></td>
                            <td>cd_codec.c OOB read<br><small>ì •ë³´ ìœ ì¶œ ë° ì„œë¹„ìŠ¤ ê±°ë¶€ ê³µê²©</small></td>
                            <td>2023-11 ë³´ì•ˆ íŒ¨ì¹˜</td>
                        </tr>
                        <tr>
                            <td><strong>CVE-2023-35674</strong></td>
                            <td><span style="color: #f59e0b; font-weight: bold;">High</span></td>
                            <td>MediaProvider ê¶Œí•œ ìš°íšŒ<br><small>ë¯¸ë””ì–´ íŒŒì¼ ë¬´ë‹¨ ì ‘ê·¼</small></td>
                            <td>2023-10 ë³´ì•ˆ íŒ¨ì¹˜</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 16px; padding: 12px; background: rgba(239, 68, 68, 0.15); border-radius: 6px;">
                    <p style="margin: 0; font-size: 0.95rem; line-height: 1.6;">
                        <strong>ğŸ“Œ ì •ê¸° ì—…ë°ì´íŠ¸ í™•ì¸</strong><br>
                        â€¢ <a href="https://source.android.com/docs/security/bulletin" style="color: #60a5fa; text-decoration: underline;">Android Security Bulletins</a> - ë§¤ì›” ì²«ì§¸ ì›”ìš”ì¼ ë³´ì•ˆ íŒ¨ì¹˜ ê³µê°œ<br>
                        â€¢ <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-1224/product_id-19997/Google-Android.html" style="color: #60a5fa; text-decoration: underline;">CVE Details - Android</a> - ì „ì²´ CVE ëª©ë¡ ê²€ìƒ‰<br>
                        â€¢ <strong>ê¶Œì¥</strong>: ë¶„ê¸°ë³„ 1íšŒ ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ì ìš© ë° ì·¨ì•½ì  ì ê²€
                    </p>
                </div>
            </div>

            <h4 style="color: #10b981; margin: 30px 0 12px 0; font-size: 1.1rem;">âœ… ìµœì‹  ë³´ì•ˆ ê°•í™” ì‚¬í•­ (Android 13+)</h4>
            <div class="info-box" style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981;">
                <ul style="margin: 0; line-height: 1.8;">
                    <li><strong>Codec2 ì™„ì „ ì „í™˜</strong>: OMX ì œê±°ë¡œ ë ˆê±°ì‹œ ì½”ë± ì·¨ì•½ì  ê°ì†Œ</li>
                    <li><strong>Media3 ë„ì…</strong>: ê°œì„ ëœ ë³´ì•ˆ ëª¨ë¸ ë° ìƒŒë“œë°•ì‹±</li>
                    <li><strong>Scoped Storage ê°•í™”</strong>: MediaProvider ì ‘ê·¼ ì œì–´ ê°•í™”</li>
                    <li><strong>ëŸ°íƒ€ì„ ê¶Œí•œ ì„¸ë¶„í™”</strong>: READ_MEDIA_AUDIO/VIDEO/IMAGES ë¶„ë¦¬</li>
                    <li><strong>Trust On First Use (TOFU)</strong>: ì•± ì²« ì‹¤í–‰ ì‹œ ë¯¸ë””ì–´ íŒŒì¼ ìŠ¤ìº”</li>
                </ul>
            </div>

            <h3>7.3 ì•ˆì „í•œ ë¯¸ë””ì–´ íŒŒì¼ ì²˜ë¦¬</h3>
            <pre><code>// âŒ Bad: ì§ì ‘ íŒŒì¼ ì ‘ê·¼
val inputStream = FileInputStream(untrustedFile)
mediaPlayer.setDataSource(inputStream.fd)

// âœ… Good: ContentResolverë¥¼ í†µí•œ ì•ˆì „í•œ ì ‘ê·¼
contentResolver.openFileDescriptor(uri, "r")?.use { pfd ->
    mediaPlayer.setDataSource(pfd.fileDescriptor)
}

// âœ… Good: ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹œ íƒ€ì„ì•„ì›ƒ ë° ì˜ˆì™¸ ì²˜ë¦¬
fun safeExtractMetadata(uri: Uri): MediaMetadata? {
    return try {
        MediaMetadataRetriever().use { retriever ->
            retriever.setDataSource(context, uri)
            // ìœ íš¨ì„± ê²€ì¦
            val duration = retriever.extractMetadata(
                MediaMetadataRetriever.METADATA_KEY_DURATION
            )?.toLongOrNull() ?: return null

            if (duration <= 0 || duration > MAX_DURATION_MS) {
                return null
            }
            // ì•ˆì „í•˜ê²Œ ë©”íƒ€ë°ì´í„° ë°˜í™˜
            extractSafeMetadata(retriever)
        }
    } catch (e: Exception) {
        Log.w(TAG, "Failed to extract metadata", e)
        null
    }
}</code></pre>

            <h3>7.4 í”„ë¡œì„¸ìŠ¤ ë¶„ë¦¬ ì•„í‚¤í…ì²˜ (Android 7.0+)</h3>
            <div class="mermaid">
flowchart TB
    subgraph APP["App Process"]
        A[Media App]
    end

    subgraph ISOLATED["Isolated Processes (Sandboxed)"]
        MC[mediacodec]
        ME[mediaextractor]
        MD[mediadrmserver]
    end

    subgraph SYSTEM["System Process"]
        MS[mediaserver]
        AF[audioflinger]
    end

    A -->|Binder IPC| MC
    A -->|Binder IPC| ME
    A -->|Binder IPC| MD
    MC --> MS
    MS --> AF
            </div>
            <p>ë¯¸ë””ì–´ ì½”ë±ê³¼ ì¶”ì¶œê¸°ê°€ ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ë¶„ë¦¬ë˜ì–´ ì·¨ì•½ì  ì•…ìš© ì‹œ ì˜í–¥ ë²”ìœ„ê°€ ì œí•œë©ë‹ˆë‹¤.</p>
        </section>

        <!-- Section 8: DRM ì‹œìŠ¤í…œ ë¹„êµ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">08</span>DRM ì‹œìŠ¤í…œ ë¹„êµ</h2>

            <h3>8.1 ì£¼ìš” DRM ì‹œìŠ¤í…œ</h3>
            <table>
                <thead>
                    <tr><th>DRM</th><th>ì†Œìœ ì‚¬</th><th>ì£¼ìš” í”Œë«í¼</th><th>Android ì§€ì›</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Widevine</strong></td>
                        <td>Google</td>
                        <td>Android, Chrome, Smart TV</td>
                        <td>ë„¤ì´í‹°ë¸Œ ì§€ì›</td>
                    </tr>
                    <tr>
                        <td><strong>PlayReady</strong></td>
                        <td>Microsoft</td>
                        <td>Windows, Xbox, Smart TV</td>
                        <td>OEM êµ¬í˜„ í•„ìš”</td>
                    </tr>
                    <tr>
                        <td><strong>FairPlay</strong></td>
                        <td>Apple</td>
                        <td>iOS, macOS, Apple TV</td>
                        <td>ë¯¸ì§€ì›</td>
                    </tr>
                    <tr>
                        <td><strong>ClearKey</strong></td>
                        <td>W3C (í‘œì¤€)</td>
                        <td>ëª¨ë“  EME ì§€ì› ë¸Œë¼ìš°ì €</td>
                        <td>ì§€ì› (í…ŒìŠ¤íŠ¸ìš©)</td>
                    </tr>
                </tbody>
            </table>

            <h3>8.2 Widevine vs PlayReady ìƒì„¸ ë¹„êµ</h3>
            <table>
                <thead>
                    <tr><th>í•­ëª©</th><th>Widevine</th><th>PlayReady</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ë¼ì´ì„ ìŠ¤ ë¹„ìš©</strong></td>
                        <td>ë¬´ë£Œ (Google ê¸°ê¸°)</td>
                        <td>ìœ ë£Œ (ë¡œì—´í‹°)</td>
                    </tr>
                    <tr>
                        <td><strong>ë³´ì•ˆ ë ˆë²¨</strong></td>
                        <td>L1, L2, L3</td>
                        <td>SL150, SL2000, SL3000</td>
                    </tr>
                    <tr>
                        <td><strong>TEE ìš”êµ¬</strong></td>
                        <td>L1: í•„ìˆ˜</td>
                        <td>SL3000: í•„ìˆ˜</td>
                    </tr>
                    <tr>
                        <td><strong>ì½˜í…ì¸  ì œê³µì</strong></td>
                        <td>Netflix, YouTube, Amazon</td>
                        <td>Netflix, Amazon, Hulu</td>
                    </tr>
                    <tr>
                        <td><strong>Android í†µí•©</strong></td>
                        <td>MediaDrm API ë„¤ì´í‹°ë¸Œ</td>
                        <td>ë³„ë„ SDK í•„ìš”</td>
                    </tr>
                </tbody>
            </table>

            <h3>8.3 ë©€í‹° DRM êµ¬í˜„</h3>
            <pre><code>// ë©€í‹° DRM ì§€ì› (Widevine + PlayReady)
class MultiDrmManager(private val context: Context) {
    companion object {
        val WIDEVINE_UUID = UUID(-0x121074568629b532L, -0x5c37d8232ae2de13L)
        val PLAYREADY_UUID = UUID(-0x65fb0f8667bfbd7aL, -0x546d19a41f77a06bL)
    }

    fun getSupportedDrm(): DrmType {
        return when {
            MediaDrm.isCryptoSchemeSupported(WIDEVINE_UUID) -> DrmType.WIDEVINE
            MediaDrm.isCryptoSchemeSupported(PLAYREADY_UUID) -> DrmType.PLAYREADY
            else -> DrmType.CLEARKEY
        }
    }

    fun createDrmSession(drmType: DrmType, licenseUrl: String): DrmSession {
        val uuid = when (drmType) {
            DrmType.WIDEVINE -> WIDEVINE_UUID
            DrmType.PLAYREADY -> PLAYREADY_UUID
            DrmType.CLEARKEY -> CLEARKEY_UUID
        }

        val mediaDrm = MediaDrm(uuid)
        // ë¼ì´ì„ ìŠ¤ ì„œë²„ URL ì„¤ì •
        mediaDrm.setPropertyString("serverUrl", licenseUrl)

        return DrmSession(mediaDrm)
    }
}

enum class DrmType { WIDEVINE, PLAYREADY, CLEARKEY }</code></pre>
        </section>

        <!-- Section 9: ì½˜í…ì¸  ë³´í˜¸ ìš°íšŒ ë°©ì§€ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">09</span>ì½˜í…ì¸  ë³´í˜¸ ìš°íšŒ ë°©ì§€</h2>

            <h3>9.1 í™”ë©´ ìº¡ì²˜/ë…¹í™” ë°©ì§€</h3>
            <pre><code>// Activityì—ì„œ í™”ë©´ ìº¡ì²˜ ë°©ì§€
class SecureVideoActivity : Activity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        // FLAG_SECURE ì„¤ì • (ìŠ¤í¬ë¦°ìƒ·, í™”ë©´ ë…¹í™” ë°©ì§€)
        window.setFlags(
            WindowManager.LayoutParams.FLAG_SECURE,
            WindowManager.LayoutParams.FLAG_SECURE
        )
    }
}

// SurfaceViewì—ì„œ Secure í”Œë˜ê·¸ ì„¤ì •
surfaceView.holder.addCallback(object : SurfaceHolder.Callback {
    override fun surfaceCreated(holder: SurfaceHolder) {
        // Secure Surfaceë¡œ ì„¤ì • (DRM ì½˜í…ì¸ ìš©)
        holder.surface.setFrameRate(60f, Surface.FRAME_RATE_COMPATIBILITY_DEFAULT)
    }
    // ...
})</code></pre>

            <h3>9.2 ë£¨íŒ…/íƒˆì˜¥ ê¸°ê¸° íƒì§€</h3>
            <pre><code>object SecurityCheck {
    // ë£¨íŒ… íƒì§€ (ê¸°ë³¸ì ì¸ ì²´í¬)
    fun isDeviceRooted(): Boolean {
        return checkRootBinaries() ||
               checkRootPackages() ||
               checkBuildTags() ||
               checkWritableSystem()
    }

    private fun checkRootBinaries(): Boolean {
        val paths = listOf(
            "/system/app/Superuser.apk",
            "/sbin/su", "/system/bin/su", "/system/xbin/su",
            "/data/local/xbin/su", "/data/local/bin/su",
            "/system/sd/xbin/su", "/system/bin/failsafe/su",
            "/data/local/su", "/su/bin/su"
        )
        return paths.any { File(it).exists() }
    }

    private fun checkRootPackages(): Boolean {
        val packages = listOf(
            "com.koushikdutta.superuser",
            "com.thirdparty.superuser",
            "eu.chainfire.supersu",
            "com.topjohnwu.magisk"
        )
        val pm = context.packageManager
        return packages.any { pkg ->
            try {
                pm.getPackageInfo(pkg, 0)
                true
            } catch (e: PackageManager.NameNotFoundException) {
                false
            }
        }
    }

    private fun checkBuildTags(): Boolean {
        val tags = Build.TAGS
        return tags != null && tags.contains("test-keys")
    }

    private fun checkWritableSystem(): Boolean {
        return try {
            Runtime.getRuntime().exec("mount").inputStream.bufferedReader()
                .readText().contains("/system.*rw")
        } catch (e: Exception) {
            false
        }
    }
}</code></pre>

            <h3>9.3 SafetyNet/Play Integrity API</h3>
            <pre><code>// Play Integrity API (SafetyNet í›„ì†)
class IntegrityChecker(private val context: Context) {

    suspend fun checkIntegrity(): IntegrityResult {
        val integrityManager = IntegrityManagerFactory.create(context)

        // ë¬´ê²°ì„± í† í° ìš”ì²­
        val nonce = generateNonce()
        val request = IntegrityTokenRequest.builder()
            .setNonce(nonce)
            .build()

        return try {
            val response = integrityManager.requestIntegrityToken(request).await()
            val token = response.token()

            // ì„œë²„ì—ì„œ í† í° ê²€ì¦ (ê¶Œì¥)
            verifyTokenOnServer(token)
        } catch (e: Exception) {
            IntegrityResult.Error(e.message)
        }
    }

    private fun generateNonce(): String {
        val bytes = ByteArray(32)
        SecureRandom().nextBytes(bytes)
        return Base64.encodeToString(bytes, Base64.NO_WRAP)
    }
}

// DRM ì¬ìƒ ì „ ë¬´ê²°ì„± ê²€ì‚¬
suspend fun playDrmContent(uri: Uri) {
    val integrityResult = integrityChecker.checkIntegrity()

    when (integrityResult) {
        is IntegrityResult.Valid -> {
            // ì •ìƒ ê¸°ê¸° â†’ DRM ì½˜í…ì¸  ì¬ìƒ
            startSecurePlayback(uri)
        }
        is IntegrityResult.DeviceTampered -> {
            // ë£¨íŒ…/ë³€ì¡° ê¸°ê¸° â†’ ì €í™”ì§ˆ ë˜ëŠ” ì¬ìƒ ê±°ë¶€
            showSecurityWarning()
        }
        is IntegrityResult.Error -> {
            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“± â†’ ì˜¤í”„ë¼ì¸ ì •ì±… ì ìš©
            applyOfflinePolicy(uri)
        }
    }
}</code></pre>

            <h3>9.4 HDCP ì¶œë ¥ ë³´í˜¸</h3>
            <table>
                <thead>
                    <tr><th>HDCP ë²„ì „</th><th>ì§€ì› í•´ìƒë„</th><th>ì ìš© ì½˜í…ì¸ </th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>HDCP 1.4</strong></td>
                        <td>1080p</td>
                        <td>HD ì½˜í…ì¸ </td>
                    </tr>
                    <tr>
                        <td><strong>HDCP 2.2</strong></td>
                        <td>4K</td>
                        <td>4K/HDR ì½˜í…ì¸ </td>
                    </tr>
                    <tr>
                        <td><strong>HDCP 2.3</strong></td>
                        <td>8K</td>
                        <td>8K/ê³ ê¸‰ HDR</td>
                    </tr>
                </tbody>
            </table>
            <pre><code>// HDCP ë ˆë²¨ í™•ì¸
val mediaDrm = MediaDrm(WIDEVINE_UUID)
val hdcpLevel = mediaDrm.connectedHdcpLevel

when (hdcpLevel) {
    MediaDrm.HDCP_LEVEL_UNKNOWN -> Log.d(TAG, "HDCP level unknown")
    MediaDrm.HDCP_NONE -> Log.d(TAG, "No HDCP")
    MediaDrm.HDCP_V1 -> Log.d(TAG, "HDCP 1.x - HD supported")
    MediaDrm.HDCP_V2 -> Log.d(TAG, "HDCP 2.0")
    MediaDrm.HDCP_V2_1 -> Log.d(TAG, "HDCP 2.1")
    MediaDrm.HDCP_V2_2 -> Log.d(TAG, "HDCP 2.2 - 4K supported")
    MediaDrm.HDCP_V2_3 -> Log.d(TAG, "HDCP 2.3 - 8K supported")
}

// ì½˜í…ì¸  í•´ìƒë„ ì •ì±… ì ìš©
val maxResolution = when {
    hdcpLevel >= MediaDrm.HDCP_V2_2 -> Resolution.UHD_4K
    hdcpLevel >= MediaDrm.HDCP_V1 -> Resolution.FHD_1080P
    else -> Resolution.SD_480P
}</code></pre>
        </section>

        <!-- ê´€ë ¨ ë¬¸ì„œ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">10</span>ê´€ë ¨ ë¬¸ì„œ</h2>
            <ul>
                <li><a href="widevine.html">DRM & Widevine Architecture</a> - Widevine ìƒì„¸</li>
                <li><a href="vendor-extension.html">Vendor Extension ê°œë°œ</a> - HAL ë³´ì•ˆ</li>
                <li><a href="media-porting-checklist.html">í¬íŒ… ì²´í¬ë¦¬ìŠ¤íŠ¸</a> - DRM í¬íŒ…</li>
                <li><a href="production-debugging.html">í”„ë¡œë•ì…˜ ë””ë²„ê¹…</a> - ë³´ì•ˆ ì´ìŠˆ ë””ë²„ê¹…</li>
            </ul>
        </section>
    </div>

    <script src="scripts/mermaid-theme.js"></script>
    <script src="scripts/copy-code.js"></script>
    <script src="scripts/toc-generator.js"></script>
    <script src="scripts/page-navigation.js"></script>
    <script src="scripts/diagram-data.js"></script>
    <script src="scripts/diagram-interactive.js"></script>
    <script src="scripts/theme-toggle.js?v=2"></script>
    <script src="scripts/lang-switch.js"></script>
</body>
</html>
