<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debugging Tools</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            â† Android Media Framework
        </a>
    </nav>
    <div class="container">
        <header>
            <h1 class="page-title">ğŸ› ï¸ Android Media Debugging & Profiling Tools</h1>
            <p class="page-subtitle">ë¯¸ë””ì–´ í”„ë ˆì„ì›Œí¬ ë””ë²„ê¹… ë° ì„±ëŠ¥ ë¶„ì„ ì™„ì „ ê°€ì´ë“œ</p>
        </header>

        

        <!-- Section 1: ê°œìš” -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">01</span>1. ê°œìš”</h2>

            <p>Android ë¯¸ë””ì–´ í”„ë ˆì„ì›Œí¬ ë””ë²„ê¹…ì€ <strong>ë©€í‹°ë ˆì´ì–´ ì•„í‚¤í…ì²˜</strong> íŠ¹ì„±ìƒ Framework, Native, HAL, Kernel ë ˆë²¨ì„ ëª¨ë‘ ì¶”ì í•´ì•¼ í•©ë‹ˆë‹¤. ì´ í˜ì´ì§€ëŠ” ì‹¤ì „ ë””ë²„ê¹… ë„êµ¬ì™€ ì›Œí¬í”Œë¡œìš°ë¥¼ ë‹¨ê³„ë³„ë¡œ ì œê³µí•©ë‹ˆë‹¤.</p>

            <h3>1.1 ë””ë²„ê¹… ë ˆë²¨ë³„ ë„êµ¬ ë§¤í•‘</h3>
            <table>
                <thead>
                    <tr>
                        <th>ë ˆë²¨</th>
                        <th>ì£¼ìš” ì»´í¬ë„ŒíŠ¸</th>
                        <th>ë„êµ¬</th>
                        <th>ì¶œë ¥ í˜•ì‹</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>App Layer</strong></td>
                        <td>MediaPlayer, ExoPlayer, Media3</td>
                        <td>Android Studio Profiler, logcat</td>
                        <td>CPU/Memory timeline, log stream</td>
                    </tr>
                    <tr>
                        <td><strong>Framework</strong></td>
                        <td>MediaSession, AudioManager</td>
                        <td>dumpsys, adb shell pm</td>
                        <td>Service state dump, JSON</td>
                    </tr>
                    <tr>
                        <td><strong>Native</strong></td>
                        <td>MediaCodec, AudioFlinger</td>
                        <td>perfetto, systrace</td>
                        <td>Trace protobuf, HTML timeline</td>
                    </tr>
                    <tr>
                        <td><strong>HAL</strong></td>
                        <td>Codec2, Audio HAL</td>
                        <td>hidl-test, aidl dump</td>
                        <td>Test report, interface dump</td>
                    </tr>
                    <tr>
                        <td><strong>Kernel</strong></td>
                        <td>Binder, ION allocator</td>
                        <td>ftrace, /proc, /sys</td>
                        <td>Kernel trace, sysfs values</td>
                    </tr>
                </tbody>
            </table>

            <h3>1.2 ë””ë²„ê¹… ì›Œí¬í”Œë¡œìš°</h3>
            <div class="mermaid">
graph TD
    A[Issue ë°œìƒ] --> B{Logì— ì—ëŸ¬?}
    B -->|Yes| C[logcat í•„í„°ë§]
    B -->|No| D{ì„±ëŠ¥ ë¬¸ì œ?}

    C --> E[Framework ìŠ¤íƒ?]
    C --> F[Native ìŠ¤íƒ?]

    D -->|Yes| G[perfetto íŠ¸ë ˆì´ìŠ¤]
    D -->|No| H[dumpsys ìƒíƒœ í™•ì¸]

    E --> I[dumpsys media.*]
    F --> J[Native ë¡œê·¸ ë¶„ì„]

    G --> K[CPU/GPU í”„ë¡œíŒŒì¼]
    H --> L[Service state ê²€ì¦]

    I --> M[í•´ê²°ì±… ì ìš©]
    J --> M
    K --> M
    L --> M

    M --> N[ì¬í˜„ í…ŒìŠ¤íŠ¸]
    N --> O{í•´ê²°?}
    O -->|No| P[Bugreport ìƒì„±]
    O -->|Yes| Q[ì¢…ë£Œ]

    P --> R[AOSP Issue ë¦¬í¬íŠ¸]
            </div>

            <div class="info-box">
                <strong>ğŸ’¡ Tip: ë””ë²„ê¹… ìˆœì„œ</strong>
                <ol>
                    <li><strong>logcat</strong>ìœ¼ë¡œ ì—ëŸ¬ ìŠ¤íƒ í™•ì¸ (5ë¶„)</li>
                    <li><strong>dumpsys</strong>ë¡œ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ (3ë¶„)</li>
                    <li><strong>perfetto</strong>ë¡œ íƒ€ì„ë¼ì¸ ë¶„ì„ (10ë¶„)</li>
                    <li><strong>Bugreport</strong> ìƒì„± í›„ ì „ë¬¸ê°€ ë¶„ì„ (30ë¶„~)</li>
                </ol>
            </div>
        </section>

        <!-- Section 2: logcat í•„í„°ë§ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">02</span>2. logcat í•„í„°ë§ íŒ¨í„´</h2>

            <p>logcatì€ Android ë””ë²„ê¹…ì˜ <strong>ì²« ë²ˆì§¸ ì§„ì…ì </strong>ì…ë‹ˆë‹¤. ë¯¸ë””ì–´ ê´€ë ¨ ë¡œê·¸ëŠ” ì´ˆë‹¹ ìˆ˜ë°± ì¤„ì´ ì¶œë ¥ë˜ë¯€ë¡œ íš¨ê³¼ì ì¸ í•„í„°ë§ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</p>

            <h3>2.1 ê¸°ë³¸ í•„í„°ë§</h3>

            <h4>ë¯¸ë””ì–´ ì „ì²´ ë¡œê·¸</h4>
            <pre><code># ëª¨ë“  ë¯¸ë””ì–´ ê´€ë ¨ ë¡œê·¸
adb logcat -s MediaPlayer MediaCodec ExoPlayerImpl MediaSession AudioFlinger

# ìš°ì„ ìˆœìœ„ í•„í„° (Warning ì´ìƒë§Œ)
adb logcat *:W | grep -E "Media|Audio|Codec"

# íŠ¹ì • íŒ¨í‚¤ì§€ë§Œ
adb logcat --pid=$(adb shell pidof -s com.example.mediaplayer)</code></pre>

            <h4>ì—ëŸ¬ ë¡œê·¸ë§Œ ì¶”ì¶œ</h4>
            <pre><code># Java Exception ìŠ¤íƒ
adb logcat -s AndroidRuntime:E

# Native Crash
adb logcat -s DEBUG:I libc:I

# ANR (Application Not Responding)
adb logcat -s ActivityManager:I | grep "ANR in"</code></pre>

            <h3>2.2 ì»´í¬ë„ŒíŠ¸ë³„ í•„í„°</h3>

            <div class="tool-grid">
                <div class="tool-card">
                    <h4>MediaCodec</h4>
                    <pre><code>adb logcat -s \
  MediaCodec \
  MediaCodecList \
  ACodec \
  CCodec \
  OMXClient</code></pre>
                </div>

                <div class="tool-card">
                    <h4>ExoPlayer / Media3</h4>
                    <pre><code>adb logcat -s \
  ExoPlayerImpl \
  MediaCodecRenderer \
  MediaCodecVideoRenderer \
  MediaCodecAudioRenderer \
  DefaultTrackSelector</code></pre>
                </div>

                <div class="tool-card">
                    <h4>AudioFlinger</h4>
                    <pre><code>adb logcat -s \
  AudioFlinger \
  AudioPolicyService \
  AudioTrack \
  AudioFocus</code></pre>
                </div>

                <div class="tool-card">
                    <h4>MediaSession</h4>
                    <pre><code>adb logcat -s \
  MediaSessionService \
  MediaController \
  MediaBrowserService \
  MediaNotificationManager</code></pre>
                </div>

                <div class="tool-card">
                    <h4>Car Media (AAOS)</h4>
                    <pre><code>adb logcat -s \
  CarMediaService \
  CarAudioService \
  VehicleHal \
  CarInputService</code></pre>
                </div>

                <div class="tool-card">
                    <h4>DRM (Widevine)</h4>
                    <pre><code>adb logcat -s \
  MediaDrm \
  Drm \
  WVCdm \
  ClearKeyDrm</code></pre>
                </div>
            </div>

            <h3>2.3 ì •ê·œì‹ íŒ¨í„´</h3>

            <table>
                <thead>
                    <tr>
                        <th>ë¬¸ì œ ìœ í˜•</th>
                        <th>grep íŒ¨í„´</th>
                        <th>ì„¤ëª…</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Codec ì—ëŸ¬</td>
                        <td><code>grep -E "codec.*error|configure.*failed"</code></td>
                        <td>configure/start ì‹¤íŒ¨</td>
                    </tr>
                    <tr>
                        <td>Buffer ì—ëŸ¬</td>
                        <td><code>grep -E "dequeue.*timeout|ETIMEDOUT"</code></td>
                        <td>dequeueOutputBuffer íƒ€ì„ì•„ì›ƒ</td>
                    </tr>
                    <tr>
                        <td>DRM ì—ëŸ¬</td>
                        <td><code>grep -E "license.*error|provision.*failed"</code></td>
                        <td>ë¼ì´ì„ ìŠ¤ íšë“ ì‹¤íŒ¨</td>
                    </tr>
                    <tr>
                        <td>Audio Focus</td>
                        <td><code>grep -E "AudioFocus.*LOSS|abandonAudioFocus"</code></td>
                        <td>í¬ì»¤ìŠ¤ ì†ì‹¤ ì´ë²¤íŠ¸</td>
                    </tr>
                    <tr>
                        <td>ANR</td>
                        <td><code>grep "Input dispatching timed out"</code></td>
                        <td>5ì´ˆ ì´ìƒ UI ë¸”ë¡</td>
                    </tr>
                    <tr>
                        <td>OOM</td>
                        <td><code>grep "OutOfMemoryError"</code></td>
                        <td>ë©”ëª¨ë¦¬ ë¶€ì¡±</td>
                    </tr>
                </tbody>
            </table>

            <h3>2.4 ì‹¤ì „ ì˜ˆì‹œ: Codec ì—ëŸ¬ ì¶”ì </h3>
            <pre><code># Step 1: ì—ëŸ¬ ë°œìƒ ì‹œì  í™•ì¸
adb logcat -t 500 | grep -E "MediaCodec|ACodec|CCodec"

# ì¶œë ¥ ì˜ˆì‹œ:
# 01-25 10:32:15.421  1234  5678 E MediaCodec: configure failed with err 0xffffffe2
# 01-25 10:32:15.422  1234  5678 E ACodec   : [OMX.qcom.video.decoder.avc] ERROR(0x80001001)

# Step 2: ì—ëŸ¬ ì½”ë“œ í•´ì„
# 0xffffffe2 = -30 (INVALID_OPERATION)
# 0x80001001 = OMX_ErrorInsufficientResources

# Step 3: ì„¤ì •ê°’ ë¤í”„
adb logcat -s MediaCodec:V | grep "format"
# ì¶œë ¥: MediaFormat: {mime=video/avc, width=3840, height=2160, ...}

# Step 4: Capabilities í™•ì¸
adb shell dumpsys media.codec | grep "avc"</code></pre>

            <div class="warning-box">
                <strong>âš ï¸ ì£¼ì˜: logcat ë²„í¼ í¬ê¸°</strong>
                <p>ê¸°ë³¸ logcat ë²„í¼ëŠ” 256KBë¡œ ë¹ ë¥´ê²Œ ë®ì–´ì¨ì§‘ë‹ˆë‹¤. ì¥ì‹œê°„ ë””ë²„ê¹… ì‹œ ë²„í¼ ì¦ê°€:</p>
                <pre><code>adb logcat -G 16M   # 16MBë¡œ ì¦ê°€
adb logcat -g       # í˜„ì¬ ë²„í¼ í¬ê¸° í™•ì¸</code></pre>
            </div>

            <h3>2.5 ë¡œê·¸ íŒŒì¼ ì €ì¥ ë° ê³µìœ </h3>
            <pre><code># íŒŒì¼ë¡œ ì €ì¥ (Timestamp í¬í•¨)
adb logcat -v threadtime > logcat_$(date +%Y%m%d_%H%M%S).txt

# íŠ¹ì • ì‹œê°„ ë™ì•ˆë§Œ (30ì´ˆ)
timeout 30 adb logcat > logcat_30s.txt

# ì´ë¯¸ ì¶œë ¥ëœ ë¡œê·¸ ì „ì²´ (-d: dump mode)
adb logcat -d > logcat_dump.txt

# ì••ì¶•í•˜ì—¬ ì €ì¥
adb logcat -d | gzip > logcat.txt.gz</code></pre>
        </section>

        <!-- Section 3: dumpsys ëª…ë ¹ì–´ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">03</span>3. dumpsys ëª…ë ¹ì–´ ì»¬ë ‰ì…˜</h2>

            <p>dumpsysëŠ” Android ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ì˜ <strong>ëŸ°íƒ€ì„ ìƒíƒœë¥¼ ë¤í”„</strong>í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ë¯¸ë””ì–´ ê´€ë ¨ ì„œë¹„ìŠ¤ëŠ” ì•½ 15ê°œ ì´ìƒ ì¡´ì¬í•©ë‹ˆë‹¤.</p>

            <h3>3.1 ì£¼ìš” ë¯¸ë””ì–´ ì„œë¹„ìŠ¤</h3>

            <h4>3.1.1 media.player (MediaPlayerService)</h4>
            <pre><code># ì „ì²´ ë¤í”„
adb shell dumpsys media.player

# ì¶œë ¥ ì˜ˆì‹œ:
# MediaPlayerService:
#   Clients:
#     pid(1234) uid(10123) connId(5)
#       IMediaPlayer[OMX.qcom.video.decoder.avc]
#         state: started
#         position: 125300 ms
#         duration: 300000 ms</code></pre>

            <div class="info-box">
                <strong>ì£¼ìš” ì •ë³´:</strong>
                <ul>
                    <li><strong>Clients</strong>: í˜„ì¬ ì¬ìƒ ì¤‘ì¸ í´ë¼ì´ì–¸íŠ¸ ëª©ë¡</li>
                    <li><strong>state</strong>: idle/prepared/started/paused/stopped</li>
                    <li><strong>Audio routing</strong>: ì¶œë ¥ ë””ë°”ì´ìŠ¤ (speaker/headset/bluetooth)</li>
                </ul>
            </div>

            <h4>3.1.2 media.codec (MediaCodecService)</h4>
            <pre><code># Codec ë¦¬ìŠ¤íŠ¸ ë° Capabilities
adb shell dumpsys media.codec

# ì¶œë ¥ ì˜ˆì‹œ (ì¼ë¶€):
# Decoder: OMX.qcom.video.decoder.avc (video/avc)
#   Max instances: 4
#   Current instances: 1
#   Supported sizes: 64x64 ~ 3840x2160
#   Frame rates: 1fps ~ 240fps
#   Color formats: YUV420Flexible, YUV420Planar</code></pre>

            <h4>íŠ¹ì • ì½”ë± ê²€ìƒ‰</h4>
            <pre><code># H.264 ë””ì½”ë”ë§Œ
adb shell dumpsys media.codec | grep -A 20 "video/avc.*decoder"

# H.265 ì¸ì½”ë”ë§Œ
adb shell dumpsys media.codec | grep -A 20 "video/hevc.*encoder"</code></pre>

            <h4>3.1.3 media.audio_flinger (AudioFlinger)</h4>
            <pre><code># AudioFlinger ì „ì²´ ìƒíƒœ
adb shell dumpsys media.audio_flinger

# ì¶œë ¥ êµ¬ì¡°:
# - Hardware status (HAL ìƒíƒœ)
# - Playback threads (ê° ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼)
# - Active tracks (í˜„ì¬ ì¬ìƒ ì¤‘ì¸ íŠ¸ë™)
# - FastMixer status (ì €ì§€ì—° ë¯¹ì„œ)
# - Global effects (ì´í€„ë¼ì´ì €, ë¦¬ë²„ë¸Œ ë“±)</code></pre>

            <div class="success-box">
                <strong>âœ… í™œìš© ì˜ˆì‹œ: Audio glitch ë””ë²„ê¹…</strong>
                <pre><code># FastMixer ìƒíƒœ í™•ì¸
adb shell dumpsys media.audio_flinger | grep -A 50 "FastMixer"

# ì¶œë ¥ ë¶„ì„:
# - underruns: 0 â†’ ì •ìƒ
# - underruns: 152 â†’ Buffer underrun ë°œìƒ (glitch ì›ì¸)</code></pre>
            </div>

            <h4>3.1.4 media.audio_policy (AudioPolicyService)</h4>
            <pre><code># Audio ë¼ìš°íŒ… ì •ì±…
adb shell dumpsys media.audio_policy

# ì£¼ìš” ì •ë³´:
# - Available audio devices (ì‚¬ìš© ê°€ëŠ¥í•œ ì¶œë ¥ ì¥ì¹˜)
# - Audio streams (MUSIC, ALARM, NOTIFICATION ë“±)
# - Volume curves (ë³¼ë¥¨ ê³¡ì„ )
# - Audio focus stack (í˜„ì¬ í¬ì»¤ìŠ¤ ì†Œìœ ì)</code></pre>

            <h3>3.2 Automotive (AAOS) ì„œë¹„ìŠ¤</h3>

            <table>
                <thead>
                    <tr>
                        <th>ì„œë¹„ìŠ¤</th>
                        <th>ëª…ë ¹ì–´</th>
                        <th>ì£¼ìš” ì •ë³´</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>CarMediaService</strong></td>
                        <td><code>dumpsys car_service --services CarMediaService</code></td>
                        <td>Last media source, autoplay ìƒíƒœ</td>
                    </tr>
                    <tr>
                        <td><strong>CarAudioService</strong></td>
                        <td><code>dumpsys car_service --services CarAudioService</code></td>
                        <td>Audio zones, volume groups, ducking</td>
                    </tr>
                    <tr>
                        <td><strong>VehicleHal</strong></td>
                        <td><code>dumpsys android.hardware.automotive.vehicle@2.0::IVehicle/default</code></td>
                        <td>Vehicle properties (speed, gear, etc.)</td>
                    </tr>
                    <tr>
                        <td><strong>CarInputService</strong></td>
                        <td><code>dumpsys car_service --services CarInputService</code></td>
                        <td>Key event routing, inject events</td>
                    </tr>
                    <tr>
                        <td><strong>CarPowerManagement</strong></td>
                        <td><code>dumpsys car_service --services CarPowerManagementService</code></td>
                        <td>Power state, suspend listeners</td>
                    </tr>
                </tbody>
            </table>

            <h4>CarMediaService ìƒì„¸</h4>
            <pre><code># Last media source í™•ì¸
adb shell dumpsys car_service --services CarMediaService | grep "last.*source"

# ì¶œë ¥ ì˜ˆì‹œ:
# mPrimaryMediaSource: [MediaSource:
#   packageName=com.spotify.music
#   className=com.spotify.music.MusicService]

# Autoplay ì„¤ì •
# mPlayOnBootConfiguration: RETAIN
# mPlayOnMediaSourceChanged: ENABLE</code></pre>

            <h3>3.3 MediaSession</h3>
            <pre><code># ì „ì²´ ì„¸ì…˜ ë¦¬ìŠ¤íŠ¸
adb shell dumpsys media_session

# ì¶œë ¥ êµ¬ì¡°:
# Sessions Stack:
#   User 0:
#     - com.spotify.music/MediaSessionService (priority: 100, active: true)
#       controller: PendingIntent{...}
#       metadata: {title=Song Name, artist=Artist Name, ...}
#       playbackState: {state=3(PLAYING), position=45123, ...}</code></pre>

            <div class="tool-card">
                <h4>íŠ¹ì • ì•±ì˜ MediaSessionë§Œ í•„í„°ë§</h4>
                <pre><code>adb shell dumpsys media_session | grep -A 30 "com.spotify.music"</code></pre>
            </div>

            <h3>3.4 DRM ê´€ë ¨</h3>
            <pre><code># MediaDrm í”ŒëŸ¬ê·¸ì¸
adb shell dumpsys media.drm

# ì¶œë ¥:
# Drm Plugins:
#   Plugin: libwvdrmengine.so (Widevine CDM)
#     UUID: edef8ba9-79d6-4ace-a3c8-27dcd51d21ed
#     Description: Widevine Content Decryption Module
#     Algorithms: AES/CBC/NoPadding
#   Plugin: libclearkeydrmengine.so (ClearKey)
#     UUID: e2719d58-a985-b3c9-781a-b030af78d30e</code></pre>

            <h3>3.5 ì¢…í•© ìŠ¤í¬ë¦½íŠ¸</h3>
            <pre><code>#!/bin/bash
# media_debug_dump.sh - ë¯¸ë””ì–´ ë””ë²„ê¹… ì¢…í•© ë¤í”„

TIMESTAMP=$(date +%Y%m%d_%H%M%S)
OUTPUT_DIR="media_dump_${TIMESTAMP}"
mkdir -p "${OUTPUT_DIR}"

echo "ğŸ” Collecting media debugging data..."

# 1. logcat (ìµœê·¼ 1000ì¤„)
adb logcat -t 1000 > "${OUTPUT_DIR}/logcat.txt"

# 2. dumpsys ì „ì²´
adb shell dumpsys media.player > "${OUTPUT_DIR}/media.player.txt"
adb shell dumpsys media.codec > "${OUTPUT_DIR}/media.codec.txt"
adb shell dumpsys media.audio_flinger > "${OUTPUT_DIR}/audio_flinger.txt"
adb shell dumpsys media.audio_policy > "${OUTPUT_DIR}/audio_policy.txt"
adb shell dumpsys media_session > "${OUTPUT_DIR}/media_session.txt"

# 3. Car services (AAOS only)
adb shell dumpsys car_service > "${OUTPUT_DIR}/car_service.txt" 2>/dev/null

# 4. í”„ë¡œì„¸ìŠ¤ ì •ë³´
adb shell ps -A | grep -E "media|audio" > "${OUTPUT_DIR}/processes.txt"

# 5. ë©”ëª¨ë¦¬
adb shell dumpsys meminfo com.example.mediaplayer > "${OUTPUT_DIR}/meminfo.txt"

# ì••ì¶•
tar -czf "${OUTPUT_DIR}.tar.gz" "${OUTPUT_DIR}"
echo "âœ… Done: ${OUTPUT_DIR}.tar.gz"</code></pre>
        </section>

        <!-- Section 4: perfetto / systrace -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">04</span>4. perfetto / systrace íŠ¸ë ˆì´ì‹±</h2>

            <p><strong>perfetto</strong>ëŠ” Android 10+ì˜ ì°¨ì„¸ëŒ€ ì‹œìŠ¤í…œ íŠ¸ë ˆì´ì‹± ë„êµ¬ë¡œ, ê¸°ì¡´ systraceë¥¼ ëŒ€ì²´í•©ë‹ˆë‹¤. ë¯¸ë””ì–´ íŒŒì´í”„ë¼ì¸ì˜ <strong>íƒ€ì„ë¼ì¸ ë ˆë²¨ ë¶„ì„</strong>ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

            <h3>4.1 perfetto vs systrace ë¹„êµ</h3>
            <table>
                <thead>
                    <tr>
                        <th>íŠ¹ì„±</th>
                        <th>perfetto (Android 10+)</th>
                        <th>systrace (Legacy)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ì¶œë ¥ í˜•ì‹</td>
                        <td>Protobuf (binary)</td>
                        <td>HTML (í…ìŠ¤íŠ¸)</td>
                    </tr>
                    <tr>
                        <td>íŒŒì¼ í¬ê¸°</td>
                        <td>ì‘ìŒ (ì••ì¶•)</td>
                        <td>í¼ (ë¹„ì••ì¶•)</td>
                    </tr>
                    <tr>
                        <td>ë·°ì–´</td>
                        <td>ui.perfetto.dev (ì›¹)</td>
                        <td>chrome://tracing</td>
                    </tr>
                    <tr>
                        <td>ê¸°ëŠ¥</td>
                        <td>CPU, GPU, Memory, Power</td>
                        <td>CPU, ftraceë§Œ</td>
                    </tr>
                    <tr>
                        <td>ê¶Œì¥</td>
                        <td>âœ… Android 10+ í•„ìˆ˜</td>
                        <td>âš ï¸ Android 9 ì´í•˜ë§Œ</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.2 perfetto ê¸°ë³¸ ì‚¬ìš©ë²•</h3>

            <h4>4.2.1 ì„¤ì¹˜ (PC)</h4>
            <pre><code># Linux / macOS
curl -O https://get.perfetto.dev/perfetto
chmod +x perfetto
sudo mv perfetto /usr/local/bin/

# ë˜ëŠ” AOSP ë¹Œë“œ í™˜ê²½ì—ì„œ
source build/envsetup.sh
lunch aosp_cf_x86_64_phone-userdebug
perfetto --help</code></pre>

            <h4>4.2.2 ë¯¸ë””ì–´ íŠ¸ë ˆì´ì‹± ì„¤ì •</h4>
            <pre><code># config.pbtx (perfetto ì„¤ì • íŒŒì¼)
cat > media_trace_config.pbtx << 'EOF'
# íŠ¸ë ˆì´ìŠ¤ ì§€ì† ì‹œê°„: 10ì´ˆ
duration_ms: 10000

buffers {
  size_kb: 65536  # 64MB ë²„í¼
  fill_policy: RING_BUFFER
}

# ftrace (Kernel events)
data_sources {
  config {
    name: "linux.ftrace"
    ftrace_config {
      # Scheduler (CPU)
      ftrace_events: "sched/sched_switch"
      ftrace_events: "sched/sched_wakeup"

      # Binder IPC
      ftrace_events: "binder/binder_transaction"
      ftrace_events: "binder/binder_transaction_received"

      # Graphics
      ftrace_events: "fence/fence_wait_start"
      ftrace_events: "fence/fence_wait_end"
    }
  }
}

# atrace (Android Framework)
data_sources {
  config {
    name: "linux.ftrace"
    ftrace_config {
      atrace_categories: "video"
      atrace_categories: "audio"
      atrace_categories: "camera"
      atrace_categories: "gfx"
      atrace_categories: "view"
      atrace_categories: "am"  # ActivityManager
      atrace_categories: "dalvik"
      atrace_apps: "com.example.mediaplayer"
    }
  }
}

# Process stats
data_sources {
  config {
    name: "linux.process_stats"
    process_stats_config {
      scan_all_processes_on_start: true
    }
  }
}
EOF</code></pre>

            <h4>4.2.3 íŠ¸ë ˆì´ìŠ¤ ìº¡ì²˜</h4>
            <pre><code># Method 1: ì„¤ì • íŒŒì¼ ì‚¬ìš© (ê¶Œì¥)
adb shell perfetto \
  -c - --txt \
  -o /data/misc/perfetto-traces/media_trace.perfetto-trace \
  < media_trace_config.pbtx

# Method 2: ì»¤ë§¨ë“œë¼ì¸ í”Œë˜ê·¸ (ê°„ë‹¨í•œ ê²½ìš°)
adb shell perfetto \
  -o /data/misc/perfetto-traces/trace.perfetto-trace \
  -t 10s \
  sched freq idle am wm gfx view binder_driver \
  video audio camera

# PCë¡œ ë‹¤ìš´ë¡œë“œ
adb pull /data/misc/perfetto-traces/media_trace.perfetto-trace ./

# ì›¹ ë·°ì–´ì—ì„œ ì—´ê¸°
# https://ui.perfetto.dev ì ‘ì† â†’ Open trace file</code></pre>

            <div class="info-box">
                <strong>ğŸ’¡ Tip: ì‹¤ì‹œê°„ íŠ¸ë ˆì´ì‹±</strong>
                <p>perfettoëŠ” <code>traced</code> ë°ëª¬ì´ í•­ìƒ ì‹¤í–‰ë˜ë¯€ë¡œ ì¦‰ì‹œ ìº¡ì²˜ ê°€ëŠ¥:</p>
                <pre><code># ì•± ì‹¤í–‰ ì§ì „ì— íŠ¸ë ˆì´ìŠ¤ ì‹œì‘
adb shell perfetto -o /data/misc/perfetto-traces/trace.pb -t 10s video audio &
# ì•± ì‹¤í–‰
adb shell am start -n com.example.app/.MainActivity
# 10ì´ˆ ëŒ€ê¸° í›„ ìë™ ì¢…ë£Œ</code></pre>
            </div>

            <h3>4.3 ë¯¸ë””ì–´ íŠ¸ë ˆì´ìŠ¤ ë¶„ì„</h3>

            <h4>4.3.1 ì£¼ìš” í™•ì¸ í¬ì¸íŠ¸</h4>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>â‘  CPU ìŠ¤ì¼€ì¤„ë§</h4>
                    <p><strong>Thread States</strong> íŠ¸ë™ì—ì„œ:</p>
                    <ul>
                        <li>ğŸŸ¢ <strong>Running</strong>: CPU ì‹¤í–‰ ì¤‘</li>
                        <li>ğŸŸ¡ <strong>Runnable</strong>: ì‹¤í–‰ ëŒ€ê¸° (CPU ê²½í•©)</li>
                        <li>ğŸ”´ <strong>Sleeping</strong>: I/O ëŒ€ê¸°</li>
                    </ul>
                </div>

                <div class="tool-card">
                    <h4>â‘¡ MediaCodec íŒŒì´í”„ë¼ì¸</h4>
                    <p><code>video</code> ì¹´í…Œê³ ë¦¬ì—ì„œ:</p>
                    <ul>
                        <li><code>C2SoftAvcDec::process</code></li>
                        <li><code>dequeueInputBuffer</code></li>
                        <li><code>queueInputBuffer</code></li>
                        <li><code>dequeueOutputBuffer</code></li>
                    </ul>
                </div>

                <div class="tool-card">
                    <h4>â‘¢ AudioFlinger ë¯¹ì‹±</h4>
                    <p><code>audio</code> ì¹´í…Œê³ ë¦¬ì—ì„œ:</p>
                    <ul>
                        <li><code>AudioMixer::process</code></li>
                        <li><code>FastMixer::threadLoop</code></li>
                        <li><code>write</code> (HAL í˜¸ì¶œ)</li>
                    </ul>
                </div>

                <div class="tool-card">
                    <h4>â‘£ Binder IPC</h4>
                    <p><code>binder_driver</code> ì¹´í…Œê³ ë¦¬:</p>
                    <ul>
                        <li>Transaction ì§€ì—° (>100ms ê²½ê³ )</li>
                        <li>ë™ê¸° í˜¸ì¶œ vs ë¹„ë™ê¸° í˜¸ì¶œ</li>
                    </ul>
                </div>
            </div>

            <h4>4.3.2 Frame Drop ë¶„ì„ ì˜ˆì‹œ</h4>
            <pre><code># 1. íŠ¸ë ˆì´ìŠ¤ì—ì„œ "Choreographer#doFrame" ê²€ìƒ‰
# 2. Frame íƒ€ì„ë¼ì¸ í™•ì¸:
#    - ì •ìƒ: 16.6ms ê°„ê²© (60fps)
#    - Frame drop: >33ms ê°„ê²© (í”„ë ˆì„ ìŠ¤í‚µ)
#
# 3. ì›ì¸ ì¶”ì :
#    - UI Thread ë¸”ë¡? â†’ Main Threadì—ì„œ ê¸´ ì‘ì—…
#    - RenderThread ì§€ì—°? â†’ GPU ì˜¤ë²„ë¡œë“œ
#    - MediaCodec ì§€ì—°? â†’ dequeueOutputBuffer íƒ€ì„ì•„ì›ƒ</code></pre>

            <div class="mermaid">
sequenceDiagram
    participant App as App Thread
    participant Codec as MediaCodec
    participant HAL as Codec2 HAL
    participant HW as Hardware Decoder

    Note over App,HW: perfetto trace timeline â†’

    App->>Codec: dequeueInputBuffer()
    activate Codec
    Codec-->>App: inputBufferId
    deactivate Codec

    App->>Codec: queueInputBuffer(data)
    activate Codec
    Codec->>HAL: C2Work (input buffer)
    activate HAL
    HAL->>HW: DMA transfer
    activate HW
    HW-->>HAL: decode done
    deactivate HW
    HAL-->>Codec: C2Work (output buffer)
    deactivate HAL
    deactivate Codec

    App->>Codec: dequeueOutputBuffer()
    activate Codec
    Note right of Codec: âš ï¸ ë§Œì•½ HALì´ ëŠ¦ìœ¼ë©´<br/>ì—¬ê¸°ì„œ TIMEOUT
    Codec-->>App: outputBufferId
    deactivate Codec

    App->>Codec: releaseOutputBuffer(render=true)
    activate Codec
    Codec->>App: renderOutputBuffer (SurfaceFlinger)
    deactivate Codec
            </div>

            <h3>4.4 systrace (Legacy - Android 9 ì´í•˜)</h3>
            <pre><code># AOSP í™˜å¢ƒ
cd $ANDROID_BUILD_TOP
python systrace.py --time=10 -o trace.html \
  sched freq idle am wm gfx view binder_driver hal \
  video audio camera

# ë˜ëŠ” ê°„ë‹¨ ë²„ì „
adb shell atrace --async_start -b 32768 sched gfx view video audio
# ... ì¬í˜„ ...
adb shell atrace --async_stop > trace.txt
# chrome://tracingì—ì„œ ì—´ê¸°</code></pre>

            <h3>4.5 ê³ ê¸‰: Custom Trace Points</h3>
            <pre><code>// Kotlin/Java
import android.os.Trace

class MyMediaPlayer {
    fun decodeFrame() {
        Trace.beginSection("MyMediaPlayer::decodeFrame")
        try {
            // decode logic
        } finally {
            Trace.endSection()
        }
    }
}</code></pre>

            <pre><code>// C++ (Native)
#include <cutils/trace.h>

void decodeFrame() {
    ATRACE_CALL();  // í•¨ìˆ˜ ì´ë¦„ ìë™
    // ë˜ëŠ”
    ATRACE_BEGIN("decodeFrame");
    // decode logic
    ATRACE_END();
}</code></pre>

            <div class="success-box">
                <strong>âœ… ì´ì œ perfettoì—ì„œ "MyMediaPlayer::decodeFrame" ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤!</strong>
            </div>
        </section>

        <!-- Section 5: adb ë¯¸ë””ì–´ ë””ë²„ê¹… -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">05</span>5. adb ë¯¸ë””ì–´ ë””ë²„ê¹… ëª…ë ¹ì–´</h2>

            <p>adb shellì„ í†µí•´ ë””ë°”ì´ìŠ¤ì—ì„œ ì§ì ‘ ë””ë²„ê¹… ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <h3>5.1 MediaPlayer ì œì–´</h3>

            <h4>ë¯¸ë””ì–´ ì¬ìƒ í…ŒìŠ¤íŠ¸</h4>
            <pre><code># ë¡œì»¬ íŒŒì¼ ì¬ìƒ
adb shell am start -a android.intent.action.VIEW \
  -d file:///sdcard/test.mp4 \
  -t video/mp4

# HTTP ìŠ¤íŠ¸ë¦¬ë°
adb shell am start -a android.intent.action.VIEW \
  -d "http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"

# Intentë¡œ íŠ¹ì • ì•± ì‹¤í–‰
adb shell am start -n com.google.android.apps.youtube.music/.MainActivity</code></pre>

            <h4>ë¯¸ë””ì–´ í‚¤ ì´ë²¤íŠ¸ ì£¼ì…</h4>
            <pre><code># Play/Pause
adb shell input keyevent KEYCODE_MEDIA_PLAY_PAUSE  # 85

# Play
adb shell input keyevent KEYCODE_MEDIA_PLAY  # 126

# Pause
adb shell input keyevent KEYCODE_MEDIA_PAUSE  # 127

# Next
adb shell input keyevent KEYCODE_MEDIA_NEXT  # 87

# Previous
adb shell input keyevent KEYCODE_MEDIA_PREVIOUS  # 88

# Stop
adb shell input keyevent KEYCODE_MEDIA_STOP  # 86

# Volume Up/Down
adb shell input keyevent KEYCODE_VOLUME_UP  # 24
adb shell input keyevent KEYCODE_VOLUME_DOWN  # 25</code></pre>

            <div class="tool-card">
                <h4>ìë™í™” ìŠ¤í¬ë¦½íŠ¸</h4>
                <pre><code>#!/bin/bash
# test_media_keys.sh

echo "Testing media keys..."
adb shell input keyevent KEYCODE_MEDIA_PLAY
sleep 2
adb shell input keyevent KEYCODE_MEDIA_PAUSE
sleep 1
adb shell input keyevent KEYCODE_MEDIA_NEXT
echo "Done"</code></pre>
            </div>

            <h3>5.2 íŒŒì¼ ì‹œìŠ¤í…œ íƒìƒ‰</h3>

            <h4>ë¯¸ë””ì–´ íŒŒì¼ ê²€ìƒ‰</h4>
            <pre><code># ì „ì²´ ë¯¸ë””ì–´ íŒŒì¼ (MP4, MKV, MP3 ë“±)
adb shell find /sdcard -type f \( -name "*.mp4" -o -name "*.mkv" -o -name "*.mp3" \)

# íŠ¹ì • ë””ë ‰í† ë¦¬
adb shell ls -lh /sdcard/Music/
adb shell ls -lh /sdcard/Movies/

# MediaProvider DB ì§ì ‘ ì¿¼ë¦¬
adb shell content query --uri content://media/external/video/media \
  --projection _id,_data,title,duration</code></pre>

            <h4>íŒŒì¼ ì „ì†¡</h4>
            <pre><code># PC â†’ ë””ë°”ì´ìŠ¤
adb push test.mp4 /sdcard/Download/

# ë””ë°”ì´ìŠ¤ â†’ PC
adb pull /sdcard/Download/test.mp4 ./

# ëŒ€ìš©ëŸ‰ íŒŒì¼ (ì§„í–‰ë¥  í‘œì‹œ)
adb push large_video.mp4 /sdcard/ | pv</code></pre>

            <h3>5.3 Codec ì •ë³´ ì¡°íšŒ</h3>
            <pre><code># MediaCodecList ì „ì²´ ì¶œë ¥
adb shell am broadcast -a android.media.action.QUERY_CODEC_SUPPORT

# ë˜ëŠ” ì§ì ‘ í´ë˜ìŠ¤ í˜¸ì¶œ
adb shell cmd media_codec list

# ì¶œë ¥ ì˜ˆì‹œ:
# Decoders:
#   OMX.qcom.video.decoder.avc (video/avc)
#     Supported sizes: 64x64 - 3840x2160
#     Color formats: 0x7f000789, 0x13
#   c2.android.avc.decoder (video/avc)
#     ...</code></pre>

            <h3>5.4 Audio ë¼ìš°íŒ…</h3>

            <h4>ì¶œë ¥ ì¥ì¹˜ í™•ì¸</h4>
            <pre><code># í˜„ì¬ ì˜¤ë””ì˜¤ ì¥ì¹˜
adb shell dumpsys audio | grep "Devices:"

# ì¶œë ¥ ì˜ˆì‹œ:
# - device:0x2 (SPEAKER)
# - device:0x4 (WIRED_HEADSET)
# - device:0x80 (BLUETOOTH_A2DP)

# Bluetooth ì¥ì¹˜ ê°•ì œ ì—°ê²°
adb shell cmd bluetooth_manager connect-audio <device_mac></code></pre>

            <h4>ë³¼ë¥¨ ì œì–´</h4>
            <pre><code># í˜„ì¬ ë³¼ë¥¨ í™•ì¸
adb shell dumpsys audio | grep "STREAM_MUSIC"

# ì¶œë ¥ ì˜ˆì‹œ:
# - STREAM_MUSIC:
#     Current: 8 (range: 0..15)

# ë³¼ë¥¨ ì„¤ì • (0~15)
adb shell media volume --stream 3 --set 10
# stream 3 = STREAM_MUSIC</code></pre>

            <h3>5.5 DRM / ë³´ì•ˆ</h3>
            <pre><code># Widevine ë³´ì•ˆ ë ˆë²¨ í™•ì¸
adb shell getprop drm.service.enabled  # true/false
adb shell getprop ro.vendor.mtk_widevine_drm_level  # L1/L3 (Vendor specific)

# ClearKey DRM í…ŒìŠ¤íŠ¸
adb shell am start -a android.intent.action.VIEW \
  -d "https://storage.googleapis.com/shaka-demo-assets/angel-one-clearkey/dash.mpd"</code></pre>

            <h3>5.6 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</h3>

            <h4>CPU ì‚¬ìš©ë¥  (ì‹¤ì‹œê°„)</h4>
            <pre><code># ì „ì²´ í”„ë¡œì„¸ìŠ¤
adb shell top -m 10

# íŠ¹ì • ì•±ë§Œ
adb shell top -p $(adb shell pidof com.example.mediaplayer)</code></pre>

            <h4>ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </h4>
            <pre><code># ì•±ë³„ ë©”ëª¨ë¦¬
adb shell dumpsys meminfo com.example.mediaplayer

# ì¶œë ¥ ì£¼ìš” í•­ëª©:
# - Native Heap: 45MB (MediaCodec ë²„í¼)
# - Graphics: 120MB (SurfaceFlinger)
# - Total PSS: 180MB</code></pre>

            <h4>GPU ë Œë”ë§ í”„ë¡œíŒŒì¼</h4>
            <pre><code># GPU ë Œë”ë§ í”„ë¡œíŒŒì¼ í™œì„±í™”
adb shell setprop debug.hwui.profile true
adb shell setprop debug.hwui.profile.maxframes 128

# ì•± ì¬ì‹œì‘ í›„ ë¤í”„
adb shell dumpsys gfxinfo com.example.mediaplayer

# ì¶œë ¥: ê° í”„ë ˆì„ì˜ Draw/Process/Execute ì‹œê°„</code></pre>

            <h3>5.7 Automotive (AAOS) ì „ìš©</h3>

            <h4>Vehicle Property ì½ê¸°/ì“°ê¸°</h4>
            <pre><code># Vehicle Speed ì½ê¸°
adb shell dumpsys android.hardware.automotive.vehicle@2.0::IVehicle/default \
  --get PERF_VEHICLE_SPEED

# Gear Selection
adb shell dumpsys android.hardware.automotive.vehicle@2.0::IVehicle/default \
  --get GEAR_SELECTION

# Property ì£¼ì… (í…ŒìŠ¤íŠ¸ ëª©ì )
adb shell cmd car_service inject-vhal-event PERF_VEHICLE_SPEED 50</code></pre>

            <h4>Car Audio Zone í…ŒìŠ¤íŠ¸</h4>
            <pre><code># Primary zone ë³¼ë¥¨ ì„¤ì •
adb shell cmd car_service set-audio-zone-volume 0 1 10
# zone=0 (primary), group=1 (music), volume=10

# Rear zone ë³¼ë¥¨
adb shell cmd car_service set-audio-zone-volume 1 1 5</code></pre>

            <h3>5.8 ì¢…í•© ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</h3>
            <pre><code>#!/bin/bash
# real_time_monitor.sh - ë¯¸ë””ì–´ ì•± ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

PACKAGE="com.example.mediaplayer"
PID=$(adb shell pidof "$PACKAGE")

if [ -z "$PID" ]; then
    echo "âŒ App not running: $PACKAGE"
    exit 1
fi

echo "ğŸ“± Monitoring: $PACKAGE (PID: $PID)"
echo "-----------------------------------"

while true; do
    clear
    echo "=== $(date) ==="

    # CPU %
    CPU=$(adb shell top -n 1 -p "$PID" | tail -1 | awk '{print $9}')
    echo "CPU: ${CPU}%"

    # Memory (PSS)
    PSS=$(adb shell dumpsys meminfo "$PID" | grep TOTAL | awk '{print $2}')
    echo "Memory: ${PSS} KB"

    # Audio Focus
    FOCUS=$(adb shell dumpsys media_session | grep -A 5 "$PACKAGE" | grep "playbackState")
    echo "Playback: $FOCUS"

    sleep 2
done</code></pre>
        </section>

        <!-- Section 6: Android Studio Profiler -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">06</span>6. Android Studio Profiler</h2>

            <p>Android Studioì˜ <strong>Profiler</strong>ëŠ” ì‹¤ì‹œê°„ GUI ê¸°ë°˜ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ë¡œ, CPU/Memory/Network/Energyë¥¼ ë™ì‹œì— ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <h3>6.1 Profiler ì‹œì‘</h3>
            <ol>
                <li><strong>View â†’ Tool Windows â†’ Profiler</strong> ì„ íƒ</li>
                <li>ì—°ê²°ëœ ë””ë°”ì´ìŠ¤ì—ì„œ ì•± í”„ë¡œì„¸ìŠ¤ ì„ íƒ</li>
                <li>4ê°œ íƒ€ì„ë¼ì¸ ìë™ í‘œì‹œ: CPU, Memory, Network, Energy</li>
            </ol>

            <div class="info-box">
                <strong>ğŸ’¡ Tip: Debuggable Build</strong>
                <p>ì •í™•í•œ í”„ë¡œíŒŒì¼ë§ì„ ìœ„í•´ <code>build.gradle</code>ì—ì„œ:</p>
                <pre><code>android {
    buildTypes {
        debug {
            debuggable true
            minifyEnabled false
        }
    }
}</code></pre>
            </div>

            <h3>6.2 CPU Profiler</h3>

            <h4>6.2.1 Trace ì¢…ë¥˜</h4>
            <table>
                <thead>
                    <tr>
                        <th>Trace Type</th>
                        <th>ì˜¤ë²„í—¤ë“œ</th>
                        <th>ìš©ë„</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Sample Java Methods</strong></td>
                        <td>ë‚®ìŒ (~5%)</td>
                        <td>ì „ì²´ CPU ì‚¬ìš©ë¥  ê°œìš”</td>
                    </tr>
                    <tr>
                        <td><strong>Trace Java Methods</strong></td>
                        <td>ë†’ìŒ (~30%)</td>
                        <td>ëª¨ë“  ë©”ì†Œë“œ í˜¸ì¶œ ê¸°ë¡ (ì •í™•)</td>
                    </tr>
                    <tr>
                        <td><strong>Sample C/C++ Functions</strong></td>
                        <td>ë‚®ìŒ</td>
                        <td>Native ì½”ë“œ í”„ë¡œíŒŒì¼ë§</td>
                    </tr>
                    <tr>
                        <td><strong>Trace System Calls</strong></td>
                        <td>ë§¤ìš° ë†’ìŒ</td>
                        <td>Binder/I/O í˜¸ì¶œ ì¶”ì </td>
                    </tr>
                </tbody>
            </table>

            <h4>6.2.2 ë¯¸ë””ì–´ ì•± ë¶„ì„ ì˜ˆì‹œ</h4>
            <div class="success-box">
                <strong>âœ… ì‹œë‚˜ë¦¬ì˜¤: ExoPlayer ë²„í¼ë§ ì§€ì—°</strong>
                <ol>
                    <li><strong>Record</strong> ë²„íŠ¼ í´ë¦­ â†’ "Sample Java Methods" ì„ íƒ</li>
                    <li>ì•±ì—ì„œ ë¹„ë””ì˜¤ ì¬ìƒ â†’ ë²„í¼ë§ ë°œìƒ</li>
                    <li><strong>Stop</strong> ë²„íŠ¼ í´ë¦­</li>
                    <li><strong>Flame Chart</strong>ì—ì„œ ë¶„ì„:
                        <ul>
                            <li><code>ExoPlayerImpl.handleMessage()</code>: 45% CPU</li>
                            <li><code>MediaCodecRenderer.render()</code>: 30% CPU</li>
                            <li><code>DefaultLoadControl.shouldContinueLoading()</code>: 10% CPU</li>
                        </ul>
                    </li>
                    <li><strong>ê²°ë¡ </strong>: <code>handleMessage</code>ì—ì„œ ê³¼ë„í•œ ì‹œê°„ ì†Œëª¨ â†’ UI Thread ë¸”ë¡ ì˜ì‹¬</li>
                </ol>
            </div>

            <h4>6.2.3 Thread ë¶„ì„</h4>
            <p>ProfilerëŠ” ëª¨ë“  Threadë¥¼ ê°œë³„ íŠ¸ë™ìœ¼ë¡œ í‘œì‹œ:</p>
            <ul>
                <li><strong>main</strong>: UI Thread (16ms ì´ë‚´ ì™„ë£Œ ê¶Œì¥)</li>
                <li><strong>ExoPlayer:Playback</strong>: ExoPlayer ì¬ìƒ ìŠ¤ë ˆë“œ</li>
                <li><strong>ExoPlayer:Loader:Progressive</strong>: ë‹¤ìš´ë¡œë“œ ìŠ¤ë ˆë“œ</li>
                <li><strong>RenderThread</strong>: GPU ë Œë”ë§</li>
            </ul>

            <div class="warning-box">
                <strong>âš ï¸ Main Threadì—ì„œ I/O ê¸ˆì§€</strong>
                <p>ë§Œì•½ main Threadì—ì„œ <code>MediaExtractor.readSampleData()</code> ê°™ì€ I/O í˜¸ì¶œì´ ë³´ì´ë©´ ì¦‰ì‹œ Background Threadë¡œ ì´ë™í•´ì•¼ í•©ë‹ˆë‹¤.</p>
            </div>

            <h3>6.3 Memory Profiler</h3>

            <h4>6.3.1 ë©”ëª¨ë¦¬ íƒ€ì„ë¼ì¸</h4>
            <ul>
                <li><strong>Java Heap</strong>: Java ê°ì²´ ë©”ëª¨ë¦¬</li>
                <li><strong>Native Heap</strong>: MediaCodec ë²„í¼ ë“±</li>
                <li><strong>Graphics</strong>: Texture, SurfaceFlinger ë²„í¼</li>
                <li><strong>Stack</strong>: Thread ìŠ¤íƒ</li>
                <li><strong>Code</strong>: APK ì½”ë“œ ë©”ëª¨ë¦¬</li>
            </ul>

            <h4>6.3.2 Heap Dump ë¶„ì„</h4>
            <pre><code>1. ë©”ëª¨ë¦¬ ê¸‰ì¦ êµ¬ê°„ ì„ íƒ
2. "Dump Java heap" ë²„íŠ¼ í´ë¦­
3. Heap dump (.hprof) ìë™ ìƒì„±
4. Instance Viewì—ì„œ í° ê°ì²´ ê²€ìƒ‰:
   - ByteBuffer[] (ì½”ë± ë²„í¼)
   - Bitmap[] (ì¸ë„¤ì¼)
   - ArrayList<MediaItem> (í”Œë ˆì´ë¦¬ìŠ¤íŠ¸)</code></pre>

            <div class="error-box">
                <strong>ğŸ”´ Memory Leak íƒì§€</strong>
                <p>ë¹„ë””ì˜¤ ì¬ìƒ í›„ Activity ì¢…ë£Œ â†’ Heap dump ìƒì„± â†’ Activity ì¸ìŠ¤í„´ìŠ¤ê°€ ë‚¨ì•„ìˆìœ¼ë©´ Leak!</p>
                <pre><code>// Leak ì˜ˆì‹œ
class VideoActivity : AppCompatActivity() {
    companion object {
        var player: ExoPlayer? = null  // âŒ Static ë³€ìˆ˜ì— ì €ì¥ (Leak!)
    }
}</code></pre>
            </div>

            <h3>6.4 Network Profiler</h3>

            <h4>HTTP ìŠ¤íŠ¸ë¦¬ë° ë¶„ì„</h4>
            <p>Network ProfilerëŠ” ëª¨ë“  HTTP/HTTPS ìš”ì²­ì„ ìº¡ì²˜:</p>
            <ul>
                <li><strong>Timeline</strong>: ì´ˆë‹¹ ì „ì†¡/ìˆ˜ì‹  ë°”ì´íŠ¸</li>
                <li><strong>Connection View</strong>: ê° ìš”ì²­ì˜ URL, Size, Duration</li>
                <li><strong>Response</strong>: HTTP í—¤ë” ë° ë°”ë”” (ìµœëŒ€ 1MB)</li>
            </ul>

            <div class="tool-card">
                <h4>HLS/DASH ìŠ¤íŠ¸ë¦¬ë° ë””ë²„ê¹…</h4>
                <ol>
                    <li>Network Profilerì—ì„œ <code>.m3u8</code> ë˜ëŠ” <code>.mpd</code> ìš”ì²­ ì°¾ê¸°</li>
                    <li>Response íƒ­ì—ì„œ Manifest ë‚´ìš© í™•ì¸</li>
                    <li>ê° Segment ìš”ì²­ì˜ Duration í™•ì¸ (>2ì´ˆë©´ ë„¤íŠ¸ì›Œí¬ ë³‘ëª©)</li>
                </ol>
            </div>

            <h3>6.5 Energy Profiler</h3>
            <p>ë°°í„°ë¦¬ ì†Œëª¨ëŸ‰ì„ ì»´í¬ë„ŒíŠ¸ë³„ë¡œ ë¶„í•´:</p>
            <ul>
                <li><strong>CPU</strong>: í”„ë¡œì„¸ì„œ ì‚¬ìš©</li>
                <li><strong>Network</strong>: WiFi/Cellular ì „ì†¡</li>
                <li><strong>Location</strong>: GPS ì‚¬ìš© (ë¯¸ë””ì–´ ì•±ì€ ë³´í†µ 0)</li>
            </ul>

            <div class="info-box">
                <strong>ğŸ’¡ ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒ ìµœì í™”</strong>
                <p>Energy Profilerì—ì„œ í™”ë©´ êº¼ì§„ ìƒíƒœì˜ CPU ì‚¬ìš©ë¥  í™•ì¸ â†’ <strong>Audio Focus</strong> ì†ì‹¤ ì‹œ ì¦‰ì‹œ ì¼ì‹œì •ì§€í•˜ì—¬ ë°°í„°ë¦¬ ì ˆì•½</p>
            </div>

            <h3>6.6 Layout Inspector (Bonus)</h3>
            <p>ë¯¸ë””ì–´ ì•±ì˜ UI ë ˆì´ì•„ì›ƒ ì‹¤ì‹œê°„ ê²€ì‚¬:</p>
            <pre><code>Tools â†’ Layout Inspector â†’ ë””ë°”ì´ìŠ¤ ì„ íƒ

í™•ì¸ í•­ëª©:
- PlayerView í¬ê¸° (match_parent í™•ì¸)
- SurfaceView hierarchy (ì¤‘ì²© ì—†ëŠ”ì§€)
- VideoTextureView vs VideoSurfaceView ì„ íƒ</code></pre>
        </section>

        <!-- Section 7: MediaMetrics -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">07</span>7. MediaMetrics ë¶„ì„</h2>

            <p><strong>MediaMetrics</strong>ëŠ” Android 11+ì—ì„œ ë„ì…ëœ ë¯¸ë””ì–´ ì´ë²¤íŠ¸ ìˆ˜ì§‘ ì‹œìŠ¤í…œìœ¼ë¡œ, MediaCodec/AudioTrack/MediaPlayerì˜ ìƒëª…ì£¼ê¸°ì™€ ì„±ëŠ¥ ë©”íŠ¸ë¦­ì„ ìë™ìœ¼ë¡œ ê¸°ë¡í•©ë‹ˆë‹¤.</p>

            <h3>7.1 MediaMetrics ê°œìš”</h3>
            <div class="info-box">
                <strong>ì£¼ìš” íŠ¹ì§•:</strong>
                <ul>
                    <li>ìë™ ìˆ˜ì§‘: ì•± ìˆ˜ì • ë¶ˆí•„ìš”</li>
                    <li>í”„ë¼ì´ë²„ì‹œ ë³´í˜¸: ê°œì¸ì •ë³´ ë¯¸í¬í•¨</li>
                    <li>ì‹œìŠ¤í…œ ì „ì—­: ëª¨ë“  ë¯¸ë””ì–´ ì•± í†µí•©</li>
                    <li>Statsd ì—°ë™: ëŒ€ì‹œë³´ë“œ ì‹œê°í™” ê°€ëŠ¥</li>
                </ul>
            </div>

            <h3>7.2 MediaMetrics ë°ì´í„° ì¡°íšŒ</h3>

            <h4>7.2.1 dumpsysë¡œ í™•ì¸</h4>
            <pre><code># ìµœê·¼ MediaMetrics ì´ë²¤íŠ¸
adb shell dumpsys media.metrics

# ì¶œë ¥ ì˜ˆì‹œ:
# MediaMetrics:
#   Item[0]: {
#     "key": "codec.video.decoder.avc",
#     "package": "com.example.mediaplayer",
#     "timestamp": 1705825935421,
#     "width": 1920,
#     "height": 1080,
#     "framerate": 30.0,
#     "bitrate": 5000000,
#     "encoder": 0,
#     "secure": 0,
#     "error_count": 0,
#     "latency_max": 45,
#     "latency_avg": 18
#   }</code></pre>

            <h4>7.2.2 ì£¼ìš” ë©”íŠ¸ë¦­ í•­ëª©</h4>
            <table>
                <thead>
                    <tr>
                        <th>ì¹´í…Œê³ ë¦¬</th>
                        <th>Key</th>
                        <th>ì£¼ìš” í•„ë“œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>MediaCodec</strong></td>
                        <td><code>codec.video.decoder.*</code></td>
                        <td>width, height, framerate, bitrate, error_count, latency</td>
                    </tr>
                    <tr>
                        <td><strong>AudioTrack</strong></td>
                        <td><code>audio.track.*</code></td>
                        <td>sample_rate, channel_count, buffer_size, underrun_count</td>
                    </tr>
                    <tr>
                        <td><strong>MediaPlayer</strong></td>
                        <td><code>mediaplayer.*</code></td>
                        <td>duration, buffering_ms, seek_count</td>
                    </tr>
                    <tr>
                        <td><strong>MediaDrm</strong></td>
                        <td><code>drm.*</code></td>
                        <td>scheme, security_level, error_code</td>
                    </tr>
                </tbody>
            </table>

            <h3>7.3 ì‹¤ì „ ë¶„ì„ ì˜ˆì‹œ</h3>

            <h4>Scenario: Codec ì—ëŸ¬ìœ¨ ëª¨ë‹ˆí„°ë§</h4>
            <pre><code># 1. ì „ì²´ Codec ì´ë²¤íŠ¸ ì¶”ì¶œ
adb shell dumpsys media.metrics | grep "codec.video" > codec_metrics.json

# 2. Pythonìœ¼ë¡œ ì—ëŸ¬ìœ¨ ê³„ì‚°
python3 << 'EOF'
import json

with open('codec_metrics.json') as f:
    events = [json.loads(line) for line in f if line.strip()]

total = len(events)
errors = sum(1 for e in events if e.get('error_count', 0) > 0)

print(f"Total codec sessions: {total}")
print(f"Sessions with errors: {errors}")
print(f"Error rate: {errors/total*100:.2f}%")
EOF

# ì¶œë ¥:
# Total codec sessions: 152
# Sessions with errors: 3
# Error rate: 1.97%</code></pre>

            <h4>Latency ë¶„í¬ ë¶„ì„</h4>
            <pre><code># latency_max ê°’ ì¶”ì¶œ
adb shell dumpsys media.metrics | jq -r '.[] | select(.key | contains("codec.video")) | .latency_max' | sort -n

# ì¶œë ¥ (ms):
# 12
# 18
# 22
# ...
# 87  â† P99 í™•ì¸
# 145 â† Outlier</code></pre>

            <h3>7.4 Statsd ì—°ë™ (Advanced)</h3>

            <p>MediaMetricsëŠ” <code>StatsD</code>ë¡œ ìë™ ì „ì†¡ë˜ì–´ ì‹œìŠ¤í…œ ëŒ€ì‹œë³´ë“œì— í‘œì‹œë©ë‹ˆë‹¤.</p>

            <h4>Statsd ì¿¼ë¦¬</h4>
            <pre><code># Statsd ì„¤ì • í™•ì¸
adb shell dumpsys stats

# MediaMetrics atom ì¡°íšŒ (Atom ID: 276)
adb shell cmd stats print-stats 276

# ì¶œë ¥: ìµœê·¼ 1ì‹œê°„ ë™ì•ˆì˜ Codec ì„¸ì…˜ ìˆ˜, í‰ê·  latency ë“±</code></pre>

            <div class="warning-box">
                <strong>âš ï¸ ì£¼ì˜: StatsdëŠ” ì‹œìŠ¤í…œ ê¶Œí•œ í•„ìš”</strong>
                <p>ì¼ë°˜ ì•±ì—ì„œëŠ” ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•˜ë©°, OEM/AOSP ë¹Œë“œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>

            <h3>7.5 Custom MediaMetrics (ì•± ê°œë°œììš©)</h3>

            <p>Android 12+ë¶€í„° ì•±ì—ì„œ ì§ì ‘ MediaMetrics ì´ë²¤íŠ¸ë¥¼ ê¸°ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>

            <pre><code>// Kotlin
import android.media.metrics.MediaMetricsManager
import android.media.metrics.PlaybackMetrics

val metricsManager = getSystemService(MediaMetricsManager::class.java)
val session = metricsManager.createPlaybackSession()

// ì¬ìƒ ì‹œì‘
val playbackMetrics = PlaybackMetrics.Builder()
    .setStreamSource(PlaybackMetrics.STREAM_SOURCE_NETWORK)
    .setStreamType(PlaybackMetrics.STREAM_TYPE_OTHER)
    .setMediaDurationMillis(300000)
    .build()

session.reportPlaybackMetrics(playbackMetrics)

// ì—ëŸ¬ ë¦¬í¬íŠ¸
val errorMetrics = PlaybackErrorEvent.Builder()
    .setErrorCode(PlaybackErrorEvent.ERROR_CODE_CODEC_ERROR)
    .setSubErrorCode(MediaCodec.CodecException.ERROR_INSUFFICIENT_RESOURCE)
    .build()

session.reportPlaybackErrorEvent(errorMetrics)

// ì„¸ì…˜ ì¢…ë£Œ
session.close()</code></pre>

            <div class="success-box">
                <strong>âœ… ì´ì œ <code>dumpsys media.metrics</code>ì—ì„œ ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤!</strong>
            </div>
        </section>

        <!-- Section 8: Bugreport -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">08</span>8. Bugreport ìƒì„± ë° ë¶„ì„</h2>

            <p><strong>Bugreport</strong>ëŠ” Android ì‹œìŠ¤í…œ ì „ì²´ì˜ ìƒíƒœë¥¼ ë‹´ì€ ì¢…í•© ì§„ë‹¨ íŒŒì¼ë¡œ, ë³µì¡í•œ ì´ìŠˆ ë¶„ì„ì— í•„ìˆ˜ì ì…ë‹ˆë‹¤.</p>

            <h3>8.1 Bugreport ìƒì„±</h3>

            <h4>8.1.1 adb ëª…ë ¹ì–´</h4>
            <pre><code># Method 1: ê°„ë‹¨ ë²„ì „ (ê¶Œì¥)
adb bugreport bugreport_$(date +%Y%m%d_%H%M%S).zip

# Method 2: ì „ì²´ ë²„ì „ (ë” ìƒì„¸)
adb shell bugreportz
# ì¶œë ¥: OK:/data/user_de/0/com.android.shell/files/bugreports/bugreport-...-.zip
adb pull /data/user_de/0/com.android.shell/files/bugreports/bugreport-XXX.zip ./

# Method 3: ë””ë°”ì´ìŠ¤ UIì—ì„œ
# Settings â†’ About phone â†’ (7ë²ˆ íƒ­) Developer options â†’ Take bug report</code></pre>

            <div class="info-box">
                <strong>ğŸ’¡ Tip: ìƒì„± ì‹œê°„</strong>
                <p>Bugreport ìƒì„±ì€ ë””ë°”ì´ìŠ¤ ì‚¬ì–‘ì— ë”°ë¼ <strong>30ì´ˆ~3ë¶„</strong> ì†Œìš”ë©ë‹ˆë‹¤. ìƒì„± ì¤‘ì—ëŠ” ë””ë°”ì´ìŠ¤ ì‚¬ìš©ì„ ìµœì†Œí™”í•˜ì„¸ìš”.</p>
            </div>

            <h4>8.1.2 Bugreport ë‚´ìš©ë¬¼</h4>
            <p>ZIP íŒŒì¼ ë‚´ë¶€:</p>
            <ul>
                <li><strong>bugreport-*.txt</strong>: í…ìŠ¤íŠ¸ ë¤í”„ (ì£¼ìš” ë¶„ì„ ëŒ€ìƒ)</li>
                <li><strong>dumpstate_board.bin</strong>: Vendor ë¡œê·¸ (OEM ì „ìš©)</li>
                <li><strong>FS/</strong>: íŒŒì¼ ì‹œìŠ¤í…œ ìŠ¤ëƒ…ìƒ·</li>
                <li><strong>proto/</strong>: Protobuf í˜•ì‹ ë©”íŠ¸ë¦­</li>
            </ul>

            <h3>8.2 Bugreport ë¶„ì„ ë„êµ¬</h3>

            <h4>8.2.1 Battery Historian</h4>
            <p>Googleì˜ ë°°í„°ë¦¬ ë¶„ì„ ë„êµ¬ (Bugreport ì—…ë¡œë“œ ì§€ì›):</p>
            <pre><code># Dockerë¡œ ì‹¤í–‰
docker run -p 9999:9999 gcr.io/android-battery-historian/stable:3.1 --port 9999

# ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
# http://localhost:9999
# Bugreport ZIP ì—…ë¡œë“œ â†’ ë°°í„°ë¦¬ ì‚¬ìš©ëŸ‰ íƒ€ì„ë¼ì¸ í‘œì‹œ</code></pre>

            <div class="success-box">
                <strong>âœ… ë¯¸ë””ì–´ ì•± ë°°í„°ë¦¬ ì†Œëª¨ ë¶„ì„</strong>
                <p>Battery Historianì—ì„œ "App Usage" ì„¹ì…˜ â†’ ë¯¸ë””ì–´ ì•±ì˜ CPU/Wake Lock ì‹œê°„ í™•ì¸</p>
            </div>

            <h4>8.2.2 í…ìŠ¤íŠ¸ ê²€ìƒ‰</h4>
            <pre><code># ZIP ì••ì¶• í•´ì œ
unzip bugreport_20260125.zip -d bugreport/

# ì£¼ìš” ì„¹ì…˜ ê²€ìƒ‰
cd bugreport/

# MediaCodec ì—ëŸ¬
grep -E "MediaCodec.*error|ACodec.*ERROR" *.txt

# ANR ë°œìƒ
grep -A 100 "ANR in" *.txt

# Native Crash
grep -A 50 "Fatal signal" *.txt

# Audio underrun
grep "underrun" *.txt</code></pre>

            <h3>8.3 Bugreport ì£¼ìš” ì„¹ì…˜</h3>

            <table>
                <thead>
                    <tr>
                        <th>ì„¹ì…˜ ì œëª©</th>
                        <th>ë‚´ìš©</th>
                        <th>ê²€ìƒ‰ í‚¤ì›Œë“œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>DUMPSYS MEDIA.PLAYER</strong></td>
                        <td>MediaPlayerService ìƒíƒœ</td>
                        <td><code>grep -A 200 "DUMPSYS MEDIA.PLAYER"</code></td>
                    </tr>
                    <tr>
                        <td><strong>DUMPSYS MEDIA.CODEC</strong></td>
                        <td>Codec ë¦¬ìŠ¤íŠ¸ ë° ì‚¬ìš© ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤</td>
                        <td><code>grep -A 500 "DUMPSYS MEDIA.CODEC"</code></td>
                    </tr>
                    <tr>
                        <td><strong>DUMPSYS MEDIA.AUDIO_FLINGER</strong></td>
                        <td>AudioFlinger ìƒíƒœ (threads, tracks)</td>
                        <td><code>grep -A 1000 "DUMPSYS MEDIA.AUDIO_FLINGER"</code></td>
                    </tr>
                    <tr>
                        <td><strong>SYSTEM LOG</strong></td>
                        <td>logcat ì „ì²´ (ìˆ˜ì²œ~ìˆ˜ë§Œ ì¤„)</td>
                        <td><code>grep -A 10000 "SYSTEM LOG"</code></td>
                    </tr>
                    <tr>
                        <td><strong>KERNEL LOG</strong></td>
                        <td>dmesg (ì»¤ë„ ë©”ì‹œì§€)</td>
                        <td><code>grep -A 5000 "KERNEL LOG"</code></td>
                    </tr>
                    <tr>
                        <td><strong>PROCESSES AND THREADS</strong></td>
                        <td>ps -A ì¶œë ¥</td>
                        <td><code>grep -A 500 "PROCESSES AND THREADS"</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>8.4 ì‹¤ì „ ë¶„ì„ ì›Œí¬í”Œë¡œìš°</h3>

            <div class="tool-card">
                <h4>Scenario: ë¹„ë””ì˜¤ ì¬ìƒ ì¤‘ ANR ë°œìƒ</h4>
                <pre><code># Step 1: ANR ìŠ¤íƒ ì¶”ì¶œ
grep -A 100 "ANR in com.example.mediaplayer" bugreport.txt > anr_stack.txt

# Step 2: Main Thread ìƒíƒœ í™•ì¸
# ì¶œë ¥ ì˜ˆì‹œ:
# "main" prio=5 tid=1 Native
#   | at android.os.MessageQueue.nativePollOnce(MessageQueue.java:0)
#   | at android.os.Looper.loop(Looper.java:168)
#   â†’ Main Threadê°€ Message Queueì—ì„œ ëŒ€ê¸° ì¤‘ (ì •ìƒ)

# Step 3: Blocking Thread ì°¾ê¸°
grep "ExoPlayer:Playback" anr_stack.txt
# ì¶œë ¥:
# "ExoPlayer:Playback" prio=5 tid=15 TimedWaiting
#   | at java.lang.Thread.sleep(Thread.java:1000)
#   | at com.google.android.exoplayer2.MediaCodecRenderer.render(...)
#   â†’ ExoPlayer Threadê°€ sleep ì¤‘ (codec timeout ì˜ì‹¬)

# Step 4: Codec ìƒíƒœ í™•ì¸
grep -A 50 "DUMPSYS MEDIA.CODEC" bugreport.txt
# ì¶œë ¥: Current instances: 5 / Max instances: 4
# â†’ Codec ì¸ìŠ¤í„´ìŠ¤ ì´ˆê³¼! (ì›ì¸ ë°œê²¬)</code></pre>
            </div>

            <h3>8.5 ìë™ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸</h3>
            <pre><code>#!/bin/bash
# analyze_bugreport.sh - Bugreport ìë™ ë¶„ì„

BUGREPORT_ZIP=$1

if [ ! -f "$BUGREPORT_ZIP" ]; then
    echo "Usage: $0 <bugreport.zip>"
    exit 1
fi

# ì••ì¶• í•´ì œ
TMPDIR=$(mktemp -d)
unzip -q "$BUGREPORT_ZIP" -d "$TMPDIR"
TXTFILE=$(find "$TMPDIR" -name "bugreport-*.txt")

echo "ğŸ“Š Bugreport Analysis Report"
echo "============================="

# 1. ANR ê°œìˆ˜
ANR_COUNT=$(grep -c "ANR in" "$TXTFILE")
echo "ANR count: $ANR_COUNT"

# 2. Native Crash ê°œìˆ˜
CRASH_COUNT=$(grep -c "Fatal signal" "$TXTFILE")
echo "Native crashes: $CRASH_COUNT"

# 3. Codec ì—ëŸ¬
CODEC_ERRORS=$(grep -c "MediaCodec.*error" "$TXTFILE")
echo "MediaCodec errors: $CODEC_ERRORS"

# 4. Audio underrun
UNDERRUNS=$(grep -c "underrun" "$TXTFILE")
echo "Audio underruns: $UNDERRUNS"

# 5. ìƒìœ„ CPU ì‚¬ìš© ì•± (TOP 5)
echo ""
echo "Top CPU consumers:"
grep -A 50 "PROCESSES AND THREADS" "$TXTFILE" | grep -E "^[0-9]+" | sort -k9 -rn | head -5

# Cleanup
rm -rf "$TMPDIR"</code></pre>

            <div class="success-box">
                <strong>âœ… ì‚¬ìš© ì˜ˆì‹œ:</strong>
                <pre><code>./analyze_bugreport.sh bugreport_20260125.zip

# ì¶œë ¥:
# ğŸ“Š Bugreport Analysis Report
# =============================
# ANR count: 1
# Native crashes: 0
# MediaCodec errors: 3
# Audio underruns: 152
#
# Top CPU consumers:
# 1234 u0_a123   20  0  2.1G 180M  45M S 38.2  ... com.example.mediaplayer
# ...</code></pre>
            </div>
        </section>

        <!-- Section 9: ê³ ê¸‰ ë””ë²„ê¹… ê¸°ë²• -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">09</span>9. ê³ ê¸‰ ë””ë²„ê¹… ê¸°ë²•</h2>

            <h3>9.1 GDBë¥¼ ì´ìš©í•œ Native ë””ë²„ê¹…</h3>

            <h4>9.1.1 gdbserver ì„¤ì •</h4>
            <pre><code># 1. gdbserverë¥¼ ë””ë°”ì´ìŠ¤ì— í‘¸ì‹œ
adb push $ANDROID_NDK/prebuilt/android-arm64/gdbserver/gdbserver /data/local/tmp/

# 2. ì•± ì‹¤í–‰ ë° PID í™•ì¸
PID=$(adb shell pidof com.example.mediaplayer)

# 3. gdbserver attach
adb shell /data/local/tmp/gdbserver :5039 --attach $PID

# 4. PCì—ì„œ gdb ì—°ê²°
adb forward tcp:5039 tcp:5039
$ANDROID_NDK/prebuilt/linux-x86_64/bin/gdb

# gdb í”„ë¡¬í”„íŠ¸ì—ì„œ
(gdb) target remote :5039
(gdb) symbol-file /path/to/symbols/libmediaplayer.so
(gdb) break MediaCodec::configure
(gdb) continue</code></pre>

            <h4>9.1.2 ì‹¤ì „: Codec Crash ë””ë²„ê¹…</h4>
            <pre><code># Crash ë°œìƒ ì§€ì ì—ì„œ backtrace
(gdb) bt
#0  0x00007f8a1c3d4e20 in OMX_GetHandle () from libstagefright_omx.so
#1  0x00007f8a1c3d5123 in android::OMXClient::connect () from libstagefright.so
#2  0x00007f8a1c3d6456 in android::ACodec::initiateAllocateComponent ()

# ë³€ìˆ˜ ê²€ì‚¬
(gdb) print componentName
$1 = "OMX.qcom.video.decoder.avc"

# ë©”ëª¨ë¦¬ ë¤í”„
(gdb) x/16x $sp</code></pre>

            <h3>9.2 Simpleperf (Native Profiler)</h3>

            <p>Android NDKì˜ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ë¡œ, Native ì½”ë“œ ì„±ëŠ¥ ë¶„ì„ì— íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>

            <pre><code># 1. simpleperf ì„¤ì¹˜ (NDK í¬í•¨)
# ë˜ëŠ”
adb push $ANDROID_NDK/simpleperf/android/arm64/simpleperf /data/local/tmp/

# 2. í”„ë¡œíŒŒì¼ë§ (30ì´ˆ)
adb shell /data/local/tmp/simpleperf record -p $(adb shell pidof com.example.mediaplayer) -o /data/local/tmp/perf.data --duration 30

# 3. PCë¡œ ë‹¤ìš´ë¡œë“œ
adb pull /data/local/tmp/perf.data ./

# 4. ë¦¬í¬íŠ¸ ìƒì„±
$ANDROID_NDK/simpleperf/report_html.py -i perf.data

# 5. ë¸Œë¼ìš°ì €ì—ì„œ index.html ì—´ê¸°
# â†’ Flamegraph í˜•íƒœë¡œ Native í•¨ìˆ˜ CPU ì‚¬ìš©ë¥  í‘œì‹œ</code></pre>

            <h3>9.3 AddressSanitizer (ASan)</h3>

            <p>ë©”ëª¨ë¦¬ ì—ëŸ¬ ê²€ì¶œ ë„êµ¬ (Use-after-free, Buffer overflow ë“±):</p>

            <pre><code># build.gradleì— ì¶”ê°€
android {
    buildTypes {
        debug {
            externalNativeBuild {
                cmake {
                    arguments "-DANDROID_ARM_MODE=arm", "-DENABLE_ASAN=1"
                }
            }
        }
    }
}

# CMakeLists.txt
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=address -fno-omit-frame-pointer")

# ë¹Œë“œ í›„ ì‹¤í–‰ â†’ Crash ì‹œ ìƒì„¸ ìŠ¤íƒ ì¶œë ¥</code></pre>

            <h3>9.4 MediaCodec ë¤í”„ í™œì„±í™”</h3>

            <p>MediaCodec ì…ì¶œë ¥ ë²„í¼ë¥¼ íŒŒì¼ë¡œ ë¤í”„í•˜ì—¬ ìœ¡ì•ˆ ê²€ì¦:</p>

            <pre><code># ì‹œìŠ¤í…œ í”„ë¡œí¼í‹° ì„¤ì •
adb shell setprop debug.stagefright.ccodec_delayed_params 1
adb shell setprop debug.stagefright.ccodec 4  # ë¡œê·¸ ë ˆë²¨

# Input/Output ë¤í”„
adb shell setprop debug.stagefright.codecname OMX.qcom.video.decoder.avc
adb shell setprop debug.stagefright.codecinput /sdcard/codec_input.h264
adb shell setprop debug.stagefright.codecoutput /sdcard/codec_output.yuv

# ì¬ìƒ í›„ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
adb pull /sdcard/codec_input.h264
adb pull /sdcard/codec_output.yuv

# ffmpegë¡œ ê²€ì¦
ffmpeg -i codec_input.h264 -f null -
ffplay -f rawvideo -pixel_format yuv420p -video_size 1920x1080 codec_output.yuv</code></pre>

            <h3>9.5 Kernel ftrace</h3>

            <p>perfetto ì—†ì´ ìˆœìˆ˜ Kernel ì´ë²¤íŠ¸ë§Œ ì¶”ì :</p>

            <pre><code># ftrace í™œì„±í™”
adb shell
mount -t debugfs none /sys/kernel/debug
cd /sys/kernel/debug/tracing

# Binder ì´ë²¤íŠ¸ í™œì„±í™”
echo 1 > events/binder/enable

# Trace ì‹œì‘
echo 1 > tracing_on
# ... ì¬í˜„ ...
cat trace > /sdcard/kernel_trace.txt
echo 0 > tracing_on

# PCë¡œ ë‹¤ìš´ë¡œë“œ
adb pull /sdcard/kernel_trace.txt</code></pre>

            <h3>9.6 Remote Debugging (Android Studio)</h3>

            <p>ì‹¤ ë””ë°”ì´ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì•±ì— ë””ë²„ê±° attach:</p>

            <pre><code>1. Android Studio â†’ Run â†’ Attach Debugger to Android Process
2. í”„ë¡œì„¸ìŠ¤ ì„ íƒ: com.example.mediaplayer
3. Breakpoint ì„¤ì •:
   - MediaCodecRenderer.java:324 (render ë©”ì†Œë“œ)
   - ExoPlayerImpl.java:567 (handleMessage)
4. ë³€ìˆ˜ Inspection, Step Over/Into ì‹¤í–‰</code></pre>

            <div class="warning-box">
                <strong>âš ï¸ ì£¼ì˜: Release ë¹Œë“œëŠ” ì½”ë“œ ë‚œë…í™”ë¡œ ë””ë²„ê¹… ì–´ë ¤ì›€</strong>
                <p>ProGuard/R8 ë¹„í™œì„±í™” ë˜ëŠ” <code>-keepattributes SourceFile,LineNumberTable</code> ì¶”ê°€</p>
            </div>
        </section>

        <!-- Section 10: ì°¸ê³  ë¬¸ì„œ -->
        <section class="content-section section">
            <h2 class="section-title"><span class="section-number">10</span>10. ì°¸ê³  ë¬¸ì„œ ë° ë¦¬ì†ŒìŠ¤</h2>

            <h3>10.1 ê³µì‹ ë¬¸ì„œ</h3>
            <ul>
                <li><a href="https://source.android.com/docs/core/media" target="_blank">AOSP Media Framework</a></li>
                <li><a href="https://developer.android.com/studio/profile" target="_blank">Android Studio Profiler</a></li>
                <li><a href="https://perfetto.dev/docs/" target="_blank">Perfetto Documentation</a></li>
                <li><a href="https://developer.android.com/studio/command-line/adb" target="_blank">adb Reference</a></li>
            </ul>

            <h3>10.2 ë„êµ¬ ë‹¤ìš´ë¡œë“œ</h3>
            <ul>
                <li><a href="https://get.perfetto.dev/perfetto" target="_blank">perfetto CLI</a></li>
                <li><a href="https://ui.perfetto.dev" target="_blank">perfetto Web UI</a></li>
                <li><a href="https://github.com/google/battery-historian" target="_blank">Battery Historian</a></li>
                <li><a href="https://developer.android.com/ndk/downloads" target="_blank">Android NDK (simpleperf, gdb)</a></li>
            </ul>

            <h3>10.3 ê´€ë ¨ í˜ì´ì§€</h3>
            <ul>
                <li><a href="common-media-issues.html">Common Media Issues & Solutions</a> - ì‹¤ì „ ì´ìŠˆ í•´ê²°</li>
                <li><a href="media-framework-core.html">Media Framework Core</a> - ì•„í‚¤í…ì²˜ ì´í•´</li>
                <li><a href="codec2.html">Codec 2.0 & Media HAL</a> - Codec ì‹¬í™”</li>
                <li><a href="audio-framework.html">Audio Framework</a> - AudioFlinger ìƒì„¸</li>
            </ul>

            <h3>10.4 ë””ë²„ê¹… ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
            <div class="success-box">
                <strong>âœ… ë¯¸ë””ì–´ ì´ìŠˆ ë°œìƒ ì‹œ ìˆœì„œ:</strong>
                <ol>
                    <li><strong>logcat</strong>ìœ¼ë¡œ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸ (5ë¶„)</li>
                    <li><strong>dumpsys</strong>ë¡œ ì„œë¹„ìŠ¤ ìƒíƒœ ê²€ì¦ (3ë¶„)</li>
                    <li>ì¬í˜„ ê°€ëŠ¥í•˜ë©´ <strong>perfetto</strong> íŠ¸ë ˆì´ìŠ¤ (10ë¶„)</li>
                    <li>ë³µì¡í•˜ë©´ <strong>Bugreport</strong> ìƒì„± (30ë¶„~)</li>
                    <li>Native CrashëŠ” <strong>gdb/simpleperf</strong> (1ì‹œê°„~)</li>
                </ol>
            </div>

            <h3>10.5 ì»¤ë®¤ë‹ˆí‹°</h3>
            <ul>
                <li><a href="https://groups.google.com/g/android-platform" target="_blank">android-platform Google Group</a></li>
                <li><a href="https://stackoverflow.com/questions/tagged/android-mediaplayer" target="_blank">Stack Overflow - android-mediaplayer</a></li>
                <li><a href="https://issuetracker.google.com/issues?q=componentid:190923" target="_blank">Google Issue Tracker - Media</a></li>
            </ul>
        </section>

        <!-- Back to Home -->
        <section style="text-align: center; padding: 3rem;" class="content-section section">
            <a href="index.html" style="display: inline-block; padding: 1rem 2rem; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); color: white; text-decoration: none; border-radius: 12px; font-weight: 600; transition: transform 0.3s ease;">
                â† Back to Main Page
            </a>
        </section>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: document.documentElement.getAttribute('data-theme') === 'light' ? 'default' : 'dark',
            themeVariables: {
                primaryColor: '#00d4ff',
                primaryTextColor: '#e8eaed',
                primaryBorderColor: '#1a2030',
                lineColor: '#9aa0a6',
                secondaryColor: '#4a9eff',
                tertiaryColor: '#26de81'
            }
        });
    </script>
    <script src="scripts/theme-toggle.js"></script>
</body>
</html>
