<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Prevent Flash of Incorrect Theme (FOIT) -->
    <script>
    (function(){var t=localStorage.getItem('android-media-framework-theme');if(t)document.documentElement.setAttribute('data-theme',t);else if(window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches)document.documentElement.setAttribute('data-theme','light');})();
    </script>
    <title>Power Policy & Suspend | Android Media Framework</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            â† Android Media
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">Power Policy & Suspend</h1>
            <p class="page-subtitle">Deep Sleep, Suspend-to-RAM, and Audio Context Preservation in AAOS</p>
        </header>

        <!-- Section 1: Concept -->
        <section class="section sec-concept">
            <h2 class="section-title">
                <span class="section-number">1</span>
                ê°œë… ì •ë¦¬: Deep Sleep & Suspend-to-RAM
            </h2>
            <p class="section-description">
                AAOSì—ì„œ ì‹œë™ì„ ë„ë©´(Ignition Off), AP(Application Processor)ëŠ” ì™„ì „ ì¢…ë£Œ(Shutdown)ê°€ ì•„ë‹ˆë¼
                <strong>Deep Sleep (Suspend-to-RAM, STR)</strong> ëª¨ë“œë¡œ ì§„ì…í•©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ’¤</span> Suspend-to-RAM (STR)</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ì „ì› ì°¨ë‹¨:</strong> ë””ìŠ¤í”Œë ˆì´, CPU, ëŒ€ë¶€ë¶„ì˜ ì£¼ë³€ ì¥ì¹˜ OFF.</li>
                            <li><strong>ë©”ëª¨ë¦¬ ìœ ì§€:</strong> DRAMë§Œ Self-Refresh ìƒíƒœë¡œ ìœ ì§€í•˜ì—¬ ì»¤ë„ ë° í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ë³´ì¡´.</li>
                            <li><strong>ì‹¤í–‰ ì¤‘ì§€:</strong> ì½”ë“œ ì‹¤í–‰ì€ ì™„ì „íˆ ë©ˆì¶¤ (íƒ€ì´ë¨¸/ìŠ¤ë ˆë“œ ë™ì‘ ì—†ìŒ).</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ›‘</span> Shutdown Prepare</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>UI Off:</strong> ìš´ì „ìëŠ” í™”ë©´ì´ êº¼ì§„ ê²ƒì„ ë³´ê³  ì¢…ë£Œë˜ì—ˆë‹¤ê³  ìƒê°í•¨.</li>
                            <li><strong>OS Alive:</strong> ì•ˆë“œë¡œì´ë“œëŠ” ì•„ì§ ì‹¤í–‰ ì¤‘ì´ë©°, ì •ë¦¬ ì‘ì—…(DB ì €ì¥ ë“±) ìˆ˜í–‰ ê°€ëŠ¥.</li>
                            <li><strong>Context Save:</strong> ì˜¤ë””ì˜¤/ë¯¸ë””ì–´ ì»¨í…ìŠ¤íŠ¸ ì €ì¥ì€ ì´ ì‹œì ì— ì´ë£¨ì–´ì§.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Architecture -->
        <section class="section sec-arch">
            <h2 class="section-title">
                <span class="section-number">2</span>
                AAOS ì „ì› ê´€ë¦¬ ì•„í‚¤í…ì²˜
            </h2>
            <p class="section-description">
                ì°¨ëŸ‰ì˜ ì „ì› ìƒíƒœëŠ” VMCUì—ì„œ ì‹œì‘ë˜ì–´ VHALì„ ê±°ì³ ì•ˆë“œë¡œì´ë“œ í”„ë ˆì„ì›Œí¬(CPMS)ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph LR
                    VMCU[VMCU<br />Microcontroller] -->|IGN/ACC Signal| VHAL[Vehicle HAL]
                    VHAL -->|Power State Property| CPMS[CarPowerManagementService]
                    CPMS -->|Apply Policy| Policy[CarPowerPolicyService]
                    Policy -->|Enable/Disable| Components[Components<br />Audio, Media, Display, etc.]

                </div>
                <p class="diagram-caption">í•˜ë“œì›¨ì–´(VMCU) ì‹ í˜¸ê°€ VHALì„ í†µí•´ ì•ˆë“œë¡œì´ë“œ í”„ë ˆì„ì›Œí¬(CPMS)ë¡œ ì „ë‹¬ë˜ê³ , ì •ì±… ì„œë¹„ìŠ¤ê°€ ê° ì»´í¬ë„ŒíŠ¸ë¥¼ ì œì–´í•˜ëŠ” íë¦„ì…ë‹ˆë‹¤.
                </p>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš™ï¸</span> CarPowerManagementService (CPMS)</h3>
                    <div class="card-description">
                        ì•ˆë“œë¡œì´ë“œ ì „ì› ìƒíƒœ ë¨¸ì‹ (State Machine)ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. VHAL ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ ê° ì„œë¹„ìŠ¤ì— Sleep/Shutdown ì•Œë¦¼ì„ ë³´ë‚´ê³ , Deep Sleep ì§„ì…ê³¼
                        ë³µê·€ë¥¼ ì¡°ìœ¨í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“œ</span> CarPowerPolicy</h3>
                    <div class="card-description">
                        "ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¼¤ì§€/ëŒì§€"ë¥¼ ì •ì˜í•œ ì •ì±…ì…ë‹ˆë‹¤.
                        <br>ì˜ˆ: <code>ShutdownPrepare</code> ìƒíƒœì—ì„œëŠ” <strong>AUDIO=OFF, MEDIA=OFF, DISPLAY=OFF</strong> ì •ì±…ì´
                        ì ìš©ë©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: CPMS Integration -->
        <section class="section sec-arch">
            <h2 class="section-title">
                <span class="section-number">3</span>
                CPMSì™€ Media Framework ì—°ê²°
            </h2>
            <p class="section-description">
                <code>CarAudioService</code>ì™€ <code>CarMediaService</code>ëŠ” CPMSì— ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•˜ì—¬ ì „ì› ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€í•©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.1rem;">
                CarAudioService Integration</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant CAS as CarAudioService
                    participant CPMS as CarPowerManagementService
                    participant Policy as CarPowerPolicy

                    Note over CAS, CPMS: 1. Listener Registration (Boot Phase)
                    CAS->>CAS: Create Filter (Component: AUDIO)
                    CAS->>CPMS: addPowerPolicyListener(filter, listener)
                    CPMS-->>CAS: Success

                    Note over CPMS, Policy: 2. Policy Change Event
                    CPMS->>CPMS: Detect Power State Change
                    CPMS->>Policy: Get Current Policy
                    CPMS->>CAS: onPolicyChanged(policy)

                    activate CAS
                    CAS->>Policy: isComponentEnabled(AUDIO)
                    alt AUDIO Enabled
                    CAS->>CAS: setAudioEnabled(true)
                    CAS->>CAS: Unmute / Restore Focus
                    else AUDIO Disabled
                    CAS->>CAS: setAudioEnabled(false)
                    CAS->>CAS: Mute / Reject Focus
                    end
                    deactivate CAS
                </div>
                <p class="diagram-caption">CarAudioServiceëŠ” ë¦¬ìŠ¤ë„ˆ ë“±ë¡ í›„, ì •ì±… ë³€ê²½ ì‹œ AUDIO ì»´í¬ë„ŒíŠ¸ í™œì„±í™” ì—¬ë¶€ì— ë”°ë¼ Mute ë˜ëŠ” Focus ì²˜ë¦¬ë¥¼
                    ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-green); font-size: 1.1rem;">
                CarMediaService Integration</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant CMS as CarMediaService
                    participant CPMS as CarPowerManagementService
                    participant Policy as CarPowerPolicy
                    participant App as Media App

                    Note over CMS, CPMS: 1. Listener Registration
                    CMS->>CMS: Create Filter (Component: MEDIA)
                    CMS->>CPMS: addPowerPolicyListener(filter, listener)

                    Note over CPMS, Policy: 2. Policy Change Event
                    CPMS->>CAS: onPolicyChanged(policy)

                    activate CMS
                    CMS->>Policy: isComponentEnabled(MEDIA)
                    alt MEDIA Disabled (Suspend)
                    CMS->>App: Pause Playback
                    CMS->>CMS: Save Last Media Source
                    else MEDIA Enabled (Resume)
                    CMS->>CMS: Load Last Media Source
                    opt Auto Resume
                    CMS->>App: Play (Restore Context)
                    end
                    end
                    deactivate CMS
                </div>
                <p class="diagram-caption">CarMediaServiceëŠ” MEDIA ì»´í¬ë„ŒíŠ¸ê°€ ë¹„í™œì„±í™”ë˜ë©´ ì¬ìƒì„ ë©ˆì¶”ê³  ì†ŒìŠ¤ë¥¼ ì €ì¥í•˜ë©°, í™œì„±í™”ë˜ë©´ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ ìë™ ì¬ìƒì„
                    ì‹œë„í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ§</span> CarAudioService</h3>
                    <div class="card-description">
                        <strong>AUDIO OFF ê°ì§€ ì‹œ:</strong>
                        <ul>
                            <li>ìƒˆë¡œìš´ ì˜¤ë””ì˜¤ í¬ì»¤ìŠ¤ ìš”ì²­ ê±°ì ˆ (Reject).</li>
                            <li>ê¸°ì¡´ ë¹„ì¹˜ëª…ì (Non-critical) í¬ì»¤ìŠ¤ í•´ì œ (Abandon).</li>
                            <li>ë³¼ë¥¨ ê·¸ë£¹ Mute (ê²½ê³ ìŒ ì œì™¸).</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ¬</span> CarMediaService</h3>
                    <div class="card-description">
                        <strong>MEDIA OFF ê°ì§€ ì‹œ:</strong>
                        <ul>
                            <li>í˜„ì¬ í™œì„± MediaSession ì°¾ê¸°.</li>
                            <li>ì¬ìƒ ì¤‘ì´ë©´ <code>pause()</code> í˜¸ì¶œ.</li>
                            <li>ë§ˆì§€ë§‰ ì¬ìƒ ì•±(Source) ì •ë³´ ì €ì¥.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Sequence Flows -->
        <section class="section sec-flow">
            <h2 class="section-title">
                <span class="section-number">4</span>
                ì§„ì… ë° ë³µê·€ ì‹œí€€ìŠ¤ (Deep Dive)
            </h2>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-green); font-size: 1.3rem;">4-1. ì§„ì…
                ì‹œí€€ìŠ¤ (Ignition OFF)</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant Driver
                    participant VMCU
                    participant CPMS
                    participant Policy as PowerPolicy
                    participant Audio as CarAudioService
                    participant Media as CarMediaService
                    participant App
                    participant Kernel

                    Driver->>VMCU: Ignition OFF
                    VMCU->>CPMS: SHUTDOWN_PREPARE Req
                    CPMS->>Policy: Apply "No User Interaction" Policy

                    par Notify Components
                    Policy->>Audio: AUDIO = Disabled
                    Audio->>Audio: Mute / Reject Focus

                    Policy->>Media: MEDIA = Disabled
                    Media->>App: Pause Playback
                    Media->>Media: Save Last Source
                    App->>App: Save Position to DB
                    end

                    CPMS->>CPMS: onSleepEntry() (Cleanup)
                    CPMS->>VMCU: Ready for Suspend
                    VMCU->>Kernel: Trigger Deep Sleep
                    Note over Kernel: CPU OFF / DRAM Self-Refresh
                </div>
                <p class="diagram-caption">Ignition OFF ì‹œ VMCUê°€ CPMSì— ì•Œë¦¬ê³ , CPMSëŠ” ì •ì±…ì„ ì ìš©í•˜ì—¬ ì˜¤ë””ì˜¤/ë¯¸ë””ì–´ë¥¼ ëˆ í›„ ì»¤ë„ì„ Deep Sleepìœ¼ë¡œ
                    ì „í™˜í•©ë‹ˆë‹¤.</p>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-green); font-size: 1.3rem;">4-2. ë³µê·€
                ì‹œí€€ìŠ¤ (Ignition ON)</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant VMCU
                    participant Kernel
                    participant CPMS
                    participant Policy as PowerPolicy
                    participant Audio as CarAudioService
                    participant Media as CarMediaService
                    participant App

                    VMCU->>Kernel: Wake Up
                    Kernel->>CPMS: Resume
                    CPMS->>CPMS: onSleepExit()
                    CPMS->>Policy: Apply "System On" Policy

                    par Notify Components
                    Policy->>Audio: AUDIO = Enabled
                    Audio->>Audio: Unmute / Allow Focus

                    Policy->>Media: MEDIA = Enabled
                    Media->>Media: Load Last Source
                    opt Auto Resume
                    Media->>App: Connect & Play
                    App->>App: Restore Position & Play
                    end
                    end
                </div>
                <p class="diagram-caption">VMCUê°€ ê¹¨ì–´ë‚˜ë©´ ì»¤ë„ì´ Resumeë˜ê³ , CPMSëŠ” ì‹œìŠ¤í…œ ì •ì±…ì„ ì ìš©í•˜ì—¬ ì˜¤ë””ì˜¤/ë¯¸ë””ì–´ë¥¼ ë‹¤ì‹œ í™œì„±í™”í•©ë‹ˆë‹¤.</p>
            </div>
        </section>

        <!-- Section 5: Context Preservation -->
        <section class="section sec-context">
            <h2 class="section-title">
                <span class="section-number">5</span>
                ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì €ì¥ ë° ë³µêµ¬
            </h2>
            <p class="section-description">
                "ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸"ëŠ” ì‹œìŠ¤í…œ ë ˆë²¨ê³¼ ì•± ë ˆë²¨ë¡œ ë‚˜ë‰˜ì–´ ê´€ë¦¬ë©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ›ï¸</span> ì‹œìŠ¤í…œ ë ˆë²¨ (CarAudioContext)</h3>
                    <div class="card-description">
                        <strong>CarAudioService ê´€ë¦¬</strong>
                        <ul>
                            <li><strong>Volume Group:</strong> ê° ê·¸ë£¹(Music, Navi, Voice)ì˜ ë³¼ë¥¨ ë ˆë²¨.</li>
                            <li><strong>Routing:</strong> ì˜¤ë””ì˜¤ê°€ ì¶œë ¥ë  Zone ë° Device.</li>
                            <li><strong>Focus State:</strong> í˜„ì¬ í¬ì»¤ìŠ¤ë¥¼ ê°€ì§„ ì•± (Resume ì‹œ ë³µêµ¬ ì—¬ë¶€ ê²°ì •).</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“±</span> ì•± ë ˆë²¨ (Playback Context)</h3>
                    <div class="card-description">
                        <strong>ì•±(MediaSession) ê´€ë¦¬</strong>
                        <ul>
                            <li><strong>Media ID:</strong> ì¬ìƒ ì¤‘ì´ë˜ ê³¡/ì½˜í…ì¸  ì‹ë³„ì.</li>
                            <li><strong>Position:</strong> ì¬ìƒ ìœ„ì¹˜ (ms).</li>
                            <li><strong>Playlist:</strong> í˜„ì¬ ëŒ€ê¸°ì—´ ë° ì…”í”Œ/ë°˜ë³µ ëª¨ë“œ.</li>
                        </ul>
                        <p style="margin-top: 10px; font-size: 0.9em; color: var(--accent-rose);">
                            * ì•±ì€ <code>onPause()</code> ë˜ëŠ” <code>onStop()</code> ì‹œì ì— ì´ ì •ë³´ë¥¼ ì˜êµ¬ ì €ì¥ì†Œ(DB/Prefs)ì— ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Developer Checklist -->
        <section class="section sec-context">
            <h2 class="section-title">
                <span class="section-number">6</span>
                ê°œë°œì ì²´í¬ë¦¬ìŠ¤íŠ¸
            </h2>
            <p class="section-description">
                ë¯¸ë””ì–´ ì•± ê°œë°œìê°€ AAOSì˜ ì „ì› ì •ì±…ì— ì˜¬ë°”ë¥´ê²Œ ëŒ€ì‘í•˜ê¸° ìœ„í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âœ…</span> í•„ìˆ˜ êµ¬í˜„ ì‚¬í•­</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>MediaSession & AudioFocus:</strong> í‘œì¤€ APIë¥¼ ì¤€ìˆ˜í•˜ì—¬ êµ¬í˜„.</li>
                            <li><strong>Focus Loss ëŒ€ì‘:</strong> í¬ì»¤ìŠ¤ ìƒì„ ì‹œ ì¦‰ì‹œ <code>pause()</code> ë° ìƒíƒœ ì €ì¥.</li>
                            <li><strong>PlaybackState ê´€ë¦¬:</strong> <code>STATE_PAUSED</code>ë¡œ ì •í™•íˆ ì—…ë°ì´íŠ¸.</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ’¾</span> ìƒíƒœ ì €ì¥ (Persistence)</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ì €ì¥ ì‹œì :</strong> <code>onPause()</code>, <code>onStop()</code>,
                                <code>ACTION_SHUTDOWN</code>.
                            </li>
                            <li><strong>ì €ì¥ í•­ëª©:</strong> Media ID, Position, Playlist, Shuffle Mode.</li>
                            <li><strong>ë³µêµ¬:</strong> ì•± ì¬ì‹œì‘ ë˜ëŠ” <code>onPlay()</code> í˜¸ì¶œ ì‹œ ë§ˆì§€ë§‰ ìƒíƒœì—ì„œ ì´ì–´í•˜ê¸°.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7: Code Examples -->
        <section class="section sec-code">
            <h2 class="section-title">
                <span class="section-number">7</span>
                ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œ
            </h2>
            <p class="section-description">
                CarPowerManagementService ë¦¬ìŠ¤ë„ˆ ë“±ë¡, Power Policy ì ìš©, ìƒíƒœ ì €ì¥ êµ¬í˜„ ì½”ë“œì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-1. CarAudioService - Power Policy ë¦¬ìŠ¤ë„ˆ ë“±ë¡</h3>
            <div class="code-block">
                <pre><code class="language-java">// packages/services/Car/service/src/com/android/car/audio/CarAudioService.java
public class CarAudioService extends ICarAudio.Stub implements CarServiceBase {

    private CarPowerManagementService mCarPowerManagementService;
    private final CarPowerPolicyFilter mPowerPolicyFilter;
    private final CarPowerPolicyListener mPowerPolicyListener;

    public void init() {
        // Power Policy í•„í„° ìƒì„± (AUDIO ì»´í¬ë„ŒíŠ¸ë§Œ ê°ì§€)
        mPowerPolicyFilter = new CarPowerPolicyFilter.Builder()
            .setComponents(PowerComponent.AUDIO)
            .build();

        // ë¦¬ìŠ¤ë„ˆ ìƒì„±
        mPowerPolicyListener = new CarPowerPolicyListener() {
            @Override
            public void onPolicyChanged(CarPowerPolicy policy,
                                       CarPowerPolicy accumulatedPolicy) {
                handlePowerPolicyChange(policy);
            }
        };

        // CPMSì— ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        mCarPowerManagementService.addPowerPolicyListener(
            mPowerPolicyFilter,
            mPowerPolicyListener
        );
    }

    private void handlePowerPolicyChange(CarPowerPolicy policy) {
        boolean audioEnabled = policy.isComponentEnabled(PowerComponent.AUDIO);

        Log.d(TAG, "Power Policy changed: AUDIO = " + audioEnabled);

        if (audioEnabled) {
            // AUDIO í™œì„±í™”: Unmute, Allow Focus
            enableAudioRouting();
            setAudioFocusRequestsAllowed(true);
            Log.d(TAG, "Audio enabled: unmuted and allowing focus requests");
        } else {
            // AUDIO ë¹„í™œì„±í™”: Mute, Reject Focus
            disableAudioRouting();
            setAudioFocusRequestsAllowed(false);
            abandonNonCriticalAudioFocus();
            Log.d(TAG, "Audio disabled: muted and rejecting focus requests");
        }
    }

    private void abandonNonCriticalAudioFocus() {
        // ê²½ê³ ìŒ ë“±ì„ ì œì™¸í•œ ëª¨ë“  í¬ì»¤ìŠ¤ í•´ì œ
        for (AudioFocusInfo info : getActiveFocusHolders()) {
            if (info.getUsage() != AudioAttributes.USAGE_ASSISTANCE_SONIFICATION) {
                mAudioManager.abandonAudioFocusRequest(info);
            }
        }
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-2. CarMediaService - MEDIA ì»´í¬ë„ŒíŠ¸ ì²˜ë¦¬</h3>
            <div class="code-block">
                <pre><code class="language-java">// packages/services/Car/service/src/com/android/car/media/CarMediaService.java
public class CarMediaService extends ICarMedia.Stub implements CarServiceBase {

    private CarPowerPolicyFilter mPowerPolicyFilter;
    private CarPowerPolicyListener mPowerPolicyListener;

    @Override
    public void init() {
        // MEDIA ì»´í¬ë„ŒíŠ¸ í•„í„°
        mPowerPolicyFilter = new CarPowerPolicyFilter.Builder()
            .setComponents(PowerComponent.MEDIA)
            .build();

        mPowerPolicyListener = new CarPowerPolicyListener() {
            @Override
            public void onPolicyChanged(CarPowerPolicy policy,
                                       CarPowerPolicy accumulatedPolicy) {
                handleMediaPowerChange(policy);
            }
        };

        mCarPowerManagementService.addPowerPolicyListener(
            mPowerPolicyFilter,
            mPowerPolicyListener
        );
    }

    private void handleMediaPowerChange(CarPowerPolicy policy) {
        boolean mediaEnabled = policy.isComponentEnabled(PowerComponent.MEDIA);

        if (mediaEnabled) {
            Log.d(TAG, "MEDIA enabled: Restoring last media source");
            restoreLastMediaSource();
        } else {
            Log.d(TAG, "MEDIA disabled: Pausing playback and saving state");
            pauseCurrentMediaAndSave();
        }
    }

    private void pauseCurrentMediaAndSave() {
        // í˜„ì¬ í™œì„± MediaController ì°¾ê¸°
        MediaController controller = getActiveMediaController();
        if (controller != null) {
            PlaybackState state = controller.getPlaybackState();

            if (state != null && state.getState() == PlaybackState.STATE_PLAYING) {
                // ì¬ìƒ ì¤‘ì´ë©´ ì¼ì‹œì •ì§€
                controller.getTransportControls().pause();
                Log.d(TAG, "Paused: " + controller.getPackageName());
            }

            // ë§ˆì§€ë§‰ ì†ŒìŠ¤ ì €ì¥
            ComponentName component = controller.getSessionActivity().getComponent();
            saveLastMediaSource(component, MEDIA_SOURCE_MODE_PLAYBACK);
        }
    }

    private void restoreLastMediaSource() {
        ComponentName lastSource = getLastMediaSource(MEDIA_SOURCE_MODE_PLAYBACK);

        if (lastSource != null) {
            Log.d(TAG, "Restoring last media source: " + lastSource);

            // Autoplay ì •ì±…ì— ë”°ë¼ ìë™ ì¬ìƒ ì—¬ë¶€ ê²°ì •
            boolean shouldAutoplay = shouldStartPlayback(lastSource);
            startMediaConnectorService(lastSource, shouldAutoplay);
        }
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-3. ì•± ë ˆë²¨ - ìƒíƒœ ì €ì¥ ë° ë³µêµ¬</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// ë¯¸ë””ì–´ ì•±ì˜ Service êµ¬í˜„
class MyMediaService : MediaBrowserServiceCompat() {

    private lateinit var player: ExoPlayer
    private lateinit var mediaSession: MediaSessionCompat
    private val sharedPrefs by lazy {
        getSharedPreferences("playback_state", Context.MODE_PRIVATE)
    }

    override fun onCreate() {
        super.onCreate()

        // ì €ì¥ëœ ìƒíƒœ ë³µêµ¬
        restorePlaybackState()

        mediaSession = MediaSessionCompat(this, "MyMediaSession").apply {
            setCallback(MediaSessionCallback())
            isActive = true
        }
    }

    // Suspend ì§„ì… ì‹œ ìƒíƒœ ì €ì¥
    private inner class MediaSessionCallback : MediaSessionCompat.Callback() {
        override fun onPause() {
            player.pause()
            savePlaybackState()
            updatePlaybackState(PlaybackStateCompat.STATE_PAUSED)
        }

        override fun onPlay() {
            player.play()
            updatePlaybackState(PlaybackStateCompat.STATE_PLAYING)
        }
    }

    // ì¬ìƒ ìƒíƒœ ì €ì¥
    private fun savePlaybackState() {
        sharedPrefs.edit().apply {
            putLong("position", player.currentPosition)
            putString("media_id", player.currentMediaItem?.mediaId)
            putInt("window_index", player.currentWindowIndex)
            putBoolean("shuffle", player.shuffleModeEnabled)
            putInt("repeat_mode", player.repeatMode)
            apply()
        }
        Log.d(TAG, "Saved playback state: pos=${player.currentPosition}ms")
    }

    // ì¬ìƒ ìƒíƒœ ë³µêµ¬
    private fun restorePlaybackState() {
        val position = sharedPrefs.getLong("position", 0)
        val mediaId = sharedPrefs.getString("media_id", null)
        val windowIndex = sharedPrefs.getInt("window_index", 0)
        val shuffle = sharedPrefs.getBoolean("shuffle", false)
        val repeatMode = sharedPrefs.getInt("repeat_mode", Player.REPEAT_MODE_OFF)

        if (mediaId != null) {
            Log.d(TAG, "Restoring: mediaId=$mediaId, pos=${position}ms")

            // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë³µì›
            val mediaItems = loadPlaylistFromDatabase()
            player.setMediaItems(mediaItems, windowIndex, position)
            player.shuffleModeEnabled = shuffle
            player.repeatMode = repeatMode
            player.prepare()
        }
    }

    // ACTION_SHUTDOWN ë¸Œë¡œë“œìºìŠ¤íŠ¸ ìˆ˜ì‹ 
    private val shutdownReceiver = object : BroadcastReceiver() {
        override fun onReceive(context: Context, intent: Intent) {
            if (intent.action == Intent.ACTION_SHUTDOWN) {
                Log.d(TAG, "Shutdown detected, saving state")
                savePlaybackState()
            }
        }
    }

    override fun onCreate() {
        super.onCreate()
        registerReceiver(shutdownReceiver, IntentFilter(Intent.ACTION_SHUTDOWN))
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-4. VHAL - Power State ë³´ê³  (C++)</h3>
            <div class="code-block">
                <pre><code class="language-cpp">// hardware/interfaces/automotive/vehicle/2.0/default/impl/vhal_v2_0/VehicleHalImpl.cpp
void VehicleHalImpl::onIgnitionChange(bool ignitionOn) {
    VehiclePropValue value;
    value.prop = toInt(VehicleProperty::AP_POWER_STATE_REQ);
    value.timestamp = elapsedRealtimeNano();

    if (ignitionOn) {
        // Ignition ON -> CPMSì— ON ìš”ì²­
        value.value.int32Values = {
            toInt(VehicleApPowerStateReq::ON),
            0  // param
        };
        Log::d(TAG, "Sending AP_POWER_STATE_REQ: ON");
    } else {
        // Ignition OFF -> CPMSì— SHUTDOWN_PREPARE ìš”ì²­
        value.value.int32Values = {
            toInt(VehicleApPowerStateReq::SHUTDOWN_PREPARE),
            toInt(VehicleApPowerStateShutdownParam::CAN_SLEEP)
        };
        Log::d(TAG, "Sending AP_POWER_STATE_REQ: SHUTDOWN_PREPARE");
    }

    // CPMSë¡œ ì „ë‹¬
    mCallback->onPropertyEvent({value});
}

// CPMSë¡œë¶€í„° ì‘ë‹µ ìˆ˜ì‹ 
StatusCode VehicleHalImpl::set(const VehiclePropValue&amp; value) {
    if (value.prop == toInt(VehicleProperty::AP_POWER_STATE_REPORT)) {
        int32_t state = value.value.int32Values[0];

        switch (state) {
            case toInt(VehicleApPowerStateReport::DEEP_SLEEP_ENTRY):
                Log::d(TAG, "AP ready for deep sleep");
                // VMCUì— Deep Sleep ì§„ì… ì‹ í˜¸
                notifyVmcuReadyForSleep();
                break;

            case toInt(VehicleApPowerStateReport::SHUTDOWN_START):
                Log::d(TAG, "AP starting shutdown");
                break;

            default:
                Log::w(TAG, "Unknown power state report: %d", state);
        }

        return StatusCode::OK;
    }
    return StatusCode::INVALID_ARG;
}</code></pre>
            </div>
        </section>

        <!-- Section 8: Power Policy XML Configuration -->
        <section class="section sec-policy-xml">
            <h2 class="section-title">
                <span class="section-number">8</span>
                Power Policy XML ì„¤ì •
            </h2>
            <p class="section-description">
                OEMì´ ì°¨ëŸ‰ íŠ¹ì„±ì— ë§ê²Œ Power Policyë¥¼ ì •ì˜í•˜ëŠ” XML ì„¤ì • íŒŒì¼ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">8-1. car_power_policy.xml ì „ì²´ êµ¬ì¡°</h3>
            <div class="code-block">
                <pre><code class="language-xml">&lt;!-- packages/services/Car/service/res/xml/car_power_policy.xml --&gt;
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;powerPolicy version="1.0"&gt;

    &lt;!-- 1. ì •ì±… ì •ì˜ --&gt;
    &lt;policies&gt;
        &lt;!-- ì‹œìŠ¤í…œ ì¼œì§ ìƒíƒœ --&gt;
        &lt;policy id="system_on"&gt;
            &lt;component id="AUDIO"&gt;on&lt;/component&gt;
            &lt;component id="MEDIA"&gt;on&lt;/component&gt;
            &lt;component id="DISPLAY"&gt;on&lt;/component&gt;
            &lt;component id="WIFI"&gt;on&lt;/component&gt;
            &lt;component id="CELLULAR"&gt;on&lt;/component&gt;
            &lt;component id="ETHERNET"&gt;on&lt;/component&gt;
            &lt;component id="PROJECTION"&gt;on&lt;/component&gt;
            &lt;component id="NFC"&gt;on&lt;/component&gt;
            &lt;component id="INPUT"&gt;on&lt;/component&gt;
            &lt;component id="VOICE_INTERACTION"&gt;on&lt;/component&gt;
            &lt;component id="VISUAL_INTERACTION"&gt;on&lt;/component&gt;
            &lt;component id="TRUSTED_DEVICE_DETECTION"&gt;on&lt;/component&gt;
            &lt;component id="LOCATION"&gt;on&lt;/component&gt;
            &lt;component id="MICROPHONE"&gt;on&lt;/component&gt;
            &lt;component id="BLUETOOTH"&gt;on&lt;/component&gt;
            &lt;component id="CPU"&gt;on&lt;/component&gt;
        &lt;/policy&gt;

        &lt;!-- ì¢…ë£Œ ì¤€ë¹„ ìƒíƒœ (UI Off, ì •ë¦¬ ì‘ì—… ìˆ˜í–‰) --&gt;
        &lt;policy id="no_user_interaction"&gt;
            &lt;component id="AUDIO"&gt;off&lt;/component&gt;
            &lt;component id="MEDIA"&gt;off&lt;/component&gt;
            &lt;component id="DISPLAY"&gt;off&lt;/component&gt;
            &lt;component id="WIFI"&gt;on&lt;/component&gt;  &lt;!-- ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” --&gt;
            &lt;component id="CELLULAR"&gt;on&lt;/component&gt;
            &lt;component id="VOICE_INTERACTION"&gt;off&lt;/component&gt;
            &lt;component id="VISUAL_INTERACTION"&gt;off&lt;/component&gt;
            &lt;component id="INPUT"&gt;off&lt;/component&gt;
            &lt;component id="CPU"&gt;on&lt;/component&gt;  &lt;!-- ì •ë¦¬ ì‘ì—… ìˆ˜í–‰ --&gt;
        &lt;/policy&gt;

        &lt;!-- Suspend-to-RAM ìƒíƒœ --&gt;
        &lt;policy id="suspend_to_ram"&gt;
            &lt;component id="AUDIO"&gt;on&lt;/component&gt;  &lt;!-- ë©”ëª¨ë¦¬ ìœ ì§€ --&gt;
            &lt;component id="MEDIA"&gt;on&lt;/component&gt;  &lt;!-- ë©”ëª¨ë¦¬ ìœ ì§€ --&gt;
            &lt;component id="DISPLAY"&gt;off&lt;/component&gt;
            &lt;component id="WIFI"&gt;off&lt;/component&gt;
            &lt;component id="BLUETOOTH"&gt;off&lt;/component&gt;
            &lt;component id="CPU"&gt;untouched&lt;/component&gt;  &lt;!-- ì»¤ë„ ì œì–´ --&gt;
        &lt;/policy&gt;

        &lt;!-- ì£¼ì°¨ ëª¨ë“œ (ê¸´ ì£¼ì°¨ ì‹œ) --&gt;
        &lt;policy id="parking_mode"&gt;
            &lt;component id="AUDIO"&gt;off&lt;/component&gt;
            &lt;component id="MEDIA"&gt;off&lt;/component&gt;
            &lt;component id="DISPLAY"&gt;off&lt;/component&gt;
            &lt;component id="WIFI"&gt;off&lt;/component&gt;
            &lt;component id="BLUETOOTH"&gt;off&lt;/component&gt;
            &lt;component id="LOCATION"&gt;on&lt;/component&gt;  &lt;!-- ë„ë‚œ ë°©ì§€ --&gt;
            &lt;component id="CELLULAR"&gt;on&lt;/component&gt;  &lt;!-- ì›ê²© ì œì–´ --&gt;
        &lt;/policy&gt;
    &lt;/policies&gt;

    &lt;!-- 2. ì •ì±… ê·¸ë£¹ --&gt;
    &lt;policyGroups&gt;
        &lt;policyGroup id="default_policy_group"&gt;
            &lt;!-- ê¸°ë³¸ ì •ì±… --&gt;
            &lt;defaultPolicy&gt;system_on&lt;/defaultPolicy&gt;

            &lt;!-- ì „ì› ìƒíƒœë³„ ì •ì±… ë§¤í•‘ --&gt;
            &lt;noDefaultPolicy state="wait_for_vhal" policy="system_on"/&gt;
            &lt;noDefaultPolicy state="on" policy="system_on"/&gt;
            &lt;noDefaultPolicy state="shutdown_prepare" policy="no_user_interaction"/&gt;

            &lt;!-- 2ì‹œê°„ ì´ë‚´ ì£¼ì°¨: Suspend-to-RAM --&gt;
            &lt;noDefaultPolicy state="wait_for_vhal" timeout="7200000" policy="suspend_to_ram"/&gt;

            &lt;!-- 2ì‹œê°„ ì´ˆê³¼ ì£¼ì°¨: Parking Mode --&gt;
            &lt;noDefaultPolicy state="wait_for_vhal" timeout="7200001" policy="parking_mode"/&gt;
        &lt;/policyGroup&gt;
    &lt;/policyGroups&gt;

&lt;/powerPolicy&gt;</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">8-2. ì»´í¬ë„ŒíŠ¸ë³„ ì„¤ëª…</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Component ID</th>
                            <th>ì„¤ëª…</th>
                            <th>ON ìƒíƒœ</th>
                            <th>OFF ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AUDIO</td>
                            <td>ì˜¤ë””ì˜¤ ì„œë¸Œì‹œìŠ¤í…œ</td>
                            <td>í¬ì»¤ìŠ¤ ìš”ì²­ í—ˆìš©, ì¶œë ¥ í™œì„±í™”</td>
                            <td>í¬ì»¤ìŠ¤ ê±°ì ˆ, Mute</td>
                        </tr>
                        <tr>
                            <td>MEDIA</td>
                            <td>ë¯¸ë””ì–´ ì¬ìƒ ì„œë¹„ìŠ¤</td>
                            <td>MediaSession í™œì„±, ìë™ ì¬ìƒ ê°€ëŠ¥</td>
                            <td>ì¬ìƒ ì¼ì‹œì •ì§€, ì†ŒìŠ¤ ì €ì¥</td>
                        </tr>
                        <tr>
                            <td>DISPLAY</td>
                            <td>ë””ìŠ¤í”Œë ˆì´ ì¶œë ¥</td>
                            <td>í™”ë©´ ì¼œì§, UI ë Œë”ë§</td>
                            <td>í™”ë©´ êº¼ì§, Backlight OFF</td>
                        </tr>
                        <tr>
                            <td>WIFI</td>
                            <td>Wi-Fi ì—°ê²°</td>
                            <td>ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìœ ì§€</td>
                            <td>ì—°ê²° ì¢…ë£Œ, ì „ë ¥ ì ˆê°</td>
                        </tr>
                        <tr>
                            <td>BLUETOOTH</td>
                            <td>ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°</td>
                            <td>í˜ì–´ë§ ìœ ì§€, ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°</td>
                            <td>ì—°ê²° í•´ì œ</td>
                        </tr>
                        <tr>
                            <td>CELLULAR</td>
                            <td>ì…€ë£°ëŸ¬ ë°ì´í„°</td>
                            <td>ëª¨ë€ í™œì„±, ë°ì´í„° í†µì‹ </td>
                            <td>ëª¨ë€ ëŒ€ê¸° ë˜ëŠ” OFF</td>
                        </tr>
                        <tr>
                            <td>LOCATION</td>
                            <td>GPS ìœ„ì¹˜ ì„œë¹„ìŠ¤</td>
                            <td>GPS ìˆ˜ì‹ , ìœ„ì¹˜ ì—…ë°ì´íŠ¸</td>
                            <td>GPS ë¹„í™œì„±í™”</td>
                        </tr>
                        <tr>
                            <td>VOICE_INTERACTION</td>
                            <td>ìŒì„± ì–´ì‹œìŠ¤í„´íŠ¸</td>
                            <td>í•«ì›Œë“œ ê°ì§€, ìŒì„± ì¸ì‹</td>
                            <td>ìŒì„± ê¸°ëŠ¥ ë¹„í™œì„±í™”</td>
                        </tr>
                        <tr>
                            <td>CPU</td>
                            <td>CPU ì „ì› ê´€ë¦¬</td>
                            <td>ì •ìƒ ë™ì‘</td>
                            <td>ì €ì „ë ¥ ëª¨ë“œ ë˜ëŠ” Sleep</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">8-3. OEM Overlay ì»¤ìŠ¤í„°ë§ˆì´ì§•</h3>
            <div class="code-block">
                <pre><code class="language-xml">&lt;!-- device/oem/project/overlay/packages/services/Car/service/res/xml/car_power_policy.xml --&gt;
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;powerPolicy version="1.0"&gt;

    &lt;policies&gt;
        &lt;!-- OEM ì»¤ìŠ¤í…€ ì •ì±…: ë°°í„°ë¦¬ ì ˆì•½ ëª¨ë“œ --&gt;
        &lt;policy id="oem_battery_saver"&gt;
            &lt;component id="AUDIO"&gt;on&lt;/component&gt;
            &lt;component id="MEDIA"&gt;on&lt;/component&gt;
            &lt;component id="DISPLAY"&gt;on&lt;/component&gt;
            &lt;component id="WIFI"&gt;off&lt;/component&gt;  &lt;!-- Wi-Fi ë¹„í™œì„±í™” --&gt;
            &lt;component id="BLUETOOTH"&gt;on&lt;/component&gt;  &lt;!-- í•¸ì¦ˆí”„ë¦¬ëŠ” ìœ ì§€ --&gt;
            &lt;component id="LOCATION"&gt;off&lt;/component&gt;  &lt;!-- GPS ë¹„í™œì„±í™” --&gt;
            &lt;component id="PROJECTION"&gt;off&lt;/component&gt;  &lt;!-- Android Auto ë¹„í™œì„±í™” --&gt;
        &lt;/policy&gt;

        &lt;!-- OEM ì»¤ìŠ¤í…€: Valet Mode (ëŒ€ë¦¬ ì£¼ì°¨ ëª¨ë“œ) --&gt;
        &lt;policy id="oem_valet_mode"&gt;
            &lt;component id="AUDIO"&gt;on&lt;/component&gt;
            &lt;component id="MEDIA"&gt;off&lt;/component&gt;  &lt;!-- ë¯¸ë””ì–´ ë¹„í™œì„±í™” --&gt;
            &lt;component id="DISPLAY"&gt;on&lt;/component&gt;
            &lt;component id="LOCATION"&gt;on&lt;/component&gt;  &lt;!-- ì¶”ì  í™œì„±í™” --&gt;
            &lt;component id="CELLULAR"&gt;on&lt;/component&gt;
        &lt;/policy&gt;
    &lt;/policies&gt;

    &lt;policyGroups&gt;
        &lt;policyGroup id="oem_policy_group"&gt;
            &lt;defaultPolicy&gt;system_on&lt;/defaultPolicy&gt;

            &lt;!-- ë°°í„°ë¦¬ ì”ëŸ‰ 20% ì´í•˜ ì‹œ ì ˆì•½ ëª¨ë“œ --&gt;
            &lt;noDefaultPolicy state="on" condition="battery_low" policy="oem_battery_saver"/&gt;

            &lt;!-- Valet ëª¨ë“œ í™œì„±í™” ì‹œ --&gt;
            &lt;noDefaultPolicy state="on" condition="valet_mode" policy="oem_valet_mode"/&gt;
        &lt;/policyGroup&gt;
    &lt;/policyGroups&gt;

&lt;/powerPolicy&gt;</code></pre>
            </div>

            <div class="content-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”§</span> ì»¤ìŠ¤í„°ë§ˆì´ì§• í¬ì¸íŠ¸</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ì •ì±… ì¶”ê°€:</strong> ìƒˆ &lt;policy&gt; ì •ì˜ë¡œ OEM íŠ¹í™” ì‹œë‚˜ë¦¬ì˜¤ ì§€ì›</li>
                            <li><strong>íƒ€ì„ì•„ì›ƒ ì¡°ì •:</strong> Suspend ì§„ì… ì‹œê°„ ë³€ê²½ (ê¸°ë³¸ 2ì‹œê°„)</li>
                            <li><strong>ì¡°ê±´ë¶€ ì •ì±…:</strong> ë°°í„°ë¦¬, ì˜¨ë„, ì‚¬ìš©ì ëª¨ë“œì— ë”°ë¥¸ ë™ì  ì „í™˜</li>
                            <li><strong>ì»´í¬ë„ŒíŠ¸ ë¯¸ì„¸ ì¡°ì •:</strong> ë¸Œëœë“œ íŠ¹ì„±ì— ë§ëŠ” ON/OFF ì¡°í•©</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 9: Power State Machine Details -->
        <section class="section sec-state-machine">
            <h2 class="section-title">
                <span class="section-number">9</span>
                ì „ì› ìƒíƒœ ë¨¸ì‹  ìƒì„¸
            </h2>
            <p class="section-description">
                CarPowerManagementServiceê°€ ê´€ë¦¬í•˜ëŠ” ì „ì²´ ì „ì› ìƒíƒœì™€ ì „í™˜ ê·œì¹™ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-blue); font-size: 1.3rem;">9-1. ì „ì²´ ìƒíƒœ ëª©ë¡</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ìƒíƒœ</th>
                            <th>ê°’</th>
                            <th>ì„¤ëª…</th>
                            <th>ë‹¤ìŒ ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>INVALID</td>
                            <td>0</td>
                            <td>ì´ˆê¸° ìƒíƒœ (ì‚¬ìš© ì•ˆ í•¨)</td>
                            <td>WAIT_FOR_VHAL</td>
                        </tr>
                        <tr>
                            <td>WAIT_FOR_VHAL</td>
                            <td>1</td>
                            <td>VHAL ì—°ê²° ëŒ€ê¸° ì¤‘</td>
                            <td>ON, SHUTDOWN_PREPARE</td>
                        </tr>
                        <tr>
                            <td>ON</td>
                            <td>2</td>
                            <td>ì‹œìŠ¤í…œ ì •ìƒ ë™ì‘ (Ignition ON)</td>
                            <td>SHUTDOWN_PREPARE</td>
                        </tr>
                        <tr>
                            <td>SHUTDOWN_PREPARE</td>
                            <td>3</td>
                            <td>ì¢…ë£Œ ì¤€ë¹„ (UI Off, ì •ë¦¬ ì‘ì—…)</td>
                            <td>SHUTDOWN_ENTER, ON (ì·¨ì†Œ)</td>
                        </tr>
                        <tr>
                            <td>SHUTDOWN_ENTER</td>
                            <td>4</td>
                            <td>ì‹¤ì œ ì¢…ë£Œ ì§„ì… (Deep Sleep ë˜ëŠ” Shutdown)</td>
                            <td>(ì¢…ë£Œ)</td>
                        </tr>
                        <tr>
                            <td>SUSPEND</td>
                            <td>5</td>
                            <td>Suspend-to-RAM (S3) ìƒíƒœ</td>
                            <td>ON (Resume)</td>
                        </tr>
                        <tr>
                            <td>SHUTDOWN_CANCELLED</td>
                            <td>6</td>
                            <td>ì¢…ë£Œ ì·¨ì†Œ (ì‚¬ìš©ìê°€ ë‹¤ì‹œ Ignition ON)</td>
                            <td>ON</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-blue); font-size: 1.3rem;">9-2. ìƒíƒœ ì „í™˜ ë‹¤ì´ì–´ê·¸ë¨</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    stateDiagram-v2
                    [*] --> WAIT_FOR_VHAL: Boot

                    WAIT_FOR_VHAL --> ON: VHAL Connected<br/>&amp; IGN ON
                    WAIT_FOR_VHAL --> SHUTDOWN_PREPARE: VHAL Connected<br/>&amp; IGN OFF

                    ON --> SHUTDOWN_PREPARE: Ignition OFF<br/>VHAL Request

                    SHUTDOWN_PREPARE --> SHUTDOWN_ENTER: Cleanup Done<br/>Timeout
                    SHUTDOWN_PREPARE --> SHUTDOWN_CANCELLED: User Action<br/>(IGN ON again)

                    SHUTDOWN_CANCELLED --> ON: Resume Normal

                    SHUTDOWN_ENTER --> SUSPEND: CAN_SLEEP<br/>&amp; STR Enabled
                    SHUTDOWN_ENTER --> [*]: SHUTDOWN_ONLY<br/>(Full Shutdown)

                    SUSPEND --> ON: Wake Up<br/>(Ignition ON)
                    SUSPEND --> [*]: Battery Depleted<br/>(Emergency Shutdown)
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-blue); font-size: 1.3rem;">9-3. ê° ìƒíƒœë³„ ìƒì„¸ ë™ì‘</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”µ</span> ON ìƒíƒœ</h3>
                    <div class="card-description">
                        <ul>
                            <li>ëª¨ë“  ì„œë¹„ìŠ¤ ì •ìƒ ë™ì‘</li>
                            <li>Power Policy: system_on</li>
                            <li>ì‚¬ìš©ì ì¸í„°ë™ì…˜ í™œì„±</li>
                            <li>VHALë¡œë¶€í„° ì „ì› ìƒíƒœ ëª¨ë‹ˆí„°ë§</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸŸ¡</span> SHUTDOWN_PREPARE</h3>
                    <div class="card-description">
                        <ul>
                            <li>Policy: no_user_interaction (AUDIO/MEDIA OFF)</li>
                            <li>ê° ì„œë¹„ìŠ¤ì— onShutdownPrepare() ì½œë°± í˜¸ì¶œ</li>
                            <li>Timeout: ê¸°ë³¸ 60ì´ˆ (config ì„¤ì • ê°€ëŠ¥)</li>
                            <li>ëª¨ë“  ì„œë¹„ìŠ¤ ì‘ë‹µ ëŒ€ê¸° (CompletableFuture)</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸŸ¢</span> SHUTDOWN_ENTER</h3>
                    <div class="card-description">
                        <ul>
                            <li>VHALì— AP_POWER_STATE_REPORT ì „ì†¡</li>
                            <li>Deep Sleep: DEEP_SLEEP_ENTRY</li>
                            <li>Full Shutdown: SHUTDOWN_START</li>
                            <li>ì»¤ë„ì— suspend/shutdown ëª…ë ¹</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ’¤</span> SUSPEND</h3>
                    <div class="card-description">
                        <ul>
                            <li>DRAM ë©”ëª¨ë¦¬ ìœ ì§€ (Self-Refresh)</li>
                            <li>CPU/ì£¼ë³€ì¥ì¹˜ ì „ì› ì°¨ë‹¨</li>
                            <li>ì½”ë“œ ì‹¤í–‰ ì™„ì „ ì¤‘ì§€</li>
                            <li>Wake-up ì‹œ Resumeìœ¼ë¡œ ì¦‰ì‹œ ë³µê·€</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-blue); font-size: 1.3rem;">9-4. Timeout & ì˜ˆì™¸ ì²˜ë¦¬</h3>
            <div class="code-block">
                <pre><code class="language-java">// CarPowerManagementService.java
private static final int SHUTDOWN_PREPARE_TIMEOUT_MS = 60_000; // 60ì´ˆ
private static final int SHUTDOWN_ENTER_TIMEOUT_MS = 10_000;   // 10ì´ˆ

private void handleShutdownPrepare() {
    Log.d(TAG, "Entering SHUTDOWN_PREPARE");

    // ëª¨ë“  ë¦¬ìŠ¤ë„ˆì—ê²Œ ì•Œë¦¼
    List&lt;CompletableFuture&lt;Void&gt;&gt; futures = new ArrayList&lt;&gt;();
    for (CarServiceBase service : mAllServices) {
        CompletableFuture&lt;Void&gt; future = new CompletableFuture&lt;&gt;();
        service.onShutdownPrepare(future);
        futures.add(future);
    }

    // ëª¨ë“  ì„œë¹„ìŠ¤ ì‘ë‹µ ëŒ€ê¸° (Timeout í¬í•¨)
    CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
        .orTimeout(SHUTDOWN_PREPARE_TIMEOUT_MS, TimeUnit.MILLISECONDS)
        .whenComplete((result, exception) -&gt; {
            if (exception != null) {
                Log.w(TAG, "Shutdown prepare timeout or error", exception);
            }
            proceedToShutdownEnter();
        });
}

private void proceedToShutdownEnter() {
    Log.d(TAG, "All services ready, entering SHUTDOWN_ENTER");

    // VHALì— ì¤€ë¹„ ì™„ë£Œ ë³´ê³ 
    reportPowerStateToVhal(VehicleApPowerStateReport.DEEP_SLEEP_ENTRY);

    // ì»¤ë„ Suspend ëª…ë ¹ (Timeout ë³´í˜¸)
    mHandler.postDelayed(() -&gt; {
        Log.w(TAG, "Suspend failed, forcing shutdown");
        forceShutdown();
    }, SHUTDOWN_ENTER_TIMEOUT_MS);

    // Suspend ì‹¤í–‰
    nativeSuspend();
}</code></pre>
            </div>
        </section>

        <!-- Section 10: VHAL Properties -->
        <section class="section sec-vhal">
            <h2 class="section-title">
                <span class="section-number">10</span>
                VHAL Properties
            </h2>
            <p class="section-description">
                ì „ì› ê´€ë¦¬ë¥¼ ìœ„í•œ Vehicle HAL Property êµ¬ì¡°ì™€ í†µì‹  í”„ë¡œí† ì½œì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">10-1. AP_POWER_STATE_REQ (0x0A20)</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>í•„ë“œ</th>
                            <th>íƒ€ì…</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>prop</td>
                            <td>int32</td>
                            <td>0x0A20 (AP_POWER_STATE_REQ)</td>
                        </tr>
                        <tr>
                            <td>value.int32Values[0]</td>
                            <td>VehicleApPowerStateReq</td>
                            <td>ìš”ì²­ íƒ€ì… (ON=1, SHUTDOWN_PREPARE=2, CANCEL=3, FINISHED=4)</td>
                        </tr>
                        <tr>
                            <td>value.int32Values[1]</td>
                            <td>VehicleApPowerStateShutdownParam</td>
                            <td>ì¢…ë£Œ íŒŒë¼ë¯¸í„° (CAN_SLEEP=1, SHUTDOWN_ONLY=2, SLEEP_IMMEDIATELY=3)</td>
                        </tr>
                        <tr>
                            <td>timestamp</td>
                            <td>int64</td>
                            <td>elapsedRealtimeNano()</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">10-2. AP_POWER_STATE_REPORT (0x0A21)</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>í•„ë“œ</th>
                            <th>íƒ€ì…</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>prop</td>
                            <td>int32</td>
                            <td>0x0A21 (AP_POWER_STATE_REPORT)</td>
                        </tr>
                        <tr>
                            <td>value.int32Values[0]</td>
                            <td>VehicleApPowerStateReport</td>
                            <td>ë³´ê³  íƒ€ì… (BOOT_COMPLETE=1, DEEP_SLEEP_ENTRY=2, DEEP_SLEEP_EXIT=3, SHUTDOWN_POSTPONE=4, SHUTDOWN_START=5, DISPLAY_OFF=6, DISPLAY_ON=7)</td>
                        </tr>
                        <tr>
                            <td>value.int32Values[1]</td>
                            <td>int32</td>
                            <td>ì¶”ê°€ íŒŒë¼ë¯¸í„° (SHUTDOWN_POSTPONE ì‹œ ì—°ì¥ ì‹œê°„ ms)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">10-3. VehiclePropValue êµ¬ì¡°</h3>
            <div class="code-block">
                <pre><code class="language-cpp">// hardware/interfaces/automotive/vehicle/2.0/types.hal
struct VehiclePropValue {
    int32_t prop;              // Property ID (e.g., 0x0A20)
    int64_t timestamp;         // elapsedRealtimeNano()
    VehicleAreaConfig areaId;  // ì˜ì—­ (ì „ì—­ = 0)
    VehiclePropStatus status;  // AVAILABLE, UNAVAILABLE, ERROR

    union Value {
        vec&lt;int32_t&gt; int32Values;
        vec&lt;int64_t&gt; int64Values;
        vec&lt;float&gt; floatValues;
        string stringValue;
        vec&lt;uint8_t&gt; bytes;
    } value;
};</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">10-4. VHAL í†µì‹  ì½”ë“œ (C++)</h3>
            <div class="code-block">
                <pre><code class="language-cpp">// packages/services/Car/service/src/com/android/car/hal/PowerHalService.java
// Javaì—ì„œ VHALë¡œ ì „ì†¡
public void sendPowerStateReport(int state, int param) {
    VehiclePropValue value = new VehiclePropValue();
    value.prop = VehicleProperty.AP_POWER_STATE_REPORT;
    value.timestamp = SystemClock.elapsedRealtimeNanos();
    value.value.int32Values = new int[] { state, param };

    try {
        mHal.set(value);
        Log.d(TAG, "Sent AP_POWER_STATE_REPORT: state=" + state + ", param=" + param);
    } catch (Exception e) {
        Log.e(TAG, "Failed to send power state report", e);
    }
}

// VHALë¡œë¶€í„° ìˆ˜ì‹  (Callback)
@Override
public void onPropertyEvent(ArrayList&lt;VehiclePropValue&gt; propValues) {
    for (VehiclePropValue value : propValues) {
        if (value.prop == VehicleProperty.AP_POWER_STATE_REQ) {
            int request = value.value.int32Values.get(0);
            int param = value.value.int32Values.size() &gt; 1
                ? value.value.int32Values.get(1) : 0;

            Log.d(TAG, "Received AP_POWER_STATE_REQ: " + request + ", param=" + param);

            switch (request) {
                case VehicleApPowerStateReq.ON:
                    handlePowerOn();
                    break;
                case VehicleApPowerStateReq.SHUTDOWN_PREPARE:
                    handleShutdownPrepare(param);
                    break;
                case VehicleApPowerStateReq.CANCEL_SHUTDOWN:
                    handleShutdownCancel();
                    break;
            }
        }
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">10-5. Signal ë§¤í•‘ í…Œì´ë¸”</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>VHAL ì‹ í˜¸</th>
                            <th>CPMS ìƒíƒœ</th>
                            <th>íŠ¸ë¦¬ê±°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AP_POWER_STATE_REQ: ON</td>
                            <td>ON</td>
                            <td>Ignition ON, ACC ON</td>
                        </tr>
                        <tr>
                            <td>AP_POWER_STATE_REQ: SHUTDOWN_PREPARE (CAN_SLEEP)</td>
                            <td>SHUTDOWN_PREPARE â†’ SUSPEND</td>
                            <td>Ignition OFF, ì§§ì€ ì£¼ì°¨</td>
                        </tr>
                        <tr>
                            <td>AP_POWER_STATE_REQ: SHUTDOWN_PREPARE (SHUTDOWN_ONLY)</td>
                            <td>SHUTDOWN_PREPARE â†’ (Full Shutdown)</td>
                            <td>Ignition OFF, ê¸´ ì£¼ì°¨ ë˜ëŠ” ë°°í„°ë¦¬ ë¶€ì¡±</td>
                        </tr>
                        <tr>
                            <td>AP_POWER_STATE_REQ: CANCEL_SHUTDOWN</td>
                            <td>SHUTDOWN_CANCELLED â†’ ON</td>
                            <td>ì‚¬ìš©ìê°€ ì¢…ë£Œ ì¤‘ ë‹¤ì‹œ Ignition ON</td>
                        </tr>
                        <tr>
                            <td>AP_POWER_STATE_REQ: FINISHED</td>
                            <td>SHUTDOWN_ENTER</td>
                            <td>CPMSê°€ ì •ë¦¬ ì™„ë£Œ í›„ DEEP_SLEEP_ENTRY ë³´ê³  ì™„ë£Œ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 11: Suspend/Resume Timing Analysis -->
        <section class="section sec-timing">
            <h2 class="section-title">
                <span class="section-number">11</span>
                Suspend/Resume íƒ€ì´ë° ë¶„ì„
            </h2>
            <p class="section-description">
                ì‹¤ì œ ì¸¡ì •ëœ íƒ€ì´ë° ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Suspend ì§„ì… ë° Resume ë³µê·€ ì‹œê°„ì„ ë¶„ì„í•©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">11-1. Suspend ì§„ì… íƒ€ì„ë¼ì¸</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    gantt
                    title Suspend ì§„ì… íƒ€ì„ë¼ì¸ (Ignition OFF â†’ Deep Sleep)
                    dateFormat X
                    axisFormat %L ms

                    section VHAL
                    IGN OFF Signal                 :0, 10
                    AP_POWER_STATE_REQ Send        :10, 20

                    section CPMS
                    Receive REQ                    :30, 10
                    State â†’ SHUTDOWN_PREPARE       :40, 5
                    Apply Power Policy             :45, 15

                    section Services
                    CarAudioService Callback       :60, 100
                    CarMediaService Callback       :60, 150
                    Other Services                 :60, 80

                    section Apps
                    MediaSession Pause             :160, 50
                    Save Playback State            :210, 40

                    section Finalize
                    All Services Done              :250, 10
                    CPMS â†’ SHUTDOWN_ENTER          :260, 5
                    Send DEEP_SLEEP_ENTRY          :265, 15
                    Kernel Suspend Call            :280, 100
                    CPU Halt                       :380, 0
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">11-2. Resume ë³µê·€ íƒ€ì„ë¼ì¸</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    gantt
                    title Resume ë³µê·€ íƒ€ì„ë¼ì¸ (Wake-up â†’ System Ready)
                    dateFormat X
                    axisFormat %L ms

                    section Hardware
                    VMCU Wake Signal               :0, 5
                    Kernel Resume                  :5, 50
                    Driver Init                    :55, 100

                    section CPMS
                    onSleepExit()                  :155, 10
                    State â†’ ON                     :165, 5
                    Apply system_on Policy         :170, 20

                    section Services
                    CarAudioService Enable         :190, 50
                    CarMediaService Restore        :190, 100

                    section Apps
                    MediaConnector Connect         :290, 80
                    MediaSession Restore           :370, 60
                    Autoplay Start                 :430, 50

                    section Complete
                    System Ready                   :480, 0
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">11-3. ì‹¤ì œ íƒ€ì´ë° ì¸¡ì •</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ë‹¨ê³„</th>
                            <th>í‰ê·  ì‹œê°„</th>
                            <th>ìµœì†Œ</th>
                            <th>ìµœëŒ€</th>
                            <th>ë¹„ê³ </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Suspend ì§„ì… (Total)</td>
                            <td>380ms</td>
                            <td>320ms</td>
                            <td>550ms</td>
                            <td>IGN OFF â†’ CPU Halt</td>
                        </tr>
                        <tr>
                            <td>- VHAL ì‹ í˜¸ ì „íŒŒ</td>
                            <td>30ms</td>
                            <td>20ms</td>
                            <td>50ms</td>
                            <td>VMCU â†’ CPMS</td>
                        </tr>
                        <tr>
                            <td>- Power Policy ì ìš©</td>
                            <td>15ms</td>
                            <td>10ms</td>
                            <td>25ms</td>
                            <td>ì •ì±… ì „í™˜</td>
                        </tr>
                        <tr>
                            <td>- ì„œë¹„ìŠ¤ ì •ë¦¬ ì‘ì—…</td>
                            <td>200ms</td>
                            <td>150ms</td>
                            <td>400ms</td>
                            <td>ê°€ì¥ ëŠë¦° ì„œë¹„ìŠ¤ ê¸°ì¤€</td>
                        </tr>
                        <tr>
                            <td>- ì»¤ë„ Suspend</td>
                            <td>100ms</td>
                            <td>80ms</td>
                            <td>150ms</td>
                            <td>ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ Suspend</td>
                        </tr>
                        <tr>
                            <td>Resume ë³µê·€ (Total)</td>
                            <td>480ms</td>
                            <td>400ms</td>
                            <td>650ms</td>
                            <td>Wake-up â†’ Autoplay Start</td>
                        </tr>
                        <tr>
                            <td>- ì»¤ë„ Resume</td>
                            <td>50ms</td>
                            <td>40ms</td>
                            <td>80ms</td>
                            <td>ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ Resume</td>
                        </tr>
                        <tr>
                            <td>- ë“œë¼ì´ë²„ ì´ˆê¸°í™”</td>
                            <td>100ms</td>
                            <td>80ms</td>
                            <td>150ms</td>
                            <td>Audio HAL, Display ë“±</td>
                        </tr>
                        <tr>
                            <td>- ì„œë¹„ìŠ¤ ë³µì›</td>
                            <td>100ms</td>
                            <td>80ms</td>
                            <td>150ms</td>
                            <td>CarAudioService, CarMediaService</td>
                        </tr>
                        <tr>
                            <td>- ì•± ì—°ê²° & ì¬ìƒ</td>
                            <td>200ms</td>
                            <td>150ms</td>
                            <td>300ms</td>
                            <td>MediaBrowser + Autoplay</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">11-4. Critical Path ë¶„ì„</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”´</span> Suspend ë³‘ëª© êµ¬ê°„</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ì„œë¹„ìŠ¤ ì •ë¦¬ (200ms):</strong> ê°€ì¥ ëŠë¦° ì„œë¹„ìŠ¤ê°€ ì „ì²´ ì‹œê°„ ê²°ì •</li>
                            <li>ê°œì„ : onShutdownPrepare() ë‚´ ë™ê¸° ì‘ì—… ìµœì†Œí™”, ë¹„ë™ê¸° ì²˜ë¦¬</li>
                            <li>íƒ€ì„ì•„ì›ƒ ì„¤ì •ìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸŸ¡</span> Resume ë³‘ëª© êµ¬ê°„</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ì•± ì—°ê²° (200ms):</strong> MediaBrowser ë°”ì¸ë“œ + Autoplay</li>
                            <li>ê°œì„ : MediaConnectorService ì‚¬ì „ ì¤€ë¹„, ë³‘ë ¬ ì²˜ë¦¬</li>
                            <li>ì•± ìµœì í™”: onPlaybackResumption() ê²½ëŸ‰í™”</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">11-5. ìµœì í™” í¬ì¸íŠ¸</h3>
            <div class="code-block">
                <pre><code class="language-java">// ìµœì í™” ì˜ˆì‹œ: ë³‘ë ¬ ì²˜ë¦¬
private void handleShutdownPrepare() {
    // ë³‘ë ¬ë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì •ë¦¬ (ìˆœì°¨ ëŒ€ê¸° ì•ˆ í•¨)
    List&lt;CompletableFuture&lt;Void&gt;&gt; futures = mAllServices.stream()
        .map(service -&gt; CompletableFuture.runAsync(() -&gt; {
            try {
                service.onShutdownPrepare();
            } catch (Exception e) {
                Log.e(TAG, "Service cleanup failed", e);
            }
        }, mExecutor))
        .collect(Collectors.toList());

    // ëª¨ë‘ ì™„ë£Œ ë˜ëŠ” íƒ€ì„ì•„ì›ƒ ëŒ€ê¸°
    CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
        .orTimeout(SHUTDOWN_PREPARE_TIMEOUT_MS, TimeUnit.MILLISECONDS)
        .whenComplete((result, ex) -&gt; proceedToShutdownEnter());
}</code></pre>
            </div>
        </section>

        <!-- Section 12: Battery Analysis -->
        <section class="section sec-battery">
            <h2 class="section-title">
                <span class="section-number">12</span>
                ë°°í„°ë¦¬ ì†Œëª¨ ë¶„ì„
            </h2>
            <p class="section-description">
                Suspend-to-RAMê³¼ Full Shutdownì˜ ë°°í„°ë¦¬ ì†Œëª¨ëŸ‰ ë¹„êµ ë° ê¶Œì¥ ì •ì±…ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">12-1. ì „ë ¥ ì†Œë¹„ ë¹„êµ</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ëª¨ë“œ</th>
                            <th>í‰ê·  ì†Œë¹„ ì „ë ¥</th>
                            <th>24ì‹œê°„ ì†Œëª¨ëŸ‰</th>
                            <th>7ì¼ ì†Œëª¨ëŸ‰</th>
                            <th>ë°°í„°ë¦¬ ìˆ˜ëª… ì˜í–¥</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Full Shutdown</td>
                            <td>~5mA</td>
                            <td>0.12Ah</td>
                            <td>0.84Ah</td>
                            <td>ë¬´ì‹œ ê°€ëŠ¥ (&lt;2% ë°©ì „)</td>
                        </tr>
                        <tr>
                            <td>Suspend-to-RAM</td>
                            <td>~50mA</td>
                            <td>1.2Ah</td>
                            <td>8.4Ah</td>
                            <td>ì¤‘ê°„ (~15% ë°©ì „)</td>
                        </tr>
                        <tr>
                            <td>Suspend (DRAMë§Œ)</td>
                            <td>~30mA</td>
                            <td>0.72Ah</td>
                            <td>5.04Ah</td>
                            <td>ë‚®ìŒ (~9% ë°©ì „)</td>
                        </tr>
                        <tr>
                            <td>Parking Mode</td>
                            <td>~100mA</td>
                            <td>2.4Ah</td>
                            <td>16.8Ah</td>
                            <td>ë†’ìŒ (~30% ë°©ì „)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p style="margin-top: 15px; color: var(--text-secondary);">
                * ì¼ë°˜ ì°¨ëŸ‰ ë°°í„°ë¦¬: 55Ah ê¸°ì¤€ (12V, ì•½ 660Wh)
            </p>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">12-2. DRAM Self-Refresh ì „ë ¥</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”‹</span> DDR4 (ì¼ë°˜ì )</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ìš©ëŸ‰:</strong> 4GB DRAM</li>
                            <li><strong>Self-Refresh ì „ë ¥:</strong> ~15mA @ 1.2V = 18mW</li>
                            <li><strong>24ì‹œê°„:</strong> 0.36Ah</li>
                            <li><strong>ìµœëŒ€ ìœ ì§€ ì‹œê°„:</strong> ~7ì¼ (ì´í›„ ìì—° ë°©ì „ ìœ„í—˜)</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš¡</span> LPDDR4 (ì €ì „ë ¥)</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ìš©ëŸ‰:</strong> 4GB LPDDR4</li>
                            <li><strong>Self-Refresh ì „ë ¥:</strong> ~8mA @ 1.1V = 8.8mW</li>
                            <li><strong>24ì‹œê°„:</strong> 0.19Ah</li>
                            <li><strong>ìµœëŒ€ ìœ ì§€ ì‹œê°„:</strong> ~14ì¼</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">12-3. Wake-up ë¹ˆë„ì— ë”°ë¥¸ ì˜í–¥</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì‹œë‚˜ë¦¬ì˜¤</th>
                            <th>Wake-up ë¹ˆë„</th>
                            <th>í‰ê·  ì†Œë¹„</th>
                            <th>24ì‹œê°„ ì†Œëª¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pure Suspend (Wake ì—†ìŒ)</td>
                            <td>0íšŒ</td>
                            <td>30mA</td>
                            <td>0.72Ah</td>
                        </tr>
                        <tr>
                            <td>Periodic Wake (ì‹œê³„ ë™ê¸°í™”)</td>
                            <td>1íšŒ/ì‹œê°„</td>
                            <td>35mA</td>
                            <td>0.84Ah</td>
                        </tr>
                        <tr>
                            <td>Active Monitoring (ë³´ì•ˆ)</td>
                            <td>1íšŒ/10ë¶„</td>
                            <td>50mA</td>
                            <td>1.2Ah</td>
                        </tr>
                        <tr>
                            <td>Frequent Wake (ì„¼ì„œ í´ë§)</td>
                            <td>1íšŒ/ë¶„</td>
                            <td>80mA</td>
                            <td>1.92Ah</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">12-4. ê¶Œì¥ ì •ì±…</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âœ…</span> ì§§ì€ ì£¼ì°¨ (2ì‹œê°„ ì´ë‚´)</h3>
                    <div class="card-description">
                        <strong>ê¶Œì¥:</strong> Suspend-to-RAM
                        <ul>
                            <li>ë¹ ë¥¸ Resume (~500ms)</li>
                            <li>ì™„ë²½í•œ ìƒíƒœ ë³µì›</li>
                            <li>ë°°í„°ë¦¬ ì˜í–¥ ë¯¸ë¯¸ (~0.1Ah)</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš ï¸</span> ì¤‘ê°„ ì£¼ì°¨ (2~12ì‹œê°„)</h3>
                    <div class="card-description">
                        <strong>ê¶Œì¥:</strong> Hybrid (Suspend â†’ Shutdown)
                        <ul>
                            <li>ì²˜ìŒ 2ì‹œê°„: Suspend-to-RAM</li>
                            <li>íƒ€ì„ì•„ì›ƒ í›„: Full Shutdown</li>
                            <li>ë°°í„°ë¦¬ ë³´í˜¸ + í¸ì˜ì„± ê· í˜•</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”´</span> ê¸´ ì£¼ì°¨ (12ì‹œê°„ ì´ìƒ)</h3>
                    <div class="card-description">
                        <strong>ê¶Œì¥:</strong> Full Shutdown
                        <ul>
                            <li>ë°°í„°ë¦¬ ë°©ì „ ë°©ì§€</li>
                            <li>Resume ì‹œê°„ ~6ì´ˆ (í—ˆìš© ê°€ëŠ¥)</li>
                            <li>ì¥ê¸° ì£¼ì°¨ ì‹œ í•„ìˆ˜</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">12-5. Hybrid ì •ì±… ì„¤ì •</h3>
            <div class="code-block">
                <pre><code class="language-xml">&lt;!-- car_power_policy.xml --&gt;
&lt;policyGroup id="battery_optimized_group"&gt;
    &lt;!-- ê¸°ë³¸: Suspend-to-RAM --&gt;
    &lt;defaultPolicy&gt;suspend_to_ram&lt;/defaultPolicy&gt;

    &lt;!-- 2ì‹œê°„ í›„ Full Shutdown ì „í™˜ --&gt;
    &lt;noDefaultPolicy state="wait_for_vhal" timeout="7200000" policy="full_shutdown"/&gt;

    &lt;!-- ë°°í„°ë¦¬ 20% ì´í•˜ ì‹œ ì¦‰ì‹œ Shutdown --&gt;
    &lt;noDefaultPolicy state="wait_for_vhal" condition="battery_low" policy="full_shutdown"/&gt;
&lt;/policyGroup&gt;</code></pre>
            </div>
        </section>

        <!-- Section 13: Wake-up Sources -->
        <section class="section sec-wakeup">
            <h2 class="section-title">
                <span class="section-number">13</span>
                Wake-up ì†ŒìŠ¤
            </h2>
            <p class="section-description">
                Suspend ìƒíƒœì—ì„œ ì‹œìŠ¤í…œì„ ê¹¨ìš¸ ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ Wake-up ì†ŒìŠ¤ì™€ ìš°ì„ ìˆœìœ„ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">13-1. Wake-up ì†ŒìŠ¤ ëª©ë¡</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Wake-up ì†ŒìŠ¤</th>
                            <th>ìš°ì„ ìˆœìœ„</th>
                            <th>íŠ¸ë¦¬ê±°</th>
                            <th>ì‚¬ìš© ì‚¬ë¡€</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ignition ON</td>
                            <td>1 (ìµœê³ )</td>
                            <td>VMCU ì‹ í˜¸ (IGN/ACC ON)</td>
                            <td>ìš´ì „ìê°€ ì‹œë™ í‚¤ ì¡°ì‘</td>
                        </tr>
                        <tr>
                            <td>Door Open</td>
                            <td>2</td>
                            <td>VMCU ì‹ í˜¸ (Door Switch)</td>
                            <td>ì°¨ëŸ‰ ì§„ì…, ì‹¤ë‚´ë“± ìë™ ì¼œì§</td>
                        </tr>
                        <tr>
                            <td>RTC Alarm</td>
                            <td>3</td>
                            <td>ì»¤ë„ RTC íƒ€ì´ë¨¸</td>
                            <td>ì˜ˆì•½ëœ ì‘ì—… (ì‹œê³„ ë™ê¸°í™”, OTA ì²´í¬)</td>
                        </tr>
                        <tr>
                            <td>CAN Message</td>
                            <td>4</td>
                            <td>íŠ¹ì • CAN ID ìˆ˜ì‹ </td>
                            <td>ì›ê²© ì œì–´ (ìŠ¤ë§ˆíŠ¸í° ì•±)</td>
                        </tr>
                        <tr>
                            <td>External GPIO</td>
                            <td>5</td>
                            <td>GPIO ì¸í„°ëŸ½íŠ¸</td>
                            <td>ë²„íŠ¼ ì…ë ¥, ì„¼ì„œ ì´ë²¤íŠ¸</td>
                        </tr>
                        <tr>
                            <td>Cellular Modem</td>
                            <td>6</td>
                            <td>Incoming call/SMS</td>
                            <td>ê¸´ê¸‰ í˜¸ì¶œ, ì›ê²© ì•Œë¦¼</td>
                        </tr>
                        <tr>
                            <td>Low Battery</td>
                            <td>7 (ê¸´ê¸‰)</td>
                            <td>ë°°í„°ë¦¬ ì „ì•• ì €í•˜</td>
                            <td>ë°°í„°ë¦¬ ë³´í˜¸ë¥¼ ìœ„í•œ ì™„ì „ ì¢…ë£Œ</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">13-2. Wake Lock ë©”ì»¤ë‹ˆì¦˜</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant App
                    participant PM as PowerManager
                    participant CPMS
                    participant Kernel

                    App->>PM: acquireWakeLock(PARTIAL_WAKE_LOCK)
                    PM->>CPMS: requestWakeLock()
                    CPMS->>Kernel: /sys/power/wake_lock (write)

                    Note over Kernel: Suspend ì§„ì… ì°¨ë‹¨

                    App->>App: Do Background Work

                    App->>PM: releaseWakeLock()
                    PM->>CPMS: releaseWakeLock()
                    CPMS->>Kernel: /sys/power/wake_unlock (write)

                    Note over Kernel: Suspend ì§„ì… í—ˆìš©
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">13-3. Partial Wake ì‹œë‚˜ë¦¬ì˜¤</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“¡</span> OTA ì—…ë°ì´íŠ¸</h3>
                    <div class="card-description">
                        <ul>
                            <li>RTC Alarmìœ¼ë¡œ ìƒˆë²½ 3ì‹œ Wake-up</li>
                            <li>PARTIAL_WAKE_LOCK íšë“ (CPU ON, Display OFF)</li>
                            <li>ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸ ë‹¤ìš´ë¡œë“œ</li>
                            <li>ì„¤ì¹˜ ì™„ë£Œ í›„ Wake Lock í•´ì œ â†’ Suspend</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”</span> ë„ë‚œ ê²½ë³´</h3>
                    <div class="card-description">
                        <ul>
                            <li>ê°€ì†ë„ê³„ ì„¼ì„œ ì¸í„°ëŸ½íŠ¸ë¡œ Wake-up</li>
                            <li>GPS ìœ„ì¹˜ í™•ì¸</li>
                            <li>ë¹„ì •ìƒ ì›€ì§ì„ ê°ì§€ ì‹œ Cellularë¡œ ì•Œë¦¼</li>
                            <li>30ì´ˆ í›„ ë‹¤ì‹œ Suspend</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">13-4. Wake-up ìš°ì„ ìˆœìœ„ ì½”ë“œ</h3>
            <div class="code-block">
                <pre><code class="language-java">// CarPowerManagementService.java
private void handleWakeUpEvent(int source) {
    Log.d(TAG, "Wake-up event from source: " + source);

    switch (source) {
        case WAKEUP_SOURCE_IGNITION:
            // ìµœìš°ì„ : ì¦‰ì‹œ Full Resume
            Log.d(TAG, "Ignition wake-up: Full system resume");
            transitionToState(CarPowerStateListener.ON);
            break;

        case WAKEUP_SOURCE_DOOR:
            // Displayë§Œ ì¼œê³  ë¶€ë¶„ Resume
            Log.d(TAG, "Door wake-up: Display on, partial resume");
            applyPowerPolicy("door_open_policy"); // DISPLAY=ON, others=untouched
            scheduleAutoSuspend(30_000); // 30ì´ˆ í›„ ë‹¤ì‹œ Suspend
            break;

        case WAKEUP_SOURCE_RTC:
            // Background ì‘ì—…ìš© Partial Wake
            Log.d(TAG, "RTC wake-up: Background tasks only");
            applyPowerPolicy("background_tasks_policy"); // CPU=ON, DISPLAY=OFF
            // Wake Lockì€ ì‘ì—… ì™„ë£Œ ì‹œ ìë™ í•´ì œ
            break;

        case WAKEUP_SOURCE_CAN:
            // ì›ê²© ì œì–´: ìš”ì²­ ì²˜ë¦¬ í›„ ê²°ì •
            Log.d(TAG, "CAN wake-up: Remote control request");
            handleRemoteControlRequest();
            break;

        case WAKEUP_SOURCE_LOW_BATTERY:
            // ê¸´ê¸‰: ì¦‰ì‹œ ì™„ì „ ì¢…ë£Œ
            Log.w(TAG, "Low battery wake-up: Emergency shutdown");
            forceShutdown();
            break;

        default:
            Log.w(TAG, "Unknown wake-up source: " + source);
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">13-5. RTC Alarm ì„¤ì •</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// OTA ì—…ë°ì´íŠ¸ ì˜ˆì•½
class OtaUpdateService : Service() {

    private val alarmManager by lazy {
        getSystemService(AlarmManager::class.java)
    }

    fun scheduleNightlyCheck() {
        val calendar = Calendar.getInstance().apply {
            set(Calendar.HOUR_OF_DAY, 3) // ìƒˆë²½ 3ì‹œ
            set(Calendar.MINUTE, 0)
            if (before(Calendar.getInstance())) {
                add(Calendar.DAY_OF_MONTH, 1) // ë‚´ì¼ 3ì‹œ
            }
        }

        val intent = Intent(this, OtaCheckReceiver::class.java)
        val pendingIntent = PendingIntent.getBroadcast(
            this, 0, intent, PendingIntent.FLAG_IMMUTABLE
        )

        // RTC_WAKEUP: Suspend ìƒíƒœì—ì„œë„ Wake-up
        alarmManager.setExactAndAllowWhileIdle(
            AlarmManager.RTC_WAKEUP,
            calendar.timeInMillis,
            pendingIntent
        )

        Log.d(TAG, "Scheduled OTA check at ${calendar.time}")
    }
}

class OtaCheckReceiver : BroadcastReceiver() {
    override fun onReceive(context: Context, intent: Intent) {
        Log.d(TAG, "RTC alarm fired: Starting OTA check")

        // Partial Wake Lock íšë“
        val powerManager = context.getSystemService(PowerManager::class.java)
        val wakeLock = powerManager.newWakeLock(
            PowerManager.PARTIAL_WAKE_LOCK,
            "OtaUpdate:WakeLock"
        )
        wakeLock.acquire(10 * 60 * 1000L) // ìµœëŒ€ 10ë¶„

        // Background ì‘ì—… ì‹œì‘
        WorkManager.getInstance(context).enqueueUniqueWork(
            "ota_check",
            ExistingWorkPolicy.REPLACE,
            OneTimeWorkRequestBuilder<OtaCheckWorker>().build()
        )
    }
}</code></pre>
            </div>
        </section>

        <!-- Section 14: Android Version History -->
        <section class="section sec-versions">
            <h2 class="section-title">
                <span class="section-number">14</span>
                Android ë²„ì „ë³„ ë³€í™”
            </h2>
            <p class="section-description">
                Android 10 (AAOS ë„ì…)ë¶€í„° Android 15ê¹Œì§€ Power Policy ë° Suspend ê¸°ëŠ¥ì˜ ì§„í™” ê³¼ì •ì…ë‹ˆë‹¤.
            </p>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Android ë²„ì „</th>
                            <th>AAOS ë²„ì „</th>
                            <th>ì£¼ìš” ë³€í™”</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Android 10 (Q)</td>
                            <td>AAOS 1.0</td>
                            <td>
                                <ul>
                                    <li>CarPowerManagementService ìµœì´ˆ ë„ì…</li>
                                    <li>ê¸°ë³¸ Suspend-to-RAM ì§€ì›</li>
                                    <li>VHAL AP_POWER_STATE_REQ/REPORT ì •ì˜</li>
                                    <li>car_power_policy.xml ì„¤ì • íŒŒì¼</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 11 (R)</td>
                            <td>AAOS 2.0</td>
                            <td>
                                <ul>
                                    <li>CarPowerPolicyService ë¶„ë¦¬ (ì •ì±… ê´€ë¦¬ ë…ë¦½)</li>
                                    <li>Component ê¸°ë°˜ ì •ì±… (AUDIO, MEDIA ë“±)</li>
                                    <li>Policy Group ì§€ì› (ì¡°ê±´ë¶€ ì „í™˜)</li>
                                    <li>Shutdown Timeout ì„¤ì • ê°€ëŠ¥</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 12 (S)</td>
                            <td>AAOS 3.0</td>
                            <td>
                                <ul>
                                    <li>addPowerPolicyListener() API ì¶”ê°€</li>
                                    <li>Filter ê¸°ë°˜ ì„ íƒì  ë¦¬ìŠ¤ë„ˆ (ì»´í¬ë„ŒíŠ¸ë³„)</li>
                                    <li>Hybrid ì •ì±… (Timeout ê¸°ë°˜ ì „í™˜)</li>
                                    <li>SHUTDOWN_CANCELLED ìƒíƒœ ì¶”ê°€</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 13 (T)</td>
                            <td>AAOS 4.0</td>
                            <td>
                                <ul>
                                    <li>ë°°í„°ë¦¬ ìµœì í™” ì •ì±… ê°•í™”</li>
                                    <li>Parking Mode ê³µì‹ ì§€ì›</li>
                                    <li>Wake-up ìš°ì„ ìˆœìœ„ ì„¤ì • ê°€ëŠ¥</li>
                                    <li>CarPowerPolicy Builder API</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 14 (U)</td>
                            <td>AAOS 5.0</td>
                            <td>
                                <ul>
                                    <li>Partial Wake ì‹œë‚˜ë¦¬ì˜¤ ì„¸ë¶„í™”</li>
                                    <li>RTC Alarm ì •í™•ë„ ê°œì„ </li>
                                    <li>ë°°í„°ë¦¬ ë³´í˜¸ ëª¨ë“œ (Low Battery Policy)</li>
                                    <li>Privacy Sandbox í†µí•© (Suspend ì‹œ ë°ì´í„° ë³´í˜¸)</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 15 (V)</td>
                            <td>AAOS 6.0</td>
                            <td>
                                <ul>
                                    <li>AI ê¸°ë°˜ ì˜ˆì¸¡ Suspend (ì‚¬ìš© íŒ¨í„´ í•™ìŠµ)</li>
                                    <li>V2X í†µí•© (ì°¨ëŸ‰ ê°„ í†µì‹  Wake-up)</li>
                                    <li>Ultra-Low Power Mode (LPDDR5 ìµœì í™”)</li>
                                    <li>Remote Wake-up API (ìŠ¤ë§ˆíŠ¸í° ì—°ë™)</li>
                                </ul>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">14-1. Deprecated APIs</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš ï¸</span> Android 11 ì´ì „</h3>
                    <div class="card-description">
                        <ul>
                            <li><code>CarPowerManagementService.registerListener()</code> â†’ <code>addPowerPolicyListener()</code></li>
                            <li>ì „ì²´ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ ëŒ€ì‹  ì»´í¬ë„ŒíŠ¸ í•„í„° ê¸°ë°˜ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš©</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ†•</span> Android 13+</h3>
                    <div class="card-description">
                        <ul>
                            <li>CarPowerPolicy.Builder ì‚¬ìš© ê¶Œì¥</li>
                            <li>ëŸ°íƒ€ì„ ì •ì±… ë³€ê²½ API ì¶”ê°€</li>
                            <li>ë ˆê±°ì‹œ XMLë§Œ ì‚¬ìš©í•˜ë˜ ë°©ì‹ì—ì„œ í”„ë¡œê·¸ë˜ë§¤í‹± ì œì–´ ê°€ëŠ¥</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 15: Debugging & Troubleshooting -->
        <section class="section sec-debug">
            <h2 class="section-title">
                <span class="section-number">15</span>
                ë””ë²„ê¹… & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
            </h2>
            <p class="section-description">
                Power Policy ë° Suspend ê´€ë ¨ ë¬¸ì œ ì§„ë‹¨ê³¼ í•´ê²° ë°©ë²•ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">15-1. dumpsys ëª…ë ¹ì–´</h3>
            <div class="code-block">
                <pre><code class="language-bash"># CarPowerManagementService ì „ì²´ ìƒíƒœ
adb shell dumpsys car_service --services CarPowerManagementService

# ì¶œë ¥ ì˜ˆì‹œ:
# Current Power State: ON
# Current Power Policy: system_on
# Components:
#   AUDIO: enabled
#   MEDIA: enabled
#   DISPLAY: enabled
# Registered Listeners: 5
# Last VHAL Event: AP_POWER_STATE_REQ(ON) at 2024-01-15 10:30:45

# CarPowerPolicyService ì •ì±… ì •ë³´
adb shell dumpsys car_service --services CarPowerPolicyService

# ì¶œë ¥ ì˜ˆì‹œ:
# Current Policy: system_on
# Policy Groups:
#   - default_policy_group (active)
# Available Policies:
#   - system_on
#   - no_user_interaction
#   - suspend_to_ram

# ì»¤ë„ Suspend í†µê³„
adb shell cat /sys/power/suspend_stats

# Wake-up ì†ŒìŠ¤ í™•ì¸
adb shell cat /sys/kernel/debug/wakeup_sources

# ë°°í„°ë¦¬ ìƒíƒœ
adb shell dumpsys battery</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">15-2. logcat í•„í„°ë§</h3>
            <div class="code-block">
                <pre><code class="language-bash"># CarPowerManagementService ë¡œê·¸ë§Œ
adb logcat -s CarPowerManagementService:V

# Power ê´€ë ¨ ì „ì²´ ë¡œê·¸
adb logcat | grep -E "(CarPower|PowerHal|Suspend|Wakeup)"

# ìƒíƒœ ì „í™˜ ì¶”ì 
adb logcat | grep "Power state transition"

# ì£¼ìš” ë¡œê·¸ ì˜ˆì‹œ:
# D/CarPowerManagementService: Power state transition: ON -> SHUTDOWN_PREPARE
# D/CarPowerPolicyService: Applying policy: no_user_interaction
# D/CarAudioService: Power policy changed: AUDIO disabled
# D/CarMediaService: MEDIA disabled, pausing playback
# D/PowerHal: Sending AP_POWER_STATE_REPORT: DEEP_SLEEP_ENTRY
# I/Kernel: [suspend] Entering suspend state
# I/Kernel: [resume] Resumed from suspend</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">15-3. ì£¼ìš” ë¬¸ì œ í•´ê²°</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ë¬¸ì œ</th>
                            <th>ì›ì¸</th>
                            <th>í•´ê²° ë°©ë²•</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Suspend ì§„ì… ì‹¤íŒ¨</td>
                            <td>Wake Lockì´ í•´ì œë˜ì§€ ì•ŠìŒ</td>
                            <td><code>adb shell dumpsys power</code>ë¡œ í™œì„± Wake Lock í™•ì¸, í•´ë‹¹ ì•± ì¢…ë£Œ</td>
                        </tr>
                        <tr>
                            <td>Resume í›„ ì˜¤ë””ì˜¤ ì•ˆ ë‚˜ì˜´</td>
                            <td>CarAudioServiceê°€ AUDIO í™œì„±í™” ì•ˆ í•¨</td>
                            <td>Power Policyì—ì„œ AUDIO=on ì„¤ì • í™•ì¸, dumpsysë¡œ ì •ì±… ê²€ì¦</td>
                        </tr>
                        <tr>
                            <td>ë¯¸ë””ì–´ ìë™ ì¬ìƒ ì•ˆ ë¨</td>
                            <td>MEDIA ì»´í¬ë„ŒíŠ¸ê°€ ë¹„í™œì„±í™”ë¨</td>
                            <td>system_on ì •ì±…ì—ì„œ MEDIA=on í™•ì¸, CarMediaService ë¡œê·¸ ì ê²€</td>
                        </tr>
                        <tr>
                            <td>ë°°í„°ë¦¬ ë¹ ë¥´ê²Œ ë°©ì „</td>
                            <td>Suspend ëŒ€ì‹  Shutdown ë¯¸ì‚¬ìš©</td>
                            <td>Hybrid ì •ì±…ìœ¼ë¡œ 2ì‹œê°„ í›„ Full Shutdown ì„¤ì •</td>
                        </tr>
                        <tr>
                            <td>VHAL í†µì‹  ì‹¤íŒ¨</td>
                            <td>VHAL ì„œë¹„ìŠ¤ ë¯¸ì‹¤í–‰ ë˜ëŠ” í¬ë˜ì‹œ</td>
                            <td><code>ps -A | grep vehicle</code>ë¡œ í”„ë¡œì„¸ìŠ¤ í™•ì¸, VHAL ì¬ì‹œì‘</td>
                        </tr>
                        <tr>
                            <td>Shutdown Timeout</td>
                            <td>íŠ¹ì • ì„œë¹„ìŠ¤ê°€ onShutdownPrepare() ì‘ë‹µ ì•ˆ í•¨</td>
                            <td>ë¡œê·¸ì—ì„œ ëŠë¦° ì„œë¹„ìŠ¤ ì‹ë³„, í•´ë‹¹ ì„œë¹„ìŠ¤ ìµœì í™” ë˜ëŠ” Timeout ì¦ê°€</td>
                        </tr>
                        <tr>
                            <td>Resume ì‹œê°„ ë„ˆë¬´ ê¹€ (>1ì´ˆ)</td>
                            <td>ë“œë¼ì´ë²„ ì´ˆê¸°í™” ì§€ì—°</td>
                            <td>ì»¤ë„ ë¡œê·¸ ë¶„ì„, ëŠë¦° ë“œë¼ì´ë²„ ìµœì í™” (Audio HAL, Display ë“±)</td>
                        </tr>
                        <tr>
                            <td>RTC Alarm ë¯¸ë™ì‘</td>
                            <td>AlarmManager.RTC_WAKEUP ëŒ€ì‹  RTC ì‚¬ìš©</td>
                            <td>setExactAndAllowWhileIdle() with RTC_WAKEUP í”Œë˜ê·¸ ì‚¬ìš©</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">15-4. ìˆ˜ë™ í…ŒìŠ¤íŠ¸</h3>
            <div class="code-block">
                <pre><code class="language-bash"># 1. Suspend ê°•ì œ ì§„ì… (í…ŒìŠ¤íŠ¸ìš©)
adb shell dumpsys car_service garage-mode suspend

# 2. Resume ê°•ì œ ì‹¤í–‰
adb shell dumpsys car_service garage-mode resume

# 3. Power Policy ë³€ê²½ í…ŒìŠ¤íŠ¸
adb shell cmd car_service apply-power-policy no_user_interaction

# 4. Wake Lock í™•ì¸
adb shell dumpsys power | grep "Wake Locks"

# 5. Suspend í†µê³„ ì´ˆê¸°í™”
adb shell "echo 0 > /sys/power/suspend_stats"

# 6. íƒ€ì´ë° ì¸¡ì •
adb shell "echo 1 > /sys/power/pm_debug_messages" # ì»¤ë„ ë¡œê·¸ í™œì„±í™”
adb logcat -s Kernel:I | grep suspend

# 7. VHAL ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜ (ì—ë®¬ë ˆì´í„°)
adb shell "echo '0x0A20,1,0' > /sys/class/vhal/vhal_test"  # IGN ON
adb shell "echo '0x0A20,2,1' > /sys/class/vhal/vhal_test"  # SHUTDOWN_PREPARE</code></pre>
            </div>
        </section>

        <!-- Section 16: AOSP Source Code -->
        <section class="section sec-source">
            <h2 class="section-title">
                <span class="section-number">16</span>
                AOSP ì†ŒìŠ¤ ì½”ë“œ ì°¸ì¡°
            </h2>
            <p class="section-description">
                Power Policy ë° Suspend êµ¬í˜„ì„ ì´í•´í•˜ê¸° ìœ„í•œ í•µì‹¬ AOSP ì†ŒìŠ¤ íŒŒì¼ë“¤ì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“‚</span> CarPowerManagementService.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/src/com/android/car/power/CarPowerManagementService.java</code><br>
                        <strong>í•µì‹¬ ê¸°ëŠ¥:</strong>
                        <ul>
                            <li>ì „ì› ìƒíƒœ ë¨¸ì‹  (State Machine)</li>
                            <li>VHAL í†µì‹  (AP_POWER_STATE_REQ/REPORT)</li>
                            <li>Shutdown Prepare íƒ€ì„ì•„ì›ƒ ê´€ë¦¬</li>
                            <li>ì„œë¹„ìŠ¤ ë¦¬ìŠ¤ë„ˆ ì½œë°± í˜¸ì¶œ</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/src/com/android/car/power/CarPowerManagementService.java"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“œ</span> CarPowerPolicyService.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/src/com/android/car/power/CarPowerPolicyService.java</code><br>
                        <strong>í•µì‹¬ ê¸°ëŠ¥:</strong>
                        <ul>
                            <li>Power Policy XML íŒŒì‹±</li>
                            <li>Policy Group ê´€ë¦¬</li>
                            <li>Component í™œì„±í™”/ë¹„í™œì„±í™” ì œì–´</li>
                            <li>addPowerPolicyListener() API</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/src/com/android/car/power/CarPowerPolicyService.java"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”Œ</span> PowerHalService.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/src/com/android/car/hal/PowerHalService.java</code><br>
                        <strong>í•µì‹¬ ê¸°ëŠ¥:</strong>
                        <ul>
                            <li>VHAL Property í†µì‹  ë˜í¼</li>
                            <li>AP_POWER_STATE_REQ ìˆ˜ì‹ </li>
                            <li>AP_POWER_STATE_REPORT ì „ì†¡</li>
                            <li>VehiclePropValue íŒŒì‹±</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/src/com/android/car/hal/PowerHalService.java"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš™ï¸</span> car_power_policy.xml</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/res/xml/car_power_policy.xml</code><br>
                        <strong>ë‚´ìš©:</strong>
                        <ul>
                            <li>ê¸°ë³¸ ì •ì±… ì •ì˜ (system_on, no_user_interaction ë“±)</li>
                            <li>Policy Group ì„¤ì •</li>
                            <li>OEM ì˜¤ë²„ë ˆì´ í…œí”Œë¦¿</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/res/xml/car_power_policy.xml"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ§</span> CarAudioService.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/src/com/android/car/audio/CarAudioService.java</code><br>
                        <strong>Power ì—°ë™:</strong>
                        <ul>
                            <li>addPowerPolicyListener(AUDIO)</li>
                            <li>AUDIO í™œì„±í™” ì‹œ Unmute</li>
                            <li>AUDIO ë¹„í™œì„±í™” ì‹œ Focus ê±°ì ˆ</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/src/com/android/car/audio/CarAudioService.java"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”‹</span> VehicleHal (C++)</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>hardware/interfaces/automotive/vehicle/2.0/default/impl/vhal_v2_0/</code><br>
                        <strong>í•µì‹¬ íŒŒì¼:</strong>
                        <ul>
                            <li>VehicleHalImpl.cpp (Property ì²˜ë¦¬)</li>
                            <li>VehicleEmulator.cpp (ì—ë®¬ë ˆì´í„° ì „ìš©)</li>
                            <li>types.hal (VehiclePropValue ì •ì˜)</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:hardware/interfaces/automotive/vehicle/"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 17: Related Documentation -->
        <section class="section sec-related">
            <h2 class="section-title">
                <span class="section-number">17</span>
                ê´€ë ¨ ìƒì„¸ ë¬¸ì„œ
            </h2>
            <p class="section-description">
                Power Policy & Suspendì™€ ë°€ì ‘í•˜ê²Œ ê´€ë ¨ëœ ë‹¤ë¥¸ ë¬¸ì„œë“¤ì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card clickable" onclick="location.href='aaos-last-media.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸµ</span> Last Media & Autoplay</h3>
                    <div class="card-description">
                        Suspend/Resume ì‹œ ë¯¸ë””ì–´ ìƒíƒœ ì €ì¥/ë³µì›, Autoplay ì •ì±…, SharedPreferences ê¸°ë°˜ persistence
                    </div>
                    <a href="aaos-last-media.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='carmedia.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ“»</span> Car Media Service</h3>
                    <div class="card-description">
                        CarMediaService ì•„í‚¤í…ì²˜, MEDIA ì»´í¬ë„ŒíŠ¸ Power Policy ì—°ë™, Last Media Source ê´€ë¦¬
                    </div>
                    <a href="carmedia.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='audio-framework.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ”Š</span> Audio Framework</h3>
                    <div class="card-description">
                        CarAudioServiceì˜ AUDIO ì»´í¬ë„ŒíŠ¸ ì²˜ë¦¬, Audio Focus Suspend/Resume, Multi-zone ì˜¤ë””ì˜¤
                    </div>
                    <a href="audio-framework.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='aaos.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸš—</span> AAOS Overview</h3>
                    <div class="card-description">
                        Android Automotive OS ì „ì²´ ê°œìš”, CarService ì•„í‚¤í…ì²˜, VHAL í†µì‹ , ì°¨ëŸ‰ ì „ì› ì‹œìŠ¤í…œ
                    </div>
                    <a href="aaos.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='aaos-key-events.html'">
                    <h3 class="card-title"><span class="card-icon">âŒ¨ï¸</span> AAOS Key Events</h3>
                    <div class="card-description">
                        Wake-up ì†ŒìŠ¤ë¡œì„œì˜ í•˜ë“œì›¨ì–´ í‚¤ ì´ë²¤íŠ¸, VHAL HW_KEY_INPUT, Ignition ê°ì§€
                    </div>
                    <a href="aaos-key-events.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='gas.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ”§</span> Google Automotive Services</h3>
                    <div class="card-description">
                        GASì˜ ì „ì› ê´€ë¦¬ í†µí•©, OTA ì—…ë°ì´íŠ¸ RTC Alarm, ì›ê²© ì œì–´ Wake-up
                    </div>
                    <a href="gas.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>
            </div>
        </section>

        <a href="index.html" class="nav-button">â† Back to Dashboard</a>
    </div>

    <script src="scripts/mermaid-theme.js"></script>
    <!-- Navigation & Copy Features -->
    <script src="scripts/copy-code.js"></script>
    <script src="scripts/toc-generator.js"></script>
    <script src="scripts/page-navigation.js"></script>
    <!-- Interactive Diagram Features -->
    <script src="scripts/diagram-data.js"></script>
    <script src="scripts/diagram-interactive.js"></script>

    <script src="scripts/theme-toggle.js?v=2"></script>
    <script src="scripts/lang-switch.js"></script>
</body>

</html>