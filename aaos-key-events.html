<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAOS Key Event Handling | Android Media Framework</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            â† Android Media
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">AAOS Key Event Handling</h1>
            <p class="page-subtitle">Architecture and flow of key events in Android Automotive OS, from hardware input to
                app-level handling.</p>
        </header>

        <!-- Section 1: Input Framework (AOSP) -->
        <section class="section sec-input">
            <h2 class="section-title">
                <span class="section-number">1</span>
                Input Framework (AOSP)
            </h2>
            <p class="section-description">
                AAOSëŠ” í‘œì¤€ Android Input Frameworkë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì§€ë§Œ, ì°¨ëŸ‰ í•˜ë“œì›¨ì–´(í•¸ë“¤ ë¦¬ëª¨ì»¨, ë¡œí„°ë¦¬ ë…¸ë¸Œ ë“±)ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´
                <strong>Vehicle HAL (VHAL)</strong>ì´ ì¶”ê°€ëœ êµ¬ì¡°ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
            </p>
            <div class="mermaid-container">
                <div class="mermaid">
                    graph TD
                    HW[Vehicle Hardware<br />Steering Wheel / Buttons] --> VHAL[Vehicle
                    HAL<br />android.hardware.automotive.vehicle]
                    VHAL -- "VEHICLE_PROPERTY_HW_KEY_INPUT" --> CarService[Car Service]
                    CarService --> InputMgr[InputManagerService]
                    InputMgr --> App[Application]

                    style VHAL fill:#10b981,stroke:#fff,color:#fff
                    style CarService fill:#3b82f6,stroke:#fff,color:#fff
                    style HW fill:#1a1f35,stroke:#9ca3af
                    style InputMgr fill:#1a1f35,stroke:#9ca3af
                    style App fill:#1a1f35,stroke:#9ca3af
                </div>
            </div>
            <p style="margin-top: 20px; color: var(--text-secondary);">
                ê¸°ë³¸ì ì¸ í‚¤ ì´ë²¤íŠ¸ëŠ” Linux Kernel Driver(evdev)ë¥¼ í†µí•´ <code>InputReader</code>ë¡œ ì „ë‹¬ë˜ì§€ë§Œ,
                ì°¨ëŸ‰ íŠ¹í™” í‚¤(Custom Input)ëŠ” VHALì„ í†µí•´ <code>CarService</code>ë¡œ ì „ë‹¬ë˜ì–´ ë³„ë„ ì²˜ë¦¬ë©ë‹ˆë‹¤.
            </p>
        </section>

        <!-- Section 2: Car Service (AAOS Specific) -->
        <section class="section sec-car">
            <h2 class="section-title">
                <span class="section-number">2</span>
                Car Service (AAOS ì „ìš©)
            </h2>
            <p class="section-description">
                <strong>CarInputService</strong>ëŠ” AAOSì—ì„œ ì…ë ¥ ì´ë²¤íŠ¸ë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.
                VHALë¡œë¶€í„° ë°›ì€ ì´ë²¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ íƒ€ê²Ÿ(Cluster, Main Display, Voice Assistant ë“±)ìœ¼ë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸš—</span> CarInputService</h3>
                    <div class="card-description">ì…ë ¥ ì´ë²¤íŠ¸ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³  í•„í„°ë§í•©ë‹ˆë‹¤.
                        íŠ¹ìˆ˜ í‚¤(Voice, Call)ë¥¼ ê°€ë¡œì±„ê±°ë‚˜, ë¡œí„°ë¦¬ ì´ë²¤íŠ¸ë¥¼ í‘œì¤€ í‚¤ ì´ë²¤íŠ¸ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ¹</span> InstrumentClusterRenderingService</h3>
                    <div class="card-description">ê³„ê¸°íŒ(Cluster) ë””ìŠ¤í”Œë ˆì´ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” í‚¤ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                        (ì˜ˆ: í•¸ë“¤ì˜ 'ë‹¤ìŒ ê³¡' ë²„íŠ¼ì´ ê³„ê¸°íŒ UIë¥¼ ì œì–´í•  ë•Œ)</div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”„</span> RotaryController</h3>
                    <div class="card-description">ë¡œí„°ë¦¬ ë…¸ë¸Œ(Rotary Knob) ì…ë ¥ì„ í¬ì»¤ìŠ¤ ì´ë™(Navigation) ì´ë²¤íŠ¸ë¡œ ë³€í™˜í•˜ì—¬
                        í„°ì¹˜ ìŠ¤í¬ë¦°ì´ ì•„ë‹Œ ì¡°ì‘ê³„ì—ì„œë„ ì•±ì„ ì œì–´í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </section>

        <!-- Section 3: Car Input / UX Restriction -->
        <section class="section sec-ux">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Car Input & UX Restriction
            </h2>
            <p class="section-description">
                ìš´ì „ì ì•ˆì „ì„ ìœ„í•´ ì£¼í–‰ ìƒíƒœ(Driving State)ì— ë”°ë¼ ì…ë ¥ ë° UXê°€ ì œí•œë©ë‹ˆë‹¤.
                <strong>CarUxRestrictionsManager</strong>ëŠ” ì°¨ëŸ‰ì˜ ê¸°ì–´ ìƒíƒœ(Parked, Moving)ì— ë”°ë¼ ì•±ì˜ UI ìƒí˜¸ì‘ìš©ì„ ì œì–´í•©ë‹ˆë‹¤.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph LR
                    Sensor[Gear / Speed Sensor] --> CarInfo[CarInfoManager]
                    CarInfo -- "Update State" --> UXR[CarUxRestrictionsManager]
                    UXR -- "onUxRestrictionsChanged()" --> App

                    subgraph App Logic
                    State{Is Moving?}
                    State -- Yes --> Block[Block Input / Hide Video]
                    State -- No --> Allow[Allow Full Interaction]
                    end

                    style UXR fill:#f43f5e,stroke:#fff,color:#fff
                    style Sensor fill:#1a1f35,stroke:#9ca3af
                    style CarInfo fill:#1a1f35,stroke:#9ca3af
                    style App fill:#1a1f35,stroke:#3b82f6
                    style App Logic fill:#1a1f35,stroke:#3b82f6
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ›‘</span> Moving State</h3>
                    <div class="card-description">í‚¤ë³´ë“œ ì…ë ¥ ì°¨ë‹¨, ë¹„ë””ì˜¤ ì¬ìƒ ì¤‘ì§€, ë¦¬ìŠ¤íŠ¸ ìŠ¤í¬ë¡¤ ì œí•œ, ì„¤ì • ë©”ë‰´ ì§„ì… ì œí•œ.</div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âœ…</span> Distraction Optimized</h3>
                    <div class="card-description">ì•±ì€ <code>Distraction Optimized</code>ë¡œ íƒœê¹…ë˜ì–´ì•¼ ì£¼í–‰ ì¤‘ì—ë„ ì œí•œëœ UIë¡œ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Framework Deep Dive: Media & Volume Key Flow -->
        <section class="section sec-car">
            <h2 class="section-title">
                <span class="section-number">4</span>
                Framework Deep Dive: Media & Volume Key Flow
            </h2>
            <p class="section-description">
                AAOSì—ì„œ ë¯¸ë””ì–´ í‚¤(Play/Pause)ì™€ ë³¼ë¥¨ í‚¤ëŠ” ì„œë¡œ ë‹¤ë¥¸ ê²½ë¡œë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                ë¯¸ë””ì–´ í‚¤ëŠ” <strong>MediaSessionService</strong>ë¥¼ í†µí•´ í™œì„± ì„¸ì…˜ìœ¼ë¡œ ì „ë‹¬ë˜ë©°,
                ë³¼ë¥¨ í‚¤ëŠ” <strong>CarAudioService</strong>ë¥¼ í†µí•´ í•˜ë“œì›¨ì–´ ì•°í”„ë¥¼ ì§ì ‘ ì œì–´í•©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">1. Media
                Key Dispatching Flow</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                ë¯¸ë””ì–´ í‚¤ ì´ë²¤íŠ¸(<code>KEYCODE_MEDIA_PLAY</code> ë“±)ëŠ” <code>CarInputService</code>ë¥¼ ê±°ì³
                Android í”„ë ˆì„ì›Œí¬ì˜ <code>MediaSessionService</code>ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
                ì´í›„ ìš°ì„ ìˆœìœ„(Priority)ì— ë”°ë¼ ê°€ì¥ ì ì ˆí•œ MediaSessionì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤.
            </p>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant HW as Vehicle HW
                    participant VHAL as Vehicle HAL
                    participant CIS as CarInputService
                    participant IMS as InputManagerService
                    participant MSS as MediaSessionService
                    participant App as Active Media App

                    HW->>VHAL: Press Play Button
                    VHAL->>CIS: VEHICLE_PROPERTY_HW_KEY_INPUT
                    CIS->>CIS: Filter & Process
                    CIS->>IMS: injectKeyEvent(KEYCODE_MEDIA_PLAY)
                    IMS->>MSS: dispatchMediaKeyEvent()
                    MSS->>MSS: Find Priority Session<br />(Active & PlaybackState)
                    MSS->>App: MediaSession.Callback.onPlay()
                    App->>App: Handle Playback
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ¯</span> Dispatch Priority Logic</h3>
                    <div class="card-description">
                        <ol>
                            <li><strong>Active UI:</strong> í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ì•±ì´ ìµœìš°ì„ .</li>
                            <li><strong>Active Session:</strong> UIê°€ ì—†ë”ë¼ë„ ì¬ìƒ ì¤‘(Active)ì¸ <code>MediaSession</code>.</li>
                            <li><strong>Last Active:</strong> ê°€ì¥ ìµœê·¼ì— ì¬ìƒí–ˆë˜ ì„¸ì…˜ (Resumption ì§€ì› ì‹œ).</li>
                        </ol>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">2.
                Volume Key Handling Flow</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                AAOSì˜ ë³¼ë¥¨ ì œì–´ëŠ” <strong>Fixed Volume</strong> ì •ì±…ì„ ë”°ë¦…ë‹ˆë‹¤.
                ì†Œí”„íŠ¸ì›¨ì–´ ë¯¹ì„œì—ì„œ ë³¼ë¥¨ì„ ì¤„ì´ì§€ ì•Šê³ , <strong>CarAudioService</strong>ê°€ í•˜ë“œì›¨ì–´ ì•°í”„(Audio Control HAL)ì— ì§ì ‘ ê²Œì¸(Gain) ê°’ì„
                ì „ë‹¬í•©ë‹ˆë‹¤.
            </p>
            <div class="mermaid-container">
                <div class="mermaid">
                    graph TD
                    HW[Volume Knob / Button] --> VHAL[Vehicle HAL]
                    VHAL -- "HW_KEY_INPUT" --> CIS[CarInputService]
                    CIS -- "KEYCODE_VOLUME_UP/DOWN" --> CAS[CarAudioService]

                    subgraph Volume Logic
                    CAS --> Group{Identify Volume Group}
                    Group -- "Music Group" --> Current[Get Current Context]
                    Group -- "Navi Group" --> Priority[Check Priority]
                    end

                    CAS -- "setGroupVolume(zone, group, index)" --> HAL[Audio Control HAL]
                    HAL -- "Apply Hardware Gain" --> Amp[Hardware Amplifier]

                    style CAS fill:#ec4899,stroke:#fff,color:#fff
                    style HAL fill:#10b981,stroke:#fff,color:#fff
                    style HW fill:#1a1f35,stroke:#9ca3af
                    style VHAL fill:#1a1f35,stroke:#9ca3af
                    style CIS fill:#1a1f35,stroke:#9ca3af
                    style Volume Logic fill:#1a1f35,stroke:#3b82f6
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”Š</span> Volume Groups & Audio Context</h3>
                    <div class="card-description">
                        <p>
                            <code>CarAudioService</code>ëŠ” ì˜¤ë””ì˜¤ ì†ì„±(Usage)ì— ë”°ë¼ <strong>Volume Group</strong>ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
                            ì˜ˆë¥¼ ë“¤ì–´, ë¯¸ë””ì–´ ë³¼ë¥¨ì„ ì¡°ì ˆí•  ë•Œ ë‚´ë¹„ê²Œì´ì…˜ ì•ˆë‚´ ë³¼ë¥¨ì€ ì˜í–¥ì„ ë°›ì§€ ì•Šë„ë¡ ê·¸ë£¹ë³„ë¡œ ë…ë¦½ì ì¸ ì œì–´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: App Level Handling -->
        <section class="section sec-input">
            <h2 class="section-title">
                <span class="section-number">5</span>
                App ë ˆë²¨ ì²˜ë¦¬
            </h2>
            <p class="section-description">
                ì•± ê°œë°œìëŠ” í‘œì¤€ Android APIë¥¼ ì‚¬ìš©í•˜ì—¬ í‚¤ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ë˜, AAOSì˜ íŠ¹ìˆ˜ì„±ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">Best
                Practices</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âœ…</span> Checklist</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>MediaSession Callback êµ¬í˜„:</strong> <code>onPlay()</code>,
                                <code>onPause()</code>,
                                <code>onSkipToNext()</code> ë“±ì„ êµ¬í˜„í•˜ì—¬ ë¯¸ë””ì–´ í‚¤ì— ëŒ€ì‘í•©ë‹ˆë‹¤.
                            </li>
                            <li><strong>Audio Focus ê´€ë¦¬:</strong> ì¬ìƒ ì‹œì‘ ì „ ë°˜ë“œì‹œ í¬ì»¤ìŠ¤ë¥¼ ìš”ì²­í•˜ê³ ,
                                <code>onAudioFocusChange()</code>ì—ì„œ í¬ì»¤ìŠ¤
                                ì†ì‹¤(Loss)ì— ëŒ€ì‘í•©ë‹ˆë‹¤.
                            </li>
                            <li><strong>UX Restriction ì¤€ìˆ˜:</strong> <code>CarUxRestrictionsManager</code>ë¥¼ êµ¬ë…í•˜ì—¬ ì£¼í–‰ ì¤‘ UIë¥¼
                                ë‹¨ìˆœí™”í•˜ê±°ë‚˜ ì…ë ¥ì„
                                ì°¨ë‹¨í•´ì•¼ í•©ë‹ˆë‹¤.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant HW as HW Button
                    participant CS as CarService
                    participant MS as MediaSession
                    participant App as Media App

                    HW->>CS: Key Event (KEYCODE_MEDIA_PLAY)
                    CS->>MS: Dispatch Media Button
                    MS->>App: onPlay() Callback
                    App->>App: requestAudioFocus()
                    App->>App: Start Playback
                </div>
            </div>
        </section>

        <a href="index.html" class="nav-button">â† Back to Dashboard</a>
    </div>

    <script src="scripts/mermaid-theme.js"></script>
    <script src="scripts/theme-toggle.js"></script>
</body>

</html>
```