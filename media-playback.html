<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaProvider in Media Playback Flow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-card: #1a1f35;
            --bg-card-hover: #222844;
            --accent-primary: #7c3aed;
            --accent-secondary: #a78bfa;
            --accent-tertiary: #c4b5fd;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0f1419 50%, #1a0f2e 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .nav {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: rgba(26, 31, 53, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-button:hover {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--accent-primary);
            transform: translateX(-5px);
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            margin-top: 40px;
            padding: 60px 20px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            font-weight: 300;
            position: relative;
            z-index: 1;
        }

        .section {
            margin-bottom: 80px;
            padding: 40px;
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .section:hover {
            border-color: rgba(124, 58, 237, 0.3);
            box-shadow: 0 10px 40px rgba(124, 58, 237, 0.1);
            transform: translateY(-2px);
        }

        .section:hover::before {
            opacity: 1;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 900;
            color: white;
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
        }

        .section-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            padding-left: 65px;
        }

        .diagram-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            min-height: 300px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateX(5px);
            border-color: rgba(124, 58, 237, 0.4);
            box-shadow: 0 5px 20px rgba(124, 58, 237, 0.15);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .card-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .card-description ul {
            margin-top: 10px;
            padding-left: 20px;
        }

        .card-description li {
            margin-bottom: 8px;
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(124, 58, 237, 0.1);
            padding: 2px 8px;
            border-radius: 4px;
            color: var(--accent-secondary);
            font-size: 0.9em;
        }

        .highlight-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(167, 139, 250, 0.1));
            border-left: 4px solid var(--accent-primary);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .highlight-box strong {
            color: var(--accent-primary);
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1));
            border-left: 4px solid var(--accent-warning);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-box strong {
            color: var(--accent-warning);
        }

        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <nav class="nav">
        <a href="mediaprovider.html" class="nav-button">
            â† MediaProvider Overview
        </a>
    </nav>

    <div class="container">
        <header>
            <h1>ğŸ¬ ë¯¸ë””ì–´ ì¬ìƒ í”Œë¡œìš°</h1>
            <p class="subtitle">MediaProviderì˜ ì—­í• ê³¼ ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ ì¬ìƒ ê³¼ì •</p>
        </header>

        <!-- Section 1: Overview -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-number">1</span>
                Overview: ë¯¸ë””ì–´ ì¬ìƒì—ì„œ MediaProviderì˜ ì—­í• 
            </h2>
            <p class="section-description">
                ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ ì¬ìƒ ì‹œ MediaProviderëŠ” ë¯¸ë””ì–´ íŒŒì¼ ë°œê²¬, ë©”íƒ€ë°ì´í„° ì œê³µ, íŒŒì¼ ì ‘ê·¼ ì œì–´ì˜ í•µì‹¬ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ”</span>
                        ë¯¸ë””ì–´ ë°œê²¬ ë° ì¸ë±ì‹±
                    </h3>
                    <div class="card-description">
                        <p><strong>MediaStoreë¥¼ í†µí•œ ë¯¸ë””ì–´ ê²€ìƒ‰</strong></p>
                        <ul>
                            <li>ì €ì¥ì†Œ ìŠ¤ìº” ë° ë©”íƒ€ë°ì´í„° ì¸ë±ì‹±</li>
                            <li><code>content://</code> URIë¡œ ë¯¸ë””ì–´ ì‹ë³„</li>
                            <li>ì œëª©, ì•„í‹°ìŠ¤íŠ¸, ì•¨ë²”, ì¬ìƒ ì‹œê°„ ë“± ë©”íƒ€ë°ì´í„° ì œê³µ</li>
                            <li>MIME íƒ€ì… ìë™ ê°ì§€</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ“‚</span>
                        íŒŒì¼ ì ‘ê·¼ ì œê³µ
                    </h3>
                    <div class="card-description">
                        <p><strong>ContentResolverë¥¼ í†µí•œ ë°ì´í„° ì ‘ê·¼</strong></p>
                        <ul>
                            <li><code>openFileDescriptor()</code>ë¡œ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œê³µ</li>
                            <li><code>openInputStream()</code>ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¼ ì œê³µ</li>
                            <li>Scoped Storage ê¶Œí•œ ê²€ì‚¬</li>
                            <li>FUSEë¥¼ í†µí•œ ì‹¤ì‹œê°„ ì ‘ê·¼ ì œì–´</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ›¡ï¸</span>
                        ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ
                    </h3>
                    <div class="card-description">
                        <p><strong>ì•ˆì „í•œ ë¯¸ë””ì–´ ì ‘ê·¼</strong></p>
                        <ul>
                            <li>ì•±ë³„ ê¶Œí•œ ê²€ì‚¬ (READ_MEDIA_*)</li>
                            <li>ìœ„ì¹˜ ì •ë³´ ìë™ ì œê±° (Redaction)</li>
                            <li>ë‹¤ë¥¸ ì•±ì˜ ë¯¸ë””ì–´ ë³´í˜¸</li>
                            <li>FUSE Daemonì„ í†µí•œ ì‹¤ì‹œê°„ í•„í„°ë§</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">âš¡</span>
                        ì„±ëŠ¥ ìµœì í™”
                    </h3>
                    <div class="card-description">
                        <p><strong>FUSE Passthrough (Android 12+)</strong></p>
                        <ul>
                            <li>ê¶Œí•œ í™•ì¸ í›„ ì§ì ‘ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼</li>
                            <li>User-space ìš°íšŒë¡œ I/O ì„±ëŠ¥ í–¥ìƒ</li>
                            <li>Random Read ì„±ëŠ¥ ê°œì„ </li>
                            <li>ë„¤ì´í‹°ë¸Œ íŒŒì¼ ì‹œìŠ¤í…œ ìˆ˜ì¤€ì˜ ì†ë„</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Complete Playback Flow -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-number">2</span>
                ì „ì²´ ì¬ìƒ í”Œë¡œìš°
            </h2>
            <p class="section-description">
                ì•±ì´ ë¯¸ë””ì–´ë¥¼ ê²€ìƒ‰í•˜ê³  ì¬ìƒí•˜ê¸°ê¹Œì§€ì˜ ì „ì²´ ê³¼ì •ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.
            </p>

            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant App as Media App
                    participant CR as ContentResolver
                    participant MP as MediaProvider
                    participant DB as SQLite DB
                    participant FUSE as FUSE Daemon
                    participant FS as File System
                    participant Player as MediaPlayer/Extractor

                    Note over App,Player: 1. ë¯¸ë””ì–´ ê²€ìƒ‰ ë‹¨ê³„
                    App->>CR: query(MediaStore.Audio.Media.EXTERNAL_CONTENT_URI)
                    CR->>MP: query() í˜¸ì¶œ
                    MP->>DB: SELECT * FROM audio WHERE...
                    DB-->>MP: Cursor (ë©”íƒ€ë°ì´í„°)
                    MP-->>CR: Cursor ë°˜í™˜
                    CR-->>App: Cursor ë°˜í™˜
                    App->>App: Cursor ìˆœíšŒ ë° URI ì¶”ì¶œ

                    Note over App,Player: 2. íŒŒì¼ ì ‘ê·¼ ë‹¨ê³„
                    App->>CR: openFileDescriptor(content://media/...)
                    CR->>MP: openFile() í˜¸ì¶œ
                    MP->>MP: ê¶Œí•œ ê²€ì‚¬ (READ_MEDIA_AUDIO)
                    MP->>FUSE: FUSE_OPEN ìš”ì²­
                    FUSE->>FUSE: ì•± UID ê²€ì¦
                    FUSE->>FS: ì‹¤ì œ íŒŒì¼ ì—´ê¸°
                    FS-->>FUSE: File Descriptor
                    FUSE->>FUSE: FUSE Passthrough ì„¤ì • (Android 12+)
                    FUSE-->>MP: FD ë°˜í™˜
                    MP-->>CR: ParcelFileDescriptor
                    CR-->>App: ParcelFileDescriptor

                    Note over App,Player: 3. ë¯¸ë””ì–´ ì¬ìƒ ë‹¨ê³„
                    App->>Player: setDataSource(fileDescriptor)
                    Player->>Player: MediaExtractor ì´ˆê¸°í™”
                    Player->>FS: read() - Passthrough í™œì„±í™” ì‹œ ì§ì ‘ ì ‘ê·¼
                    FS-->>Player: ë¯¸ë””ì–´ ë°ì´í„°
                    Player->>Player: ë””ì½”ë”© ë° ë Œë”ë§
                </div>
            </div>

            <div class="highlight-box">
                <strong>í•µì‹¬ í¬ì¸íŠ¸:</strong>
                <ul>
                    <li><strong>1ë‹¨ê³„ (ê²€ìƒ‰)</strong>: MediaProviderì˜ SQLite DBì—ì„œ ë©”íƒ€ë°ì´í„° ì¿¼ë¦¬</li>
                    <li><strong>2ë‹¨ê³„ (ì ‘ê·¼)</strong>: FUSE Daemonì„ í†µí•œ ê¶Œí•œ ê²€ì‚¬ ë° íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œê³µ</li>
                    <li><strong>3ë‹¨ê³„ (ì¬ìƒ)</strong>: MediaPlayer/MediaExtractorê°€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¡œ ì§ì ‘ ì½ê¸°</li>
                    <li><strong>ì„±ëŠ¥</strong>: FUSE Passthroughë¡œ User-space ìš°íšŒ, ë„¤ì´í‹°ë¸Œ ì†ë„ ë‹¬ì„±</li>
                </ul>
            </div>
        </section>

        <!-- Section 3: MediaPlayer Flow -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-number">3</span>
                MediaPlayerë¥¼ í†µí•œ ì¬ìƒ
            </h2>
            <p class="section-description">
                ê³ ìˆ˜ì¤€ APIì¸ MediaPlayerë¥¼ ì‚¬ìš©í•œ ê°„í¸í•œ ë¯¸ë””ì–´ ì¬ìƒ ë°©ì‹ì…ë‹ˆë‹¤.
            </p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TD
                    START[ì•± ì‹œì‘] --> QUERY[MediaStore ì¿¼ë¦¬]
                    QUERY --> URI[content:// URI íšë“]
                    URI --> MP_CREATE[MediaPlayer ìƒì„±]

                    MP_CREATE --> SET_DS{setDataSource ë°©ì‹}

                    SET_DS -->|ë°©ë²• 1| URI_DS[setDataSource<br />context, uri]
                    SET_DS -->|ë°©ë²• 2| FD_DS[setDataSource<br />fileDescriptor]

                    URI_DS --> MP_INTERNAL[MediaPlayer ë‚´ë¶€<br />ContentResolver í˜¸ì¶œ]
                    FD_DS --> SKIP[ì•±ì´ ì§ì ‘<br />FD íšë“]

                    MP_INTERNAL --> OPEN_FD[openFileDescriptor]
                    SKIP --> OPEN_FD

                    OPEN_FD --> FUSE_CHECK[FUSE Daemon<br />ê¶Œí•œ ê²€ì‚¬]
                    FUSE_CHECK --> PASSTHROUGH{FUSE Passthrough<br />ê°€ëŠ¥?<br />Android 12+}

                    PASSTHROUGH -->|Yes| DIRECT[ì§ì ‘ íŒŒì¼<br />ì‹œìŠ¤í…œ ì ‘ê·¼]
                    PASSTHROUGH -->|No| USERSPACE[User-space<br />ê²½ìœ  ì ‘ê·¼]

                    DIRECT --> PREPARE[prepare /<br />prepareAsync]
                    USERSPACE --> PREPARE

                    PREPARE --> START_PLAY[start]
                    START_PLAY --> DECODE[ë””ì½”ë”© ë° ì¬ìƒ]
                    DECODE --> END[ì¬ìƒ ì™„ë£Œ]

                    style FUSE_CHECK fill:#1a1f35,stroke:#7c3aed,stroke-width:2px
                    style PASSTHROUGH fill:#1a1f35,stroke:#10b981,stroke-width:2px
                    style DIRECT fill:#1a1f35,stroke:#10b981,stroke-width:2px
                    style USERSPACE fill:#1a1f35,stroke:#f59e0b,stroke-width:2px
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                ğŸ“ MediaPlayer ì‚¬ìš© ë°©ì‹
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">1ï¸âƒ£</span>
                        URI ë°©ì‹ (ê¶Œì¥)
                    </h3>
                    <div class="card-description">
                        <p><strong>ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•</strong></p>
                        <ul>
                            <li><code>setDataSource(context, uri)</code></li>
                            <li>MediaPlayerê°€ ë‚´ë¶€ì ìœ¼ë¡œ ContentResolver í˜¸ì¶œ</li>
                            <li>ê¶Œí•œ ì²˜ë¦¬ ìë™í™”</li>
                            <li>Scoped Storage ì™„ë²½ ì§€ì›</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">2ï¸âƒ£</span>
                        FileDescriptor ë°©ì‹
                    </h3>
                    <div class="card-description">
                        <p><strong>ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥</strong></p>
                        <ul>
                            <li>ì•±ì´ ì§ì ‘ <code>openFileDescriptor()</code> í˜¸ì¶œ</li>
                            <li><code>setDataSource(fileDescriptor)</code></li>
                            <li>ì˜¤í”„ì…‹ ë° ê¸¸ì´ ì§€ì • ê°€ëŠ¥</li>
                            <li>ì—¬ëŸ¬ MediaPlayer ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì¬ì‚¬ìš©</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">âš ï¸</span>
                        ì£¼ì˜ì‚¬í•­
                    </h3>
                    <div class="card-description">
                        <p><strong>íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œì•½</strong></p>
                        <ul>
                            <li>Seekable FD í•„ìš” (Pipe ë¶ˆê°€)</li>
                            <li><code>ParcelFileDescriptor.createPipe()</code> ì‚¬ìš© ë¶ˆê°€</li>
                            <li>MediaPlayerëŠ” Random Access í•„ìš”</li>
                            <li><code>openFileDescriptor()</code> ì‚¬ìš© ê¶Œì¥</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸš€</span>
                        ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­
                    </h3>
                    <div class="card-description">
                        <p><strong>ìµœì í™” íŒ</strong></p>
                        <ul>
                            <li><code>prepareAsync()</code> ì‚¬ìš© (UI Thread ë¸”ë¡œí‚¹ ë°©ì§€)</li>
                            <li>FUSE Passthrough í™œìš© (Android 12+)</li>
                            <li>ë¡œì»¬ íŒŒì¼ì€ URI ë°©ì‹ì´ íš¨ìœ¨ì </li>
                            <li>ìŠ¤íŠ¸ë¦¬ë°ì€ URL ë°©ì‹ ì‚¬ìš©</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: MediaExtractor Flow -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-number">4</span>
                MediaExtractorë¥¼ í†µí•œ ì¬ìƒ
            </h2>
            <p class="section-description">
                ì €ìˆ˜ì¤€ APIì¸ MediaExtractorì™€ MediaCodecì„ ì‚¬ìš©í•œ ê³ ê¸‰ ë¯¸ë””ì–´ ì²˜ë¦¬ ë°©ì‹ì…ë‹ˆë‹¤.
            </p>

            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant App
                    participant CR as ContentResolver
                    participant MP as MediaProvider
                    participant FUSE as FUSE Daemon
                    participant FS as File System
                    participant ME as MediaExtractor
                    participant MC as MediaCodec

                    App->>CR: openFileDescriptor(uri)
                    CR->>MP: openFile()
                    MP->>FUSE: FUSE_OPEN
                    FUSE->>FS: íŒŒì¼ ì—´ê¸°
                    FS-->>FUSE: FD
                    FUSE->>FUSE: Passthrough ì„¤ì •
                    FUSE-->>MP: FD
                    MP-->>CR: ParcelFileDescriptor
                    CR-->>App: ParcelFileDescriptor

                    App->>ME: setDataSource(fileDescriptor)
                    ME->>FS: ì»¨í…Œì´ë„ˆ íŒŒì‹± (MP4, MKV ë“±)
                    FS-->>ME: íŠ¸ë™ ì •ë³´
                    ME-->>App: Track Count ë°˜í™˜

                    App->>ME: selectTrack(trackIndex)
                    App->>MC: MediaCodec ìƒì„± ë° configure()
                    App->>MC: start()

                    loop ë””ì½”ë”© ë£¨í”„
                    App->>ME: readSampleData(buffer)
                    ME->>FS: read() - Passthroughë¡œ ì§ì ‘ ì ‘ê·¼
                    FS-->>ME: ì¸ì½”ë”©ëœ ìƒ˜í”Œ ë°ì´í„°
                    ME-->>App: ìƒ˜í”Œ ë°ì´í„° ë°˜í™˜

                    App->>MC: queueInputBuffer()
                    MC->>MC: í•˜ë“œì›¨ì–´ ë””ì½”ë”©
                    MC-->>App: dequeueOutputBuffer()
                    App->>App: ë Œë”ë§ (AudioTrack/Surface)

                    App->>ME: advance()
                    end

                    App->>ME: release()
                    App->>MC: release()
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                ğŸ”§ MediaExtractorì˜ ì¥ì 
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ›ï¸</span>
                        ì„¸ë°€í•œ ì œì–´
                    </h3>
                    <div class="card-description">
                        <p><strong>í”„ë ˆì„ ë‹¨ìœ„ ì²˜ë¦¬</strong></p>
                        <ul>
                            <li>ê°œë³„ ìƒ˜í”Œ ë°ì´í„° ì ‘ê·¼</li>
                            <li>Presentation Timestamp ì œì–´</li>
                            <li>íŠ¹ì • íŠ¸ë™ ì„ íƒ (ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤/ìë§‰)</li>
                            <li>Seek ìœ„ì¹˜ ì •ë°€ ì œì–´</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ¨</span>
                        ì»¤ìŠ¤í…€ ì²˜ë¦¬
                    </h3>
                    <div class="card-description">
                        <p><strong>ë¯¸ë””ì–´ í¸ì§‘ ë° ë³€í™˜</strong></p>
                        <ul>
                            <li>ë¹„ë””ì˜¤ í¸ì§‘ (ìë¥´ê¸°, ë³‘í•©)</li>
                            <li>í¬ë§· ë³€í™˜ (Transcoding)</li>
                            <li>í•„í„° ì ìš© (ìƒ‰ìƒ ë³´ì •, ì´í™íŠ¸)</li>
                            <li>ì˜¤ë””ì˜¤ ë¯¹ì‹±</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ“Š</span>
                        ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
                    </h3>
                    <div class="card-description">
                        <p><strong>ìƒì„¸ ì •ë³´ íšë“</strong></p>
                        <ul>
                            <li>ì½”ë± ì •ë³´ (MIME, Profile, Level)</li>
                            <li>í•´ìƒë„ ë° í”„ë ˆì„ë ˆì´íŠ¸</li>
                            <li>ë¹„íŠ¸ë ˆì´íŠ¸ ë° ìƒ˜í”Œë ˆì´íŠ¸</li>
                            <li>ì¬ìƒ ì‹œê°„ ë° íŠ¸ë™ ìˆ˜</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">âš¡</span>
                        ì„±ëŠ¥ ìµœì í™”
                    </h3>
                    <div class="card-description">
                        <p><strong>íš¨ìœ¨ì ì¸ ë°ì´í„° ì²˜ë¦¬</strong></p>
                        <ul>
                            <li>Zero-Copy ë²„í¼ ì‚¬ìš©</li>
                            <li>í•˜ë“œì›¨ì–´ ê°€ì† ë””ì½”ë”©</li>
                            <li>FUSE Passthroughë¡œ I/O ìµœì í™”</li>
                            <li>ë¹„ë™ê¸° ì²˜ë¦¬ ê°€ëŠ¥</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: FUSE Passthrough Performance -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-number">5</span>
                FUSE Passthrough ì„±ëŠ¥ ìµœì í™”
            </h2>
            <p class="section-description">
                Android 12+ì—ì„œ ë„ì…ëœ FUSE PassthroughëŠ” ë¯¸ë””ì–´ ì¬ìƒ ì„±ëŠ¥ì„ íšê¸°ì ìœ¼ë¡œ ê°œì„ í•©ë‹ˆë‹¤.
            </p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    subgraph LEGACY ["Legacy FUSE - Android 11"]
                    direction TB
                    L_APP[App] --> L_KERNEL[Kernel FUSE]
                    L_KERNEL --> L_DAEMON[FUSE Daemon<br />User-space]
                    L_DAEMON --> L_KERNEL2[Kernel]
                    L_KERNEL2 --> L_FS[File System]
                    end

                    subgraph PASSTHROUGH ["FUSE Passthrough - Android 12+"]
                    direction TB
                    P_APP[App] --> P_KERNEL[Kernel FUSE]
                    P_KERNEL --> P_CHECK{ê¶Œí•œ í™•ì¸<br />ìµœì´ˆ 1íšŒ}
                    P_CHECK -->|í—ˆìš©| P_DIRECT[Direct Access<br />Kernel Only]
                    P_DIRECT --> P_FS[File System]
                    P_CHECK -.->|ê²€ì‚¬ë§Œ| P_DAEMON[FUSE Daemon]
                    end

                    LEGACY -.->|ì„±ëŠ¥ ê°œì„ | PASSTHROUGH

                    style L_DAEMON fill:#1a1f35,stroke:#f59e0b,stroke-width:2px
                    style P_DIRECT fill:#1a1f35,stroke:#10b981,stroke-width:3px
                    style P_CHECK fill:#1a1f35,stroke:#7c3aed,stroke-width:2px
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                ğŸ“ˆ ì„±ëŠ¥ ë¹„êµ
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸŒ</span>
                        Legacy FUSE (Android 11)
                    </h3>
                    <div class="card-description">
                        <p><strong>User-space ê²½ìœ </strong></p>
                        <ul>
                            <li>ëª¨ë“  read/writeê°€ FUSE Daemon ê²½ìœ </li>
                            <li>Kernel â†” User-space ì „í™˜ ì˜¤ë²„í—¤ë“œ</li>
                            <li>Random Read ì„±ëŠ¥ ì €í•˜</li>
                            <li>ì¤‘ì €ê°€ ê¸°ê¸°ì—ì„œ ì„±ëŠ¥ ë¬¸ì œ</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸš€</span>
                        FUSE Passthrough (Android 12+)
                    </h3>
                    <div class="card-description">
                        <p><strong>ì§ì ‘ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼</strong></p>
                        <ul>
                            <li>ìµœì´ˆ ê¶Œí•œ í™•ì¸ í›„ ì§ì ‘ ì ‘ê·¼</li>
                            <li>User-space ìš°íšŒ</li>
                            <li>ë„¤ì´í‹°ë¸Œ íŒŒì¼ ì‹œìŠ¤í…œ ìˆ˜ì¤€ ì„±ëŠ¥</li>
                            <li>ë¯¸ë””ì–´ ì¬ìƒ ëŠê¹€ í˜„ìƒ í•´ê²°</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">âš™ï¸</span>
                        Passthrough ë™ì‘ ë°©ì‹
                    </h3>
                    <div class="card-description">
                        <p><strong>ioctl ê¸°ë°˜ ìµœì í™”</strong></p>
                        <ul>
                            <li><code>FUSE_DEV_IOC_PASSTHROUGH_OPEN</code> ioctl ì‚¬ìš©</li>
                            <li>FUSE íŒŒì¼ ê°ì²´ â†” í•˜ìœ„ íŒŒì¼ ê°ì²´ ì§ì ‘ ì—°ê²°</li>
                            <li>Read/Writeë§Œ Passthrough (ë‹¤ë¥¸ ì‘ì—…ì€ Daemon ê²½ìœ )</li>
                            <li>ì •ì±… ê¸°ë°˜ ì„ íƒì  ì ìš©</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ“Š</span>
                        ì„±ëŠ¥ í–¥ìƒ ìˆ˜ì¹˜
                    </h3>
                    <div class="card-description">
                        <p><strong>ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼</strong></p>
                        <ul>
                            <li>Random Read: ì•½ 2~3ë°° í–¥ìƒ</li>
                            <li>Sequential Write: ì•½ 1.5~2ë°° í–¥ìƒ</li>
                            <li>4K ë¹„ë””ì˜¤ ì¬ìƒ ëŠê¹€ í˜„ìƒ ì œê±°</li>
                            <li>ì €ê°€ ê¸°ê¸°ì—ì„œ íŠ¹íˆ í° íš¨ê³¼</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <strong>âš ï¸ ì¶”ê°€ ìµœì í™” ê¸°ë²•:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li><strong>Splicing</strong>: ë°ì´í„° ë³µì‚¬ ìµœì†Œí™”</li>
                    <li><strong>Write-back Cache</strong>: FUSE ì“°ê¸° ìºì‹œ í™œìš©</li>
                    <li><strong>Permission Caching</strong>: ê¶Œí•œ ê²€ì‚¬ ê²°ê³¼ ìºì‹±ìœ¼ë¡œ IPC ê°ì†Œ</li>
                    <li><strong>FUSE Bypass</strong>: <code>/Android/data</code>, <code>/Android/obb</code> ë””ë ‰í† ë¦¬ëŠ” FUSE
                        ìš°íšŒ</li>
                </ul>
            </div>
        </section>

        <!-- Section 6: Best Practices -->
        <section class="section">
            <h2 class="section-title">
                <span class="section-number">6</span>
                ë¯¸ë””ì–´ ì¬ìƒ Best Practices
            </h2>
            <p class="section-description">
                MediaProviderë¥¼ í™œìš©í•œ íš¨ìœ¨ì ì¸ ë¯¸ë””ì–´ ì¬ìƒì„ ìœ„í•œ ê¶Œì¥ì‚¬í•­ì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">âœ…</span>
                        ê¶Œì¥ ì‚¬í•­
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>URI ì‚¬ìš©</strong>: <code>content://</code> URIë¡œ ë¯¸ë””ì–´ ì ‘ê·¼</li>
                            <li><strong>MediaStore í™œìš©</strong>: íŒŒì¼ ê²½ë¡œ ëŒ€ì‹  MediaStore API ì‚¬ìš©</li>
                            <li><strong>ë¹„ë™ê¸° ì²˜ë¦¬</strong>: <code>prepareAsync()</code>ë¡œ UI Thread ë³´í˜¸</li>
                            <li><strong>ê¶Œí•œ ìš”ì²­</strong>: <code>READ_MEDIA_*</code> ê¶Œí•œ ëª…ì‹œì  ìš”ì²­</li>
                            <li><strong>ë¦¬ì†ŒìŠ¤ í•´ì œ</strong>: <code>release()</code>ë¡œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">âŒ</span>
                        í”¼í•´ì•¼ í•  ì‚¬í•­
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ì§ì ‘ íŒŒì¼ ê²½ë¡œ</strong>: <code>/storage/emulated/0/...</code> ì§ì ‘ ì ‘ê·¼ ì§€ì–‘</li>
                            <li><strong>Pipe ì‚¬ìš©</strong>: MediaPlayerì— Pipe FileDescriptor ì „ë‹¬ ë¶ˆê°€</li>
                            <li><strong>UI Thread ë¸”ë¡œí‚¹</strong>: <code>prepare()</code>ëŒ€ì‹  <code>prepareAsync()</code>
                            </li>
                            <li><strong>ê¶Œí•œ ë¯¸í™•ì¸</strong>: ê¶Œí•œ ì—†ì´ ë¯¸ë””ì–´ ì ‘ê·¼ ì‹œë„</li>
                            <li><strong>ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜</strong>: MediaPlayer/MediaExtractor ë¯¸í•´ì œ</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ¯</span>
                        ì„±ëŠ¥ ìµœì í™”
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Android 12+ íƒ€ê²Ÿ</strong>: FUSE Passthrough í™œìš©</li>
                            <li><strong>ë¡œì»¬ íŒŒì¼</strong>: URI ë°©ì‹ì´ ê°€ì¥ íš¨ìœ¨ì </li>
                            <li><strong>ìŠ¤íŠ¸ë¦¬ë°</strong>: HTTP URL ì§ì ‘ ì‚¬ìš©</li>
                            <li><strong>ëŒ€ìš©ëŸ‰ íŒŒì¼</strong>: MediaExtractorë¡œ ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬</li>
                            <li><strong>ìºì‹±</strong>: ìì£¼ ì‚¬ìš©í•˜ëŠ” ë©”íƒ€ë°ì´í„° ìºì‹±</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ”’</span>
                        ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Scoped Storage ì¤€ìˆ˜</strong>: Android 10+ ì •ì±… ë”°ë¥´ê¸°</li>
                            <li><strong>ìµœì†Œ ê¶Œí•œ ì›ì¹™</strong>: í•„ìš”í•œ ê¶Œí•œë§Œ ìš”ì²­</li>
                            <li><strong>ì‚¬ìš©ì ë™ì˜</strong>: ë‹¤ë¥¸ ì•± ë¯¸ë””ì–´ ìˆ˜ì • ì‹œ ë™ì˜ íšë“</li>
                            <li><strong>ë¯¼ê° ì •ë³´ ë³´í˜¸</strong>: ìœ„ì¹˜ ì •ë³´ ë“± Redaction ì¸ì§€</li>
                            <li><strong>ì•ˆì „í•œ URI</strong>: ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ì˜ URIë§Œ ì‚¬ìš©</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer
            style="text-align: center; padding: 40px 20px; color: var(--text-muted); border-top: 1px solid var(--border-color); margin-top: 60px;">
            <p>MediaProvider in Media Playback Flow</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Audio/Video Playback Architecture & Performance Optimization
            </p>
            <p style="margin-top: 20px;">
                <a href="mediaprovider.html" style="color: var(--accent-primary); text-decoration: none;">
                    â† MediaProvider Overviewë¡œ ëŒì•„ê°€ê¸°
                </a>
                |
                <a href="index.html" style="color: var(--accent-primary); text-decoration: none;">
                    AOSP Media Frameworkë¡œ ëŒì•„ê°€ê¸°
                </a>
            </p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#1a1f35',
                primaryTextColor: '#e5e7eb',
                primaryBorderColor: '#7c3aed',
                lineColor: '#a78bfa',
                secondaryColor: '#111827',
                tertiaryColor: '#0a0e1a',
                background: '#0a0e1a',
                mainBkg: '#1a1f35',
                secondBkg: '#111827',
                border1: '#7c3aed',
                border2: '#a78bfa',
                note: '#c4b5fd',
                noteBkgColor: 'rgba(124, 58, 237, 0.1)',
                noteBorderColor: '#7c3aed',
                fontFamily: 'Noto Sans KR'
            },
            flowchart: {
                curve: 'basis',
                padding: 20,
                nodeSpacing: 50,
                rankSpacing: 50
            },
            sequence: {
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35
            }
        });

        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.section').forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(30px)';
            section.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
            observer.observe(section);
        });
    </script>
</body>

</html>