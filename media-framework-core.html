<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Framework Core</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            ← Android Media
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">Media Framework Core</h1>
            <p class="page-subtitle">Android 미디어 프레임워크의 핵심 아키텍처 및 계층별 상세 구조</p>
        </header>

        <!-- Section 1: Overall Architecture -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">1</span>
                전체 아키텍처
            </h2>
            <p class="section-description">
                AOSP Media Framework는 Application부터 Hardware까지 여러 레이어로 구성된 복잡한 구조입니다.
                각 레이어는 명확하게 정의된 인터페이스를 통해 상호작용합니다.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph APP["Application Layer"]
                    A1["Application<br />(Java/Kotlin)"]
                    end

                    subgraph FRAMEWORK["Application Framework Layer"]
                    F1["android.media APIs"]
                    F2["MediaPlayer"]
                    F3["MediaCodec"]
                    F4["MediaRecorder"]
                    end

                    subgraph JNI["JNI Bridge"]
                    J1["JNI Glue Classes"]
                    end

                    subgraph NATIVE["Native Framework Layer"]
                    N1["libmedia"]
                    N2["Stagefright Engine"]
                    N3["MediaExtractor"]
                    N4["NuPlayer / AwesomePlayer"]
                    N5["CCodec<br />(Codec2 Entry)"]
                    N6["ACodec<br />(OMX Entry)"]
                    end

                    subgraph BINDER["Binder IPC"]
                    B1["Binder Proxies"]
                    end

                    subgraph SERVER["Media Server"]
                    S1["MediaPlayerService"]
                    S2["AudioFlinger"]
                    S3["CameraService"]
                    end

                    subgraph CODEC2["Codec2 Framework (Modern)"]
                    C2_1["Codec2Client"]
                    C2_2["C2Component"]
                    C2_3["C2ComponentStore"]
                    C2_4["C2BufferChannel"]
                    end

                    subgraph OMX["OpenMAX IL (Legacy)"]
                    O1["OMXCodec"]
                    O2["OMX Components"]
                    end

                    subgraph HAL["Hardware Abstraction Layer"]
                    H1["Audio HAL<br />(Core/Effects)"]
                    H2["Codec2 HAL"]
                    H3["Camera HAL"]
                    end

                    subgraph KERNEL["Linux Kernel & Drivers"]
                    K1["ALSA Driver"]
                    K2["V4L2 Driver"]
                    K3["Hardware Codecs"]
                    end

                    A1 --> F1
                    F1 --> F2 & F3 & F4
                    F2 & F3 & F4 --> J1
                    J1 --> N1
                    N1 --> N2
                    N2 --> N3 & N4
                    N4 --> N5 & N6
                    N5 --> C2_1
                    N6 --> O1

                    N1 --> B1
                    B1 --> S1 & S2 & S3

                    C2_1 --> C2_2 & C2_3
                    C2_2 --> C2_4
                    C2_3 --> H2

                    O1 --> O2
                    O2 --> H2

                    S2 --> H1
                    S3 --> H3
                    H2 --> K3
                    H1 --> K1
                    H3 --> K2

                </div>
            </div>
        </section>

        <!-- Section 2: Application Framework -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">2</span>
                Application Framework Layer
            </h2>
            <p class="section-description">
                Android 애플리케이션이 미디어 기능에 접근하기 위해 사용하는 고수준 Java/Kotlin API들입니다.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🎬</span>
                        MediaPlayer
                    </h3>
                    <div class="card-description">
                        <p>고수준 미디어 재생 API</p>
                        <ul>
                            <li>오디오/비디오 파일 재생</li>
                            <li>스트리밍 지원 (HTTP, RTSP)</li>
                            <li>간단한 재생 제어 (play, pause, stop)</li>
                            <li>내부적으로 NuPlayer 사용</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">⚙️</span>
                        MediaCodec
                    </h3>
                    <div class="card-description">
                        <p>저수준 코덱 접근 API</p>
                        <ul>
                            <li>하드웨어/소프트웨어 코덱 직접 제어</li>
                            <li>인코더/디코더 버퍼 관리</li>
                            <li>비동기 처리 지원</li>
                            <li>Surface 출력 지원</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">📹</span>
                        MediaRecorder
                    </h3>
                    <div class="card-description">
                        <p>미디어 녹화 API</p>
                        <ul>
                            <li>오디오/비디오 캡처</li>
                            <li>다양한 포맷 지원 (MP4, 3GP 등)</li>
                            <li>카메라/마이크 통합</li>
                            <li>실시간 인코딩</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔗</span>
                        JNI Bridge
                    </h3>
                    <div class="card-description">
                        <p>Java-Native 연결</p>
                        <ul>
                            <li>Java API → C++ Native 코드 변환</li>
                            <li>타입 매핑 및 메모리 관리</li>
                            <li>예외 처리 브릿지</li>
                            <li><code>android_media_MediaPlayer.cpp</code></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Native Framework -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Native Framework Layer
            </h2>
            <p class="section-description">
                C++로 구현된 핵심 미디어 처리 엔진입니다. Stagefright 엔진을 중심으로 구성되어 있습니다.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph LR
                    subgraph STAGEFRIGHT["Stagefright Engine"]
                    ME["MediaExtractor<br />(Demuxer)"]
                    NP["NuPlayer<br />(Player Engine)"]
                    CC["CCodec<br />(Codec2)"]
                    AC["ACodec<br />(OpenMAX)"]
                    end

                    subgraph COMPONENTS["Core Components"]
                    LM["libmedia<br />(IPC Client)"]
                    LS["libstagefright<br />(Core Logic)"]
                    end

                    APP["Application<br />Framework"] --> LM
                    LM --> ME
                    ME --> NP
                    NP --> CC & AC
                    NP --> LS

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">📦</span>
                        MediaExtractor
                    </h3>
                    <div class="card-description">
                        <p>미디어 컨테이너 파싱</p>
                        <ul>
                            <li>다양한 컨테이너 포맷 지원 (MP4, MKV, WebM)</li>
                            <li>트랙 분리 (오디오/비디오)</li>
                            <li>메타데이터 추출</li>
                            <li>APEX 모듈로 업데이트 가능</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">▶️</span>
                        NuPlayer
                    </h3>
                    <div class="card-description">
                        <p>통합 재생 엔진 (Android 5.0+)</p>
                        <ul>
                            <li>오디오/비디오 동기화</li>
                            <li>버퍼 관리 및 스케줄링</li>
                            <li>디코더 제어</li>
                            <li>렌더러 (AudioTrack, Surface) 연결</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🆕</span>
                        CCodec
                        <span class="tag tag-new">Modern</span>
                    </h3>
                    <div class="card-description">
                        <p>Codec2 Framework 진입점</p>
                        <ul>
                            <li><code>/frameworks/av/media/codec2/sfplugin/</code></li>
                            <li>ACodec과 일관된 API 제공</li>
                            <li>Codec2Client와 상호작용</li>
                            <li>제로카피 버퍼 채널</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔙</span>
                        ACodec
                        <span class="tag tag-legacy">Legacy</span>
                    </h3>
                    <div class="card-description">
                        <p>OpenMAX IL 진입점</p>
                        <ul>
                            <li>Android 9 이하에서 주로 사용</li>
                            <li>OMXCodec 래퍼</li>
                            <li>하위 호환성 제공</li>
                            <li>Codec2로 마이그레이션 중</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3.5: Codec2 Architecture -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">3.5</span>
                Codec2 아키텍처
                <span class="tag tag-new">Android 10+</span>
            </h2>
            <p class="section-description">
                Codec2는 OpenMAX IL을 대제하는 현대적인 코덱 프레임워크입니다.
                성능 향상, 모듈화, 메인라인 업데이트를 제공합니다.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph APP_LAYER["Application Layer"]
                    MC["MediaCodec API"]
                    end

                    subgraph CCODEC["CCodec Layer"]
                    CC_MAIN["CCodec<br />(Entry Point)"]
                    CC_BUFFER["CCodecBufferChannel<br />(Zero-Copy Buffers)"]
                    CC_CLIENT["Codec2Client"]
                    end

                    subgraph C2_CORE["Codec2 Core"]
                    C2_COMP["C2Component<br />(Decoder/Encoder)"]
                    C2_STORE["C2ComponentStore<br />(Factory)"]
                    C2_PARAM["C2Params<br />(Configuration)"]
                    end

                    subgraph C2_IMPL["Component Implementations"]
                    C2_SW["Software Codecs<br />(c2.android.*)"]
                    C2_HW["Hardware Codecs<br />(c2.vendor.*)"]
                    end

                    subgraph C2_HAL["Codec2 HAL"]
                    HAL_INTF["android.hardware<br />.media.c2@1.x"]
                    end

                    MC --> CC_MAIN
                    CC_MAIN --> CC_BUFFER & CC_CLIENT
                    CC_CLIENT --> C2_COMP & C2_STORE
                    C2_COMP --> C2_PARAM
                    C2_STORE --> C2_SW & C2_HW
                    C2_HW --> HAL_INTF

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔌</span>
                        Codec2Client
                    </h3>
                    <div class="card-description">
                        <p>Codec2 Framework 진입점</p>
                        <ul>
                            <li>Component 및 Interface 객체 생성</li>
                            <li>Vendor ComponentStore 접근</li>
                            <li>리스너 콜백 관리</li>
                            <li>HIDL/AIDL 통신</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🎯</span>
                        C2Component
                    </h3>
                    <div class="card-description">
                        <p>실제 코덱 컴포넌트</p>
                        <ul>
                            <li>특정 코덱 구현 (H.264, VP8, VP9, AV1)</li>
                            <li>고유한 컴포넌트 이름 (<code>c2.android.*</code>)</li>
                            <li>작업 큐 처리 (Input/Output)</li>
                            <li>파라미터 쿼리 및 설정</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🏭</span>
                        C2ComponentStore
                    </h3>
                    <div class="card-description">
                        <p>컴포넌트 팩토리 및 관리</p>
                        <ul>
                            <li>Component 생성 및 라이프사이클 관리</li>
                            <li>C2PlatformComponentStore 구현</li>
                            <li>벤더별 커스텀 구현 가능</li>
                            <li>APEX 패키징 지원</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">⚡</span>
                        C2BufferChannel
                    </h3>
                    <div class="card-description">
                        <p>제로카피 버퍼 관리</p>
                        <ul>
                            <li>효율적인 버퍼 전달 (Zero-Copy)</li>
                            <li>Shared Memory 활용</li>
                            <li>성능 최적화 핵심 요소</li>
                            <li>입출력 버퍼 스케줄링</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">⚙️</span>
                        C2Params
                    </h3>
                    <div class="card-description">
                        <p>설정 파라미터</p>
                        <ul>
                            <li><strong>정적 파라미터:</strong> 해상도, 프로파일, 키프레임 간격</li>
                            <li><strong>동적 파라미터:</strong> 비트레이트, 프레임레이트, 키프레임 요청</li>
                            <li>타입별 고유한 C2Param 구조</li>
                            <li>컴포넌트별 설정 가능</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">📦</span>
                        메인라인 모듈
                    </h3>
                    <div class="card-description">
                        <p>Google 관리 업데이트</p>
                        <ul>
                            <li>제조사가 직접 수정 불가</li>
                            <li>Play Store를 통한 보안 업데이트</li>
                            <li>단편화 감소</li>
                            <li>빠른 버그 수정 및 기능 추가</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Codec2 vs OpenMAX Comparison -->
            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                🔄 Codec2 vs OpenMAX IL 비교
            </h3>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>항목</th>
                        <th>Codec2 (C2)</th>
                        <th>OpenMAX IL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>도입 시기</strong></td>
                        <td>Android 10 (2019)</td>
                        <td>초기 Android 버전</td>
                    </tr>
                    <tr>
                        <td><strong>버퍼 관리</strong></td>
                        <td>Zero-Copy (공유 메모리)</td>
                        <td>버퍼 복사 필요</td>
                    </tr>
                    <tr>
                        <td><strong>성능</strong></td>
                        <td>높음 (복사 오버헤드 제거)</td>
                        <td>상대적으로 낮음</td>
                    </tr>
                    <tr>
                        <td><strong>모듈화</strong></td>
                        <td>메인라인 모듈 (Google 관리)</td>
                        <td>시스템 이미지에 포함</td>
                    </tr>
                    <tr>
                        <td><strong>업데이트</strong></td>
                        <td>Play Store 통해 독립 업데이트</td>
                        <td>시스템 OTA 필요</td>
                    </tr>
                    <tr>
                        <td><strong>확장성</strong></td>
                        <td>컴포넌트 체이닝, 필터 지원</td>
                        <td>제한적</td>
                    </tr>
                    <tr>
                        <td><strong>설정 관리</strong></td>
                        <td>C2Params (타입 안전)</td>
                        <td>OMX Index (덜 안전)</td>
                    </tr>
                    <tr>
                        <td><strong>HAL 인터페이스</strong></td>
                        <td>HIDL/AIDL 기반</td>
                        <td>OMX IL 인터페이스</td>
                    </tr>
                    <tr>
                        <td><strong>현재 상태</strong></td>
                        <td>활성 개발 및 권장</td>
                        <td>레거시, 단계적 폐기</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Section 4: Media Server -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">4</span>
                Media Server
            </h2>
            <p class="section-description">
                미디어 서비스를 제공하는 시스템 프로세스입니다. Binder IPC를 통해 클라이언트와 통신합니다.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph CLIENT["Client Process"]
                    C1["MediaPlayer<br />(App)"]
                    end

                    subgraph BINDER["Binder IPC"]
                    B1["IMediaPlayer<br />(Interface)"]
                    end

                    subgraph SERVER["Media Server Process"]
                    MS["MediaPlayerService"]
                    AF["AudioFlinger"]
                    CS["CameraService"]
                    end

                    subgraph HAL_LAYER["HAL Layer"]
                    AHAL["Audio HAL"]
                    CHAL["Camera HAL"]
                    end

                    C1 -->|"IPC Call"| B1
                    B1 --> MS
                    MS --> AF & CS
                    AF --> AHAL
                    CS --> CHAL

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🎮</span>
                        MediaPlayerService
                    </h3>
                    <div class="card-description">
                        <p>미디어 재생 서비스</p>
                        <ul>
                            <li>MediaPlayer 인스턴스 생성 및 관리</li>
                            <li>Stagefright 엔진 선택 및 제어</li>
                            <li>클라이언트별 세션 관리</li>
                            <li>리소스 관리 및 우선순위</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔊</span>
                        AudioFlinger
                    </h3>
                    <div class="card-description">
                        <p>오디오 믹싱 엔진</p>
                        <ul>
                            <li>여러 오디오 스트림 믹싱</li>
                            <li>Audio HAL과 직접 통신</li>
                            <li>샘플레이트 변환</li>
                            <li>오디오 이펙트 적용</li>
                            <li>오디오 라우팅 제어</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">📸</span>
                        CameraService
                    </h3>
                    <div class="card-description">
                        <p>카메라 관리 서비스</p>
                        <ul>
                            <li>카메라 장치 연결 및 제어</li>
                            <li>Camera HAL 인터페이스</li>
                            <li>프레임 캡처 및 스트리밍</li>
                            <li>멀티 카메라 지원</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔗</span>
                        Binder IPC
                    </h3>
                    <div class="card-description">
                        <p>프로세스 간 통신</p>
                        <ul>
                            <li>클라이언트-서버 RPC 메커니즘</li>
                            <li>프록시 및 스텁 자동 생성</li>
                            <li>공유 메모리 지원</li>
                            <li><code>/frameworks/av/media/libmedia</code></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: HAL Layer -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">5</span>
                Hardware Abstraction Layer (HAL)
                <span class="tag tag-hal">Hardware</span>
            </h2>
            <p class="section-description">
                하드웨어 추상화 계층으로, Android Framework와 하드웨어 드라이버 사이의 표준 인터페이스를 제공합니다.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🎵</span>
                        Audio HAL
                    </h3>
                    <div class="card-description">
                        <p>오디오 하드웨어 인터페이스 (AIDL)</p>
                        <ul>
                            <li><strong>Core HAL:</strong> AudioFlinger가 사용하는 메인 API</li>
                            <li><strong>Effects HAL:</strong> 오디오 이펙트 제어 (AGC, NS)</li>
                            <li><strong>Common HAL:</strong> 공통 데이터 타입 라이브러리</li>
                            <li>Android 14+는 AIDL 기반</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🎬</span>
                        Codec2 HAL
                    </h3>
                    <div class="card-description">
                        <p>비디오/오디오 코덱 HAL</p>
                        <ul>
                            <li><code>android.hardware.media.c2@1.x</code></li>
                            <li>하드웨어 인코더/디코더 접근</li>
                            <li>벤더별 커스텀 코덱 지원</li>
                            <li>C2ComponentStore 구현</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">📷</span>
                        Camera HAL
                    </h3>
                    <div class="card-description">
                        <p>카메라 하드웨어 인터페이스</p>
                        <ul>
                            <li>HAL3 (Camera2 API용)</li>
                            <li>파이프라인 설정 및 제어</li>
                            <li>캡처 요청 처리</li>
                            <li>메타데이터 및 이미지 스트림</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔙</span>
                        OpenMAX IL (레거시)
                        <span class="tag tag-legacy">Deprecated</span>
                    </h3>
                    <div class="card-description">
                        <p>레거시 코덱 인터페이스</p>
                        <ul>
                            <li>Android 9 이하에서 사용</li>
                            <li>Khronos 표준 기반</li>
                            <li>포트 기반 버퍼 통신</li>
                            <li>Android 10+에서 Codec2로 대체</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Video Playback Flow -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">6</span>
                비디오 재생 플로우
            </h2>
            <p class="section-description">
                비디오 파일이 재생될 때 각 레이어를 거치며 데이터가 어떻게 변환되고 처리되는지 보여줍니다.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant App as Application
                    participant MP as MediaPlayer
                    participant NP as NuPlayer
                    participant ME as MediaExtractor
                    participant CC as CCodec
                    participant C2 as C2Component
                    participant HAL as Codec2 HAL
                    participant HW as Hardware Decoder
                    participant SF as Surface

                    App->>MP: setDataSource(url)
                    App->>MP: prepare()
                    MP->>NP: 초기화
                    NP->>ME: 컨테이너 파싱
                    ME-->>NP: 비디오 트랙 정보
                    NP->>CC: 디코더 생성 요청
                    CC->>C2: Codec2Client.createComponent()
                    C2->>HAL: 하드웨어 코덱 확인
                    HAL-->>C2: 컴포넌트 생성

                    App->>MP: start()
                    loop 재생 루프
                    NP->>ME: getSample()
                    ME-->>NP: 압축된 비디오 프레임
                    NP->>CC: queueInputBuffer()
                    CC->>C2: queue() - Zero-Copy
                    C2->>HW: 하드웨어 디코딩
                    HW-->>C2: 디코딩된 프레임
                    C2-->>CC: dequeueOutputBuffer()
                    CC-->>NP: 디코딩된 프레임
                    NP->>SF: renderToSurface()
                    end

                    App->>MP: stop()
                    MP->>NP: 정지
                    NP->>CC: 디코더 해제
                    CC->>C2: 컴포넌트 해제
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 30px; margin-bottom: 15px;">
                📋 단계별 상세 설명
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">1️⃣ 소스 설정</h3>
                    <div class="card-description">
                        <ul>
                            <li>앱에서 <code>MediaPlayer.setDataSource()</code> 호출</li>
                            <li>로컬 파일 또는 네트워크 URL 지정</li>
                            <li>NuPlayer 인스턴스 생성</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">2️⃣ 컨테이너 파싱</h3>
                    <div class="card-description">
                        <ul>
                            <li>MediaExtractor가 MP4/MKV 컨테이너 분석</li>
                            <li>비디오/오디오/자막 트랙 식별</li>
                            <li>코덱 정보 및 메타데이터 추출</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">3️⃣ 디코더 생성</h3>
                    <div class="card-description">
                        <ul>
                            <li>CCodec을 통해 Codec2Client 호출</li>
                            <li>적절한 C2Component 선택 (H.264, VP9 등)</li>
                            <li>하드웨어 코덱 우선, 소프트웨어 코덱 대체</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">4️⃣ 디코딩 루프</h3>
                    <div class="card-description">
                        <ul>
                            <li>압축된 프레임을 입력 버퍼에 큐잉</li>
                            <li>제로카피로 하드웨어 디코더에 전달</li>
                            <li>디코딩된 YUV 프레임 수신</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">5️⃣ 렌더링</h3>
                    <div class="card-description">
                        <ul>
                            <li>디코딩된 프레임을 Surface로 전달</li>
                            <li>SurfaceFlinger가 화면 합성</li>
                            <li>오디오와 동기화 (A/V Sync)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">6️⃣ 정리</h3>
                    <div class="card-description">
                        <ul>
                            <li>재생 종료 시 디코더 해제</li>
                            <li>버퍼 메모리 해제</li>
                            <li>하드웨어 리소스 반환</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7: Audio Playback Flow -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">7</span>
                오디오 재생 플로우
            </h2>
            <p class="section-description">
                오디오 파일이 재생될 때의 데이터 흐름과 각 컴포넌트의 역할을 시각화합니다.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant App as Application
                    participant MP as MediaPlayer
                    participant NP as NuPlayer
                    participant ME as MediaExtractor
                    participant C2 as C2Component<br />(Audio Decoder)
                    participant AF as AudioFlinger
                    participant AHAL as Audio HAL
                    participant SPK as Speaker

                    App->>MP: setDataSource(audio.mp3)
                    App->>MP: prepare()
                    MP->>NP: 초기화
                    NP->>ME: MP3 파싱
                    ME-->>NP: 오디오 트랙 (AAC/MP3)
                    NP->>C2: 오디오 디코더 생성

                    App->>MP: start()
                    loop 재생 루프
                    NP->>ME: getSample()
                    ME-->>NP: 압축된 오디오 프레임
                    NP->>C2: 디코딩 요청
                    C2-->>NP: PCM 데이터
                    NP->>AF: AudioTrack.write()
                    AF->>AF: 믹싱 & 이펙트
                    AF->>AHAL: 오디오 출력
                    AHAL->>SPK: 재생
                    end

                    App->>MP: stop()
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🎼</span>
                        압축 포맷
                    </h3>
                    <div class="card-description">
                        <p>입력 오디오 포맷</p>
                        <ul>
                            <li>AAC (Advanced Audio Coding)</li>
                            <li>MP3 (MPEG Audio Layer 3)</li>
                            <li>Opus, Vorbis, FLAC</li>
                            <li>비트레이트: 128-320 kbps (MP3)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔧</span>
                        디코딩
                    </h3>
                    <div class="card-description">
                        <p>오디오 디코더 처리</p>
                        <ul>
                            <li>C2Component (소프트웨어 디코더)</li>
                            <li>압축 → PCM 변환</li>
                            <li>샘플레이트: 44.1kHz / 48kHz</li>
                            <li>채널: 스테레오 (2ch) / 멀티채널</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🎚️</span>
                        AudioFlinger
                    </h3>
                    <div class="card-description">
                        <p>오디오 믹싱 및 처리</p>
                        <ul>
                            <li>여러 AudioTrack 믹싱</li>
                            <li>볼륨 조정 및 페이드</li>
                            <li>이펙트 적용 (EQ, Reverb)</li>
                            <li>샘플레이트 리샘플링</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">🔊</span>
                        Audio HAL
                    </h3>
                    <div class="card-description">
                        <p>하드웨어 오디오 출력</p>
                        <ul>
                            <li>PCM 데이터 → 하드웨어 전달</li>
                            <li>ALSA/OSS 드라이버 제어</li>
                            <li>오디오 라우팅 (스피커/헤드폰)</li>
                            <li>저전력 오디오 경로</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                🔄 버퍼 관리 및 동기화
            </h3>

            <div class="card">
                <div class="card-description">
                    <p><strong>버퍼 플로우:</strong></p>
                    <ol style="margin-top: 10px; padding-left: 20px;">
                        <li><strong>입력 버퍼:</strong> MediaExtractor에서 압축된 오디오 프레임 추출</li>
                        <li><strong>디코더 버퍼:</strong> C2Component가 압축 해제하여 PCM 생성</li>
                        <li><strong>AudioTrack 버퍼:</strong> NuPlayer가 PCM 데이터를 AudioFlinger에 전달</li>
                        <li><strong>HAL 버퍼:</strong> AudioFlinger가 믹싱 후 Audio HAL로 전달</li>
                        <li><strong>하드웨어 버퍼:</strong> DMA를 통해 스피커로 재생</li>
                    </ol>

                    <p style="margin-top: 20px;"><strong>지연 최소화:</strong></p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>작은 버퍼 크기로 레이턴시 감소</li>
                        <li>Fast Audio Path (저전력 모드)</li>
                        <li>AAudio API (저지연 오디오)</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer
            style="text-align: center; margin-top: 60px; padding: 40px; color: var(--text-muted); border-top: 1px solid var(--border-color);">
            <p>© Android Media Framework Documentation</p>
        </footer>
    </div>

    <script src="scripts/mermaid-theme.js"></script>
    <script src="scripts/theme-toggle.js"></script>
</body>

</html>