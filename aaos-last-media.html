<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAOS Last Media & Autoplay | Android Media Framework</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            â† Android Media
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">AAOS Last Media & Autoplay</h1>
            <p class="page-subtitle">Comprehensive guide to Last Media Source, Playback State restoration, and Autoplay
                policies in Android Automotive OS.</p>
        </header>

        <!-- Section 1: Concept -->
        <section class="section sec-concept">
            <h2 class="section-title">
                <span class="section-number">1</span>
                What is "Last Media"?
            </h2>
            <p class="section-description">
                AAOSì—ì„œ "Last Media"ëŠ” ì°¨ëŸ‰ ì¬ì‹œë™ì´ë‚˜ ì‚¬ìš©ì ì „í™˜ ì‹œ ì´ì „ ë¯¸ë””ì–´ ê²½í—˜ì„ ëŠê¹€ ì—†ì´ ì´ì–´ì£¼ê¸° ìœ„í•œ í•µì‹¬ ê°œë…ì…ë‹ˆë‹¤. í¬ê²Œ ë‘ ê°€ì§€ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸµ</span> Last Media Source</h3>
                    <div class="card-description">
                        ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚¬ìš©ëœ ë¯¸ë””ì–´ ì•±/ì„œë¹„ìŠ¤(ComponentName) ì…ë‹ˆë‹¤.
                        <br>(ì˜ˆ: <code>com.spotify.music</code>, <code>com.google.android.apps.youtube.music</code>)
                        <br>CarMediaServiceê°€ <strong>SharedPreferences</strong>ì— Per-User, Per-Mode (PLAYBACK/BROWSE)ë¡œ
                        íˆìŠ¤í† ë¦¬ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">â–¶ï¸</span> Last Playback State</h3>
                    <div class="card-description">
                        í•´ë‹¹ ì†ŒìŠ¤ì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì¬ìƒ ì¤‘ì´ì—ˆëŠ”ì§€(PLAYING), ì¼ì‹œì •ì§€(PAUSED) ìƒíƒœì˜€ëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ì…ë‹ˆë‹¤.
                        <br>ì´ ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì°¨ëŸ‰ ì‹œë™ ì‹œ <strong>ìë™ ì¬ìƒ (Autoplay)</strong>ì„ í• ì§€ ë§ì§€ ê²°ì •í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            <p
                style="margin-top: 20px; color: var(--text-secondary); padding-left: 10px; border-left: 3px solid var(--accent-purple);">
                ì‚¬ìš©ì UXì˜ "ë§ˆì§€ë§‰ì— ë“£ë˜ ìŒì•… ë‹¤ì‹œ ì¬ìƒí•´ì¤˜", ì°¨ëŸ‰ ì‹œë™ í›„ ìë™ìœ¼ë¡œ ì´ì „ ë¯¸ë””ì–´ë¥¼ ì´ì–´ ì¬ìƒ, í˜¹ì€ "Connect and play last media source" ê°™ì€
                ìŒì„±/ë²„íŠ¼ ì•¡ì…˜ì´ ì „ë¶€ ì´ ê°œë… ìœ„ì— êµ¬ì¶•ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
            </p>
        </section>

        <!-- Section 2: Architecture Overview -->
        <section class="section sec-arch">
            <h2 class="section-title">
                <span class="section-number">2</span>
                Architecture Overview
            </h2>
            <p class="section-description">
                Last Media ê¸°ëŠ¥ì€ <code>CarMediaService</code>ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ <code>MediaConnectorService</code>ì™€ ê° ë¯¸ë””ì–´ ì•± ê°„ì˜ ìœ ê¸°ì ì¸
                í˜‘ë ¥ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TD
                    User[User / Voice Command] -- "Play Last Media" --> CMS[CarMediaService]

                    subgraph System Services
                    CMS -- "Store/Retrieve History" --> Prefs[(SharedPreferences)]
                    CMS -- "Start with EXTRA_AUTOPLAY" --> MCS[MediaConnectorService]
                    end

                    subgraph Media App
                    MCS -- "MediaBrowser.connect()" --> MBS[MediaBrowserService]
                    MBS -- "Session Token" --> MCS
                    MCS -- "TransportControls.play()" --> Session[MediaSession]
                    end

                    style CMS fill:#3b82f6,stroke:#fff,color:#fff
                    style MCS fill:#6366f1,stroke:#fff,color:#fff
                    style MBS fill:#10b981,stroke:#fff,color:#fff
                    style Session fill:#10b981,stroke:#fff,color:#fff
                    style Prefs fill:#1a1f35,stroke:#9ca3af
                    style User fill:#1a1f35,stroke:#9ca3af
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“±</span> Media App (Spotify, etc.)</h3>
                    <div class="card-description">
                        <code>MediaBrowserService</code> + <code>MediaSession</code> (í˜¹ì€
                        <code>MediaSessionCompat</code>)ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
                        ìì‹ ì˜ ì¬ìƒ ìƒíƒœë¥¼ ì‹œìŠ¤í…œì— ì•Œë¦¬ê³ , ì—°ê²° ìš”ì²­ì— ì‘ë‹µí•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ§ </span> CarMediaService</h3>
                    <div class="card-description">
                        í•µì‹¬ ê´€ë¦¬ìì…ë‹ˆë‹¤. í˜„ì¬ Primary Media Source, Browse Source, Last Media History, Playback Stateë¥¼ ì €ì¥í•˜ê³ 
                        ê´€ë¦¬í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”Œ</span> MediaConnectorService</h3>
                    <div class="card-description">
                        OEM/AAOS ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ë¡œ, CarMediaServiceì˜ ì§€ì‹œë¥¼ ë°›ì•„ í•´ë‹¹ Media Sourceì— ë°”ì¸ë“œ(Bind)í•˜ê³ ,
                        í•„ìš” ì‹œ <code>EXTRA_AUTOPLAY</code>ë¡œ "ìë™ì¬ìƒ"ì„ ì‹œë„í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸš—</span> CarService / Car API</h3>
                    <div class="card-description">
                        ì°¨ëŸ‰ ì „ì›/ìŠ¬ë¦½ ìƒíƒœì—ì„œ Snapshotì„ ê¸°ë°˜ìœ¼ë¡œ ë³µì›í•˜ê³ , ì¬ê¸°ë™ ì‹œ Last Media ê´€ë ¨ ìƒíƒœë¥¼ ì´ì–´ë°›ìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Internal Logic & Storage -->
        <section class="section sec-logic">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Internal Logic: How it works
            </h2>
            <p class="section-description">
                CarMediaService ë‚´ë¶€ì—ì„œ Last Media ì •ë³´ê°€ ì–´ë–»ê²Œ ì €ì¥ë˜ê³ , ìë™ ì¬ìƒ ì—¬ë¶€ê°€ ì–´ë–»ê²Œ ê²°ì •ë˜ëŠ”ì§€ ìƒì„¸ ë¡œì§ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">3-1. Last
                Media Source ì €ì¥ êµ¬ì¡°</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                <code>SharedPreferences</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ Per-User, Per-Modeë¡œ Historyë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
                <br>Key: <code>SOURCE_KEY</code>, <code>PLAYBACK_STATE_KEY</code>
            </p>

            <div class="content-grid">
                <div class="card" style="grid-column: span 2;">
                    <h3 class="card-title"><span class="card-icon">ğŸ’¾</span> Logic Summary</h3>
                    <div class="card-description">
                        <pre><code>private void setPlaybackMediaSource(ComponentName playbackMediaSource) {
    // ... Stop existing callbacks ...
    synchronized (mLock) {
        mPrimaryMediaComponents[MEDIA_SOURCE_MODE_PLAYBACK] = playbackMediaSource;
    }
    if (playbackMediaSource != null) {
        if (!isCurrentUserEphemeral()) {
            saveLastMediaSource(playbackMediaSource, MEDIA_SOURCE_MODE_PLAYBACK);
        }
    }
    // ... Notify listeners & Start MediaConnectorService ...
}</code></pre>
                        <p style="margin-top: 10px;">
                            <code>saveLastMediaSource()</code>ëŠ” History(Deque)ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ìƒˆ ì†ŒìŠ¤ë¥¼ ê°€ì¥ ì•ì— ì¶”ê°€í•˜ê³ , ì¤‘ë³µì„ ì œê±°í•œ ë’¤ ì§ë ¬í™”í•˜ì—¬
                            ì €ì¥í•©ë‹ˆë‹¤.
                            ì´ë¥¼ í†µí•´ <strong>"ìµœê·¼ ì‚¬ìš© Media Source ë¦¬ìŠ¤íŠ¸"</strong>ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">3-2. Last
                Playback State & Autoplay</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                <code>MediaController.Callback</code>ì—ì„œ <code>onPlaybackStateChanged</code>ë¥¼ ê°ì§€í•˜ì—¬ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
                ì´ ê°’ì€ <code>shouldStartPlayback()</code>ì—ì„œ ìë™ ì¬ìƒ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš™ï¸</span> Autoplay Config Policies</h3>
                    <div class="card-description">
                        <ul>
                            <li><code>AUTOPLAY_CONFIG_NEVER</code>: ìë™ ì¬ìƒ ì•ˆ í•¨.</li>
                            <li><code>AUTOPLAY_CONFIG_ALWAYS</code>: ë¬´ì¡°ê±´ ì¬ìƒ ì‹œë„.</li>
                            <li><code>RETAIN_PER_SOURCE</code>: "ì´ ì•±ì—ì„œ ë§ˆì§€ë§‰ ìƒíƒœê°€ PLAYINGì´ì—ˆìœ¼ë©´" ë‹¤ì‹œ ìë™ ì¬ìƒ.</li>
                            <li><code>RETAIN_PREVIOUS</code>: CarMediaServiceê°€ ê¸°ì–µí•˜ëŠ” ë§ˆì§€ë§‰ ìƒíƒœê°€ PLAYINGì´ë©´ ì¬ìƒ.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Restoration Flow -->
        <section class="section sec-restore">
            <h2 class="section-title">
                <span class="section-number">4</span>
                Restoration Flow
            </h2>
            <p class="section-description">
                ì‹œìŠ¤í…œ ë ˆë²¨ì—ì„œ Last Mediaê°€ ì–´ë–»ê²Œ ë³µì›ë˜ëŠ”ì§€, ë¶€íŒ… ì‹œë‚˜ë¦¬ì˜¤ì™€ UX ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë‚˜ëˆ„ì–´ ë´…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">4-1. Boot /
                Resume Scenario</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant CarService
                    participant CMS as CarMediaService
                    participant MCS as MediaConnectorService
                    participant App as Media App

                    Note over CarService: Vehicle Ignition ON (Resume)
                    CarService->>CMS: Restore State (Snapshot)
                    CMS->>CMS: getLastMediaSource() -> Set Default

                    Note over CMS: Power Policy / User Unlock
                    CMS->>CMS: shouldStartPlayback() -> true/false

                    alt Autoplay Allowed
                    CMS->>MCS: startMediaConnectorService(EXTRA_AUTOPLAY=true)
                    MCS->>App: MediaBrowser.connect()
                    MCS->>App: MediaController.play()
                    else Autoplay Denied
                    CMS->>MCS: startMediaConnectorService(EXTRA_AUTOPLAY=false)
                    MCS->>App: MediaBrowser.connect()
                    Note right of App: Only Connect (Ready State)
                    end
                </div>
            </div>
            <p style="color: var(--text-secondary); margin-top: 15px;">
                CarServiceëŠ” Suspendì—ì„œ Resumeë  ë•Œ VHALì— ë‹¤ì‹œ ë¶™ì§€ ì•Šê³ , ë§ˆì§€ë§‰ Snapshot (Suspend-to-RAM ìƒíƒœ)ì—ì„œ ìƒíƒœë¥¼ ë³µì›í•©ë‹ˆë‹¤.
                ì´í›„ Configì— ë”°ë¼ ìë™ ì¬ìƒì„ ì‹œë„í•˜ê±°ë‚˜, ë‹¨ìˆœíˆ "ë§ˆì§€ë§‰ ì†ŒìŠ¤"ë§Œ UIì— ë…¸ì¶œí•©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">4-2. Voice
                / UX Interaction</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ—£ï¸</span> Voice Commands</h3>
                    <div class="card-description">
                        "Play last media source", "Resume music" ê°™ì€ ëª…ë ¹ì€ ë‚´ë¶€ì ìœ¼ë¡œ CarMediaServiceë¥¼ í†µí•´
                        <strong>"Last Media Source + Autoplay ì—¬ë¶€"</strong>ë¥¼ ì–»ì–´ ì‹¤í–‰ë©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ‘†</span> Home Screen UI</h3>
                    <div class="card-description">
                        í™ˆ í™”ë©´ì´ë‚˜ ë¯¸ë””ì–´ ìœ„ì ¯ì˜ "ë§ˆì§€ë§‰ ë¯¸ë””ì–´ ì¬ìƒ" ì¹´ë“œ ë˜í•œ ë™ì¼í•œ ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ì—¬
                        ìµœê·¼ ì•±ì„ í‘œì‹œí•˜ê³  í„°ì¹˜ ì‹œ ì¬ìƒì„ ì¬ê°œí•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Developer & OEM Guide -->
        <section class="section sec-dev">
            <h2 class="section-title">
                <span class="section-number">5</span>
                Developer & OEM Guide
            </h2>
            <p class="section-description">
                Last Media ê¸°ëŠ¥ì„ 100% í™œìš©í•˜ê¸° ìœ„í•œ ê°€ì´ë“œë¼ì¸ì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ‘¨â€ğŸ’»</span> For App Developers</h3>
                    <div class="card-description">
                        ì•± ê°œë°œìê°€ í•´ì•¼ í•  ì¼ì€ ì˜ì™¸ë¡œ ë‹¨ìˆœí•©ë‹ˆë‹¤.
                        <ul>
                            <li><strong>MediaSession êµ¬í˜„:</strong> <code>PlaybackState</code> (STATE_PLAYING ë“±)ë¥¼ ì˜¬ë°”ë¥´ê²Œ
                                ê°±ì‹ í•˜ì„¸ìš”.</li>
                            <li><strong>Browse Service Extras:</strong> ì„¸ì…˜ Extrasì—
                                <code>CAR_EXTRA_BROWSE_SERVICE_FOR_SESSION</code> ê°’ì„ ë„£ì–´ Browse Serviceë¥¼ ëª…ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </li>
                            <li><strong>Self-Restoration:</strong> ì•±ì´ ì¬ì‹œì‘ë  ë•Œ í(Queue)ì™€ ì¬ìƒ ìœ„ì¹˜(Position)ë¥¼ ë³µì›í•˜ëŠ” ê²ƒì€
                                <strong>ì•±ì˜ ì±…ì„</strong>ì…ë‹ˆë‹¤. OSëŠ” ë‹¨ì§€ "ì¬ìƒ ë²„íŠ¼"ì„ ëˆŒëŸ¬ì¤„ ë¿ì…ë‹ˆë‹¤.
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ­</span> For OEMs / Platform</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Autoplay Policy:</strong> <code>config_mediaSourceAutoplayConfig</code>ë¥¼ ì˜¤ë²„ë ˆì´í•˜ì—¬
                                ìë™ ì¬ìƒ ë™ì‘ì„ ì œì–´í•˜ì„¸ìš”.</li>
                            <li><strong>Default Source:</strong> <code>config_defaultMediaSource</code>ë¡œ íˆìŠ¤í† ë¦¬ê°€ ì—†ì„ ë•Œì˜ ê¸°ë³¸
                                ì•±ì„ ì§€ì •í•˜ì„¸ìš”.</li>
                            <li><strong>User Types:</strong> <code>isCurrentUserEphemeral()</code>ì´ trueì¸ ê²ŒìŠ¤íŠ¸/ì„ì‹œ ìœ ì €ëŠ”
                                Last Mediaê°€ ì €ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒì„ í™•ì¸í•˜ì„¸ìš”.</li>
                            <li><strong>Independent Playback:</strong> <code>mIndependentPlaybackConfig</code> ì„¤ì •ì„ í†µí•´
                                ë¼ë””ì˜¤ì™€ ë¯¸ë””ì–´ ì•±ì˜ ì†ŒìŠ¤ ë¶„ë¦¬ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ì„¸ìš”.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Summary -->
        <section class="section"
            style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1)); border-color: var(--accent-indigo);">
            <h2 class="section-title" style="color: var(--text-primary);">
                <span class="section-number" style="background: var(--accent-indigo);">6</span>
                Summary
            </h2>
            <p class="section-description" style="color: var(--text-primary); font-weight: 500;">
                AAOSì˜ "Last Media"ëŠ” CarMediaServiceê°€ ì‚¬ìš©ìì˜ ë§ˆì§€ë§‰ ë¯¸ë””ì–´ ì†ŒìŠ¤ì™€ ì¬ìƒ ìƒíƒœë¥¼ Per-Userë¡œ ì €ì¥í•´ ë‘ì—ˆë‹¤ê°€, ì°¨ëŸ‰ ì¬ê¸°ë™/ìŒì„±ëª…ë ¹/UX ìƒì—ì„œ ì´
                ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì ì ˆíˆ ì•±ì„ ì¬ì—°ê²°í•˜ê³ , ì •ì±… (Autoplay Config)ì— ë”°ë¼ ìë™ ì¬ìƒê¹Œì§€ ì œì–´í•˜ëŠ” ì „ì²´ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.
            </p>
            <p style="margin-top: 10px; color: var(--text-secondary);">
                ì•± ê°œë°œìëŠ” ì˜¬ë°”ë¥¸ MediaSession/PlaybackState êµ¬í˜„ì— ì§‘ì¤‘í•˜ë©´ ë˜ê³ ,
                í”Œë«í¼/OEM ê°œë°œìëŠ” CarMediaServiceì™€ ê´€ë ¨ Configë¥¼ íŠœë‹í•¨ìœ¼ë¡œì¨ "ë§ˆì§€ë§‰ì— ë“£ë˜ ê±¸ ì–¼ë§ˆë‚˜ ì ê·¹ì ìœ¼ë¡œ ë‹¤ì‹œ í‹€ì–´ì¤„ì§€"ë¥¼ ì¡°ì ˆí•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.
            </p>
        </section>

        <a href="index.html" class="nav-button">â† Back to Dashboard</a>
    </div>

    <script src="scripts/mermaid-theme.js"></script>
    <script src="scripts/theme-toggle.js"></script>
</body>

</html>