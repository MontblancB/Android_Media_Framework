<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Prevent Flash of Incorrect Theme (FOIT) -->
    <script>
    (function(){var t=localStorage.getItem('android-media-framework-theme');if(t)document.documentElement.setAttribute('data-theme',t);else if(window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches)document.documentElement.setAttribute('data-theme','light');})();
    </script>
    <title>AAOS Last Media & Autoplay | Android Media Framework</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            â† Android Media
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">AAOS Last Media & Autoplay</h1>
            <p class="page-subtitle">Comprehensive guide to Last Media Source, Playback State restoration, and Autoplay
                policies in Android Automotive OS.</p>
        </header>

        <!-- Section 1: Concept -->
        <section class="section sec-concept">
            <h2 class="section-title">
                <span class="section-number">1</span>
                What is "Last Media"?
            </h2>
            <p class="section-description">
                AAOSì—ì„œ "Last Media"ëŠ” ì°¨ëŸ‰ ì¬ì‹œë™ì´ë‚˜ ì‚¬ìš©ì ì „í™˜ ì‹œ ì´ì „ ë¯¸ë””ì–´ ê²½í—˜ì„ ëŠê¹€ ì—†ì´ ì´ì–´ì£¼ê¸° ìœ„í•œ í•µì‹¬ ê°œë…ì…ë‹ˆë‹¤. í¬ê²Œ ë‘ ê°€ì§€ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸµ</span> Last Media Source</h3>
                    <div class="card-description">
                        ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚¬ìš©ëœ ë¯¸ë””ì–´ ì•±/ì„œë¹„ìŠ¤(ComponentName) ì…ë‹ˆë‹¤.
                        <br>(ì˜ˆ: <code>com.spotify.music</code>, <code>com.google.android.apps.youtube.music</code>)
                        <br>CarMediaServiceê°€ <strong>SharedPreferences</strong>ì— Per-User, Per-Mode (PLAYBACK/BROWSE)ë¡œ
                        íˆìŠ¤í† ë¦¬ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">â–¶ï¸</span> Last Playback State</h3>
                    <div class="card-description">
                        í•´ë‹¹ ì†ŒìŠ¤ì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì¬ìƒ ì¤‘ì´ì—ˆëŠ”ì§€(PLAYING), ì¼ì‹œì •ì§€(PAUSED) ìƒíƒœì˜€ëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ì…ë‹ˆë‹¤.
                        <br>ì´ ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì°¨ëŸ‰ ì‹œë™ ì‹œ <strong>ìë™ ì¬ìƒ (Autoplay)</strong>ì„ í• ì§€ ë§ì§€ ê²°ì •í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            <p
                style="margin-top: 20px; color: var(--text-secondary); padding-left: 10px; border-left: 3px solid var(--accent-purple);">
                ì‚¬ìš©ì UXì˜ "ë§ˆì§€ë§‰ì— ë“£ë˜ ìŒì•… ë‹¤ì‹œ ì¬ìƒí•´ì¤˜", ì°¨ëŸ‰ ì‹œë™ í›„ ìë™ìœ¼ë¡œ ì´ì „ ë¯¸ë””ì–´ë¥¼ ì´ì–´ ì¬ìƒ, í˜¹ì€ "Connect and play last media source" ê°™ì€
                ìŒì„±/ë²„íŠ¼ ì•¡ì…˜ì´ ì „ë¶€ ì´ ê°œë… ìœ„ì— êµ¬ì¶•ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
            </p>
        </section>

        <!-- Section 2: Architecture Overview -->
        <section class="section sec-arch">
            <h2 class="section-title">
                <span class="section-number">2</span>
                Architecture Overview
            </h2>
            <p class="section-description">
                Last Media ê¸°ëŠ¥ì€ <code>CarMediaService</code>ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ <code>MediaConnectorService</code>ì™€ ê° ë¯¸ë””ì–´ ì•± ê°„ì˜ ìœ ê¸°ì ì¸
                í˜‘ë ¥ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TD
                    User[User / Voice Command] -- "Play Last Media" --> CMS[CarMediaService]

                    subgraph System Services
                    CMS -- "Store/Retrieve History" --> Prefs[(SharedPreferences)]
                    CMS -- "Start with EXTRA_AUTOPLAY" --> MCS[MediaConnectorService]
                    end

                    subgraph Media App
                    MCS -- "MediaBrowser.connect()" --> MBS[MediaBrowserService]
                    MBS -- "Session Token" --> MCS
                    MCS -- "TransportControls.play()" --> Session[MediaSession]
                    end

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“±</span> Media App (Spotify, etc.)</h3>
                    <div class="card-description">
                        <code>MediaBrowserService</code> + <code>MediaSession</code> (í˜¹ì€
                        <code>MediaSessionCompat</code>)ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
                        ìì‹ ì˜ ì¬ìƒ ìƒíƒœë¥¼ ì‹œìŠ¤í…œì— ì•Œë¦¬ê³ , ì—°ê²° ìš”ì²­ì— ì‘ë‹µí•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ§ </span> CarMediaService</h3>
                    <div class="card-description">
                        í•µì‹¬ ê´€ë¦¬ìì…ë‹ˆë‹¤. í˜„ì¬ Primary Media Source, Browse Source, Last Media History, Playback Stateë¥¼ ì €ì¥í•˜ê³ 
                        ê´€ë¦¬í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”Œ</span> MediaConnectorService</h3>
                    <div class="card-description">
                        OEM/AAOS ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ë¡œ, CarMediaServiceì˜ ì§€ì‹œë¥¼ ë°›ì•„ í•´ë‹¹ Media Sourceì— ë°”ì¸ë“œ(Bind)í•˜ê³ ,
                        í•„ìš” ì‹œ <code>EXTRA_AUTOPLAY</code>ë¡œ "ìë™ì¬ìƒ"ì„ ì‹œë„í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸš—</span> CarService / Car API</h3>
                    <div class="card-description">
                        ì°¨ëŸ‰ ì „ì›/ìŠ¬ë¦½ ìƒíƒœì—ì„œ Snapshotì„ ê¸°ë°˜ìœ¼ë¡œ ë³µì›í•˜ê³ , ì¬ê¸°ë™ ì‹œ Last Media ê´€ë ¨ ìƒíƒœë¥¼ ì´ì–´ë°›ìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Internal Logic & Storage -->
        <section class="section sec-logic">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Internal Logic: How it works
            </h2>
            <p class="section-description">
                CarMediaService ë‚´ë¶€ì—ì„œ Last Media ì •ë³´ê°€ ì–´ë–»ê²Œ ì €ì¥ë˜ê³ , ìë™ ì¬ìƒ ì—¬ë¶€ê°€ ì–´ë–»ê²Œ ê²°ì •ë˜ëŠ”ì§€ ìƒì„¸ ë¡œì§ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">3-1. Last
                Media Source ì €ì¥ êµ¬ì¡°</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                <code>SharedPreferences</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ Per-User, Per-Modeë¡œ Historyë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
                <br>Key: <code>SOURCE_KEY</code>, <code>PLAYBACK_STATE_KEY</code>
            </p>

            <div class="content-grid">
                <div class="card" style="grid-column: span 2;">
                    <h3 class="card-title"><span class="card-icon">ğŸ’¾</span> Logic Summary</h3>
                    <div class="card-description">
                        <pre><code>private void setPlaybackMediaSource(ComponentName playbackMediaSource) {
    // ... Stop existing callbacks ...
    synchronized (mLock) {
        mPrimaryMediaComponents[MEDIA_SOURCE_MODE_PLAYBACK] = playbackMediaSource;
    }
    if (playbackMediaSource != null) {
        if (!isCurrentUserEphemeral()) {
            saveLastMediaSource(playbackMediaSource, MEDIA_SOURCE_MODE_PLAYBACK);
        }
    }
    // ... Notify listeners & Start MediaConnectorService ...
}</code></pre>
                        <p style="margin-top: 10px;">
                            <code>saveLastMediaSource()</code>ëŠ” History(Deque)ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ìƒˆ ì†ŒìŠ¤ë¥¼ ê°€ì¥ ì•ì— ì¶”ê°€í•˜ê³ , ì¤‘ë³µì„ ì œê±°í•œ ë’¤ ì§ë ¬í™”í•˜ì—¬
                            ì €ì¥í•©ë‹ˆë‹¤.
                            ì´ë¥¼ í†µí•´ <strong>"ìµœê·¼ ì‚¬ìš© Media Source ë¦¬ìŠ¤íŠ¸"</strong>ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">3-2. Last
                Playback State & Autoplay</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                <code>MediaController.Callback</code>ì—ì„œ <code>onPlaybackStateChanged</code>ë¥¼ ê°ì§€í•˜ì—¬ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
                ì´ ê°’ì€ <code>shouldStartPlayback()</code>ì—ì„œ ìë™ ì¬ìƒ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš™ï¸</span> Autoplay Config Policies</h3>
                    <div class="card-description">
                        <ul>
                            <li><code>AUTOPLAY_CONFIG_NEVER</code>: ìë™ ì¬ìƒ ì•ˆ í•¨.</li>
                            <li><code>AUTOPLAY_CONFIG_ALWAYS</code>: ë¬´ì¡°ê±´ ì¬ìƒ ì‹œë„.</li>
                            <li><code>RETAIN_PER_SOURCE</code>: "ì´ ì•±ì—ì„œ ë§ˆì§€ë§‰ ìƒíƒœê°€ PLAYINGì´ì—ˆìœ¼ë©´" ë‹¤ì‹œ ìë™ ì¬ìƒ.</li>
                            <li><code>RETAIN_PREVIOUS</code>: CarMediaServiceê°€ ê¸°ì–µí•˜ëŠ” ë§ˆì§€ë§‰ ìƒíƒœê°€ PLAYINGì´ë©´ ì¬ìƒ.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Restoration Flow -->
        <section class="section sec-restore">
            <h2 class="section-title">
                <span class="section-number">4</span>
                Restoration Flow
            </h2>
            <p class="section-description">
                ì‹œìŠ¤í…œ ë ˆë²¨ì—ì„œ Last Mediaê°€ ì–´ë–»ê²Œ ë³µì›ë˜ëŠ”ì§€, ë¶€íŒ… ì‹œë‚˜ë¦¬ì˜¤ì™€ UX ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë‚˜ëˆ„ì–´ ë´…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">4-1. Boot /
                Resume Scenario</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant CarService
                    participant CMS as CarMediaService
                    participant MCS as MediaConnectorService
                    participant App as Media App

                    Note over CarService: Vehicle Ignition ON (Resume)
                    CarService->>CMS: Restore State (Snapshot)
                    CMS->>CMS: getLastMediaSource() -> Set Default

                    Note over CMS: Power Policy / User Unlock
                    CMS->>CMS: shouldStartPlayback() -> true/false

                    alt Autoplay Allowed
                    CMS->>MCS: startMediaConnectorService(EXTRA_AUTOPLAY=true)
                    MCS->>App: MediaBrowser.connect()
                    MCS->>App: MediaController.play()
                    else Autoplay Denied
                    CMS->>MCS: startMediaConnectorService(EXTRA_AUTOPLAY=false)
                    MCS->>App: MediaBrowser.connect()
                    Note right of App: Only Connect (Ready State)
                    end
                </div>
            </div>
            <p style="color: var(--text-secondary); margin-top: 15px;">
                CarServiceëŠ” Suspendì—ì„œ Resumeë  ë•Œ VHALì— ë‹¤ì‹œ ë¶™ì§€ ì•Šê³ , ë§ˆì§€ë§‰ Snapshot (Suspend-to-RAM ìƒíƒœ)ì—ì„œ ìƒíƒœë¥¼ ë³µì›í•©ë‹ˆë‹¤.
                ì´í›„ Configì— ë”°ë¼ ìë™ ì¬ìƒì„ ì‹œë„í•˜ê±°ë‚˜, ë‹¨ìˆœíˆ "ë§ˆì§€ë§‰ ì†ŒìŠ¤"ë§Œ UIì— ë…¸ì¶œí•©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">4-2. Voice
                / UX Interaction</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ—£ï¸</span> Voice Commands</h3>
                    <div class="card-description">
                        "Play last media source", "Resume music" ê°™ì€ ëª…ë ¹ì€ ë‚´ë¶€ì ìœ¼ë¡œ CarMediaServiceë¥¼ í†µí•´
                        <strong>"Last Media Source + Autoplay ì—¬ë¶€"</strong>ë¥¼ ì–»ì–´ ì‹¤í–‰ë©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ‘†</span> Home Screen UI</h3>
                    <div class="card-description">
                        í™ˆ í™”ë©´ì´ë‚˜ ë¯¸ë””ì–´ ìœ„ì ¯ì˜ "ë§ˆì§€ë§‰ ë¯¸ë””ì–´ ì¬ìƒ" ì¹´ë“œ ë˜í•œ ë™ì¼í•œ ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ì—¬
                        ìµœê·¼ ì•±ì„ í‘œì‹œí•˜ê³  í„°ì¹˜ ì‹œ ì¬ìƒì„ ì¬ê°œí•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Developer & OEM Guide -->
        <section class="section sec-dev">
            <h2 class="section-title">
                <span class="section-number">5</span>
                Developer & OEM Guide
            </h2>
            <p class="section-description">
                Last Media ê¸°ëŠ¥ì„ 100% í™œìš©í•˜ê¸° ìœ„í•œ ê°€ì´ë“œë¼ì¸ì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ‘¨â€ğŸ’»</span> For App Developers</h3>
                    <div class="card-description">
                        ì•± ê°œë°œìê°€ í•´ì•¼ í•  ì¼ì€ ì˜ì™¸ë¡œ ë‹¨ìˆœí•©ë‹ˆë‹¤.
                        <ul>
                            <li><strong>MediaSession êµ¬í˜„:</strong> <code>PlaybackState</code> (STATE_PLAYING ë“±)ë¥¼ ì˜¬ë°”ë¥´ê²Œ
                                ê°±ì‹ í•˜ì„¸ìš”.</li>
                            <li><strong>Browse Service Extras:</strong> ì„¸ì…˜ Extrasì—
                                <code>CAR_EXTRA_BROWSE_SERVICE_FOR_SESSION</code> ê°’ì„ ë„£ì–´ Browse Serviceë¥¼ ëª…ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </li>
                            <li><strong>Self-Restoration:</strong> ì•±ì´ ì¬ì‹œì‘ë  ë•Œ í(Queue)ì™€ ì¬ìƒ ìœ„ì¹˜(Position)ë¥¼ ë³µì›í•˜ëŠ” ê²ƒì€
                                <strong>ì•±ì˜ ì±…ì„</strong>ì…ë‹ˆë‹¤. OSëŠ” ë‹¨ì§€ "ì¬ìƒ ë²„íŠ¼"ì„ ëˆŒëŸ¬ì¤„ ë¿ì…ë‹ˆë‹¤.
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ­</span> For OEMs / Platform</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Autoplay Policy:</strong> <code>config_mediaSourceAutoplayConfig</code>ë¥¼ ì˜¤ë²„ë ˆì´í•˜ì—¬
                                ìë™ ì¬ìƒ ë™ì‘ì„ ì œì–´í•˜ì„¸ìš”.</li>
                            <li><strong>Default Source:</strong> <code>config_defaultMediaSource</code>ë¡œ íˆìŠ¤í† ë¦¬ê°€ ì—†ì„ ë•Œì˜ ê¸°ë³¸
                                ì•±ì„ ì§€ì •í•˜ì„¸ìš”.</li>
                            <li><strong>User Types:</strong> <code>isCurrentUserEphemeral()</code>ì´ trueì¸ ê²ŒìŠ¤íŠ¸/ì„ì‹œ ìœ ì €ëŠ”
                                Last Mediaê°€ ì €ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒì„ í™•ì¸í•˜ì„¸ìš”.</li>
                            <li><strong>Independent Playback:</strong> <code>mIndependentPlaybackConfig</code> ì„¤ì •ì„ í†µí•´
                                ë¼ë””ì˜¤ì™€ ë¯¸ë””ì–´ ì•±ì˜ ì†ŒìŠ¤ ë¶„ë¦¬ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ì„¸ìš”.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Summary -->
        <section class="section"
            style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1)); border-color: var(--accent-indigo);">
            <h2 class="section-title" style="color: var(--text-primary);">
                <span class="section-number" style="background: var(--accent-indigo);">6</span>
                Summary
            </h2>
            <p class="section-description" style="color: var(--text-primary); font-weight: 500;">
                AAOSì˜ "Last Media"ëŠ” CarMediaServiceê°€ ì‚¬ìš©ìì˜ ë§ˆì§€ë§‰ ë¯¸ë””ì–´ ì†ŒìŠ¤ì™€ ì¬ìƒ ìƒíƒœë¥¼ Per-Userë¡œ ì €ì¥í•´ ë‘ì—ˆë‹¤ê°€, ì°¨ëŸ‰ ì¬ê¸°ë™/ìŒì„±ëª…ë ¹/UX ìƒì—ì„œ ì´
                ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì ì ˆíˆ ì•±ì„ ì¬ì—°ê²°í•˜ê³ , ì •ì±… (Autoplay Config)ì— ë”°ë¼ ìë™ ì¬ìƒê¹Œì§€ ì œì–´í•˜ëŠ” ì „ì²´ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.
            </p>
            <p style="margin-top: 10px; color: var(--text-secondary);">
                ì•± ê°œë°œìëŠ” ì˜¬ë°”ë¥¸ MediaSession/PlaybackState êµ¬í˜„ì— ì§‘ì¤‘í•˜ë©´ ë˜ê³ ,
                í”Œë«í¼/OEM ê°œë°œìëŠ” CarMediaServiceì™€ ê´€ë ¨ Configë¥¼ íŠœë‹í•¨ìœ¼ë¡œì¨ "ë§ˆì§€ë§‰ì— ë“£ë˜ ê±¸ ì–¼ë§ˆë‚˜ ì ê·¹ì ìœ¼ë¡œ ë‹¤ì‹œ í‹€ì–´ì¤„ì§€"ë¥¼ ì¡°ì ˆí•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.
            </p>
        </section>

        <!-- Section 7: Code Examples -->
        <section class="section sec-code">
            <h2 class="section-title">
                <span class="section-number">7</span>
                ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œ
            </h2>
            <p class="section-description">
                Last Media Source ì €ì¥/ë³µì›, MediaBrowserService ìë™ ì¬ìƒ ì²˜ë¦¬, CarMediaManager API ì‚¬ìš© ì˜ˆì‹œì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-1. SharedPreferencesì—ì„œ Last Media Source ì €ì¥/ë³µì› (CarMediaService)</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// packages/services/Car/service/src/com/android/car/media/CarMediaService.java
// Last Media Sourceë¥¼ SharedPreferencesì— ì €ì¥
private void saveLastMediaSource(
    @NonNull ComponentName component,
    @CarMediaManager.MediaSourceMode int mode
) {
    if (mUserManager.isUserUnlocked()) {
        String key = getSharedPrefsKey(mode);
        String componentString = component.flattenToString();

        // Deque ê¸°ë°˜ íˆìŠ¤í† ë¦¬ ê´€ë¦¬
        Deque&lt;String&gt; lastMediaSources = getLastMediaSources(mode);
        lastMediaSources.remove(componentString); // ì¤‘ë³µ ì œê±°
        lastMediaSources.addFirst(componentString); // ìµœì‹  í•­ëª©ì„ ë§¨ ì•ì—

        // ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ìœ ì§€
        while (lastMediaSources.size() &gt; MAX_LAST_MEDIA_SOURCES) {
            lastMediaSources.removeLast();
        }

        // SharedPreferencesì— ì§ë ¬í™”í•˜ì—¬ ì €ì¥
        mSharedPrefs.edit()
            .putString(key, serializeDeque(lastMediaSources))
            .apply();
    }
}

// Last Media Source ë³µì›
private ComponentName getLastMediaSource(@CarMediaManager.MediaSourceMode int mode) {
    if (!mUserManager.isUserUnlocked()) return null;

    String key = getSharedPrefsKey(mode);
    String serialized = mSharedPrefs.getString(key, null);
    if (serialized == null) return null;

    Deque&lt;String&gt; lastMediaSources = deserializeDeque(serialized);
    if (lastMediaSources.isEmpty()) return null;

    // ê°€ì¥ ìµœê·¼ í•­ëª© ë°˜í™˜
    String componentString = lastMediaSources.peekFirst();
    return ComponentName.unflattenFromString(componentString);
}

// Per-User, Per-Mode SharedPreferences í‚¤ ìƒì„±
private String getSharedPrefsKey(@CarMediaManager.MediaSourceMode int mode) {
    int userId = ActivityManager.getCurrentUser();
    return String.format("user_%d_mode_%d_last_media_source", userId, mode);
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-2. MediaBrowserServiceì—ì„œ onPlaybackResumption() êµ¬í˜„ (Media App)</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// ë¯¸ë””ì–´ ì•±ì˜ MediaBrowserService êµ¬í˜„
class MyMediaBrowserService : MediaBrowserServiceCompat() {

    private lateinit var mediaSession: MediaSessionCompat

    override fun onCreate() {
        super.onCreate()

        // MediaSession ì´ˆê¸°í™”
        mediaSession = MediaSessionCompat(this, "MyMediaSession").apply {
            setCallback(MediaSessionCallback())
            setFlags(
                MediaSessionCompat.FLAG_HANDLES_MEDIA_BUTTONS or
                MediaSessionCompat.FLAG_HANDLES_TRANSPORT_CONTROLS
            )
            setSessionToken(sessionToken)
        }
    }

    // AAOSì—ì„œ ìë™ ì¬ìƒì„ ìš”ì²­í•  ë•Œ í˜¸ì¶œë¨
    override fun onPlaybackResumption(
        mediaSession: MediaSessionCompat,
        controller: MediaControllerCompat
    ) {
        Log.d(TAG, "onPlaybackResumption: Autoplay requested by system")

        // ë§ˆì§€ë§‰ ì¬ìƒ ìƒíƒœë¥¼ ë³µì›
        val lastPlaylist = restoreLastPlaylist() // ì•± ë‚´ë¶€ DB/SharedPreferences
        val lastPosition = restoreLastPosition()

        if (lastPlaylist != null) {
            // í ë³µì›
            controller.addQueueItem(lastPlaylist)

            // ë§ˆì§€ë§‰ ìœ„ì¹˜ë¡œ ì‹œí¬
            controller.transportControls.seekTo(lastPosition)

            // ìë™ ì¬ìƒ ì‹œì‘
            controller.transportControls.play()

            Log.d(TAG, "Restored and started playback: ${lastPlaylist.description.title}")
        } else {
            Log.w(TAG, "No last playlist found, playing default")
            playDefaultContent()
        }
    }

    // MediaSession Callback
    private inner class MediaSessionCallback : MediaSessionCompat.Callback() {
        override fun onPlay() {
            // Audio Focus ìš”ì²­
            val result = audioFocusHelper.requestAudioFocus()
            if (result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {
                player.start()
                updatePlaybackState(PlaybackStateCompat.STATE_PLAYING)
            }
        }

        override fun onPause() {
            player.pause()
            updatePlaybackState(PlaybackStateCompat.STATE_PAUSED)
        }
    }

    // PlaybackState ì—…ë°ì´íŠ¸ (CarMediaServiceê°€ ê°ì§€í•¨)
    private fun updatePlaybackState(@PlaybackStateCompat.State state: Int) {
        val playbackState = PlaybackStateCompat.Builder()
            .setState(state, player.currentPosition, 1.0f)
            .setActions(
                PlaybackStateCompat.ACTION_PLAY or
                PlaybackStateCompat.ACTION_PAUSE or
                PlaybackStateCompat.ACTION_SKIP_TO_NEXT or
                PlaybackStateCompat.ACTION_SKIP_TO_PREVIOUS
            )
            .build()

        mediaSession.setPlaybackState(playbackState)
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-3. CarMediaManager APIë¡œ Last Media Source ì¡°íšŒ/ë³€ê²½</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// AAOS ì•±ì—ì„œ CarMediaManagerë¥¼ ì‚¬ìš©í•˜ì—¬ Last Media Source ì œì–´
class CarMediaActivity : AppCompatActivity() {

    private lateinit var car: Car
    private lateinit var carMediaManager: CarMediaManager

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        // Car API ì—°ê²°
        car = Car.createCar(this)
        carMediaManager = car.getCarManager(Car.CAR_MEDIA_SERVICE) as CarMediaManager

        // Last Media Source ì¡°íšŒ
        val lastMediaSource = carMediaManager.lastMediaSource
        Log.d(TAG, "Last Media Source: ${lastMediaSource?.flattenToShortString()}")

        // MediaSource ë³€ê²½ (ìƒˆ ì•±ìœ¼ë¡œ ì „í™˜)
        btnSwitchToSpotify.setOnClickListener {
            val spotifyComponent = ComponentName(
                "com.spotify.music",
                "com.spotify.music.MainActivity"
            )
            carMediaManager.setMediaSource(
                spotifyComponent,
                CarMediaManager.MEDIA_SOURCE_MODE_PLAYBACK
            )
        }

        // MediaSource ë³€ê²½ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        carMediaManager.addMediaSourceListener(
            Executor { it.run() },
            object : CarMediaManager.MediaSourceChangedListener {
                override fun onMediaSourceChanged(componentName: ComponentName?) {
                    Log.d(TAG, "Media source changed: ${componentName?.flattenToShortString()}")
                    updateUI(componentName)
                }
            }
        )
    }

    override fun onDestroy() {
        super.onDestroy()
        car.disconnect()
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-amber); font-size: 1.3rem;">7-4. EXTRA_AUTOPLAY Intent Extra ì²˜ë¦¬ (MediaConnectorService)</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// MediaConnectorServiceì—ì„œ EXTRA_AUTOPLAYë¥¼ ì²˜ë¦¬
private fun connectToMediaBrowser(component: ComponentName, autoplay: Boolean) {
    val intent = Intent().apply {
        setComponent(component)
        putExtra(MediaConstants.EXTRA_AUTOPLAY, autoplay) // ìë™ ì¬ìƒ ì—¬ë¶€ ì „ë‹¬
    }

    val mediaBrowser = MediaBrowserCompat(
        context,
        component,
        object : MediaBrowserCompat.ConnectionCallback() {
            override fun onConnected() {
                Log.d(TAG, "MediaBrowser connected: $component")

                val token = mediaBrowser.sessionToken
                val controller = MediaControllerCompat(context, token)

                if (autoplay) {
                    // Autoplayê°€ trueë©´ ìë™ìœ¼ë¡œ play() í˜¸ì¶œ
                    Log.d(TAG, "Starting autoplay")
                    controller.transportControls.play()
                } else {
                    Log.d(TAG, "Connected without autoplay (ready state)")
                }
            }

            override fun onConnectionFailed() {
                Log.e(TAG, "MediaBrowser connection failed: $component")
            }
        },
        null
    )

    mediaBrowser.connect()
}</code></pre>
            </div>
        </section>

        <!-- Section 8: Autoplay Policy Configuration -->
        <section class="section sec-policy">
            <h2 class="section-title">
                <span class="section-number">8</span>
                Autoplay Policy ì„¤ì •
            </h2>
            <p class="section-description">
                OEMì´ ì°¨ëŸ‰ íŠ¹ì„±ì— ë§ê²Œ ìë™ ì¬ìƒ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆëŠ” config ë¦¬ì†ŒìŠ¤ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">8-1. config_mediaSourceAutoplayConfig XML</h3>
            <div class="code-block">
                <pre><code class="language-xml">&lt;!-- packages/services/Car/service/res/values/config.xml --&gt;
&lt;!-- Autoplay Policy ì„¤ì • --&gt;
&lt;integer name="config_mediaSourceAutoplayConfig"&gt;2&lt;/integer&gt;

&lt;!--
    0 = AUTOPLAY_CONFIG_NEVER (ìë™ ì¬ìƒ ì•ˆ í•¨)
    1 = AUTOPLAY_CONFIG_ALWAYS (ë¬´ì¡°ê±´ ì¬ìƒ)
    2 = AUTOPLAY_CONFIG_RETAIN_PER_SOURCE (ì†ŒìŠ¤ë³„ ë§ˆì§€ë§‰ ìƒíƒœ ìœ ì§€)
    3 = AUTOPLAY_CONFIG_RETAIN_PREVIOUS (ì „ì—­ ë§ˆì§€ë§‰ ìƒíƒœ ìœ ì§€)
--&gt;</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">8-2. 4ê°€ì§€ Autoplay Policy ìƒì„¸</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Policy</th>
                            <th>ê°’</th>
                            <th>ë™ì‘ ë°©ì‹</th>
                            <th>ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>AUTOPLAY_CONFIG_NEVER</code></td>
                            <td>0</td>
                            <td>ì°¨ëŸ‰ ì‹œë™ ì‹œ ìë™ ì¬ìƒí•˜ì§€ ì•ŠìŒ. ë‹¨ìˆœíˆ ë§ˆì§€ë§‰ ì†ŒìŠ¤ë§Œ UIì— í‘œì‹œ</td>
                            <td>ìš´ì „ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ í•˜ëŠ” ì •ì±… (ì•ˆì „ ì¤‘ì‹œ)</td>
                        </tr>
                        <tr>
                            <td><code>AUTOPLAY_CONFIG_ALWAYS</code></td>
                            <td>1</td>
                            <td>ë§ˆì§€ë§‰ ì¬ìƒ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ ë¬´ì¡°ê±´ ìë™ ì¬ìƒ ì‹œë„</td>
                            <td>ìƒì—…ìš© ì°¨ëŸ‰, í•­ìƒ ë°°ê²½ ìŒì•…ì´ í•„ìš”í•œ í™˜ê²½</td>
                        </tr>
                        <tr>
                            <td><code>RETAIN_PER_SOURCE</code></td>
                            <td>2</td>
                            <td>ê° ë¯¸ë””ì–´ ì†ŒìŠ¤ë³„ë¡œ ë§ˆì§€ë§‰ ìƒíƒœë¥¼ ê¸°ì–µ. Spotifyê°€ PLAYINGì´ì—ˆìœ¼ë©´ Spotify ì—°ê²° ì‹œ ìë™ ì¬ìƒ</td>
                            <td>ëŒ€ë¶€ë¶„ì˜ AAOS ê¸°ë³¸ ì„¤ì • (ì†ŒìŠ¤ë³„ ë…ë¦½ì  ë™ì‘)</td>
                        </tr>
                        <tr>
                            <td><code>RETAIN_PREVIOUS</code></td>
                            <td>3</td>
                            <td>CarMediaServiceê°€ ê¸°ì–µí•˜ëŠ” ì „ì—­ ë§ˆì§€ë§‰ ìƒíƒœ. ì–´ë–¤ ì†ŒìŠ¤ë“  ë§ˆì§€ë§‰ì´ PLAYINGì´ì—ˆìœ¼ë©´ ì¬ìƒ</td>
                            <td>ë‹¨ìˆœí•œ UXë¥¼ ì›í•˜ëŠ” ê²½ìš° (ì „ì—­ ë™ì‘)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">8-3. OEM Overlayë¡œ ì •ì±… ë³€ê²½</h3>
            <div class="code-block">
                <pre><code class="language-xml">&lt;!-- OEM overlay: device/oem/project/overlay/packages/services/Car/service/res/values/config.xml --&gt;
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;resources&gt;
    &lt;!-- Autoplayë¥¼ ì™„ì „íˆ ë¹„í™œì„±í™” --&gt;
    &lt;integer name="config_mediaSourceAutoplayConfig"&gt;0&lt;/integer&gt;

    &lt;!-- ê¸°ë³¸ ë¯¸ë””ì–´ ì†ŒìŠ¤ ì§€ì • (íˆìŠ¤í† ë¦¬ ì—†ì„ ë•Œ) --&gt;
    &lt;string name="config_defaultMediaSource"&gt;com.google.android.apps.youtube.music&lt;/string&gt;

    &lt;!-- Independent Playback Config (ë¼ë””ì˜¤ vs ë¯¸ë””ì–´ ë¶„ë¦¬) --&gt;
    &lt;bool name="config_mediaSourceIndependentPlayback"&gt;true&lt;/bool&gt;
&lt;/resources&gt;</code></pre>
            </div>

            <div class="content-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”§</span> OEM ì»¤ìŠ¤í„°ë§ˆì´ì§• í¬ì¸íŠ¸</h3>
                    <div class="card-description">
                        <ul>
                            <li><code>config_mediaSourceAutoplayConfig</code>: ìë™ ì¬ìƒ ì •ì±…</li>
                            <li><code>config_defaultMediaSource</code>: ê¸°ë³¸ ë¯¸ë””ì–´ ì•± (íˆìŠ¤í† ë¦¬ ì—†ì„ ë•Œ)</li>
                            <li><code>config_mediaSourceIndependentPlayback</code>: ë¼ë””ì˜¤ì™€ ë¯¸ë””ì–´ ë…ë¦½ ì¬ìƒ ì—¬ë¶€</li>
                            <li><code>config_allowMediaSourceChange</code>: ì†ŒìŠ¤ ë³€ê²½ í—ˆìš© ì—¬ë¶€ (ì ê¸ˆ)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 9: Boot Sequence & Timing -->
        <section class="section sec-boot">
            <h2 class="section-title">
                <span class="section-number">9</span>
                ë¶€íŒ… ì‹œí€€ìŠ¤ & íƒ€ì´ë°
            </h2>
            <p class="section-description">
                ì°¨ëŸ‰ ì‹œë™ í›„ Last Media ë³µì›ì´ ì‹¤ì œë¡œ ì–´ë–¤ ìˆœì„œë¡œ ì¼ì–´ë‚˜ëŠ”ì§€, ì£¼ìš” ì´ë²¤íŠ¸ íƒ€ì´ë°ì„ ì‚´í´ë´…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-blue); font-size: 1.3rem;">9-1. Boot Timeline</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    flowchart TD
                        subgraph BOOT ["ğŸš— Boot Phase (0~3s)"]
                            A["âš¡ Vehicle Ignition ON<br/><small>0ms</small>"]
                            B["ğŸ”§ Kernel Boot<br/><small>0~1.5s</small>"]
                            C["ğŸ“± Android Init<br/><small>1.5~3s</small>"]
                            A --> B --> C
                        end

                        subgraph SERVICE ["âš™ï¸ System Services (3~5s)"]
                            D["CarService.onCreate()<br/><small>3s</small>"]
                            E["VHAL Connection<br/><small>3.5s</small>"]
                            F["Power Policy Init<br/><small>4s</small>"]
                            G["User Unlock (HEAD_USER)<br/><small>4.3~5s</small>"]
                            D --> E --> F --> G
                        end

                        subgraph MEDIA ["ğŸµ Media Restoration (5~6s)"]
                            H["CarMediaService.onCreate()<br/><small>5s</small>"]
                            I["Load SharedPreferences<br/><small>5.2s</small>"]
                            J["getLastMediaSource()<br/><small>5.3s</small>"]
                            K["shouldStartPlayback()<br/><small>5.35s</small>"]
                            H --> I --> J --> K
                        end

                        subgraph PLAY ["â–¶ï¸ Media Playback (6s~)"]
                            L["Start MediaConnectorService<br/><small>5.4s</small>"]
                            M["MediaBrowser.connect()<br/><small>5.6s</small>"]
                            N["MediaSession Ready<br/><small>5.9s</small>"]
                            O["ğŸ¶ Autoplay<br/><small>6s</small>"]
                            L --> M --> N --> O
                        end

                        C --> D
                        G --> H
                        K --> L
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-blue); font-size: 1.3rem;">9-2. ì£¼ìš” ì´ë²¤íŠ¸ íƒ€ì´ë°</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>íƒ€ì´ë° (ms)</th>
                            <th>ì´ë²¤íŠ¸</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0</td>
                            <td>Vehicle Ignition ON</td>
                            <td>ì°¨ëŸ‰ ì‹œë™ í‚¤ ì˜¨ (IGN_ON VHAL ì‹ í˜¸)</td>
                        </tr>
                        <tr>
                            <td>~3000</td>
                            <td>Android System Boot</td>
                            <td>Kernel, Init, Zygote, System Server ë¶€íŒ…</td>
                        </tr>
                        <tr>
                            <td>~4000</td>
                            <td>Power Policy ì ìš©</td>
                            <td>VHALì—ì„œ ì „ì› ì •ì±… ìˆ˜ì‹ , ì˜¤ë””ì˜¤ ì„œë¸Œì‹œìŠ¤í…œ í™œì„±í™”</td>
                        </tr>
                        <tr>
                            <td>~5000</td>
                            <td>User Unlock ì™„ë£Œ</td>
                            <td>HEAD_USER (ìš´ì „ì) ì ê¸ˆ í•´ì œ, SharedPreferences ì ‘ê·¼ ê°€ëŠ¥</td>
                        </tr>
                        <tr>
                            <td>~5300</td>
                            <td>Last Media Source ë³µì›</td>
                            <td>CarMediaServiceê°€ SharedPreferencesì—ì„œ ë§ˆì§€ë§‰ ì†ŒìŠ¤ ë¡œë“œ</td>
                        </tr>
                        <tr>
                            <td>~5400</td>
                            <td>Autoplay ê²°ì •</td>
                            <td>shouldStartPlayback() ë¡œì§ìœ¼ë¡œ ìë™ ì¬ìƒ ì—¬ë¶€ íŒë‹¨</td>
                        </tr>
                        <tr>
                            <td>~6000</td>
                            <td>MediaBrowser ì—°ê²°</td>
                            <td>MediaConnectorServiceê°€ ì•±ì— ë°”ì¸ë“œ, MediaSession í† í° íšë“</td>
                        </tr>
                        <tr>
                            <td>~6200</td>
                            <td>Autoplay ì‹œì‘</td>
                            <td>ì •ì±…ì— ë”°ë¼ transportControls.play() í˜¸ì¶œ</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-blue); font-size: 1.3rem;">9-3. Power Policy í†µí•©</h3>
            <div class="code-block">
                <pre><code class="language-java">// CarMediaServiceì—ì„œ Power Policy ì´ë²¤íŠ¸ ì²˜ë¦¬
@Override
public void onStateChanged(int state, CompletableFuture&lt;Void&gt; future) {
    switch (state) {
        case CarPowerManager.STATE_ON:
            Log.d(TAG, "Vehicle ON: Restoring last media source");
            restoreLastMediaSource();
            future.complete(null);
            break;

        case CarPowerManager.STATE_SHUTDOWN_PREPARE:
            Log.d(TAG, "Vehicle shutdown: Saving current state");
            saveCurrentMediaState();
            future.complete(null);
            break;

        case CarPowerManager.STATE_SUSPEND:
            Log.d(TAG, "Vehicle suspend: Preparing snapshot");
            // Suspend-to-RAM ìƒíƒœì—ì„œëŠ” ë©”ëª¨ë¦¬ ìœ ì§€
            future.complete(null);
            break;
    }
}</code></pre>
            </div>

            <div class="content-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš¡</span> Suspend vs Cold Boot</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Suspend-to-RAM:</strong> ë©”ëª¨ë¦¬ ìƒíƒœ ìœ ì§€, ì¬ê°œ ì‹œ ì¦‰ì‹œ ë³µì› (~2ì´ˆ)</li>
                            <li><strong>Cold Boot:</strong> SharedPreferencesì—ì„œ ë³µì›, ì „ì²´ ë¶€íŒ… í•„ìš” (~6ì´ˆ)</li>
                            <li><strong>Hybrid Mode:</strong> ì§§ì€ ì£¼ì°¨ëŠ” Suspend, ê¸´ ì£¼ì°¨ëŠ” Shutdown</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 10: Multi-user Support -->
        <section class="section sec-multiuser">
            <h2 class="section-title">
                <span class="section-number">10</span>
                Multi-user ì§€ì›
            </h2>
            <p class="section-description">
                AAOSëŠ” ì—¬ëŸ¬ ìš´ì „ìê°€ ì°¨ëŸ‰ì„ ê³µìœ í•  ìˆ˜ ìˆë„ë¡ Multi-userë¥¼ ì§€ì›í•˜ë©°, Last MediaëŠ” ì‚¬ìš©ìë³„ë¡œ ë…ë¦½ì ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">10-1. ì‚¬ìš©ìë³„ ì €ì¥ì†Œ</h3>
            <div class="code-block">
                <pre><code class="language-java">// CarMediaServiceì—ì„œ ì‚¬ìš©ìë³„ SharedPreferences í‚¤ ìƒì„±
private static final String SHARED_PREF = "com.android.car.media.car_media_service";

private SharedPreferences getSharedPrefsForCurrentUser() {
    int userId = ActivityManager.getCurrentUser();
    Context userContext = mContext.createContextAsUser(UserHandle.of(userId), 0);
    return userContext.getSharedPreferences(SHARED_PREF, Context.MODE_PRIVATE);
}

// User IDë¥¼ í¬í•¨í•œ í‚¤ ìƒì„±
private String getLastMediaSourceKey(@CarMediaManager.MediaSourceMode int mode) {
    int userId = ActivityManager.getCurrentUser();
    return String.format("user_%d_mode_%d_source", userId, mode);
}

// Ephemeral User ì²´í¬ (ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìëŠ” ì €ì¥ ì•ˆ í•¨)
private boolean isCurrentUserEphemeral() {
    UserManager userManager = mContext.getSystemService(UserManager.class);
    UserInfo userInfo = userManager.getUserInfo(ActivityManager.getCurrentUser());
    return userInfo != null &amp;&amp; userInfo.isEphemeral();
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">10-2. User Switching ì‹œë‚˜ë¦¬ì˜¤</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant User1
                    participant CarService
                    participant CMS as CarMediaService
                    participant Prefs as SharedPreferences

                    Note over User1: Driver 1 listening to Spotify
                    User1->>CMS: Play Spotify
                    CMS->>Prefs: Save (user_10_mode_0 = Spotify)

                    Note over User1,CarService: User Switch
                    CarService->>CMS: onUserSwitching(user_11)
                    CMS->>CMS: Stop current media
                    CMS->>Prefs: Load (user_11_mode_0)

                    alt User 11 has history
                    Prefs-->>CMS: Return YouTube Music
                    CMS->>CMS: Restore YouTube Music
                    else No history
                    Prefs-->>CMS: Return null
                    CMS->>CMS: Use default source
                    end

                    Note over User1: Driver 2 listening to YouTube Music
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">10-3. User Typeë³„ ë™ì‘</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>User Type</th>
                            <th>ì €ì¥ ì—¬ë¶€</th>
                            <th>ë³µì› ì—¬ë¶€</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SYSTEM (User 0)</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>ì‹œìŠ¤í…œ ì „ìš©, ë¯¸ë””ì–´ ì¬ìƒ ì•ˆ í•¨</td>
                        </tr>
                        <tr>
                            <td>HEAD_USER (ìš´ì „ì)</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>ë©”ì¸ ìš´ì „ì, ì „ì²´ ê¸°ëŠ¥ ì§€ì›</td>
                        </tr>
                        <tr>
                            <td>SECONDARY_USER</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>ë³´ì¡° ìš´ì „ì (ê°€ì¡± ê³µìœ  ë“±)</td>
                        </tr>
                        <tr>
                            <td>GUEST_USER (ê²ŒìŠ¤íŠ¸)</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>ì„ì‹œ ì‚¬ìš©ì, Ephemeral=true, ì €ì¥ ì•ˆ ë¨</td>
                        </tr>
                        <tr>
                            <td>PROFILE (Work Profile)</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>ì—…ë¬´ìš© í”„ë¡œíŒŒì¼, ë…ë¦½ ì €ì¥ì†Œ</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-purple); font-size: 1.3rem;">10-4. Multi-user ì²˜ë¦¬ ì½”ë“œ</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// User Switching ì´ë²¤íŠ¸ ì²˜ë¦¬
class CarMediaService : SystemService() {

    private val userSwitchObserver = object : UserLifecycleListener() {
        override fun onUserSwitching(from: UserHandle, to: UserHandle) {
            Log.d(TAG, "User switching: ${from.identifier} -> ${to.identifier}")

            // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ë¯¸ë””ì–´ ì¤‘ì§€
            stopCurrentMediaSource()

            // ìƒˆ ì‚¬ìš©ìì˜ Last Media Source ë³µì›
            val lastSource = getLastMediaSourceForUser(to.identifier)
            if (lastSource != null) {
                Log.d(TAG, "Restoring last media for user ${to.identifier}: $lastSource")
                setMediaSource(lastSource, CarMediaManager.MEDIA_SOURCE_MODE_PLAYBACK)
            } else {
                Log.d(TAG, "No history for user ${to.identifier}, using default")
                setMediaSource(getDefaultMediaSource(), CarMediaManager.MEDIA_SOURCE_MODE_PLAYBACK)
            }
        }
    }

    private fun getLastMediaSourceForUser(userId: Int): ComponentName? {
        val userContext = context.createContextAsUser(UserHandle.of(userId), 0)
        val userPrefs = userContext.getSharedPreferences(SHARED_PREF, Context.MODE_PRIVATE)

        // Ephemeral ì‚¬ìš©ìëŠ” ì €ì¥ì†Œê°€ ì—†ìŒ
        val userManager = context.getSystemService(UserManager::class.java)
        val userInfo = userManager.getUserInfo(userId)
        if (userInfo?.isEphemeral == true) {
            return null
        }

        val key = "user_${userId}_mode_0_source"
        val componentString = userPrefs.getString(key, null) ?: return null
        return ComponentName.unflattenFromString(componentString)
    }
}</code></pre>
            </div>
        </section>

        <!-- Section 11: MediaConnectorService Details -->
        <section class="section sec-connector">
            <h2 class="section-title">
                <span class="section-number">11</span>
                MediaConnectorService ìƒì„¸
            </h2>
            <p class="section-description">
                MediaConnectorServiceëŠ” CarMediaServiceì˜ ì§€ì‹œë¥¼ ë°›ì•„ ì‹¤ì œë¡œ ë¯¸ë””ì–´ ì•±ì— ì—°ê²°í•˜ê³  ìë™ ì¬ìƒì„ ì œì–´í•˜ëŠ” í•µì‹¬ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">11-1. EXTRA_AUTOPLAY ë©”ì»¤ë‹ˆì¦˜</h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    stateDiagram-v2
                    [*] --> Idle: Service Created
                    Idle --> Connecting: startService(EXTRA_AUTOPLAY)

                    Connecting --> Connected: onConnected()
                    Connecting --> Failed: onConnectionFailed()

                    Connected --> Autoplay_Check: Check EXTRA_AUTOPLAY

                    Autoplay_Check --> Playing: EXTRA_AUTOPLAY=true
                    Autoplay_Check --> Ready: EXTRA_AUTOPLAY=false

                    Playing --> Ready: User Pause
                    Ready --> Playing: User Play

                    Failed --> Idle: Retry or Give Up
                    Ready --> [*]: Service Destroyed
                    Playing --> [*]: Service Destroyed
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">11-2. Intent êµ¬ì¡°</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// CarMediaServiceì—ì„œ MediaConnectorService ì‹œì‘
private fun startMediaConnectorService(
    component: ComponentName,
    autoplay: Boolean
) {
    val intent = Intent(mContext, MediaConnectorService::class.java).apply {
        putExtra(MediaConstants.EXTRA_MEDIA_COMPONENT, component.flattenToString())
        putExtra(MediaConstants.EXTRA_AUTOPLAY, autoplay) // í•µì‹¬: ìë™ ì¬ìƒ ì—¬ë¶€
        putExtra(MediaConstants.EXTRA_BROWSE_SERVICE_HINT, getBrowseServiceForComponent(component))
    }

    Log.d(TAG, "Starting MediaConnectorService: component=$component, autoplay=$autoplay")
    mContext.startForegroundService(intent)
}

// MediaConstants ì •ì˜
object MediaConstants {
    const val EXTRA_MEDIA_COMPONENT = "media_component"
    const val EXTRA_AUTOPLAY = "autoplay"
    const val EXTRA_BROWSE_SERVICE_HINT = "browse_service_hint"
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">11-3. MediaBrowser ì—°ê²° ë¡œì§</h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// MediaConnectorService.kt (AOSP ê¸°ë°˜ ê°„ì†Œí™”)
class MediaConnectorService : Service() {

    private var mediaBrowser: MediaBrowserCompat? = null
    private var mediaController: MediaControllerCompat? = null
    private var shouldAutoplay: Boolean = false

    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
        val componentString = intent?.getStringExtra(EXTRA_MEDIA_COMPONENT) ?: return START_NOT_STICKY
        val component = ComponentName.unflattenFromString(componentString) ?: return START_NOT_STICKY

        shouldAutoplay = intent.getBooleanExtra(EXTRA_AUTOPLAY, false)

        Log.d(TAG, "Connecting to $component with autoplay=$shouldAutoplay")
        connectToMediaBrowser(component)

        return START_STICKY
    }

    private fun connectToMediaBrowser(component: ComponentName) {
        val connectionCallback = object : MediaBrowserCompat.ConnectionCallback() {
            override fun onConnected() {
                Log.d(TAG, "MediaBrowser connected")

                val browser = mediaBrowser ?: return
                val token = browser.sessionToken

                mediaController = MediaControllerCompat(this@MediaConnectorService, token).also {
                    it.registerCallback(controllerCallback)
                }

                // EXTRA_AUTOPLAY=trueë©´ ìë™ ì¬ìƒ
                if (shouldAutoplay) {
                    Log.d(TAG, "Triggering autoplay")
                    mediaController?.transportControls?.play()
                } else {
                    Log.d(TAG, "Connected without autoplay (ready state)")
                }
            }

            override fun onConnectionFailed() {
                Log.e(TAG, "MediaBrowser connection failed")
                stopSelf()
            }

            override fun onConnectionSuspended() {
                Log.w(TAG, "MediaBrowser connection suspended")
                mediaController?.unregisterCallback(controllerCallback)
                mediaController = null
            }
        }

        mediaBrowser = MediaBrowserCompat(this, component, connectionCallback, null)
        mediaBrowser?.connect()
    }

    private val controllerCallback = object : MediaControllerCompat.Callback() {
        override fun onPlaybackStateChanged(state: PlaybackStateCompat?) {
            Log.d(TAG, "Playback state changed: ${state?.state}")

            // CarMediaServiceì— ìƒíƒœ ì „íŒŒ (Broadcast ë˜ëŠ” Binder)
            val intent = Intent(ACTION_PLAYBACK_STATE_CHANGED).apply {
                putExtra(EXTRA_PLAYBACK_STATE, state?.state)
            }
            sendBroadcast(intent)
        }
    }

    override fun onDestroy() {
        mediaController?.unregisterCallback(controllerCallback)
        mediaBrowser?.disconnect()
        super.onDestroy()
    }
}</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-indigo); font-size: 1.3rem;">11-4. ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì‹œë‚˜ë¦¬ì˜¤</th>
                            <th>EXTRA_AUTOPLAY</th>
                            <th>ë™ì‘</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ì°¨ëŸ‰ ì‹œë™ + RETAIN_PER_SOURCE + ë§ˆì§€ë§‰ PLAYING</td>
                            <td>true</td>
                            <td>MediaBrowser ì—°ê²° â†’ play() í˜¸ì¶œ â†’ ìë™ ì¬ìƒ</td>
                        </tr>
                        <tr>
                            <td>ì°¨ëŸ‰ ì‹œë™ + RETAIN_PER_SOURCE + ë§ˆì§€ë§‰ PAUSED</td>
                            <td>false</td>
                            <td>MediaBrowser ì—°ê²° â†’ Ready ìƒíƒœë§Œ ìœ ì§€</td>
                        </tr>
                        <tr>
                            <td>ì°¨ëŸ‰ ì‹œë™ + AUTOPLAY_CONFIG_NEVER</td>
                            <td>false</td>
                            <td>ì—°ê²°ë§Œ í•˜ê³  ì¬ìƒ ì•ˆ í•¨</td>
                        </tr>
                        <tr>
                            <td>ì°¨ëŸ‰ ì‹œë™ + AUTOPLAY_CONFIG_ALWAYS</td>
                            <td>true</td>
                            <td>ë¬´ì¡°ê±´ ìë™ ì¬ìƒ</td>
                        </tr>
                        <tr>
                            <td>ìŒì„± ëª…ë ¹ "Play last media"</td>
                            <td>true</td>
                            <td>ê°•ì œ ìë™ ì¬ìƒ (ì„¤ì • ë¬´ì‹œ)</td>
                        </tr>
                        <tr>
                            <td>User Switching</td>
                            <td>false</td>
                            <td>ìƒˆ ì‚¬ìš©ìì˜ ë§ˆì§€ë§‰ ì†ŒìŠ¤ ì—°ê²°, ì¬ìƒ ì•ˆ í•¨</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 12: State Persistence -->
        <section class="section sec-persistence">
            <h2 class="section-title">
                <span class="section-number">12</span>
                State Persistence
            </h2>
            <p class="section-description">
                Suspend-to-RAM vs Cold Boot ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ìƒíƒœê°€ ì–´ë–»ê²Œ ìœ ì§€ë˜ê³  ë³µì›ë˜ëŠ”ì§€ ë¹„êµí•©ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">12-1. Suspend-to-RAM (S3)</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ’¾</span> ìƒíƒœ ìœ ì§€ ë°©ì‹</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ë©”ëª¨ë¦¬:</strong> DRAMì— ì „ì› ìœ ì§€, ëª¨ë“  ì¸ë©”ëª¨ë¦¬ ìƒíƒœ ë³´ì¡´</li>
                            <li><strong>CarService:</strong> Snapshot ê¸°ë°˜ ë³µì› (VHAL ì¬ì—°ê²° ë¶ˆí•„ìš”)</li>
                            <li><strong>MediaSession:</strong> ì•± í”„ë¡œì„¸ìŠ¤ê°€ ì‚´ì•„ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ìœ ì§€</li>
                            <li><strong>ì¬ê°œ ì‹œê°„:</strong> ~2ì´ˆ (ë¹ ë¥¸ ì¬ê°œ)</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš¡</span> ì¥ì  & ë‹¨ì </h3>
                    <div class="card-description">
                        <ul>
                            <li>âœ… ë¹ ë¥¸ ì¬ê°œ, ì™„ë²½í•œ ìƒíƒœ ë³µì›</li>
                            <li>âœ… ì‚¬ìš©ìê°€ ì¬ìƒ ì¤‘ì´ë˜ ìœ„ì¹˜ ì •í™•íˆ ìœ ì§€</li>
                            <li>âŒ DRAM ì „ë ¥ ì†Œëª¨ (ë°°í„°ë¦¬ ë°©ì „ ìœ„í—˜)</li>
                            <li>âŒ ê¸´ ì£¼ì°¨ ì‹œ ë¶€ì í•©</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">12-2. Cold Boot (Full Shutdown)</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”„</span> ìƒíƒœ ë³µì› ë°©ì‹</h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>ì €ì¥ì†Œ:</strong> SharedPreferences (ComponentNameë§Œ ì €ì¥)</li>
                            <li><strong>CarService:</strong> ì „ì²´ ë¶€íŒ…, VHAL ì¬ì—°ê²°</li>
                            <li><strong>MediaSession:</strong> ì•± ì¬ì‹œì‘, onPlaybackResumption() í˜¸ì¶œ</li>
                            <li><strong>ì¬ê°œ ì‹œê°„:</strong> ~6ì´ˆ (ì „ì²´ ë¶€íŒ…)</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“</span> ì•±ì˜ ì±…ì„</h3>
                    <div class="card-description">
                        <ul>
                            <li>í(Queue) ë³µì›: ì•± ë‚´ë¶€ DB/SharedPreferences</li>
                            <li>ì¬ìƒ ìœ„ì¹˜(Position): ë§ˆì§€ë§‰ ì €ì¥ëœ ì‹œì </li>
                            <li>ë©”íƒ€ë°ì´í„°: ê³¡ ì •ë³´, ì•¨ë²” ì•„íŠ¸ ë“±</li>
                            <li>ì •í™•ë„: ì•± êµ¬í˜„ì— ë”°ë¼ ë‹¤ë¦„</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">12-3. ë¹„êµí‘œ</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>í•­ëª©</th>
                            <th>Suspend-to-RAM</th>
                            <th>Cold Boot</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ì „ì› ìƒíƒœ</td>
                            <td>DRAM ì „ì› ìœ ì§€ (S3)</td>
                            <td>ì™„ì „ ì¢…ë£Œ (S5)</td>
                        </tr>
                        <tr>
                            <td>ì¬ê°œ ì‹œê°„</td>
                            <td>~2ì´ˆ</td>
                            <td>~6ì´ˆ</td>
                        </tr>
                        <tr>
                            <td>CarService ìƒíƒœ</td>
                            <td>Snapshot ê¸°ë°˜ ë³µì›</td>
                            <td>ì™„ì „ ì¬ì‹œì‘</td>
                        </tr>
                        <tr>
                            <td>MediaSession ìƒíƒœ</td>
                            <td>ë©”ëª¨ë¦¬ ìœ ì§€</td>
                            <td>ì¬ìƒì„± (onPlaybackResumption)</td>
                        </tr>
                        <tr>
                            <td>ì¬ìƒ ìœ„ì¹˜ ì •í™•ë„</td>
                            <td>100% ì •í™•</td>
                            <td>ì•± êµ¬í˜„ì— ë”°ë¼ ë‹¤ë¦„</td>
                        </tr>
                        <tr>
                            <td>ë°°í„°ë¦¬ ì†Œëª¨</td>
                            <td>ìˆìŒ (DRAM)</td>
                            <td>ì—†ìŒ</td>
                        </tr>
                        <tr>
                            <td>ì í•©í•œ ì‹œë‚˜ë¦¬ì˜¤</td>
                            <td>ì§§ì€ ì£¼ì°¨ (5ë¶„~2ì‹œê°„)</td>
                            <td>ê¸´ ì£¼ì°¨ (2ì‹œê°„ ì´ìƒ)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-teal); font-size: 1.3rem;">12-4. Hybrid Power Policy</h3>
            <div class="code-block">
                <pre><code class="language-xml">&lt;!-- car_power_policy.xml --&gt;
&lt;powerPolicy id="suspend_to_ram"&gt;
    &lt;component id="AUDIO"&gt;on&lt;/component&gt;
    &lt;component id="MEDIA"&gt;on&lt;/component&gt;
    &lt;component id="DISPLAY"&gt;off&lt;/component&gt;
    &lt;component id="WIFI"&gt;off&lt;/component&gt;
&lt;/powerPolicy&gt;

&lt;powerPolicy id="full_shutdown"&gt;
    &lt;component id="AUDIO"&gt;off&lt;/component&gt;
    &lt;component id="MEDIA"&gt;off&lt;/component&gt;
    &lt;component id="DISPLAY"&gt;off&lt;/component&gt;
    &lt;component id="WIFI"&gt;off&lt;/component&gt;
&lt;/powerPolicy&gt;

&lt;!-- ì¡°ê±´: 2ì‹œê°„ ì´ë‚´ëŠ” Suspend, ì´í›„ëŠ” Shutdown --&gt;
&lt;policyGroup id="default_policy_group"&gt;
    &lt;defaultPolicy&gt;suspend_to_ram&lt;/defaultPolicy&gt;
    &lt;noDefaultPolicy state="wait_for_vhal" timeout="7200000"&gt;full_shutdown&lt;/noDefaultPolicy&gt;
&lt;/policyGroup&gt;</code></pre>
            </div>
        </section>

        <!-- Section 13: Android Version History -->
        <section class="section sec-versions">
            <h2 class="section-title">
                <span class="section-number">13</span>
                Android ë²„ì „ë³„ ë³€í™”
            </h2>
            <p class="section-description">
                Android 10 (AAOS ì²˜ìŒ ë„ì…)ë¶€í„° Android 15ê¹Œì§€ Last Media ê¸°ëŠ¥ì˜ ì§„í™” ê³¼ì •ì…ë‹ˆë‹¤.
            </p>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Android ë²„ì „</th>
                            <th>AAOS ë²„ì „</th>
                            <th>ì£¼ìš” ë³€í™”</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Android 10 (Q)</td>
                            <td>AAOS 1.0</td>
                            <td>
                                <ul>
                                    <li>CarMediaService ìµœì´ˆ ë„ì…</li>
                                    <li>ê¸°ë³¸ Last Media Source ì €ì¥/ë³µì›</li>
                                    <li>SharedPreferences ê¸°ë°˜ ì €ì¥</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 11 (R)</td>
                            <td>AAOS 2.0</td>
                            <td>
                                <ul>
                                    <li>AUTOPLAY_CONFIG_RETAIN_PER_SOURCE ì •ì±… ì¶”ê°€</li>
                                    <li>Per-User ì €ì¥ì†Œ ì§€ì› ê°•í™”</li>
                                    <li>MediaBrowser.onPlaybackResumption() API ì¶”ê°€</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 12 (S)</td>
                            <td>AAOS 3.0</td>
                            <td>
                                <ul>
                                    <li>EXTRA_AUTOPLAY Intent Extra í‘œì¤€í™”</li>
                                    <li>Multi-user ë™ê¸°í™” ê°œì„ </li>
                                    <li>Power Policy í†µí•© (Suspend-to-RAM ìµœì í™”)</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 13 (T)</td>
                            <td>AAOS 4.0</td>
                            <td>
                                <ul>
                                    <li>Media3 (Jetpack Media) í†µí•©</li>
                                    <li>MediaSession ì„±ëŠ¥ ê°œì„  (ì§€ì—° ê°ì†Œ)</li>
                                    <li>config_mediaSourceIndependentPlayback ì¶”ê°€ (ë¼ë””ì˜¤ ë¶„ë¦¬)</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 14 (U)</td>
                            <td>AAOS 5.0</td>
                            <td>
                                <ul>
                                    <li>CarMediaManager.addMediaSourceListener() API ê°œì„ </li>
                                    <li>Ephemeral User ì²˜ë¦¬ ê°•í™”</li>
                                    <li>Privacy Sandbox í†µí•© (ì‚¬ìš©ì ë°ì´í„° ë³´í˜¸)</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Android 15 (V)</td>
                            <td>AAOS 6.0</td>
                            <td>
                                <ul>
                                    <li>AI ê¸°ë°˜ ì¶”ì²œ í†µí•© (Gemini Nano)</li>
                                    <li>ì¬ìƒ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ (ë‚ ì”¨, ì‹œê°„ëŒ€ ê¸°ë°˜)</li>
                                    <li>Multi-zone Audio ê°œì„  (ë…ë¦½ì  Autoplay)</li>
                                </ul>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-rose); font-size: 1.3rem;">13-1. Deprecated APIs</h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš ï¸</span> Android 12 ì´ì „</h3>
                    <div class="card-description">
                        <ul>
                            <li><code>CarMediaManager.setMediaSource(String)</code> â†’ <code>setMediaSource(ComponentName)</code></li>
                            <li>String ê¸°ë°˜ íŒ¨í‚¤ì§€ëª… ëŒ€ì‹  ComponentName ì‚¬ìš© í•„ìˆ˜</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ†•</span> Android 13+</h3>
                    <div class="card-description">
                        <ul>
                            <li>MediaSessionCompat â†’ Media3 MediaSession ê¶Œì¥</li>
                            <li>androidx.media3:media3-session ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 14: Debugging & Troubleshooting -->
        <section class="section sec-debug">
            <h2 class="section-title">
                <span class="section-number">14</span>
                ë””ë²„ê¹… & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
            </h2>
            <p class="section-description">
                Last Media ê¸°ëŠ¥ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë””ë²„ê¹… ë„êµ¬ì™€ ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°ë²•ì…ë‹ˆë‹¤.
            </p>

            <h3 style="margin-top: 30px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">14-1. dumpsys ëª…ë ¹ì–´</h3>
            <div class="code-block">
                <pre><code class="language-bash"># CarMediaService ì „ì²´ ìƒíƒœ ë¤í”„
adb shell dumpsys car_service --services CarMediaService

# ì¶œë ¥ ì˜ˆì‹œ:
# Primary Media Component (PLAYBACK): com.spotify.music/.MainActivity
# Primary Media Component (BROWSE): com.spotify.music/.MediaBrowserService
# Last Media Source (user_10_mode_0): com.spotify.music/.MainActivity
# Autoplay Config: RETAIN_PER_SOURCE (2)
# Independent Playback: false

# í˜„ì¬ MediaSession ì •ë³´
adb shell dumpsys media_session

# ì¶œë ¥ ì˜ˆì‹œ:
# Sessions Stack - have 1 sessions:
#   com.spotify.music (userId=10)
#     state=PlaybackState {state=3(STATE_PLAYING), position=125000ms, ...}

# SharedPreferences ì§ì ‘ í™•ì¸
adb shell run-as com.android.car.media cat /data/data/com.android.car.media/shared_prefs/com.android.car.media.car_media_service.xml

# Power Policy ìƒíƒœ
adb shell dumpsys car_service --services CarPowerManagementService</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">14-2. logcat í•„í„°ë§</h3>
            <div class="code-block">
                <pre><code class="language-bash"># CarMediaService ë¡œê·¸ë§Œ í•„í„°
adb logcat -s CarMediaService:V

# MediaConnectorService í¬í•¨
adb logcat -s CarMediaService:V MediaConnectorService:V

# MediaSession ìƒíƒœ ë³€í™” ì¶”ì 
adb logcat | grep -E "(PlaybackState|MediaSession|CarMedia)"

# Autoplay ê´€ë ¨ ë¡œê·¸ë§Œ
adb logcat | grep -i autoplay

# ì£¼ìš” ë¡œê·¸ ì˜ˆì‹œ:
# D/CarMediaService: setPlaybackMediaSource: com.spotify.music/.MainActivity
# D/CarMediaService: saveLastMediaSource: mode=0, component=com.spotify.music
# D/CarMediaService: shouldStartPlayback: config=RETAIN_PER_SOURCE, lastState=PLAYING -> true
# D/MediaConnectorService: Starting with EXTRA_AUTOPLAY=true</code></pre>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">14-3. ì£¼ìš” ë¬¸ì œ í•´ê²°</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ë¬¸ì œ</th>
                            <th>ì›ì¸</th>
                            <th>í•´ê²° ë°©ë²•</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Last Media Sourceê°€ ì €ì¥ ì•ˆ ë¨</td>
                            <td>Userê°€ Unlocked ìƒíƒœê°€ ì•„ë‹˜</td>
                            <td><code>adb shell dumpsys user</code>ë¡œ user state í™•ì¸, Direct Boot í›„ unlock í•„ìš”</td>
                        </tr>
                        <tr>
                            <td>Autoplayê°€ ë™ì‘í•˜ì§€ ì•ŠìŒ</td>
                            <td>config_mediaSourceAutoplayConfig=0 (NEVER)</td>
                            <td>OEM overlayì—ì„œ ê°’ì„ 2 (RETAIN_PER_SOURCE)ë¡œ ë³€ê²½</td>
                        </tr>
                        <tr>
                            <td>ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìì—ì„œ ì €ì¥ ì•ˆ ë¨</td>
                            <td>isCurrentUserEphemeral()=true</td>
                            <td>ì˜ë„ëœ ë™ì‘, Ephemeral userëŠ” ì €ì¥ ì•ˆ ë¨</td>
                        </tr>
                        <tr>
                            <td>MediaBrowser ì—°ê²° ì‹¤íŒ¨</td>
                            <td>ì•±ì´ MediaBrowserService ë¯¸êµ¬í˜„</td>
                            <td>AndroidManifest.xmlì— <code>&lt;service android:name=".MediaBrowserService"&gt;</code> í™•ì¸</td>
                        </tr>
                        <tr>
                            <td>ì¬ìƒ ìœ„ì¹˜ê°€ ë³µì› ì•ˆ ë¨</td>
                            <td>ì•±ì´ ë‚´ë¶€ ìƒíƒœ ì €ì¥ ì•ˆ í•¨</td>
                            <td>onPlaybackResumption()ì—ì„œ ì•± ë‚´ë¶€ DB/SharedPrefsë¡œ ìœ„ì¹˜ ë³µì› êµ¬í˜„</td>
                        </tr>
                        <tr>
                            <td>User Switching í›„ ì´ì „ ì†ŒìŠ¤ ì¬ìƒ</td>
                            <td>Per-User ì €ì¥ì†Œ ë¯¸ì‚¬ìš©</td>
                            <td>getSharedPrefsForCurrentUser() ì‚¬ìš© í™•ì¸</td>
                        </tr>
                        <tr>
                            <td>Suspend í›„ ìƒíƒœ ìœ ì‹¤</td>
                            <td>Power Policyê°€ SHUTDOWNìœ¼ë¡œ ì„¤ì •ë¨</td>
                            <td>car_power_policy.xmlì—ì„œ suspend_to_ram ì •ì±… í™•ì¸</td>
                        </tr>
                        <tr>
                            <td>íŠ¹ì • ì•±ë§Œ ìë™ ì¬ìƒ ì•ˆ ë¨</td>
                            <td>í•´ë‹¹ ì•±ì´ Audio Focus ìš”ì²­ ì‹¤íŒ¨</td>
                            <td>ì•±ì˜ AudioFocusRequest êµ¬í˜„ í™•ì¸, AUDIOFOCUS_GAIN ìš”ì²­ í•„ìˆ˜</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 16px; color: var(--accent-red); font-size: 1.3rem;">14-4. ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h3>
            <div class="code-block">
                <pre><code class="language-bash"># 1. Last Media Source ê°•ì œ ì„¤ì •
adb shell am broadcast -a com.android.car.media.SET_MEDIA_SOURCE \
  --es component "com.spotify.music/.MainActivity"

# 2. Autoplay Config ëŸ°íƒ€ì„ ë³€ê²½ (ë£¨íŒ… í•„ìš”)
adb shell setprop persist.car.media.autoplay 2

# 3. SharedPreferences ì§ì ‘ ìˆ˜ì • (í…ŒìŠ¤íŠ¸ìš©)
adb shell
run-as com.android.car.media
vi /data/data/com.android.car.media/shared_prefs/com.android.car.media.car_media_service.xml
# user_10_mode_0_source ê°’ ìˆ˜ì •

# 4. User Switching ì‹œë®¬ë ˆì´ì…˜
adb shell am switch-user 11

# 5. Suspend/Resume ì‹œë®¬ë ˆì´ì…˜
adb shell dumpsys car_service suspend  # Suspend
adb shell dumpsys car_service resume   # Resume</code></pre>
            </div>
        </section>

        <!-- Section 15: AOSP Source Code -->
        <section class="section sec-source">
            <h2 class="section-title">
                <span class="section-number">15</span>
                AOSP ì†ŒìŠ¤ ì½”ë“œ ì°¸ì¡°
            </h2>
            <p class="section-description">
                Last Media ê¸°ëŠ¥ êµ¬í˜„ì„ ì´í•´í•˜ê¸° ìœ„í•œ í•µì‹¬ AOSP ì†ŒìŠ¤ íŒŒì¼ë“¤ì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“‚</span> CarMediaService.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/src/com/android/car/media/CarMediaService.java</code><br>
                        <strong>í•µì‹¬ ê¸°ëŠ¥:</strong>
                        <ul>
                            <li>Last Media Source ì €ì¥/ë³µì› (<code>saveLastMediaSource()</code>)</li>
                            <li>Autoplay ê²°ì • ë¡œì§ (<code>shouldStartPlayback()</code>)</li>
                            <li>Per-User SharedPreferences ê´€ë¦¬</li>
                            <li>MediaController.Callback ì²˜ë¦¬ (PlaybackState ê°ì§€)</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/src/com/android/car/media/CarMediaService.java"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”Œ</span> MediaConnectorService.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/apps/Car/Media/src/com/android/car/media/MediaConnectorService.java</code><br>
                        <strong>í•µì‹¬ ê¸°ëŠ¥:</strong>
                        <ul>
                            <li>EXTRA_AUTOPLAY Intent ì²˜ë¦¬</li>
                            <li>MediaBrowser ì—°ê²° ê´€ë¦¬</li>
                            <li>MediaController.play() ìë™ í˜¸ì¶œ</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/apps/Car/Media/src/com/android/car/media/"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ›ï¸</span> CarMediaManager.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/car-lib/src/android/car/media/CarMediaManager.java</code><br>
                        <strong>í•µì‹¬ ê¸°ëŠ¥:</strong>
                        <ul>
                            <li>Public API: <code>getLastMediaSource()</code></li>
                            <li>Public API: <code>setMediaSource(ComponentName, int mode)</code></li>
                            <li>MediaSourceChangedListener ì¸í„°í˜ì´ìŠ¤</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/car-lib/src/android/car/media/CarMediaManager.java"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">âš™ï¸</span> config.xml</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/res/values/config.xml</code><br>
                        <strong>í•µì‹¬ ì„¤ì •:</strong>
                        <ul>
                            <li><code>config_mediaSourceAutoplayConfig</code></li>
                            <li><code>config_defaultMediaSource</code></li>
                            <li><code>config_mediaSourceIndependentPlayback</code></li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/res/values/config.xml"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ”‹</span> CarPowerManagementService.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>packages/services/Car/service/src/com/android/car/power/CarPowerManagementService.java</code><br>
                        <strong>ì—°ê´€ ê¸°ëŠ¥:</strong>
                        <ul>
                            <li>Suspend-to-RAM ìƒíƒœ ê´€ë¦¬</li>
                            <li>Power Policy ì ìš©</li>
                            <li>CarMediaServiceì— ì „ì› ìƒíƒœ ì „íŒŒ</li>
                        </ul>
                        <a href="https://cs.android.com/android/platform/superproject/+/main:packages/services/Car/service/src/com/android/car/power/"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><span class="card-icon">ğŸ“±</span> MediaBrowserServiceCompat.java</h3>
                    <div class="card-description">
                        <strong>ê²½ë¡œ:</strong> <code>frameworks/support/media/media/src/main/java/androidx/media/MediaBrowserServiceCompat.java</code><br>
                        <strong>ì•± ì¸¡ êµ¬í˜„:</strong>
                        <ul>
                            <li><code>onGetRoot()</code> ì˜¤ë²„ë¼ì´ë“œ</li>
                            <li><code>onLoadChildren()</code> ì˜¤ë²„ë¼ì´ë“œ</li>
                            <li><code>onPlaybackResumption()</code> (Android 11+)</li>
                        </ul>
                        <a href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:media/media/src/main/java/androidx/media/MediaBrowserServiceCompat.java"
                           target="_blank" style="color: var(--accent-blue);">â†’ ì†ŒìŠ¤ ë³´ê¸°</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 16: Related Documentation -->
        <section class="section sec-related">
            <h2 class="section-title">
                <span class="section-number">16</span>
                ê´€ë ¨ ìƒì„¸ ë¬¸ì„œ
            </h2>
            <p class="section-description">
                Last Media & Autoplayì™€ ë°€ì ‘í•˜ê²Œ ê´€ë ¨ëœ ë‹¤ë¥¸ ë¬¸ì„œë“¤ì…ë‹ˆë‹¤.
            </p>

            <div class="content-grid">
                <div class="card clickable" onclick="location.href='carmedia.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ“»</span> Car Media Service</h3>
                    <div class="card-description">
                        CarMediaService ì „ì²´ ì•„í‚¤í…ì²˜, Active Media Source ê´€ë¦¬, Audio Focus í†µí•©, Last Media Service ë©”ì»¤ë‹ˆì¦˜
                    </div>
                    <a href="carmedia.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='mediasession.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ›ï¸</span> MediaSession Framework</h3>
                    <div class="card-description">
                        MediaSession/MediaController ì•„í‚¤í…ì²˜, PlaybackState ì „íŒŒ, TransportControls API, Callback ë©”ì»¤ë‹ˆì¦˜
                    </div>
                    <a href="mediasession.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='audio-framework.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ”Š</span> Audio Framework</h3>
                    <div class="card-description">
                        Audio Focus ì‹œìŠ¤í…œ, AudioManager API, AAOS Car Audio Zone, Multi-zone ì˜¤ë””ì˜¤ ë¼ìš°íŒ…
                    </div>
                    <a href="audio-framework.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='power-policy-suspend.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ”‹</span> Power Policy & Suspend</h3>
                    <div class="card-description">
                        Suspend-to-RAM (S3) ë©”ì»¤ë‹ˆì¦˜, Deep Sleep íƒ€ì´ë°, Power Policy ì„¤ì •, Snapshot ê¸°ë°˜ ë³µì›
                    </div>
                    <a href="power-policy-suspend.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='media-app-layer.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸ“±</span> Media App Layer</h3>
                    <div class="card-description">
                        MediaPlayer/ExoPlayer/Media3 API, MediaBrowserService êµ¬í˜„ ê°€ì´ë“œ, AAOS ì•± ê°œë°œ ëª¨ë²” ì‚¬ë¡€
                    </div>
                    <a href="media-app-layer.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>

                <div class="card clickable" onclick="location.href='aaos.html'">
                    <h3 class="card-title"><span class="card-icon">ğŸš—</span> AAOS Overview</h3>
                    <div class="card-description">
                        Android Automotive OS ì „ì²´ ê°œìš”, CarService ì•„í‚¤í…ì²˜, Multi-user ì‹œìŠ¤í…œ, Vehicle HAL í†µí•©
                    </div>
                    <a href="aaos.html" class="card-link">ìì„¸íˆ ë³´ê¸° â†’</a>
                </div>
            </div>
        </section>

        <a href="index.html" class="nav-button">â† Back to Dashboard</a>
    </div>

    <script src="scripts/mermaid-theme.js"></script>
    <!-- Navigation & Copy Features -->
    <script src="scripts/copy-code.js"></script>
    <script src="scripts/toc-generator.js"></script>
    <script src="scripts/page-navigation.js"></script>
    <!-- Interactive Diagram Features -->
    <script src="scripts/diagram-data.js"></script>
    <script src="scripts/diagram-interactive.js"></script>

    <script src="scripts/theme-toggle.js"></script>
    <script src="scripts/lang-switch.js"></script>
</body>

</html>