<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Prevent Flash of Incorrect Theme (FOIT) -->
    <script>
    (function(){var t=localStorage.getItem('android-media-framework-theme');if(t)document.documentElement.setAttribute('data-theme',t);else if(window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches)document.documentElement.setAttribute('data-theme','light');})();
    </script>
    <title>Widevine DRM Architecture Detailed Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            ‚Üê AOSP Media Framework
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">üîí Widevine DRM</h1>
            <p class="page-subtitle">Google Widevine Digital Rights Management Architecture Detailed Visualization</p>
        </header>

        <!-- Section 1: Widevine Overview -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">1</span>
                Widevine DRM Overview
            </h2>
            <p class="section-description">
                Widevine is a digital rights management (DRM) system owned by Google,
                widely used to protect premium content in streaming services.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéØ</span>
                        Key Objectives
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Secure copyrighted video content</li>
                            <li>Prevent piracy and screen capture</li>
                            <li>Protect HD/4K content streaming</li>
                            <li>Cross-platform support (Web, Android, iOS, etc.)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üè¢</span>
                        Major Users
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Netflix</strong>: HD/4K streaming</li>
                            <li><strong>Amazon Prime Video</strong>: Premium content</li>
                            <li><strong>Disney+</strong>: HDR content</li>
                            <li><strong>YouTube</strong>: Paid content</li>
                            <li><strong>Spotify</strong>: Audio DRM</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîê</span>
                        Security Levels
                    </h3>
                    <div class="card-description">
                        <p>Widevine provides 3 security levels:</p>
                        <ul>
                            <li><span class="security-badge security-l1">L1</span> Highest security (Hardware TEE)</li>
                            <li><span class="security-badge security-l2">L2</span> Medium security (Partial TEE)</li>
                            <li><span class="security-badge security-l3">L3</span> Basic security (Software)</li>
                        </ul>
                        <p style="margin-top: 10px; font-size: 0.9em;">
                            Playback quality is limited based on the security level.
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Core Components
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>CDM</strong>: Content Decryption Module</li>
                            <li><strong>OEMCrypto</strong>: Hardware encryption module</li>
                            <li><strong>License Server</strong>: License issuance server</li>
                            <li><strong>EME</strong>: Encrypted Media Extensions (Web)</li>
                            <li><strong>MediaDrm</strong>: Android DRM API</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Security Levels -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">2</span>
                Security Levels (L1, L2, L3)
            </h2>
            <p class="section-description">
                Widevine security levels are distinguished by hardware-based security (TEE) usage,
                with different playable content quality for each level.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph L1["Security Level 1 (Highest Security)"]
                    L1_TEE["Trusted Execution Environment<br />(ARM TrustZone)"]
                    L1_CRYPT["Cryptographic Operations<br />(Inside TEE)"]
                    L1_DEC["Video Decoding<br />(Inside TEE)"]
                    L1_RENDER["Rendering<br />(Hardware Protected)"]
                    L1_OUT["Output: HD/4K/HDR"]
                    end

                    subgraph L2["Security Level 2 (Medium Security)"]
                    L2_TEE["Trusted Execution Environment"]
                    L2_CRYPT["Cryptographic Operations<br />(Inside TEE)"]
                    L2_DEC["Video Decoding<br />(Outside TEE)"]
                    L2_OUT["Output: ~540p"]
                    end

                    subgraph L3["Security Level 3 (Basic Security)"]
                    L3_SW["Software DRM<br />(No TEE)"]
                    L3_CRYPT["Cryptographic Operations<br />(User Space)"]
                    L3_DEC["Video Decoding<br />(Software)"]
                    L3_OUT["Output: SD (480p)"]
                    end

                    L1_TEE --> L1_CRYPT --> L1_DEC --> L1_RENDER --> L1_OUT
                    L2_TEE --> L2_CRYPT --> L2_DEC --> L2_OUT
                    L3_SW --> L3_CRYPT --> L3_DEC --> L3_OUT

                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üìä Security Level Detailed Comparison
            </h3>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>L1 (Highest)</th>
                        <th>L2 (Medium)</th>
                        <th>L3 (Basic)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Cryptographic Operations</strong></td>
                        <td>Inside TEE</td>
                        <td>Inside TEE</td>
                        <td>User Space (Software)</td>
                    </tr>
                    <tr>
                        <td><strong>Video Decoding</strong></td>
                        <td>Inside TEE</td>
                        <td>Outside TEE</td>
                        <td>User Space (Software)</td>
                    </tr>
                    <tr>
                        <td><strong>Rendering</strong></td>
                        <td>Hardware Protected</td>
                        <td>Software/Hardware</td>
                        <td>Software</td>
                    </tr>
                    <tr>
                        <td><strong>Max Quality</strong></td>
                        <td>4K UHD, HDR</td>
                        <td>~540p</td>
                        <td>SD (480p)</td>
                    </tr>
                    <tr>
                        <td><strong>Screen Capture Prevention</strong></td>
                        <td>Complete Block</td>
                        <td>Partial Block</td>
                        <td>Limited</td>
                    </tr>
                    <tr>
                        <td><strong>Hardware Requirements</strong></td>
                        <td>TEE Required (ARM TrustZone)</td>
                        <td>Partial TEE</td>
                        <td>None (All Devices)</td>
                    </tr>
                    <tr>
                        <td><strong>Security Vulnerability</strong></td>
                        <td>Very Low</td>
                        <td>Medium</td>
                        <td>Relatively High</td>
                    </tr>
                    <tr>
                        <td><strong>Primary Devices</strong></td>
                        <td>Flagship Smartphones, Certified Devices</td>
                        <td>Rare</td>
                        <td>Entry-level Devices, Rooted Devices</td>
                    </tr>
                    <tr>
                        <td><strong>Android Integration</strong></td>
                        <td>Stagefright + TrustZone</td>
                        <td>Partial Integration</td>
                        <td>Software DRM Only</td>
                    </tr>
                </tbody>
            </table>

            <div class="content-grid" style="margin-top: 40px;">
                <div class="card">
                    <h3 class="card-title">
                        üèÜ Level 1 (L1)
                        <span class="tag tag-tee">TEE</span>
                    </h3>
                    <div class="card-description">
                        <p><strong>Complete Hardware Protection</strong></p>
                        <ul>
                            <li>All processing occurs inside TEE</li>
                            <li>Decryption keys never exposed</li>
                            <li>Uses ARM TrustZone</li>
                            <li>Netflix, Disney+ 4K playback enabled</li>
                            <li>Google certification required</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        ‚ö†Ô∏è Level 2 (L2)
                    </h3>
                    <div class="card-description">
                        <p><strong>Partial Hardware Protection</strong></p>
                        <ul>
                            <li>Only encryption processed in TEE</li>
                            <li>Decoding outside TEE</li>
                            <li>Rarely used in market</li>
                            <li>Medium quality limit (540p)</li>
                            <li>Transitional solution</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        ‚õî Level 3 (L3)
                        <span class="tag tag-software">Software</span>
                    </h3>
                    <div class="card-description">
                        <p><strong>Software-Only Protection</strong></p>
                        <ul>
                            <li>Operates in software without TEE</li>
                            <li>Vulnerable to memory dump attacks</li>
                            <li>Compatible with all Android devices</li>
                            <li>SD quality limit (480p)</li>
                            <li>Rooted devices downgraded to L3</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Widevine Architecture -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Widevine Architecture
            </h2>
            <p class="section-description">
                The overall Widevine DRM architecture consists of CDM, OEMCrypto, and License Server.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph APP["Application Layer"]
                    PLAYER["Media Player<br />(ExoPlayer/HTML5)"]
                    end

                    subgraph DRM_API["DRM API Layer"]
                    EME["EME (Web)<br />Encrypted Media Extensions"]
                    MEDIADRM["MediaDrm (Android)<br />DRM Framework"]
                    end

                    subgraph CDM["Widevine CDM"]
                    CDM_CORE["CDM Core"]
                    CDM_SESSION["Session Manager"]
                    CDM_PARSER["PSSH Parser"]
                    end

                    subgraph CRYPTO["Crypto Layer"]
                    OEMCRYPTO["OEMCrypto Module"]
                    TEE["Trusted Execution Environment<br />(TrustZone)"]
                    KEYS["Key Storage<br />(Secure)"]
                    end

                    subgraph SERVER["License Server"]
                    LICENSE_SRV["Widevine License Server"]
                    AUTH["Authentication"]
                    KEY_GEN["Key Generation"]
                    end

                    subgraph MEDIA["Media Pipeline"]
                    DEMUX["Demuxer<br />(Encrypted Content)"]
                    DECRYPT["Decryptor"]
                    DECODER["Decoder"]
                    RENDER["Renderer"]
                    end

                    PLAYER --> EME & MEDIADRM
                    EME & MEDIADRM --> CDM_CORE
                    CDM_CORE --> CDM_SESSION & CDM_PARSER
                    CDM_SESSION -->|License Request| LICENSE_SRV
                    LICENSE_SRV --> AUTH --> KEY_GEN
                    KEY_GEN -->|Encrypted License| CDM_SESSION
                    CDM_SESSION --> OEMCRYPTO
                    OEMCRYPTO --> TEE
                    TEE --> KEYS

                    DEMUX --> DECRYPT
                    DECRYPT --> OEMCRYPTO
                    DECRYPT --> DECODER --> RENDER

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì¶</span>
                        CDM (Content Decryption Module)
                    </h3>
                    <div class="card-description">
                        <p>Widevine Core Component</p>
                        <ul>
                            <li>Generate license requests</li>
                            <li>PSSH (Protection System Specific Header) parsing</li>
                            <li>Session management (Temporary/Persistent)</li>
                            <li>Communicate with OEMCrypto for decryption</li>
                            <li>Operates within browser/app sandbox</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîê</span>
                        OEMCrypto Module
                    </h3>
                    <div class="card-description">
                        <p>Hardware Security Module</p>
                        <ul>
                            <li>Runs inside TEE (Trusted Execution Environment)</li>
                            <li>Decryption key management and storage</li>
                            <li>Decrypt encrypted content</li>
                            <li>Signature key verification</li>
                            <li>Provides hardware-based security (L1)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üåê</span>
                        EME (Web)
                    </h3>
                    <div class="card-description">
                        <p>Web Browser DRM API</p>
                        <ul>
                            <li>W3C Standard (<code>navigator.requestMediaKeySystemAccess()</code>)</li>
                            <li>Create MediaKeys object</li>
                            <li>MediaKeySession management</li>
                            <li>Support encrypted media playback</li>
                            <li>Chrome, Firefox, Safari supported</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì±</span>
                        MediaDrm (Android)
                    </h3>
                    <div class="card-description">
                        <p>Android DRM Framework</p>
                        <ul>
                            <li><code>android.media.MediaDrm</code> API</li>
                            <li>DRM plugin architecture</li>
                            <li>UUID-based DRM scheme identification</li>
                            <li>CryptoHal/DrmHal (AIDL)</li>
                            <li>ExoPlayer, MediaPlayer integration</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîë</span>
                        License Server
                    </h3>
                    <div class="card-description">
                        <p>Widevine License Issuance</p>
                        <ul>
                            <li>Client authentication</li>
                            <li>Content key generation and encryption</li>
                            <li>License policy application (expiration, playback count)</li>
                            <li>Device provisioning</li>
                            <li>Google or third-party license server</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üõ°Ô∏è</span>
                        TEE (TrustZone)
                    </h3>
                    <div class="card-description">
                        <p>Trusted Execution Environment</p>
                        <ul>
                            <li>ARM TrustZone technology</li>
                            <li>Isolated secure area</li>
                            <li>Protection from root attacks</li>
                            <li>Secure World / Normal World separation</li>
                            <li>Hardware-based key storage</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: License Acquisition Flow -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">4</span>
                License Acquisition Flow
            </h2>
            <p class="section-description">
                Visualizing the entire process of acquiring a Widevine license and playing content.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant APP as Media Player
                    participant EME as EME/MediaDrm API
                    participant CDM as Widevine CDM
                    participant LS as License Server
                    participant OEM as OEMCrypto
                    participant TEE as TrustZone (TEE)

                    APP->>EME: Detect encrypted media
                    EME->>EME: 'encrypted' event fired
                    APP->>EME: requestMediaKeySystemAccess()
                    EME-->>APP: Create MediaKeys object

                    APP->>CDM: createSession()
                    CDM->>CDM: Create Session
                    APP->>CDM: generateRequest(initData)
                    CDM->>CDM: Parse PSSH
                    CDM-->>APP: 'message' event<br />(License Request)

                    APP->>LS: XHR/Fetch<br />(License Request)
                    LS->>LS: Client authentication
                    LS->>LS: Generate content key
                    LS-->>APP: Encrypted License

                    APP->>CDM: update(license)
                    CDM->>OEM: Pass license
                    OEM->>TEE: Store key (Secure Storage)
                    TEE-->>OEM: Storage complete
                    OEM-->>CDM: Ready
                    CDM-->>APP: Playback ready

                    loop Content Playback
                    APP->>CDM: Encrypted chunk
                    CDM->>OEM: Decryption request
                    OEM->>TEE: Load key and decrypt
                    TEE-->>OEM: Decrypted data
                    OEM-->>CDM: Decrypted data
                    CDM-->>APP: Playback data
                    APP->>APP: Decode and render
                    end
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 30px; margin-bottom: 15px;">
                üìã Step-by-Step Details
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">1Ô∏è‚É£ Media Detection</h3>
                    <div class="card-description">
                        <ul>
                            <li>HTML5 <code>&lt;video&gt;</code> or app loads encrypted media</li>
                            <li><code>encrypted</code> event fired</li>
                            <li>PSSH info included in initData</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">2Ô∏è‚É£ Key System Selection</h3>
                    <div class="card-description">
                        <ul>
                            <li><code>navigator.requestMediaKeySystemAccess()</code></li>
                            <li>Select "com.widevine.alpha"</li>
                            <li>Create MediaKeys object</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">3Ô∏è‚É£ Session Creation</h3>
                    <div class="card-description">
                        <ul>
                            <li>Create MediaKeySession object</li>
                            <li>Session type: "temporary" or "persistent"</li>
                            <li>Call <code>generateRequest(initData)</code></li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">4Ô∏è‚É£ License Request</h3>
                    <div class="card-description">
                        <ul>
                            <li>CDM generates license request message</li>
                            <li>Passed to app via <code>message</code> event</li>
                            <li>App sends XHR to License Server</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">5Ô∏è‚É£ License Issuance</h3>
                    <div class="card-description">
                        <ul>
                            <li>License Server authenticates client</li>
                            <li>Generate and encrypt content key</li>
                            <li>Return encrypted license response</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">6Ô∏è‚É£ Key Provisioning</h3>
                    <div class="card-description">
                        <ul>
                            <li>Call <code>session.update(license)</code></li>
                            <li>CDM passes license to OEMCrypto</li>
                            <li>Store decryption key securely in TEE</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">7Ô∏è‚É£ Content Decryption</h3>
                    <div class="card-description">
                        <ul>
                            <li>Pass encrypted media chunks to CDM</li>
                            <li>OEMCrypto decrypts inside TEE</li>
                            <li>Return decrypted data to player</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">8Ô∏è‚É£ Playback</h3>
                    <div class="card-description">
                        <ul>
                            <li>Decoder processes decrypted data</li>
                            <li>Renderer outputs to screen</li>
                            <li>Maintain A/V synchronization</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Android Integration -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">5</span>
                Android Integration
            </h2>
            <p class="section-description">
                Shows how Widevine integrates with the Android Media Framework.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph APP_LAYER["Application Layer"]
                    EXOPLAYER["ExoPlayer / MediaPlayer"]
                    end

                    subgraph FRAMEWORK["Android Framework"]
                    MEDIADRM["MediaDrm API"]
                    MEDIACRYPTO["MediaCrypto"]
                    MEDIACODEC["MediaCodec"]
                    end

                    subgraph NATIVE["Native Layer"]
                    LIBMEDIADRM["libmediadrm"]
                    DRMHAL["DrmHal (AIDL)"]
                    CRYPTOHAL["CryptoHal (AIDL)"]
                    end

                    subgraph VENDOR["Vendor Layer"]
                    WIDEVINE_PLUGIN["Widevine Plugin"]
                    CDM_LIB["libwvdrmengine.so"]
                    OEMCRYPTO_LIB["liboemcrypto.so"]
                    end

                    subgraph SECURE["Secure World"]
                    TEE_OS["TEE OS (TrustZone)"]
                    TRUSTLET["Widevine Trustlet"]
                    KEY_STORE["Secure Key Storage"]
                    end

                    EXOPLAYER --> MEDIADRM
                    EXOPLAYER --> MEDIACRYPTO
                    MEDIACRYPTO --> MEDIACODEC
                    MEDIADRM --> LIBMEDIADRM
                    LIBMEDIADRM --> DRMHAL & CRYPTOHAL
                    DRMHAL --> WIDEVINE_PLUGIN
                    CRYPTOHAL --> WIDEVINE_PLUGIN
                    WIDEVINE_PLUGIN --> CDM_LIB
                    CDM_LIB --> OEMCRYPTO_LIB
                    OEMCRYPTO_LIB --> TEE_OS
                    TEE_OS --> TRUSTLET
                    TRUSTLET --> KEY_STORE

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì±</span>
                        Application Layer
                    </h3>
                    <div class="card-description">
                        <p>Media players used in apps</p>
                        <ul>
                            <li><strong>ExoPlayer</strong>: Google recommended, full DRM support</li>
                            <li><strong>MediaPlayer</strong>: System default player</li>
                            <li>License management via MediaDrm API</li>
                            <li>Decryption connection via MediaCrypto</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîß</span>
                        Framework Layer
                    </h3>
                    <div class="card-description">
                        <p>Android DRM Framework</p>
                        <ul>
                            <li><code>android.media.MediaDrm</code>: DRM session management</li>
                            <li><code>MediaCrypto</code>: Decryption session</li>
                            <li>Integration with <code>MediaCodec</code></li>
                            <li>DRM scheme identification via UUID</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Native Layer
                    </h3>
                    <div class="card-description">
                        <p>HAL Interface</p>
                        <ul>
                            <li><code>libmediadrm</code>: Native DRM library</li>
                            <li><strong>DrmHal</strong>: License management HAL (AIDL)</li>
                            <li><strong>CryptoHal</strong>: Decryption HAL (AIDL)</li>
                            <li>AIDL-based from Android 11+</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîå</span>
                        Vendor Layer
                    </h3>
                    <div class="card-description">
                        <p>Widevine Plugin</p>
                        <ul>
                            <li><code>libwvdrmengine.so</code>: Widevine CDM</li>
                            <li><code>liboemcrypto.so</code>: OEMCrypto implementation</li>
                            <li>Vendor customization available</li>
                            <li>Google certification required (L1)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üõ°Ô∏è</span>
                        Secure World
                    </h3>
                    <div class="card-description">
                        <p>TrustZone Secure Region</p>
                        <ul>
                            <li><strong>TEE OS</strong>: Trusted Execution Environment OS</li>
                            <li><strong>Widevine Trustlet</strong>: Widevine agent in TEE</li>
                            <li><strong>Secure Key Storage</strong>: Hardware key storage</li>
                            <li>Isolated from Normal World</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîç</span>
                        How to Check
                    </h3>
                    <div class="card-description">
                        <p>Check Widevine level on Android device</p>
                        <ul>
                            <li>Install <strong>DRM Info</strong> app (Play Store)</li>
                            <li>Use <code>MediaDrm.getPropertyString()</code> API</li>
                            <li>Check security level: L1/L2/L3</li>
                            <li>May be downgraded to L3 when rooted</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Security & Best Practices -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">6</span>
                Security & Best Practices
            </h2>
            <p class="section-description">
                Security considerations and best practices for using Widevine DRM safely and effectively.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚úÖ</span>
                        Security Enhancement
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Always recommend L1 level devices</li>
                            <li>License requests over HTTPS</li>
                            <li>Set license expiration time</li>
                            <li>Limit playback count</li>
                            <li>Manage device provisioning</li>
                            <li>Implement root detection</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üé¨</span>
                        Content Protection
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>HD/4K content L1 only</li>
                            <li>Apply HDCP (High-bandwidth Digital Content Protection)</li>
                            <li>Screen capture prevention (L1)</li>
                            <li>Consider adding watermarking</li>
                            <li>Embed copyright information</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö†Ô∏è</span>
                        Known Limitations
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Rooted devices downgraded to L3</li>
                            <li>Custom ROM results in L3</li>
                            <li>Bootloader unlock results in L3</li>
                            <li>Level may change after software update</li>
                            <li>L3 devices limited to SD quality</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîß</span>
                        Development Recommendations
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Recommend ExoPlayer (Android)</li>
                            <li>Support offline playback with persistent licenses</li>
                            <li>Implement license renewal logic</li>
                            <li>Error handling and fallback</li>
                            <li>Adjust quality by security level</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Performance Optimization
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Pre-fetch licenses</li>
                            <li>Session reuse</li>
                            <li>Utilize hardware decoder</li>
                            <li>Buffering optimization</li>
                            <li>ABR based on network status</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üêõ</span>
                        Debugging Tips
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Check security level with DRM Info app</li>
                            <li>Use Chrome DevTools EME logs</li>
                            <li>Check MediaDrm logs with Android Logcat</li>
                            <li><code>adb shell dumpsys media.drm</code></li>
                            <li>Verify license request/response</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7: Code Examples -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">7</span>
                Code Examples
            </h2>
            <p class="section-description">
                Android MediaDrm API, ExoPlayer DRM setup, and Web EME implementation examples.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 30px; margin-bottom: 15px;">
                7-1. Android MediaDrm API Usage
            </h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// Initialize Widevine MediaDrm
val WIDEVINE_UUID = UUID(-0x121074568629b532L, -0x5c37d8232ae2de13L)
// "edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"

val mediaDrm = MediaDrm(WIDEVINE_UUID)

// Check security level
val securityLevel = mediaDrm.getPropertyString(MediaDrm.PROPERTY_SECURITY_LEVEL)
Log.d(TAG, "Widevine Security Level: $securityLevel") // "L1", "L2", or "L3"

// Create session
val sessionId = mediaDrm.openSession()

// Generate license request
val initData = extractInitData(encryptedContent) // PSSH data
val keyRequest = mediaDrm.getKeyRequest(
    sessionId,
    initData,
    "video/mp4",
    MediaDrm.KEY_TYPE_STREAMING,
    null // Optional parameters
)

// Request to license server
val licenseUrl = "https://license.example.com/widevine"
val licenseResponse = sendLicenseRequest(licenseUrl, keyRequest.data)

// Provide license
mediaDrm.provideKeyResponse(sessionId, licenseResponse)

// Create MediaCrypto (integration with MediaCodec)
val mediaCrypto = MediaCrypto(WIDEVINE_UUID, sessionId)

// Configure MediaCodec
val mediaCodec = MediaCodec.createDecoderByType("video/avc")
mediaCodec.configure(format, surface, mediaCrypto, 0)

// Cleanup after playback
mediaDrm.closeSession(sessionId)
mediaDrm.release()
mediaCrypto.release()</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                7-2. ExoPlayer Widevine DRM Configuration
            </h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// ExoPlayer with Widevine DRM
val drmCallback = HttpMediaDrmCallback(
    "https://license.example.com/widevine",
    DefaultHttpDataSource.Factory()
)

// DRM session manager
val drmSessionManager = DefaultDrmSessionManager.Builder()
    .setUuidAndExoMediaDrmProvider(
        C.WIDEVINE_UUID,
        FrameworkMediaDrm.DEFAULT_PROVIDER
    )
    .setMultiSession(false)
    .build(drmCallback)

// Create MediaSource
val mediaItem = MediaItem.Builder()
    .setUri("https://example.com/encrypted_video.mpd")
    .setDrmConfiguration(
        MediaItem.DrmConfiguration.Builder(C.WIDEVINE_UUID)
            .setLicenseUri("https://license.example.com/widevine")
            .setMultiSession(false)
            .build()
    )
    .build()

val mediaSource = DashMediaSource.Factory(dataSourceFactory)
    .setDrmSessionManagerProvider { drmSessionManager }
    .createMediaSource(mediaItem)

// Configure ExoPlayer
val player = ExoPlayer.Builder(context)
    .build()
    .apply {
        setMediaSource(mediaSource)
        prepare()
        playWhenReady = true
    }

// DRM event listener
player.addListener(object : Player.Listener {
    override fun onPlayerError(error: PlaybackException) {
        if (error.cause is DrmSession.DrmSessionException) {
            Log.e(TAG, "DRM Error: ${error.message}")
            handleDrmError(error)
        }
    }
})</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                7-3. Web EME (Encrypted Media Extensions) Implementation
            </h3>
            <div class="code-block">
                <pre><code class="language-javascript">// Using Widevine on Web
const video = document.querySelector('video');

// Check Widevine Key System
const config = [{
    initDataTypes: ['cenc'],
    videoCapabilities: [{
        contentType: 'video/mp4; codecs="avc1.42E01E"',
        robustness: 'SW_SECURE_CRYPTO' // or 'HW_SECURE_ALL' for L1
    }],
    audioCapabilities: [{
        contentType: 'audio/mp4; codecs="mp4a.40.2"'
    }]
}];

navigator.requestMediaKeySystemAccess('com.widevine.alpha', config)
    .then(keySystemAccess => {
        return keySystemAccess.createMediaKeys();
    })
    .then(mediaKeys => {
        video.setMediaKeys(mediaKeys);
        const keySession = mediaKeys.createSession();

        // 'encrypted' event listener
        video.addEventListener('encrypted', event => {
            console.log('Encrypted event:', event.initDataType);

            keySession.generateRequest(event.initDataType, event.initData)
                .then(() => {
                    console.log('License request generated');
                })
                .catch(error => {
                    console.error('generateRequest failed:', error);
                });
        });

        // 'message' event: license request
        keySession.addEventListener('message', event => {
            console.log('License request:', event.messageType);

            fetch('https://license.example.com/widevine', {
                method: 'POST',
                headers: { 'Content-Type': 'application/octet-stream' },
                body: event.message
            })
            .then(response => response.arrayBuffer())
            .then(license => {
                return keySession.update(license);
            })
            .then(() => {
                console.log('License updated successfully');
            })
            .catch(error => {
                console.error('License update failed:', error);
            });
        });

        return keySession;
    })
    .catch(error => {
        console.error('MediaKeySystemAccess failed:', error);
    });

// Play video
video.src = 'https://example.com/encrypted_video.mp4';
video.play();</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                7-4. License Request/Response Handling
            </h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// License server communication
suspend fun sendLicenseRequest(url: String, requestData: ByteArray): ByteArray {
    return withContext(Dispatchers.IO) {
        val connection = URL(url).openConnection() as HttpURLConnection
        try {
            connection.apply {
                requestMethod = "POST"
                doOutput = true
                doInput = true
                setRequestProperty("Content-Type", "application/octet-stream")
                setRequestProperty("User-Agent", "Widevine CDM")
            }

            // Send request
            connection.outputStream.use { it.write(requestData) }

            // Receive response
            if (connection.responseCode == HttpURLConnection.HTTP_OK) {
                connection.inputStream.use { it.readBytes() }
            } else {
                throw IOException("License request failed: ${connection.responseCode}")
            }
        } finally {
            connection.disconnect()
        }
    }
}

// Extract PSSH data
fun extractInitData(mp4Data: ByteArray): ByteArray? {
    // Find 'pssh' box in MP4
    var offset = 0
    while (offset < mp4Data.size - 8) {
        val boxSize = ByteBuffer.wrap(mp4Data, offset, 4).int
        val boxType = String(mp4Data, offset + 4, 4)

        if (boxType == "pssh") {
            return mp4Data.copyOfRange(offset, offset + boxSize)
        }

        offset += boxSize
    }
    return null
}</code></pre>
            </div>
        </section>

        <!-- Section 8: DRM HAL (AIDL) Implementation -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">8</span>
                DRM HAL (AIDL) Implementation
            </h2>
            <p class="section-description">
                AIDL-based DRM/Crypto HAL interface used in Android 11+.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 30px; margin-bottom: 15px;">
                8-1. IDrmPlugin.aidl Interface
            </h3>
            <div class="code-block">
                <pre><code class="language-java">// hardware/interfaces/drm/aidl/android/hardware/drm/IDrmPlugin.aidl
package android.hardware.drm;

interface IDrmPlugin {
    // Session management
    byte[] openSession(in SecurityLevel securityLevel);
    void closeSession(in byte[] sessionId);

    // Key request/response
    KeyRequest getKeyRequest(
        in byte[] scope,
        in byte[] initData,
        in String mimeType,
        in KeyType keyType,
        in KeyValue[] optionalParameters
    );

    byte[] provideKeyResponse(
        in byte[] scope,
        in byte[] response
    );

    // Provisioning
    ProvisionRequest getProvisionRequest(
        in String certificateType,
        in String certificateAuthority
    );

    void provideProvisionResponse(in byte[] response);

    // Property management
    String getPropertyString(in String propertyName);
    byte[] getPropertyByteArray(in String propertyName);
    void setPropertyString(in String propertyName, in String value);
    void setPropertyByteArray(in String propertyName, in byte[] value);

    // Decryption
    void setCipherAlgorithm(in byte[] sessionId, in String algorithm);
    void setMacAlgorithm(in byte[] sessionId, in String algorithm);

    // Offline license
    byte[] getOfflineLicenseKeySetIds();
    void removeOfflineLicense(in byte[] keySetId);
    OfflineLicenseState getOfflineLicenseState(in byte[] keySetId);

    // Security info
    SecurityLevel getSecurityLevel(in byte[] sessionId);
    byte[] getMetrics();
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                8-2. ICryptoPlugin.aidl Interface
            </h3>
            <div class="code-block">
                <pre><code class="language-java">// hardware/interfaces/drm/aidl/android/hardware/drm/ICryptoPlugin.aidl
package android.hardware.drm;

interface ICryptoPlugin {
    // Decryption
    int decrypt(
        in boolean secure,
        in byte[] keyId,
        in byte[] iv,
        in Mode mode,
        in Pattern pattern,
        in SharedBuffer source,
        in long offset,
        in SubSample[] subSamples,
        in DestinationBuffer destination
    );

    // Memory configuration
    void setMediaDrmSession(in byte[] sessionId);
    void setSharedBufferBase(in SharedBuffer base);

    // Check security level
    SecurityLevel getSecurityLevel();

    // Log messages
    void notifyResolution(in int width, in int height);
    void requiresSecureDecoderComponent(in String mime);
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                8-3. Widevine HAL Implementation Structure (C++)
            </h3>
            <div class="code-block">
                <pre><code class="language-cpp">// Widevine HAL implementation example (vendor/widevine/)
namespace aidl::android::hardware::drm {

class WidevineDrmPlugin : public BnDrmPlugin {
public:
    // Session management
    ndk::ScopedAStatus openSession(
        SecurityLevel securityLevel,
        std::vector&lt;uint8_t&gt;* sessionId
    ) override {
        // Call OEMCrypto_OpenSession
        OEMCryptoResult result = OEMCrypto_OpenSession(sessionId->data());
        if (result != OEMCrypto_SUCCESS) {
            return ndk::ScopedAStatus::fromServiceSpecificError(
                static_cast&lt;int32_t&gt;(Status::ERROR_DRM_SESSION_NOT_OPENED)
            );
        }
        return ndk::ScopedAStatus::ok();
    }

    // Generate key request
    ndk::ScopedAStatus getKeyRequest(
        const std::vector&lt;uint8_t&gt;& scope,
        const std::vector&lt;uint8_t&gt;& initData,
        const std::string& mimeType,
        KeyType keyType,
        const std::vector&lt;KeyValue&gt;& optionalParameters,
        KeyRequest* keyRequest
    ) override {
        // Parse PSSH
        wv::InitDataParser parser;
        if (!parser.parse(initData)) {
            return ndk::ScopedAStatus::fromServiceSpecificError(
                static_cast&lt;int32_t&gt;(Status::ERROR_DRM_CANNOT_HANDLE)
            );
        }

        // Generate license request to CDM
        cdm::LicenseRequest request;
        request.set_content_id(parser.getContentId());
        request.set_session_id(scope.data(), scope.size());

        keyRequest->request = request.SerializeAsString();
        keyRequest->requestType = KeyRequestType::INITIAL;
        keyRequest->defaultUrl = "https://license.widevine.com/cenc/getlicense";

        return ndk::ScopedAStatus::ok();
    }

    // Provide key response
    ndk::ScopedAStatus provideKeyResponse(
        const std::vector&lt;uint8_t&gt;& scope,
        const std::vector&lt;uint8_t&gt;& response,
        std::vector&lt;uint8_t&gt;* keySetId
    ) override {
        // Parse license
        cdm::License license;
        if (!license.ParseFromArray(response.data(), response.size())) {
            return ndk::ScopedAStatus::fromServiceSpecificError(
                static_cast&lt;int32_t&gt;(Status::ERROR_DRM_CANNOT_HANDLE)
            );
        }

        // Load keys via OEMCrypto
        for (const auto& key : license.key()) {
            OEMCrypto_LoadKeys(
                scope.data(),
                key.id().data(), key.id().size(),
                key.key_data().data(), key.key_data().size()
            );
        }

        *keySetId = license.key_set_id();
        return ndk::ScopedAStatus::ok();
    }

private:
    wv::CdmEngine cdm_engine_;
};</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                8-4. Binder Communication Mechanism
            </h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant App as MediaDrm (Java)
                    participant JNI as libmediadrm (JNI)
                    participant Binder as Binder IPC
                    participant HAL as DrmPlugin (AIDL)
                    participant OEM as OEMCrypto

                    App->>JNI: openSession()
                    JNI->>Binder: AIDL Call
                    Binder->>HAL: openSession()
                    HAL->>OEM: OEMCrypto_OpenSession()
                    OEM-->>HAL: sessionId
                    HAL-->>Binder: sessionId
                    Binder-->>JNI: sessionId
                    JNI-->>App: sessionId

                    App->>JNI: getKeyRequest()
                    JNI->>Binder: AIDL Call
                    Binder->>HAL: getKeyRequest()
                    HAL->>HAL: Generate Request
                    HAL-->>Binder: KeyRequest
                    Binder-->>JNI: KeyRequest
                    JNI-->>App: KeyRequest
                </div>
            </div>

            <div class="content-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîß</span>
                        HIDL vs AIDL
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>HIDL (Android 8-10)</strong>: Legacy HAL, hwservicemanager</li>
                            <li><strong>AIDL (Android 11+)</strong>: Modern interface, servicemanager</li>
                            <li>AIDL is more concise and easier to maintain</li>
                            <li>HIDL is Deprecated, AIDL migration recommended</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 9: OEMCrypto API Details -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">9</span>
                OEMCrypto API Details
            </h2>
            <p class="section-description">
                Widevine OEMCrypto is the API for the hardware security module running inside the TEE.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 30px; margin-bottom: 15px;">
                9-1. Core OEMCrypto Functions
            </h3>
            <div class="code-block">
                <pre><code class="language-cpp">// OEMCrypto API (vendor/widevine/libwvdrmengine/oemcrypto/include/OEMCryptoCENC.h)

// Initialization
OEMCryptoResult OEMCrypto_Initialize(void);
OEMCryptoResult OEMCrypto_Terminate(void);

// Session management
OEMCryptoResult OEMCrypto_OpenSession(OEMCrypto_SESSION* session);
OEMCryptoResult OEMCrypto_CloseSession(OEMCrypto_SESSION session);

// Key loading
OEMCryptoResult OEMCrypto_LoadKeys(
    OEMCrypto_SESSION session,
    const uint8_t* message,
    size_t message_length,
    const uint8_t* signature,
    size_t signature_length,
    const uint8_t* enc_mac_key_iv,
    const uint8_t* enc_mac_key,
    size_t num_keys,
    const OEMCrypto_KeyObject* key_array
);

// Decryption
OEMCryptoResult OEMCrypto_DecryptCENC(
    OEMCrypto_SESSION session,
    const uint8_t* data_addr,
    size_t data_length,
    bool is_encrypted,
    const uint8_t* iv,
    size_t block_offset,
    const OEMCrypto_DestBufferDesc* out_buffer,
    OEMCrypto_DestBufferType out_buffer_type,
    const OEMCrypto_CENCEncryptPatternDesc* pattern
);

// Key renewal
OEMCryptoResult OEMCrypto_RefreshKeys(
    OEMCrypto_SESSION session,
    const uint8_t* message,
    size_t message_length,
    const uint8_t* signature,
    size_t signature_length,
    size_t num_keys,
    const OEMCrypto_KeyRefreshObject* key_array
);

// Usage Table (Usage Tracking)
OEMCryptoResult OEMCrypto_UpdateUsageTable(
    OEMCrypto_SESSION session
);

OEMCryptoResult OEMCrypto_DeactivateUsageEntry(
    const uint8_t* pst,
    size_t pst_length
);

// Provisioning
OEMCryptoResult OEMCrypto_GetDeviceID(
    uint8_t* device_id,
    size_t* id_length
);

OEMCryptoResult OEMCrypto_GetKeyData(
    uint8_t* key_data,
    size_t* key_data_length
);

// HDCP
OEMCryptoResult OEMCrypto_GetHDCPCapability(
    OEMCrypto_HDCP_Capability* current,
    OEMCrypto_HDCP_Capability* maximum
);</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                9-2. TEE Communication Protocol
            </h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant CDM as Widevine CDM<br/>(Normal World)
                    participant OEM as OEMCrypto<br/>(REE)
                    participant TEE_OS as TEE OS<br/>(TrustZone)
                    participant Trust as Widevine Trustlet<br/>(Secure World)

                    CDM->>OEM: OEMCrypto_LoadKeys()
                    OEM->>TEE_OS: SMC (Secure Monitor Call)
                    TEE_OS->>Trust: Invoke Trustlet
                    Trust->>Trust: Decrypt & Verify Keys
                    Trust->>Trust: Store in Secure RAM
                    Trust-->>TEE_OS: Success
                    TEE_OS-->>OEM: Return to REE
                    OEM-->>CDM: OEMCrypto_SUCCESS

                    CDM->>OEM: OEMCrypto_DecryptCENC()
                    OEM->>TEE_OS: SMC with encrypted data
                    TEE_OS->>Trust: Decrypt Request
                    Trust->>Trust: Load Key from Secure RAM
                    Trust->>Trust: AES-CTR Decrypt
                    Trust-->>TEE_OS: Decrypted Data
                    TEE_OS-->>OEM: Decrypted Buffer
                    OEM-->>CDM: Decrypted Data
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                9-3. Keybox Provisioning
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîë</span>
                        What is Keybox?
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Device-unique encryption key set</li>
                            <li>Securely injected during manufacturing</li>
                            <li>Contains Device ID, Encryption Key</li>
                            <li>Stored in TEE Secure Storage</li>
                            <li>Google certification required (L1)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üè≠</span>
                        Provisioning Process
                    </h3>
                    <div class="card-description">
                        <ol>
                            <li>Manufacturer requests Keybox from Google</li>
                            <li>Google generates encrypted Keybox</li>
                            <li>Inject into TEE on manufacturing line</li>
                            <li>Verify with OEMCrypto_GetDeviceID()</li>
                            <li>License server authenticates Device ID</li>
                        </ol>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                9-4. Usage Table Management
            </h3>
            <div class="code-block">
                <pre><code class="language-cpp">// Usage Table: Offline license usage tracking
struct OEMCrypto_UsageEntry {
    uint8_t pst[32];              // Provider Session Token
    uint64_t time_of_first_use;   // First use time
    uint64_t time_of_last_use;    // Last use time
    uint32_t usage_count;         // Usage count
    OEMCrypto_UsageEntryStatus status;
};

// Update Usage Table
OEMCryptoResult OEMCrypto_UpdateUsageTable(OEMCrypto_SESSION session) {
    // Record current session usage info to Usage Table
    // Persist to TEE Secure Storage
    // Block playback on license policy violation
    return OEMCrypto_SUCCESS;
}

// Deactivate
OEMCryptoResult OEMCrypto_DeactivateUsageEntry(
    const uint8_t* pst,
    size_t pst_length
) {
    // Delete Usage Entry for specific PST
    // Used when releasing offline license
    return OEMCrypto_SUCCESS;
}</code></pre>
            </div>

            <table class="comparison-table" style="margin-top: 30px;">
                <thead>
                    <tr>
                        <th>OEMCrypto Function</th>
                        <th>Execution Location</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>OEMCrypto_Initialize</td>
                        <td>REE ‚Üí TEE</td>
                        <td>Initialize OEMCrypto library</td>
                    </tr>
                    <tr>
                        <td>OEMCrypto_OpenSession</td>
                        <td>TEE</td>
                        <td>Create encryption session</td>
                    </tr>
                    <tr>
                        <td>OEMCrypto_LoadKeys</td>
                        <td>TEE (Trustlet)</td>
                        <td>Extract and store content keys from license</td>
                    </tr>
                    <tr>
                        <td>OEMCrypto_DecryptCENC</td>
                        <td>TEE (Trustlet)</td>
                        <td>Decrypt encrypted media data</td>
                    </tr>
                    <tr>
                        <td>OEMCrypto_GetDeviceID</td>
                        <td>TEE (Keybox)</td>
                        <td>Query device unique ID</td>
                    </tr>
                    <tr>
                        <td>OEMCrypto_UpdateUsageTable</td>
                        <td>TEE (Secure Storage)</td>
                        <td>Track offline license usage</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Section 10: Widevine Certification Process -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">10</span>
                Widevine Certification Process
            </h2>
            <p class="section-description">
                Google certification process for obtaining Widevine L1 security level certification.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 30px; margin-bottom: 15px;">
                10-1. Certification Steps
            </h3>
            <div class="mermaid-container">
                <div class="mermaid">
                    graph LR
                    A[1. Preparation] --> B[2. CWTS Registration]
                    B --> C[3. Implementation]
                    C --> D[4. Self-Test]
                    D --> E[5. Google Submission]
                    E --> F[6. Robustness Test]
                    F --> G[7. Certification Approval]
                    G --> H[8. Keybox Issuance]
                    H --> I[9. Production Deployment]

                    style A fill:#e3f2fd
                    style G fill:#c8e6c9
                    style I fill:#fff9c4
                </div>
            </div>

            <div class="content-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3 class="card-title">1Ô∏è‚É£ Preparation</h3>
                    <div class="card-description">
                        <ul>
                            <li>Set up TEE environment (TrustZone, OP-TEE, etc.)</li>
                            <li>Integrate OEMCrypto library</li>
                            <li>Implement DRM HAL</li>
                            <li>Widevine CDM license agreement</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">2Ô∏è‚É£ CWTS Registration</h3>
                    <div class="card-description">
                        <ul>
                            <li>Request Chrome Web Test Suite access</li>
                            <li>Google partner portal account required</li>
                            <li>Submit manufacturer information</li>
                            <li>Sign NDA</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">3Ô∏è‚É£ Implementation Development</h3>
                    <div class="card-description">
                        <ul>
                            <li>Full OEMCrypto API implementation</li>
                            <li>Trustlet development (inside TEE)</li>
                            <li>Secure Video Path implementation</li>
                            <li>HDCP support</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">4Ô∏è‚É£ Self-Test</h3>
                    <div class="card-description">
                        <ul>
                            <li>Run OEMCrypto Test Vectors</li>
                            <li>CWTS automated testing</li>
                            <li>Memory dump attack verification</li>
                            <li>Screen capture prevention check</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">5Ô∏è‚É£ Google Submission</h3>
                    <div class="card-description">
                        <ul>
                            <li>Write test results report</li>
                            <li>Submit implementation architecture document</li>
                            <li>Security analysis report</li>
                            <li>Ship sample device (optional)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">6Ô∏è‚É£ Robustness Test</h3>
                    <div class="card-description">
                        <ul>
                            <li>Penetration testing by Google security team</li>
                            <li>TEE isolation verification</li>
                            <li>Key extraction attempts (must fail)</li>
                            <li>Secure Video Path integrity</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">7Ô∏è‚É£ Certification Approval</h3>
                    <div class="card-description">
                        <ul>
                            <li>Approved when all tests pass</li>
                            <li>Widevine L1 certificate issued</li>
                            <li>Validity period: typically 2 years</li>
                            <li>Renewal required</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">8Ô∏è‚É£ Keybox Issuance</h3>
                    <div class="card-description">
                        <ul>
                            <li>Request production Keybox</li>
                            <li>Google provides encrypted</li>
                            <li>Inject on manufacturing line</li>
                            <li>Unique key per device</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">9Ô∏è‚É£ Production Deployment</h3>
                    <div class="card-description">
                        <ul>
                            <li>Ship product with Widevine L1</li>
                            <li>Regular security updates</li>
                            <li>Certification maintenance</li>
                            <li>Play Protect certification integration</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                10-2. Robustness Rules (Security Requirements)
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Rule</th>
                        <th>Requirement</th>
                        <th>Verification Method</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>R1: Key Isolation</td>
                        <td>Content keys never exposed outside TEE</td>
                        <td>Memory dump, debugger attach attempts</td>
                    </tr>
                    <tr>
                        <td>R2: Decryption Location</td>
                        <td>Decryption must occur inside TEE</td>
                        <td>Decryption process tracing, Timing Attack</td>
                    </tr>
                    <tr>
                        <td>R3: Secure Video Path</td>
                        <td>Decrypted frames only travel through protected path</td>
                        <td>Screen capture attempts, HDMI sniffing</td>
                    </tr>
                    <tr>
                        <td>R4: HDCP Enforcement</td>
                        <td>External displays require HDCP 2.2+</td>
                        <td>Connect monitor without HDCP</td>
                    </tr>
                    <tr>
                        <td>R5: Root Detection</td>
                        <td>Rooted devices downgraded to L3 or playback blocked</td>
                        <td>Test on rooted device</td>
                    </tr>
                    <tr>
                        <td>R6: Rollback Prevention</td>
                        <td>Cannot downgrade to older software version</td>
                        <td>Firmware rollback attempt</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                10-3. Certification Checklist
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚úÖ</span>
                        Technical Requirements
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>‚òëÔ∏è ARM TrustZone or equivalent TEE</li>
                            <li>‚òëÔ∏è OEMCrypto 16+ API level</li>
                            <li>‚òëÔ∏è Secure Boot Chain</li>
                            <li>‚òëÔ∏è Hardware Root of Trust</li>
                            <li>‚òëÔ∏è HDCP 2.2+ support</li>
                            <li>‚òëÔ∏è Secure Video Path</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üß™</span>
                        Required Test Passes
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>‚òëÔ∏è CWTS automated tests 100% pass</li>
                            <li>‚òëÔ∏è OEMCrypto Test Vectors all pass</li>
                            <li>‚òëÔ∏è CTS MediaDrmTest pass</li>
                            <li>‚òëÔ∏è Widevine Robustness Test pass</li>
                            <li>‚òëÔ∏è Penetration Test</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 11: CTS/GTS DRM Tests -->
        <section class="description-section">
            <h2 style="color: var(--accent-primary); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); padding-bottom: 10px;">
                11. CTS/GTS DRM Tests
            </h2>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                11-1. CTS MediaDrmTest
            </h3>
            <p style="line-height: 1.8; color: var(--text-secondary); margin-bottom: 20px;">
                CTS (Compatibility Test Suite) verifies Android compatibility and includes Widevine DRM tests.
            </p>

            <div class="mermaid-container">
                <pre class="mermaid">
graph LR
    A[CTS Test Runner] --> B[MediaDrmTest]
    A --> C[CryptoTest]
    A --> D[MediaCodecTest]

    B --> B1[testOpenSession]
    B --> B2[testGetKeyRequest]
    B --> B3[testProvideKeyResponse]
    B --> B4[testQueryKeyStatus]

    C --> C1[testDecrypt]
    C --> C2[testSetMediaDrmSession]

    D --> D1[testSecureDecoder]
    D --> D2[testClearKeyPlayback]

    style A fill:#1a1f35,stroke:#3b82f6,stroke-width:2px
    style B fill:#1a1f35,stroke:#10b981,stroke-width:2px
    style C fill:#1a1f35,stroke:#10b981,stroke-width:2px
    style D fill:#1a1f35,stroke:#10b981,stroke-width:2px
                </pre>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Test Class</th>
                        <th>Key Test Cases</th>
                        <th>Verification Content</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>MediaDrmTest</td>
                        <td>testOpenCloseSession</td>
                        <td>Session create/close normal operation</td>
                    </tr>
                    <tr>
                        <td>MediaDrmTest</td>
                        <td>testGetKeyRequest</td>
                        <td>License request generation format</td>
                    </tr>
                    <tr>
                        <td>MediaDrmTest</td>
                        <td>testProvideKeyResponse</td>
                        <td>License response handling</td>
                    </tr>
                    <tr>
                        <td>MediaDrmTest</td>
                        <td>testQueryKeyStatus</td>
                        <td>Key status query (validity period, etc.)</td>
                    </tr>
                    <tr>
                        <td>CryptoTest</td>
                        <td>testDecryptClearVideo</td>
                        <td>Clear content decryption (should pass)</td>
                    </tr>
                    <tr>
                        <td>CryptoTest</td>
                        <td>testDecryptEncryptedVideo</td>
                        <td>Encrypted content decryption</td>
                    </tr>
                    <tr>
                        <td>MediaCodecTest</td>
                        <td>testSecureDecoderPlayback</td>
                        <td>Secure decoder playback (L1)</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                11-2. Widevine-Specific Tests
            </h3>
            <div class="code-block">
                <pre><code class="language-bash"># Run Widevine CTS tests
adb shell am instrument -w -e class \
  com.android.cts.media.MediaDrmTest#testWidevineL1Provisioning \
  android.media.cts/androidx.test.runner.AndroidJUnitRunner

# Check L1 certification
adb shell getprop drm.service.enabled
# Output: true

adb shell getprop ro.vendor.widevine.level
# Output: 1 (L1), 2 (L2), 3 (L3)</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                11-3. GTS DRM Tests
            </h3>
            <p style="line-height: 1.8; color: var(--text-secondary); margin-bottom: 20px;">
                GTS (Google Mobile Services Test Suite) verifies Google services compatibility.
            </p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Test Category</th>
                        <th>Required Pass Items</th>
                        <th>Impact on Failure</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>GtsMediaTestCases</td>
                        <td>Widevine L1 Provisioning</td>
                        <td>Netflix/YouTube Premium playback unavailable</td>
                    </tr>
                    <tr>
                        <td>GtsWidevineDrmTestCases</td>
                        <td>HDCP 2.2+ Enforcement</td>
                        <td>External display 4K playback unavailable</td>
                    </tr>
                    <tr>
                        <td>GtsSecurityTestCases</td>
                        <td>Root Detection and L3 Downgrade</td>
                        <td>Premium content playback blocked</td>
                    </tr>
                    <tr>
                        <td>GtsPlayReadyTestCases</td>
                        <td>PlayReady + Widevine Coexistence</td>
                        <td>Some streaming service compatibility issues</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                11-4. Test Failure Analysis
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ùå</span>
                        testSecureDecoderPlayback Failure
                    </h3>
                    <div class="card-description">
                        <strong>Symptom:</strong> Black screen when playing L1 content<br>
                        <strong>Cause:</strong> Secure Video Path not implemented<br>
                        <strong>Solution:</strong> Add GRALLOC_USAGE_PROTECTED support to Gralloc HAL
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ùå</span>
                        testProvideKeyResponse Failure
                    </h3>
                    <div class="card-description">
                        <strong>Symptom:</strong> ERROR_LICENSE_PARSE when loading license<br>
                        <strong>Cause:</strong> OEMCrypto_LoadKeys signature verification failed<br>
                        <strong>Solution:</strong> Re-run Keybox provisioning
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 12: Persistent License (Offline Playback) -->
        <section class="description-section">
            <h2 style="color: var(--accent-primary); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); padding-bottom: 10px;">
                12. Persistent License (Offline Playback)
            </h2>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                12-1. Persistent Session Creation
            </h3>
            <p style="line-height: 1.8; color: var(--text-secondary); margin-bottom: 20px;">
                A method of storing licenses on the device for offline playback.
            </p>

            <div class="code-block">
                <pre><code class="language-kotlin">// Download Persistent License
val mediaDrm = MediaDrm(WIDEVINE_UUID)

// Create Offline session
val sessionId = mediaDrm.openSession(MediaDrm.SESSION_TYPE_OFFLINE)

// Offline key request
val request = mediaDrm.getKeyRequest(
    sessionId,
    initData,
    "video/mp4",
    MediaDrm.KEY_TYPE_OFFLINE,  // ‚Üê Offline type
    null
)

// Request to license server
val response = httpClient.post(licenseUrl, request.data)

// Save license
val keySetId = mediaDrm.provideKeyResponse(sessionId, response)

// Save keySetId to DB (for later reuse)
offlineDatabase.saveLicenseId(videoId, keySetId)</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                12-2. Load Offline License
            </h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// Play with saved license
val keySetId = offlineDatabase.getLicenseId(videoId)

val mediaDrm = MediaDrm(WIDEVINE_UUID)
val sessionId = mediaDrm.openSession()

// Restore saved keys
mediaDrm.restoreKeys(sessionId, keySetId)

// Connect session to MediaCodec
mediaCrypto = MediaCrypto(WIDEVINE_UUID, sessionId)
mediaCodec.configure(format, surface, mediaCrypto, 0)

// Start offline playback
mediaCodec.start()</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                12-3. License Renewal
            </h3>
            <div class="mermaid-container">
                <pre class="mermaid">
sequenceDiagram
    participant App
    participant MediaDrm
    participant Server
    participant OEMCrypto

    Note over App,OEMCrypto: License expiration approaching (24 hours before)

    App->>MediaDrm: getKeyRequest(sessionId, KEY_TYPE_RENEWAL)
    MediaDrm->>OEMCrypto: GenerateRenewalRequest()
    OEMCrypto-->>MediaDrm: Renewal Request
    MediaDrm-->>App: KeyRequest

    App->>Server: POST /renewal (Request)
    Server-->>App: Updated License

    App->>MediaDrm: provideKeyResponse(sessionId, response)
    MediaDrm->>OEMCrypto: LoadKeys(updated keys)
    OEMCrypto->>OEMCrypto: Update Usage Table
    OEMCrypto-->>MediaDrm: SUCCESS
    MediaDrm-->>App: keySetId (renewed)

    Note over App,OEMCrypto: License validity extended
                </pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                12-4. Storage Management
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>API</th>
                        <th>Description</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>queryKeyStatus(sessionId)</td>
                        <td>Query license expiration time, remaining plays</td>
                        <td>Determine renewal timing</td>
                    </tr>
                    <tr>
                        <td>getOfflineLicenseKeySetIds()</td>
                        <td>List all stored offline licenses</td>
                        <td>Clean up expired licenses</td>
                    </tr>
                    <tr>
                        <td>removeOfflineLicense(keySetId)</td>
                        <td>Delete offline license</td>
                        <td>Free storage, remove expired licenses</td>
                    </tr>
                    <tr>
                        <td>getOfflineLicenseState(keySetId)</td>
                        <td>UNKNOWN / USABLE / INACTIVE</td>
                        <td>Check license validity</td>
                    </tr>
                </tbody>
            </table>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üíæ</span>
                        Storage Location
                    </h3>
                    <div class="card-description">
                        <strong>Path:</strong> /data/vendor/mediadrm/[UUID]/<br>
                        <strong>File:</strong> persistent_license_*.bin<br>
                        <strong>Encryption:</strong> Auto-encrypted by OEMCrypto<br>
                        <strong>Permission:</strong> Only system UID can access
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö†Ô∏è</span>
                        Cautions
                    </h3>
                    <div class="card-description">
                        <strong>Device Change:</strong> Licenses cannot be transferred to another device<br>
                        <strong>Factory Reset:</strong> All licenses deleted<br>
                        <strong>Max Count:</strong> Usually 100 per device limit<br>
                        <strong>Storage:</strong> About 1~10KB per license
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 13: HDCP (Content Protection) -->
        <section class="description-section">
            <h2 style="color: var(--accent-primary); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); padding-bottom: 10px;">
                13. HDCP (Content Protection)
            </h2>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                13-1. HDCP Overview
            </h3>
            <p style="line-height: 1.8; color: var(--text-secondary); margin-bottom: 20px;">
                HDCP (High-bandwidth Digital Content Protection) is an encryption protocol designed to prevent illegal copying of digital video signals.
            </p>

            <div class="mermaid-container">
                <pre class="mermaid">
graph LR
    A[MediaCodec<br/>Secure Decoder] --> B[Display HAL]
    B --> C{HDCP Verification}
    C -->|HDCP 2.2+| D[External Display<br/>4K HDR Playback]
    C -->|HDCP 1.x| E[External Display<br/>1080p Limited]
    C -->|No HDCP| F[Playback Blocked<br/>ERROR_HDCP_FAILURE]

    style A fill:#1a1f35,stroke:#3b82f6,stroke-width:2px
    style C fill:#1a1f35,stroke:#f59e0b,stroke-width:2px
    style D fill:#1a1f35,stroke:#10b981,stroke-width:2px
    style E fill:#1a1f35,stroke:#f59e0b,stroke-width:2px
    style F fill:#1a1f35,stroke:#ef4444,stroke-width:2px
                </pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                13-2. HDCP Version Comparison
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>HDCP Version</th>
                        <th>Max Resolution</th>
                        <th>Interface</th>
                        <th>Widevine Requirements</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>HDCP 1.4</td>
                        <td>1080p (Full HD)</td>
                        <td>HDMI 1.4, DVI</td>
                        <td>L3 content playback only</td>
                    </tr>
                    <tr>
                        <td>HDCP 2.0</td>
                        <td>4K (3840x2160)</td>
                        <td>HDMI 2.0</td>
                        <td>L1 content limited playback</td>
                    </tr>
                    <tr>
                        <td>HDCP 2.2</td>
                        <td>4K HDR, 8K</td>
                        <td>HDMI 2.0+, DisplayPort 1.3+</td>
                        <td>L1 premium content playback (required)</td>
                    </tr>
                    <tr>
                        <td>HDCP 2.3</td>
                        <td>8K, 10K</td>
                        <td>HDMI 2.1, DP 2.0</td>
                        <td>Future 4K+ content ready</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                13-3. Android DisplayManager HDCP Configuration
            </h3>
            <div class="code-block">
                <pre><code class="language-kotlin">// Check HDCP level
val displayManager = getSystemService(Context.DISPLAY_SERVICE) as DisplayManager
val display = displayManager.getDisplay(Display.DEFAULT_DISPLAY)

val hdcpLevel = display.getHdrCapabilities()?.let {
    // Check HDCP 2.2+ support
    when {
        it.supportedHdrTypes.contains(Display.HdrCapabilities.HDR_TYPE_DOLBY_VISION) -> "HDCP 2.2+"
        it.supportedHdrTypes.contains(Display.HdrCapabilities.HDR_TYPE_HDR10) -> "HDCP 2.2+"
        else -> "HDCP 1.x or unsupported"
    }
}

// Detect external display connection
displayManager.registerDisplayListener(object : DisplayManager.DisplayListener {
    override fun onDisplayAdded(displayId: Int) {
        val externalDisplay = displayManager.getDisplay(displayId)

        // HDCP verification
        if (!isHdcpCompliant(externalDisplay)) {
            // Stop playback or downgrade resolution
            player.stop()
            showError("Display does not support HDCP 2.2.")
        }
    }

    override fun onDisplayRemoved(displayId: Int) { }
    override fun onDisplayChanged(displayId: Int) { }
}, null)</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                13-4. Miracast/Casting Limitations
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì±</span>
                        Miracast (Wi-Fi Display)
                    </h3>
                    <div class="card-description">
                        <strong>Issue:</strong> Miracast cannot pass HDCP authentication<br>
                        <strong>Result:</strong> L1 content playback blocked<br>
                        <strong>Solution:</strong> Use HDCP-certified devices like Chromecast<br>
                        <strong>Verification:</strong> MediaDrm.EVENT_SESSION_RECLAIMED triggered
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üñ•Ô∏è</span>
                        Chromecast
                    </h3>
                    <div class="card-description">
                        <strong>Support:</strong> Chromecast Ultra and above support HDCP 2.2<br>
                        <strong>Implementation:</strong> Cast SDK automatically verifies HDCP<br>
                        <strong>Fallback:</strong> Auto-downgrade resolution on HDCP failure<br>
                        <strong>Check:</strong> CastSession.isHdcpSupported()
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 14: Android Version Changes -->
        <section class="description-section">
            <h2 style="color: var(--accent-primary); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); padding-bottom: 10px;">
                14. Android Version Changes
            </h2>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                14-1. Android 8.0 Oreo
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üÜï</span>
                        Key Changes
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>DRM HAL 1.0 (HIDL) introduction</li>
                            <li>MediaDrm API level 27 additional methods</li>
                            <li>HDCP level query API added</li>
                            <li>clearkey DRM default support</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                14-2. Android 10 (Q)
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîê</span>
                        Security Enhancements
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>License access restrictions with Scoped Storage</li>
                            <li>MediaDrm metrics API added</li>
                            <li>DRM HAL 1.3 (improved session logging)</li>
                            <li>Enhanced root detection</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                14-3. Android 12 (S)
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö°</span>
                        Performance Improvements
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>DRM HAL 1.4 (multi-session optimization)</li>
                            <li>MediaDrm AIDL migration started</li>
                            <li>HDCP 2.3 support added</li>
                            <li>AV1 + Widevine official support</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                14-4. Android 13 (T)
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöÄ</span>
                        AIDL Transition
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>DRM HAL AIDL (IDrmPlugin.aidl) required</li>
                            <li>HIDL DRM HAL Deprecated</li>
                            <li>MediaDrm API 33 extension (offline expiration time)</li>
                            <li>Widevine L1 requirements strengthened (CDD)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                14-5. Android 14 (U)
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéØ</span>
                        Latest Features
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Ultra HDR + Widevine integration</li>
                            <li>MediaDrm error code granularity</li>
                            <li>DRM session memory optimization</li>
                            <li>HDCP verification logic improvements</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                14-6. Android 15 (V)
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÆ</span>
                        Planned Features
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>AI-based DRM attack detection</li>
                            <li>Widevine L0 (next-gen security level) preparation</li>
                            <li>8K HDR Widevine optimization</li>
                            <li>DRM session recovery API</li>
                        </ul>
                    </div>
                </div>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Android Version</th>
                        <th>API Level</th>
                        <th>DRM HAL</th>
                        <th>Key Changes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Android 8.0 (Oreo)</td>
                        <td>26-27</td>
                        <td>HIDL 1.0</td>
                        <td>HIDL DRM HAL introduction</td>
                    </tr>
                    <tr>
                        <td>Android 10 (Q)</td>
                        <td>29</td>
                        <td>HIDL 1.3</td>
                        <td>Scoped Storage, Metrics API</td>
                    </tr>
                    <tr>
                        <td>Android 12 (S)</td>
                        <td>31-32</td>
                        <td>HIDL 1.4 / AIDL parallel</td>
                        <td>AIDL migration started</td>
                    </tr>
                    <tr>
                        <td>Android 13 (T)</td>
                        <td>33</td>
                        <td>AIDL required</td>
                        <td>HIDL Deprecated, AIDL transition</td>
                    </tr>
                    <tr>
                        <td>Android 14 (U)</td>
                        <td>34</td>
                        <td>AIDL</td>
                        <td>Ultra HDR, Error code improvements</td>
                    </tr>
                    <tr>
                        <td>Android 15 (V)</td>
                        <td>35</td>
                        <td>AIDL</td>
                        <td>AI attack detection, L0 preparation</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Section 15: Debugging & Troubleshooting -->
        <section class="description-section">
            <h2 style="color: var(--accent-primary); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); padding-bottom: 10px;">
                15. Debugging & Troubleshooting
            </h2>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                15-1. dumpsys media.drm
            </h3>
            <div class="code-block">
                <pre><code class="language-bash"># DRM status dump
adb shell dumpsys media.drm

# Output example:
# Widevine CDM version: 16.1.0
# Security Level: L1
# Active sessions: 2
# Session 0x12345678:
#   - State: OPENED
#   - Keys loaded: 3
#   - Expiration: 2024-12-31 23:59:59
# Session 0xabcdef00:
#   - State: CLOSED

# Offline license list
adb shell dumpsys media.drm --offline-licenses

# Check session logs
adb shell dumpsys media.drm --sessions</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                15-2. logcat Filtering
            </h3>
            <div class="code-block">
                <pre><code class="language-bash"># Filter Widevine-related logs only
adb logcat | grep -E "Widevine|MediaDrm|Crypto|OEMCrypto"

# DRM HAL logs
adb logcat | grep "android.hardware.drm"

# Show errors only
adb logcat *:E | grep Widevine

# Key log examples:
# E/MediaDrm: provideKeyResponse failed: ERROR_LICENSE_PARSE
# W/OEMCrypto: Signature verification failed
# I/Widevine: Security level changed: L1 -> L3 (root detected)</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                15-3. Common Error Code Solutions
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Error Code</th>
                        <th>Cause</th>
                        <th>Solution</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ERROR_DRM_SESSION_NOT_OPENED</td>
                        <td>Invalid or expired session ID</td>
                        <td>Create new session (openSession)</td>
                    </tr>
                    <tr>
                        <td>ERROR_DRM_CANNOT_HANDLE</td>
                        <td>PSSH parsing failed</td>
                        <td>Check initData format (cenc/webm)</td>
                    </tr>
                    <tr>
                        <td>ERROR_DRM_LICENSE_EXPIRED</td>
                        <td>License validity expired</td>
                        <td>Renew license (KEY_TYPE_RENEWAL)</td>
                    </tr>
                    <tr>
                        <td>ERROR_DRM_RESOURCE_BUSY</td>
                        <td>Maximum session count exceeded</td>
                        <td>closeSession for unused sessions</td>
                    </tr>
                    <tr>
                        <td>ERROR_DRM_DEVICE_REVOKED</td>
                        <td>Device is blacklisted</td>
                        <td>Unrecoverable (firmware reissue required)</td>
                    </tr>
                    <tr>
                        <td>ERROR_HDCP_FAILURE</td>
                        <td>HDCP verification failed</td>
                        <td>Use HDCP 2.2 supported cable/display</td>
                    </tr>
                    <tr>
                        <td>ERROR_DRM_DECRYPT</td>
                        <td>Decryption failed (key mismatch)</td>
                        <td>Retry provideKeyResponse with correct key</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                15-4. L1 ‚Üí L3 Downgrade Analysis
            </h3>
            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîç</span>
                        Check Downgrade Cause
                    </h3>
                    <div class="card-description">
                        <strong>Step 1:</strong> Check Security Level<br>
                        <code>adb shell getprop ro.vendor.widevine.level</code><br><br>
                        <strong>Step 2:</strong> Log Analysis<br>
                        <code>adb logcat | grep "Security level"</code><br><br>
                        <strong>Step 3:</strong> Root Detection Check<br>
                        <code>adb shell getprop ro.boot.verifiedbootstate</code>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üõ†Ô∏è</span>
                        Common Causes
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>‚úó Device is rooted</li>
                            <li>‚úó Bootloader Unlocked</li>
                            <li>‚úó TEE firmware corrupted</li>
                            <li>‚úó OEMCrypto library tampered</li>
                            <li>‚úó External display without HDCP support connected</li>
                            <li>‚úó SafetyNet Attestation failed</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                15-5. Manual Testing Methods
            </h3>
            <div class="code-block">
                <pre><code class="language-bash"># 1. Check Widevine CDM version
adb shell dumpsys media.drm | grep "version"

# 2. Try playback with test app
adb install WidevineSampleApp.apk
adb shell am start -n com.widevine.demo/.MainActivity

# 3. Manual verification with CTS Verifier
adb install CtsVerifier.apk
# In app, select "DRM Tests" ‚Üí "Widevine L1"

# 4. Web EME test in Chrome
adb shell am start -a android.intent.action.VIEW \
  -d "https://shaka-player-demo.appspot.com/demo/"

# 5. Network packet capture (license request/response)
adb shell tcpdump -i any -s 0 -w /sdcard/drm.pcap port 443
# Analyze with Wireshark</code></pre>
            </div>
        </section>

        <!-- Section 16: AOSP Source Code Reference -->
        <section class="description-section">
            <h2 style="color: var(--accent-primary); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); padding-bottom: 10px;">
                16. AOSP Source Code Reference
            </h2>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                16-1. MediaDrm Framework (Java)
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>File Path</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>frameworks/base/media/java/android/media/MediaDrm.java</td>
                        <td>MediaDrm API entry point (openSession, getKeyRequest, etc.)</td>
                    </tr>
                    <tr>
                        <td>frameworks/base/media/java/android/media/MediaCrypto.java</td>
                        <td>MediaCodec and DRM session connection</td>
                    </tr>
                    <tr>
                        <td>frameworks/base/media/java/android/media/MediaDrmException.java</td>
                        <td>DRM exception definitions</td>
                    </tr>
                    <tr>
                        <td>frameworks/base/media/java/android/media/UnsupportedSchemeException.java</td>
                        <td>Unsupported DRM scheme exception</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                16-2. DRM HAL (Native)
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>File Path</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>frameworks/av/drm/libmediadrm/DrmHal.cpp</td>
                        <td>HIDL/AIDL DRM HAL client</td>
                    </tr>
                    <tr>
                        <td>frameworks/av/drm/libmediadrm/CryptoHal.cpp</td>
                        <td>Crypto HAL client</td>
                    </tr>
                    <tr>
                        <td>frameworks/av/drm/libmediadrm/DrmSessionManager.cpp</td>
                        <td>Session management and resource allocation</td>
                    </tr>
                    <tr>
                        <td>hardware/interfaces/drm/aidl/android/hardware/drm/IDrmPlugin.aidl</td>
                        <td>DRM HAL AIDL interface definition</td>
                    </tr>
                    <tr>
                        <td>hardware/interfaces/drm/aidl/android/hardware/drm/ICryptoPlugin.aidl</td>
                        <td>Crypto HAL AIDL interface definition</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                16-3. Widevine Plugin (Vendor)
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>File Path</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>vendor/widevine/libwvdrmengine/</td>
                        <td>Widevine DRM plugin implementation</td>
                    </tr>
                    <tr>
                        <td>vendor/widevine/oemcrypto/</td>
                        <td>OEMCrypto TEE communication library</td>
                    </tr>
                    <tr>
                        <td>vendor/widevine/mediadrm/service.cpp</td>
                        <td>Widevine DRM HAL service (AIDL)</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                16-4. OEMCrypto Headers
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>File Path</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>vendor/widevine/oemcrypto/include/OEMCryptoCENC.h</td>
                        <td>OEMCrypto API definition (CENC decryption)</td>
                    </tr>
                    <tr>
                        <td>vendor/widevine/oemcrypto/include/OEMCryptoTypes.h</td>
                        <td>OEMCrypto data type definitions</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                16-5. CTS Test Code
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>File Path</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>cts/tests/tests/media/src/android/media/cts/MediaDrmTest.java</td>
                        <td>MediaDrm CTS tests (session, key request, etc.)</td>
                    </tr>
                    <tr>
                        <td>cts/tests/tests/media/src/android/media/cts/CryptoTest.java</td>
                        <td>MediaCrypto CTS tests (decryption)</td>
                    </tr>
                    <tr>
                        <td>cts/tests/tests/media/src/android/media/cts/NativeDecoderTest.cpp</td>
                        <td>Native level secure decoder tests</td>
                    </tr>
                </tbody>
            </table>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìÇ</span>
                        Source Code Navigation Tips
                    </h3>
                    <div class="card-description">
                        <strong>1. Use Android Code Search:</strong><br>
                        Search by keywords at <a href="https://cs.android.com/" style="color: var(--accent-primary);">cs.android.com</a><br><br>
                        <strong>2. Download AOSP Locally:</strong><br>
                        <code>repo init -u https://android.googlesource.com/platform/manifest -b main</code><br>
                        <code>repo sync</code><br><br>
                        <strong>3. Key Search Keywords:</strong><br>
                        "MediaDrm", "OEMCrypto", "IDrmPlugin", "Widevine"
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 17: Related Documents -->
        <section class="description-section">
            <h2 style="color: var(--accent-primary); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); padding-bottom: 10px;">
                17. Related Documents
            </h2>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìÑ</span>
                        Media Framework Core
                    </h3>
                    <div class="card-description">
                        Explains the overall architecture of Android media framework (Framework‚ÜîNative interaction, Binder IPC, MediaServer structure).
                    </div>
                    <a href="media-framework-core.html" style="color: var(--accent-primary); text-decoration: none;">
                        View Details ‚Üí
                    </a>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üé¨</span>
                        Codec 2.0 & Media HAL
                    </h3>
                    <div class="card-description">
                        Covers Codec 2.0 architecture, HAL interface, and integration with Widevine.
                    </div>
                    <a href="codec2.html" style="color: var(--accent-primary); text-decoration: none;">
                        View Details ‚Üí
                    </a>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ñ∂Ô∏è</span>
                        Media Playback Pipeline
                    </h3>
                    <div class="card-description">
                        Explains the data flow in media playback pipeline (Extractor‚ÜíCodec‚ÜíRenderer) and DRM integration points.
                    </div>
                    <a href="media-playback.html" style="color: var(--accent-primary); text-decoration: none;">
                        View Details ‚Üí
                    </a>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üß™</span>
                        CTS/GTS Testing
                    </h3>
                    <div class="card-description">
                        Covers CTS/VTS/GTS test frameworks and Widevine DRM certification testing in detail.
                    </div>
                    <a href="cts.html" style="color: var(--accent-primary); text-decoration: none;">
                        View Details ‚Üí
                    </a>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìã</span>
                        CDD (Compatibility Definition Document)
                    </h3>
                    <div class="card-description">
                        Summarizes Android CDD media DRM requirements (Section 5.1, 5.9) and Widevine L1 certification conditions.
                    </div>
                    <a href="cdd.html" style="color: var(--accent-primary); text-decoration: none;">
                        View Details ‚Üí
                    </a>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéµ</span>
                        Dolby DRM Integration
                    </h3>
                    <div class="card-description">
                        Explains Dolby Atmos/AC-4 integration with Widevine (DRM + Premium Audio simultaneous processing).
                    </div>
                    <a href="dolby-codecs.html" style="color: var(--accent-primary); text-decoration: none;">
                        View Details ‚Üí
                    </a>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.3rem; margin-top: 40px; margin-bottom: 15px;">
                External Reference Documents
            </h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Document</th>
                        <th>Link</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>AOSP Media DRM</td>
                        <td><a href="https://source.android.com/docs/core/media/drm" style="color: var(--accent-primary);">source.android.com/media/drm</a></td>
                        <td>Official AOSP DRM Guide</td>
                    </tr>
                    <tr>
                        <td>Widevine Official Docs</td>
                        <td><a href="https://www.widevine.com/solutions/widevine-drm" style="color: var(--accent-primary);">widevine.com</a></td>
                        <td>Widevine DRM Solution Overview</td>
                    </tr>
                    <tr>
                        <td>W3C EME Standard</td>
                        <td><a href="https://www.w3.org/TR/encrypted-media/" style="color: var(--accent-primary);">w3.org/TR/encrypted-media</a></td>
                        <td>Web Encrypted Media Extensions</td>
                    </tr>
                    <tr>
                        <td>HDCP Spec</td>
                        <td><a href="https://www.digital-cp.com/hdcp-specifications" style="color: var(--accent-primary);">digital-cp.com</a></td>
                        <td>HDCP 2.2/2.3 Technical Specification</td>
                    </tr>
                    <tr>
                        <td>Android CDD</td>
                        <td><a href="https://source.android.com/compatibility/cdd" style="color: var(--accent-primary);">source.android.com/compatibility/cdd</a></td>
                        <td>Compatibility Definition Document (DRM Requirements)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Footer -->
        <footer
            style="text-align: center; padding: 40px 20px; color: var(--text-muted); border-top: 1px solid var(--border-color); margin-top: 60px;">
            <p>Widevine DRM Architecture Visualization</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Google Widevine Digital Rights Management ¬∑ L1/L2/L3 Security Levels
            </p>
            <p style="margin-top: 20px;">
                <a href="index.html" style="color: var(--accent-primary); text-decoration: none;">
                    ‚Üê Back to AOSP Media Framework
                </a>
            </p>
        </footer>
    </div>

    <script src="../scripts/mermaid-theme.js"></script>
    <script>
        // Add scroll animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.section').forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(30px)';
            section.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
            observer.observe(section);
        });
    </script>
    <!-- Navigation & Copy Features -->
    <script src="../scripts/copy-code.js"></script>
    <script src="../scripts/toc-generator.js"></script>
    <script src="../scripts/page-navigation.js"></script>
    <!-- Interactive Diagram Features -->
    <script src="../scripts/diagram-data.js"></script>
    <script src="../scripts/diagram-data-en-partial.js"></script>
    <script src="../scripts/diagram-interactive.js"></script>

    <script src="../scripts/theme-toggle.js"></script>
    <script src="../scripts/lang-switch.js"></script>
</body>

</html>