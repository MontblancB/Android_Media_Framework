<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Media Service Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            ‚Üê AOSP Media Framework
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">Car Media Service</h1>
            <p class="page-subtitle">Android Automotive OS Media and Audio Management Architecture</p>
        </header>

        <!-- Section 1: Overview -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">1</span>
                Overview: CarMedia vs CarAudio
            </h2>
            <p class="section-description">
                This section explains the roles and differences between the two core services that manage the media experience in Android Automotive OS (AAOS).
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì∫</span>
                        CarMediaService
                    </h3>
                    <div class="card-description">
                        <p><strong>Manages "What"</strong></p>
                        <ul>
                            <li><strong>Active Media Source</strong>: Manages the currently selected media app</li>
                            <li><strong>Source Selection</strong>: Tracks source changes by user/system</li>
                            <li><strong>Resumption</strong>: Restores previous media on engine restart</li>
                            <li><strong>Browsing</strong>: Manages connections for media browsing</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîä</span>
                        CarAudioService
                    </h3>
                    <div class="card-description">
                        <p><strong>Manages "How"</strong></p>
                        <ul>
                            <li><strong>Audio Focus</strong>: Coordinates audio priority between apps</li>
                            <li><strong>Routing</strong>: Determines audio output devices per Zone</li>
                            <li><strong>Volume Groups</strong>: Manages volume groups per context</li>
                            <li><strong>Ducking</strong>: Automatic volume adjustment during announcements</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Architecture -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">2</span>
                AAOS Media Architecture
            </h2>
            <p class="section-description">
                The overall architecture showing how CarMediaService and CarAudioService interact with the standard Android Media Framework.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph APPS ["Media Applications"]
                    SPOTIFY["Spotify<br />(MediaSession)"]
                    YT["YouTube Music<br />(MediaSession)"]
                    RADIO["Radio App<br />(MediaSession)"]
                    end

                    subgraph CAR_SERVICE ["Car Service (System Server)"]
                    CMS["CarMediaService<br />(Active Source Manager)"]
                    CAS["CarAudioService<br />(Focus & Routing Policy)"]

                    CMS -.->|Tracks| SPOTIFY
                    CMS -.->|Tracks| YT
                    CMS -.->|Tracks| RADIO

                    CAS -.->|Manages Focus| APPS
                    end

                    subgraph ANDROID_FW ["Android Framework"]
                    AUDIO_SVC["AudioService"]
                    MEDIA_SESSION["MediaSessionService"]
                    end

                    subgraph HAL ["Hardware Abstraction Layer"]
                    AUDIO_HAL["Audio HAL<br />(Output Devices)"]
                    VEHICLE_HAL["Vehicle HAL<br />(Events)"]
                    end

                    APPS -->|AudioAttributes| AUDIO_SVC
                    APPS -->|PlaybackState| MEDIA_SESSION

                    CAS -->|Routing Policy| AUDIO_SVC
                    AUDIO_SVC -->|Stream| AUDIO_HAL

                    VEHICLE_HAL -->|User Events| CMS

                </div>
            </div>
        </section>

        <!-- Section 3: Media Source Management -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Media Source Management
            </h2>
            <p class="section-description">
                The process by which CarMediaService selects and manages the active media source.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant User
                    participant UI as Car UI (Launcher)
                    participant CMS as CarMediaService
                    participant App as Media App
                    participant Session as MediaSession

                    Note over User,Session: Source Selection
                    User->>UI: Select media app (Spotify)
                    UI->>CMS: setMediaSource(Spotify)
                    CMS->>CMS: Update Active Source
                    CMS->>UI: onMediaSourceChanged()

                    Note over User,Session: Resumption
                    CMS->>App: Start Service / Browse
                    App->>Session: Create Session
                    Session->>CMS: Session Active
                    CMS->>App: Play Command
                    App->>Session: setPlaybackState(PLAYING)
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéØ</span>
                        Active Media Source
                    </h3>
                    <div class="card-description">
                        <p><strong>Single Active Source Management</strong></p>
                        <ul>
                            <li>Maintains a single 'active media source' in the system (Playback & Browsing)</li>
                            <li>Unlike MediaSessionManager, tracks <strong>only one app</strong> to be displayed in vehicle UI</li>
                            <li>Stores ComponentName, PlaybackState, and timestamp of currently selected source</li>
                            <li>System UI (Media Center) references this information to display content</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üëÜ</span>
                        Source Selection
                    </h3>
                    <div class="card-description">
                        <p><strong>Source Change Mechanism</strong></p>
                        <ul>
                            <li><strong>Triggers</strong>: User touch (Launcher), hardware buttons, voice commands</li>
                            <li><strong>Process</strong>: <code>setMediaSource()</code> call ‚Üí Active Source update ‚Üí Notify observers
                            </li>
                            <li><code>car-media-common</code> library Source Selector Intent support</li>
                            <li>Previous app is stopped or paused on source change</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÑ</span>
                        Resumption
                    </h3>
                    <div class="card-description">
                        <p><strong>Playback Restoration Logic</strong></p>
                        <ul>
                            <li>Automatic restoration of last Active Source on vehicle ignition</li>
                            <li>Apps must implement <code>onPlaybackResumption()</code> callback</li>
                            <li><strong>LMS (Last Media Source)</strong> information stored in Persistent Storage</li>
                            <li>Service binding and session recovery after boot</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìÇ</span>
                        Browsing
                    </h3>
                    <div class="card-description">
                        <p><strong>Media Browsing Connection</strong></p>
                        <ul>
                            <li>Automatic connection to Active Source's <code>MediaBrowserService</code></li>
                            <li><code>onGetRoot()</code> ‚Üí <code>onLoadChildren()</code> calls to build content tree</li>
                            <li>System UI (Media Center) renders app content on its behalf</li>
                            <li>List filtering applied based on UX Restrictions during driving</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Audio Focus & Routing -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">4</span>
                Audio Focus & Routing
            </h2>
            <p class="section-description">
                The mechanism by which CarAudioService manages audio focus and routes to multi-zone outputs.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    flowchart LR
                    subgraph INPUT ["Audio Focus Request"]
                    REQ_MEDIA["Media App<br />(USAGE_MEDIA)"]
                    REQ_NAV["Nav App<br />(USAGE_ASSISTANCE_NAVIGATION)"]
                    REQ_CALL["Phone<br />(USAGE_VOICE_COMMUNICATION)"]
                    end

                    subgraph CAS ["CarAudioService"]
                    MATRIX["Interaction Matrix<br />(Exclusive / Concurrent / Reject)"]
                    ZONES["Zone Manager<br />(Driver / Passenger)"]
                    GROUPS["Volume Groups"]
                    end

                    subgraph OUTPUT ["Audio Output"]
                    SPK_MAIN["Main Speakers"]
                    SPK_NAV["Driver Headrest"]
                    SPK_REAR["Rear Speakers"]
                    end

                    REQ_MEDIA --> MATRIX
                    REQ_NAV --> MATRIX
                    REQ_CALL --> MATRIX

                    MATRIX --> ZONES
                    ZONES --> GROUPS

                    GROUPS -- "Zone 1" --> SPK_MAIN
                    GROUPS -- "Zone 1 (Nav)" --> SPK_NAV
                    GROUPS -- "Zone 2" --> SPK_REAR

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéõÔ∏è</span>
                        Interaction Matrix
                    </h3>
                    <div class="card-description">
                        <p><strong>Audio Interference Rules Definition</strong></p>
                        <ul>
                            <li><strong>Exclusive</strong>: Only one plays at a time (e.g., music vs music)</li>
                            <li><strong>Concurrent</strong>: Simultaneous playback (e.g., music + navigation)</li>
                            <li><strong>Reject</strong>: Request denied (e.g., music request during call)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîâ</span>
                        Ducking & Fading
                    </h3>
                    <div class="card-description">
                        <p><strong>Automatic Volume Adjustment</strong></p>
                        <ul>
                            <li>Automatic volume reduction during navigation guidance</li>
                            <li>Mute all other audio during emergency alerts</li>
                            <li>Fading for smooth transitions</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöó</span>
                        Multi-Zone Audio
                    </h3>
                    <div class="card-description">
                        <p><strong>Independent Audio per Seat</strong></p>
                        <ul>
                            <li>Driver seat: Navigation + Radio</li>
                            <li>Rear seat: YouTube Kids (headphones)</li>
                            <li>Independent focus and volume management per Zone</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Code Examples -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">5</span>
                Code Examples
            </h2>
            <p class="section-description">
                Practical implementation examples using the CarMediaService API and MediaBrowserService.
            </p>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üì± Changing Active Media Source</h3>
            <div class="code-block">
                <pre><code>// Changing active media source via CarMediaService API
class MediaSourceSwitcher(private val context: Context) {
    private lateinit var carMediaManager: CarMediaManager

    fun initialize() {
        val car = Car.createCar(context)
        carMediaManager = car.getCarManager(Car.CAR_MEDIA_SERVICE) as CarMediaManager

        // Register media source change listener
        carMediaManager.addMediaSourceListener(mediaSourceListener)
    }

    private val mediaSourceListener = object : CarMediaManager.MediaSourceChangedListener {
        override fun onMediaSourceChanged(componentName: ComponentName) {
            Log.d("CarMedia", "Active source changed to: ${componentName.packageName}")

            // Update UI
            updateMediaUI(componentName)
        }
    }

    // Switch to a specific media app
    fun switchToSpotify() {
        val spotifyComponent = ComponentName(
            "com.spotify.music",
            "com.spotify.music.MainActivity"
        )

        // Request source change to CarMediaService
        carMediaManager.setMediaSource(spotifyComponent, CarMediaManager.MEDIA_SOURCE_MODE_PLAYBACK)

        Log.d("CarMedia", "Switched to Spotify")
    }

    // Get current active source
    fun getCurrentSource(): ComponentName? {
        return carMediaManager.mediaSource
    }

    // Get all available media sources
    fun getAvailableSources(): List&lt;ComponentName&gt; {
        return carMediaManager.getLastMediaSources(CarMediaManager.MEDIA_SOURCE_MODE_PLAYBACK)
    }

    fun release() {
        carMediaManager.removeMediaSourceListener(mediaSourceListener)
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üéµ Simple MediaBrowserService Implementation</h3>
            <div class="code-block">
                <pre><code>// MediaBrowserService for vehicle media apps
class CarMusicService : MediaBrowserServiceCompat() {
    private lateinit var mediaSession: MediaSessionCompat
    private lateinit var player: MediaPlayer

    override fun onCreate() {
        super.onCreate()

        // Create MediaSession
        mediaSession = MediaSessionCompat(this, "CarMusicService").apply {
            setFlags(MediaSessionCompat.FLAG_HANDLES_MEDIA_BUTTONS or
                     MediaSessionCompat.FLAG_HANDLES_TRANSPORT_CONTROLS)

            setCallback(mediaSessionCallback)

            // Initialize PlaybackState
            setPlaybackState(PlaybackStateCompat.Builder()
                .setActions(PlaybackStateCompat.ACTION_PLAY or
                           PlaybackStateCompat.ACTION_PAUSE or
                           PlaybackStateCompat.ACTION_SKIP_TO_NEXT)
                .setState(PlaybackStateCompat.STATE_NONE, 0, 1.0f)
                .build())

            isActive = true
        }

        sessionToken = mediaSession.sessionToken
    }

    // Client connection permission conditions
    override fun onGetRoot(
        clientPackageName: String,
        clientUid: Int,
        rootHints: Bundle?
    ): BrowserRoot? {
        // Allow only vehicle system UI connections
        if (clientPackageName.startsWith("com.android.car")) {
            return BrowserRoot("root", null)
        }
        return null
    }

    // Provide media content
    override fun onLoadChildren(
        parentId: String,
        result: Result&lt;List&lt;MediaBrowserCompat.MediaItem&gt;&gt;
    ) {
        val mediaItems = mutableListOf&lt;MediaBrowserCompat.MediaItem&gt;()

        when (parentId) {
            "root" -> {
                // Top-level menu: Library, Playlists, Recent Plays
                mediaItems.add(createBrowsableItem("library", "My Library"))
                mediaItems.add(createBrowsableItem("playlists", "Playlists"))
                mediaItems.add(createBrowsableItem("recents", "Recently Played"))
            }

            "library" -> {
                // Song list in library
                mediaItems.add(createPlayableItem("song1", "Song 1", "Artist 1"))
                mediaItems.add(createPlayableItem("song2", "Song 2", "Artist 2"))
                mediaItems.add(createPlayableItem("song3", "Song 3", "Artist 3"))
            }

            "playlists" -> {
                // Playlist list
                mediaItems.add(createBrowsableItem("playlist1", "My Favorites"))
                mediaItems.add(createBrowsableItem("playlist2", "Road Trip"))
            }
        }

        result.sendResult(mediaItems)
    }

    private fun createBrowsableItem(id: String, title: String): MediaBrowserCompat.MediaItem {
        val mediaDescription = MediaDescriptionCompat.Builder()
            .setMediaId(id)
            .setTitle(title)
            .build()

        return MediaBrowserCompat.MediaItem(
            mediaDescription,
            MediaBrowserCompat.MediaItem.FLAG_BROWSABLE
        )
    }

    private fun createPlayableItem(
        id: String,
        title: String,
        artist: String
    ): MediaBrowserCompat.MediaItem {
        val mediaDescription = MediaDescriptionCompat.Builder()
            .setMediaId(id)
            .setTitle(title)
            .setSubtitle(artist)
            .build()

        return MediaBrowserCompat.MediaItem(
            mediaDescription,
            MediaBrowserCompat.MediaItem.FLAG_PLAYABLE
        )
    }

    private val mediaSessionCallback = object : MediaSessionCompat.Callback() {
        override fun onPlay() {
            // Request Audio Focus
            requestAudioFocus()

            // Start playback
            player.start()

            // Update PlaybackState
            updatePlaybackState(PlaybackStateCompat.STATE_PLAYING)
        }

        override fun onPause() {
            player.pause()
            updatePlaybackState(PlaybackStateCompat.STATE_PAUSED)
        }

        override fun onPlayFromMediaId(mediaId: String, extras: Bundle?) {
            // Play specific track
            loadAndPlayTrack(mediaId)
        }
    }

    private fun updatePlaybackState(state: Int) {
        val position = if (::player.isInitialized) player.currentPosition.toLong() else 0

        mediaSession.setPlaybackState(PlaybackStateCompat.Builder()
            .setState(state, position, 1.0f)
            .setActions(PlaybackStateCompat.ACTION_PLAY or
                       PlaybackStateCompat.ACTION_PAUSE or
                       PlaybackStateCompat.ACTION_SKIP_TO_NEXT)
            .build())
    }

    override fun onDestroy() {
        mediaSession.release()
        super.onDestroy()
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üîä Vehicle Audio Focus Management</h3>
            <div class="code-block">
                <pre><code>// Requesting Audio Focus in vehicle environment
class CarAudioFocusManager(private val context: Context) {
    private val audioManager = context.getSystemService(Context.AUDIO_SERVICE) as AudioManager
    private var audioFocusRequest: AudioFocusRequest? = null

    fun requestFocusForMusic(): Boolean {
        val audioAttributes = AudioAttributes.Builder()
            .setUsage(AudioAttributes.USAGE_MEDIA)
            .setContentType(AudioAttributes.CONTENT_TYPE_MUSIC)
            .build()

        audioFocusRequest = AudioFocusRequest.Builder(AudioManager.AUDIOFOCUS_GAIN)
            .setAudioAttributes(audioAttributes)
            .setOnAudioFocusChangeListener(focusChangeListener)
            .setAcceptsDelayedFocusGain(true)  // Important for vehicles: allow delayed focus
            .build()

        val result = audioManager.requestAudioFocus(audioFocusRequest!!)
        return result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED
    }

    fun requestFocusForNavigation(): Boolean {
        val audioAttributes = AudioAttributes.Builder()
            .setUsage(AudioAttributes.USAGE_ASSISTANCE_NAVIGATION_GUIDANCE)
            .setContentType(AudioAttributes.CONTENT_TYPE_SPEECH)
            .build()

        audioFocusRequest = AudioFocusRequest.Builder(AudioManager.AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK)
            .setAudioAttributes(audioAttributes)
            .setOnAudioFocusChangeListener(focusChangeListener)
            .build()

        val result = audioManager.requestAudioFocus(audioFocusRequest!!)
        return result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED
    }

    private val focusChangeListener = AudioManager.OnAudioFocusChangeListener { focusChange ->
        when (focusChange) {
            AudioManager.AUDIOFOCUS_GAIN -> {
                Log.d("CarAudio", "Focus gained")
                // Resume playback
            }

            AudioManager.AUDIOFOCUS_LOSS -> {
                Log.d("CarAudio", "Focus lost permanently")
                // Stop playback
            }

            AudioManager.AUDIOFOCUS_LOSS_TRANSIENT -> {
                Log.d("CarAudio", "Focus lost temporarily")
                // Pause playback
            }

            AudioManager.AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK -> {
                Log.d("CarAudio", "Ducking (volume down)")
                // Reduce volume (20%)
            }
        }
    }

    fun abandonFocus() {
        audioFocusRequest?.let {
            audioManager.abandonAudioFocusRequest(it)
        }
    }
}</code></pre>
            </div>
        </section>

        <!-- Section 6: MediaBrowserService Implementation -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">6</span>
                MediaBrowserService for Vehicles
            </h2>
            <p class="section-description">
                Implementation guide for optimized MediaBrowserService in AAOS environments.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéØ</span>
                        Vehicle Requirements
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Distraction Optimization</strong>: Consider driving safety</li>
                            <li><strong>Depth Limit</strong>: Maximum 2-3 menu levels</li>
                            <li><strong>List Size</strong>: Limit item count (recommended: 6-12)</li>
                            <li><strong>Fast Response</strong>: onLoadChildren() within 1 second</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üñºÔ∏è</span>
                        Metadata Optimization
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Icons</strong>: Provide appropriate size (512x512)</li>
                            <li><strong>Title/Subtitle</strong>: Keep concise and clear</li>
                            <li><strong>Album Art</strong>: Use local caching</li>
                            <li><strong>Playback Progress</strong>: Accurate position updates</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîê</span>
                        Security Considerations
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>onGetRoot()</strong>: Allow only trusted clients</li>
                            <li><strong>Package Verification</strong>: Verify system apps</li>
                            <li><strong>Permission Check</strong>: When user consent is required</li>
                            <li><strong>Data Protection</strong>: Prevent sensitive information exposure</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìã Vehicle-Optimized MediaBrowserService</h3>
            <div class="code-block">
                <pre><code>// Vehicle-optimized MediaBrowserService implementation
class OptimizedCarMediaService : MediaBrowserServiceCompat() {

    companion object {
        const val MAX_SEARCH_RESULTS = 6  // Maximum search results
        const val MAX_LIST_ITEMS = 12     // Maximum list items
        const val MAX_MENU_DEPTH = 3      // Menu depth limit
    }

    override fun onGetRoot(
        clientPackageName: String,
        clientUid: Int,
        rootHints: Bundle?
    ): BrowserRoot? {
        // 1. Allow only vehicle system apps
        if (!isAuthorizedClient(clientPackageName)) {
            Log.w("CarMedia", "Unauthorized client: $clientPackageName")
            return null
        }

        // 2. Check UX Restrictions
        val extras = Bundle().apply {
            putBoolean(
                "android.media.browse.CONTENT_STYLE_SUPPORTED",
                true
            )
            putInt(
                "android.media.browse.CONTENT_STYLE_BROWSABLE_HINT",
                CONTENT_STYLE_GRID_ITEM_HINT_VALUE
            )
            putInt(
                "android.media.browse.CONTENT_STYLE_PLAYABLE_HINT",
                CONTENT_STYLE_LIST_ITEM_HINT_VALUE
            )
        }

        return BrowserRoot("__ROOT__", extras)
    }

    private fun isAuthorizedClient(packageName: String): Boolean {
        // Verify vehicle system apps
        return packageName.startsWith("com.android.car") ||
               packageName == "com.google.android.gms" ||
               packageName == "com.google.android.projection.gearhead"
    }

    override fun onLoadChildren(
        parentId: String,
        result: Result&lt;List&lt;MediaBrowserCompat.MediaItem&gt;&gt;
    ) {
        // Async loading (target: complete within 1 second)
        result.detach()

        Thread {
            val items = loadMediaItems(parentId)
            result.sendResult(items)
        }.start()
    }

    private fun loadMediaItems(parentId: String): List&lt;MediaBrowserCompat.MediaItem&gt; {
        val items = mutableListOf&lt;MediaBrowserCompat.MediaItem&gt;()

        when (parentId) {
            "__ROOT__" -> {
                // Top-level menu (depth 1)
                items.add(createTab("recents", "Recently Played", R.drawable.ic_recent))
                items.add(createTab("library", "My Library", R.drawable.ic_library))
                items.add(createTab("playlists", "Playlists", R.drawable.ic_playlist))
                items.add(createTab("radio", "Radio", R.drawable.ic_radio))
            }

            "recents" -> {
                // Recently played list (depth 2)
                val recentTracks = getRecentTracks()
                items.addAll(recentTracks.take(MAX_LIST_ITEMS))
            }

            "library" -> {
                // Library categories (depth 2)
                items.add(createTab("library_songs", "Songs", R.drawable.ic_song))
                items.add(createTab("library_albums", "Albums", R.drawable.ic_album))
                items.add(createTab("library_artists", "Artists", R.drawable.ic_artist))
            }

            "library_songs" -> {
                // All songs list (depth 3 - maximum)
                val songs = getAllSongs()
                items.addAll(songs.take(MAX_LIST_ITEMS))
            }
        }

        return items
    }

    private fun createTab(
        mediaId: String,
        title: String,
        iconRes: Int
    ): MediaBrowserCompat.MediaItem {
        val description = MediaDescriptionCompat.Builder()
            .setMediaId(mediaId)
            .setTitle(title)
            .setIconUri(Uri.parse("android.resource://$packageName/$iconRes"))
            .build()

        return MediaBrowserCompat.MediaItem(
            description,
            MediaBrowserCompat.MediaItem.FLAG_BROWSABLE
        )
    }

    // Search function (optional)
    override fun onSearch(
        query: String,
        extras: Bundle?,
        result: Result&lt;List&lt;MediaBrowserCompat.MediaItem&gt;&gt;
    ) {
        result.detach()

        Thread {
            val searchResults = performSearch(query)
            // Limit search results
            result.sendResult(searchResults.take(MAX_SEARCH_RESULTS))
        }.start()
    }

    // Custom Action support (e.g., Shuffle All)
    override fun onCustomAction(
        action: String,
        extras: Bundle?,
        result: Result&lt;Bundle&gt;
    ) {
        when (action) {
            "SHUFFLE_ALL" -> {
                shuffleAllTracks()
                result.sendResult(Bundle())
            }
            else -> {
                result.sendError(Bundle())
            }
        }
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìä Vehicle Content Structure Recommendations</h3>
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Recommended Value</th>
                            <th>Reason</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Menu Depth</td>
                            <td>Maximum 3 levels</td>
                            <td>Minimize distraction while driving</td>
                        </tr>
                        <tr>
                            <td>List Items</td>
                            <td>6-12 items</td>
                            <td>Minimize scrolling, overview at a glance</td>
                        </tr>
                        <tr>
                            <td>Search Results</td>
                            <td>Maximum 6</td>
                            <td>Enable quick selection</td>
                        </tr>
                        <tr>
                            <td>Icon Size</td>
                            <td>512x512px</td>
                            <td>Support high-resolution displays</td>
                        </tr>
                        <tr>
                            <td>Loading Time</td>
                            <td>Within 1 second</td>
                            <td>Minimize user wait time</td>
                        </tr>
                        <tr>
                            <td>Title Length</td>
                            <td>Maximum 20 characters</td>
                            <td>Prevent UI layout issues</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 7: Interaction Matrix Details -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">7</span>
                Interaction Matrix Details
            </h2>
            <p class="section-description">
                Audio focus interaction rules used by CarAudioService.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéõÔ∏è</span>
                        Interaction Types
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>EXCLUSIVE</strong>: Only one at a time (e.g., Music vs Music)</li>
                            <li><strong>CONCURRENT</strong>: Simultaneous playback (e.g., Music + Nav)</li>
                            <li><strong>REJECT</strong>: Request denied (e.g., Music during Call)</li>
                            <li><strong>DUCK</strong>: Volume reduction (e.g., Music during Nav guidance)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìã</span>
                        Matrix Configuration
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>XML-based configuration (audio_focus_configuration.xml)</li>
                            <li>Priority definition per Usage</li>
                            <li>Vendor-customizable</li>
                            <li>OEM policy reflection</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚öñÔ∏è</span>
                        Priority Rules
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Priority 1: VOICE_COMMUNICATION (Call)</li>
                            <li>Priority 2: ASSISTANCE_NAVIGATION_GUIDANCE</li>
                            <li>Priority 3: ALARM, NOTIFICATION_RINGTONE</li>
                            <li>Priority 4: MEDIA, GAME</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìä Audio Context Interaction Matrix</h3>
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Currently Playing (Row)</th>
                            <th>New Request (Column)</th>
                            <th>Result</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>MUSIC</td>
                            <td>MUSIC</td>
                            <td><strong>EXCLUSIVE</strong></td>
                            <td>Stop previous music, play new music</td>
                        </tr>
                        <tr>
                            <td>MUSIC</td>
                            <td>NAVIGATION</td>
                            <td><strong>CONCURRENT + DUCK</strong></td>
                            <td>Reduce music to 20%, play navigation</td>
                        </tr>
                        <tr>
                            <td>MUSIC</td>
                            <td>VOICE_CALL</td>
                            <td><strong>EXCLUSIVE</strong></td>
                            <td>Pause music, start call</td>
                        </tr>
                        <tr>
                            <td>NAVIGATION</td>
                            <td>MUSIC</td>
                            <td><strong>CONCURRENT</strong></td>
                            <td>Both play (nav ducks when needed)</td>
                        </tr>
                        <tr>
                            <td>VOICE_CALL</td>
                            <td>MUSIC</td>
                            <td><strong>REJECT</strong></td>
                            <td>Music request denied during call</td>
                        </tr>
                        <tr>
                            <td>VOICE_CALL</td>
                            <td>NAVIGATION</td>
                            <td><strong>CONCURRENT + DUCK</strong></td>
                            <td>Emergency nav allowed during call (low volume)</td>
                        </tr>
                        <tr>
                            <td>ALARM</td>
                            <td>MUSIC</td>
                            <td><strong>REJECT</strong></td>
                            <td>Music not allowed while alarm sounds</td>
                        </tr>
                        <tr>
                            <td>NOTIFICATION</td>
                            <td>MUSIC</td>
                            <td><strong>CONCURRENT</strong></td>
                            <td>Music continues after notification</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìã car_audio_focus_configuration.xml Example</h3>
            <div class="code-block">
                <pre><code>&lt;!-- car_audio_focus_configuration.xml: Audio focus interaction rules --&gt;
&lt;audioFocusConfiguration version="1"&gt;
    &lt;!-- Focus Interaction Matrix --&gt;
    &lt;focusInteractions&gt;
        &lt;!-- MUSIC (USAGE_MEDIA) --&gt;
        &lt;interaction usage="USAGE_MEDIA"&gt;
            &lt;loses focusGain="AUDIOFOCUS_GAIN" type="EXCLUSIVE"/&gt;
            &lt;loses focusGain="AUDIOFOCUS_GAIN_TRANSIENT" type="CONCURRENT"&gt;
                &lt;duck/&gt;
            &lt;/loses&gt;
            &lt;continues focusGain="AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK"/&gt;
        &lt;/interaction&gt;

        &lt;!-- NAVIGATION (USAGE_ASSISTANCE_NAVIGATION_GUIDANCE) --&gt;
        &lt;interaction usage="USAGE_ASSISTANCE_NAVIGATION_GUIDANCE"&gt;
            &lt;loses focusGain="AUDIOFOCUS_GAIN" type="EXCLUSIVE"/&gt;
            &lt;continues focusGain="AUDIOFOCUS_GAIN_TRANSIENT"/&gt;
            &lt;continues focusGain="AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK"/&gt;
        &lt;/interaction&gt;

        &lt;!-- VOICE CALL (USAGE_VOICE_COMMUNICATION) --&gt;
        &lt;interaction usage="USAGE_VOICE_COMMUNICATION"&gt;
            &lt;!-- Most requests rejected during call --&gt;
            &lt;rejects usage="USAGE_MEDIA"/&gt;
            &lt;rejects usage="USAGE_GAME"/&gt;
            &lt;!-- Only emergency navigation allowed (low volume) --&gt;
            &lt;continues usage="USAGE_ASSISTANCE_NAVIGATION_GUIDANCE"&gt;
                &lt;duck percentage="10"/&gt;
            &lt;/continues&gt;
        &lt;/interaction&gt;

        &lt;!-- ALARM (USAGE_ALARM) --&gt;
        &lt;interaction usage="USAGE_ALARM"&gt;
            &lt;!-- Alarm stops almost everything --&gt;
            &lt;loses focusGain="AUDIOFOCUS_GAIN" type="EXCLUSIVE"/&gt;
        &lt;/interaction&gt;
    &lt;/focusInteractions&gt;

    &lt;!-- Ducking Settings --&gt;
    &lt;duckingSettings&gt;
        &lt;!-- Reduce media volume to 20% during navigation guidance --&gt;
        &lt;ducking usage="USAGE_MEDIA" duckTo="20"/&gt;

        &lt;!-- Reduce media volume to 50% during notifications --&gt;
        &lt;ducking usage="USAGE_NOTIFICATION" duckTo="50"/&gt;
    &lt;/duckingSettings&gt;
&lt;/audioFocusConfiguration&gt;</code></pre>
            </div>
        </section>

        <!-- Section 8: Last Media Source (LMS) -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">8</span>
                Last Media Source (LMS)
            </h2>
            <p class="section-description">
                The mechanism for restoring the last media source on vehicle restart.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üíæ</span>
                        LMS Storage
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>When</strong>: On media source change</li>
                            <li><strong>Stored Info</strong>: ComponentName, timestamp, PlaybackState</li>
                            <li><strong>Storage Location</strong>: SharedPreferences (lightweight)</li>
                            <li><strong>Persistence</strong>: Maintained even when ignition is off</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÑ</span>
                        LMS Restoration
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>When</strong>: On ignition ON</li>
                            <li><strong>Process</strong>: During CarMediaService initialization</li>
                            <li><strong>Conditions</strong>: App installed, user settings</li>
                            <li><strong>Fallback</strong>: Default radio app</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö°</span>
                        Auto-resume
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Auto Play</strong>: Based on settings</li>
                            <li><strong>onPlaybackResumption()</strong>: App callback</li>
                            <li><strong>Delayed Play</strong>: After boot complete</li>
                            <li><strong>User Control</strong>: On/Off in settings</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant User
                    participant CMS as CarMediaService
                    participant Storage as SharedPreferences
                    participant App as Media App
                    participant Session as MediaSession

                    Note over User,Session: Ignition OFF
                    User->>CMS: Power Off Event
                    CMS->>Storage: Save LMS (ComponentName, Timestamp)
                    Storage-->>CMS: Saved

                    Note over User,Session: Ignition ON
                    User->>CMS: Power On Event
                    CMS->>Storage: Load LMS
                    Storage-->>CMS: Last Source = Spotify

                    CMS->>App: Start Service
                    App->>Session: Create MediaSession
                    Session-->>CMS: Session Ready

                    alt Auto-resume enabled
                        CMS->>App: onPlaybackResumption()
                        App->>Session: play()
                    else Auto-resume disabled
                        Note over CMS,App: No playback (wait)
                    end
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üíæ LMS Save/Restore Implementation</h3>
            <div class="code-block">
                <pre><code>// Last Media Source save and restore
class LastMediaSourceManager(private val context: Context) {
    private val prefs = context.getSharedPreferences("car_media_lms", Context.MODE_PRIVATE)

    companion object {
        const val KEY_LAST_PACKAGE = "last_media_package"
        const val KEY_LAST_CLASS = "last_media_class"
        const val KEY_LAST_TIMESTAMP = "last_timestamp"
        const val KEY_AUTO_RESUME = "auto_resume_enabled"
    }

    // Save LMS
    fun saveLastMediaSource(componentName: ComponentName) {
        prefs.edit().apply {
            putString(KEY_LAST_PACKAGE, componentName.packageName)
            putString(KEY_LAST_CLASS, componentName.className)
            putLong(KEY_LAST_TIMESTAMP, System.currentTimeMillis())
            apply()
        }

        Log.d("LMS", "Saved: ${componentName.packageName}")
    }

    // Restore LMS
    fun getLastMediaSource(): ComponentName? {
        val packageName = prefs.getString(KEY_LAST_PACKAGE, null)
        val className = prefs.getString(KEY_LAST_CLASS, null)

        if (packageName != null && className != null) {
            // Check if app is still installed
            if (isAppInstalled(packageName)) {
                return ComponentName(packageName, className)
            } else {
                Log.w("LMS", "Last media app not installed: $packageName")
                clearLastMediaSource()
            }
        }

        return null
    }

    private fun isAppInstalled(packageName: String): Boolean {
        return try {
            context.packageManager.getPackageInfo(packageName, 0)
            true
        } catch (e: PackageManager.NameNotFoundException) {
            false
        }
    }

    fun clearLastMediaSource() {
        prefs.edit().clear().apply()
    }

    // Auto-resume settings
    fun setAutoResumeEnabled(enabled: Boolean) {
        prefs.edit().putBoolean(KEY_AUTO_RESUME, enabled).apply()
    }

    fun isAutoResumeEnabled(): Boolean {
        return prefs.getBoolean(KEY_AUTO_RESUME, true)  // Default: true
    }

    // Check last played time
    fun getLastPlayedTime(): Long {
        return prefs.getLong(KEY_LAST_TIMESTAMP, 0)
    }
}

// Usage in CarMediaService
class CarMediaServiceImpl {
    private lateinit var lmsManager: LastMediaSourceManager

    fun onIgnitionOn() {
        // 1. Restore LMS
        val lastSource = lmsManager.getLastMediaSource()

        if (lastSource != null) {
            // 2. Set media source
            carMediaManager.setMediaSource(
                lastSource,
                CarMediaManager.MEDIA_SOURCE_MODE_PLAYBACK
            )

            // 3. Check auto-resume
            if (lmsManager.isAutoResumeEnabled()) {
                // Auto play after delay
                Handler(Looper.getMainLooper()).postDelayed({
                    resumePlayback(lastSource)
                }, 2000)  // Wait 2 seconds (boot stabilization)
            }
        } else {
            // Fallback: Default radio app
            setDefaultMediaSource()
        }
    }

    private fun resumePlayback(componentName: ComponentName) {
        // Play command via MediaController
        val mediaController = getActiveMediaController()
        mediaController?.transportControls?.play()
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üîÑ Boot Sequence</h3>
            <div class="code-block">
                <pre><code># AAOS boot media restoration timing

1. System Server Start (0-5 seconds)
   ‚îî‚îÄ CarService initialization
      ‚îî‚îÄ CarMediaService initialization
         ‚îî‚îÄ Load Last Media Source

2. Package Manager Ready (5-10 seconds)
   ‚îî‚îÄ Check installed apps list
   ‚îî‚îÄ Verify if LMS app is installed

3. Boot Complete (10-15 seconds)
   ‚îî‚îÄ CarMediaService.onBootComplete()
   ‚îî‚îÄ setMediaSource(lastSource)
   ‚îî‚îÄ Start MediaBrowserService binding

4. Media Session Ready (15-20 seconds)
   ‚îî‚îÄ MediaSession creation complete
   ‚îî‚îÄ Check auto-resume setting
      ‚îî‚îÄ Send play() command (or wait)

5. Audio Focus Acquired (20-22 seconds)
   ‚îî‚îÄ requestAudioFocus()
   ‚îî‚îÄ Actual playback starts

# Notes:
# - Playback attempts too early may fail due to audio system not ready
# - Recommend 2-3 second delay before playback
# - Some steps may be delayed based on Power Policy</code></pre>
            </div>
        </section>

        <!-- Section 9: UX Restrictions -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">9</span>
                UX Restrictions (Driving Restrictions)
            </h2>
            <p class="section-description">
                UI/UX restrictions for driving safety and implementation methods.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö†Ô∏è</span>
                        Restricted Items
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>List Length</strong>: Maximum 6-12 items</li>
                            <li><strong>Text Input</strong>: Blocked while driving</li>
                            <li><strong>Video Playback</strong>: Blocked on driver display</li>
                            <li><strong>Complex UI</strong>: Simplified interface only</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöó</span>
                        Driving State
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>PARKED</strong>: All features allowed</li>
                            <li><strong>IDLING</strong>: Most allowed</li>
                            <li><strong>MOVING</strong>: Restrictions applied</li>
                            <li><strong>UNKNOWN</strong>: Restricted for safety</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîß</span>
                        Implementation
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Use CarUxRestrictionsManager</li>
                            <li>Detect state changes via listener</li>
                            <li>Dynamic UI adjustment</li>
                            <li>CDD policy compliance</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üö¶ CarUxRestrictions Implementation</h3>
            <div class="code-block">
                <pre><code>// UI restrictions implementation while driving
class UxRestrictionsHandler(private val context: Context) {
    private lateinit var carUxRestrictionsManager: CarUxRestrictionsManager
    private var currentRestrictions: CarUxRestrictions? = null

    fun initialize() {
        val car = Car.createCar(context)
        carUxRestrictionsManager = car.getCarManager(
            Car.CAR_UX_RESTRICTION_SERVICE
        ) as CarUxRestrictionsManager

        // Register UX Restrictions change listener
        carUxRestrictionsManager.registerListener(restrictionsListener)

        // Get current restrictions
        currentRestrictions = carUxRestrictionsManager.currentCarUxRestrictions
    }

    private val restrictionsListener =
        CarUxRestrictionsManager.OnUxRestrictionsChangedListener { restrictions ->
            currentRestrictions = restrictions

            Log.d("UxRestrictions", "Active restrictions: ${restrictions.activeRestrictions}")

            // Update UI
            updateUIBasedOnRestrictions(restrictions)
        }

    private fun updateUIBasedOnRestrictions(restrictions: CarUxRestrictions) {
        // 1. Limit list length
        val maxListItems = restrictions.maxContentDepth
        if (maxListItems > 0) {
            limitListSize(maxListItems)
        }

        // 2. Restrict text input
        if (restrictions.isRequiresDistractionOptimization) {
            disableTextInput()
        } else {
            enableTextInput()
        }

        // 3. Restrict video playback
        if (restrictions.activeRestrictions and CarUxRestrictions.UX_RESTRICTIONS_NO_VIDEO != 0) {
            pauseVideoPlayback()
        }

        // 4. Hide complex UI
        if (restrictions.activeRestrictions and CarUxRestrictions.UX_RESTRICTIONS_NO_SETUP != 0) {
            hideComplexUI()
        }
    }

    fun isDrivingMode(): Boolean {
        return currentRestrictions?.isRequiresDistractionOptimization ?: false
    }

    fun getMaxListItems(): Int {
        return currentRestrictions?.maxContentDepth ?: 12
    }

    fun canShowTextInput(): Boolean {
        val restrictions = currentRestrictions?.activeRestrictions ?: 0
        return restrictions and CarUxRestrictions.UX_RESTRICTIONS_NO_KEYBOARD == 0
    }

    fun release() {
        carUxRestrictionsManager.unregisterListener()
    }
}

// Applying UX Restrictions in MediaBrowserService
override fun onLoadChildren(
    parentId: String,
    result: Result&lt;List&lt;MediaBrowserCompat.MediaItem&gt;&gt;
) {
    result.detach()

    Thread {
        val allItems = loadAllMediaItems(parentId)

        // Limit list size based on UX Restrictions
        val maxItems = uxRestrictionsHandler.getMaxListItems()
        val limitedItems = allItems.take(maxItems)

        result.sendResult(limitedItems)
    }.start()
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìã UX Restrictions Flags</h3>
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Flag</th>
                            <th>Meaning</th>
                            <th>Response</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>UX_RESTRICTIONS_NO_DIALPAD</code></td>
                            <td>Dialpad use prohibited</td>
                            <td>Disable dial UI</td>
                        </tr>
                        <tr>
                            <td><code>UX_RESTRICTIONS_NO_FILTERING</code></td>
                            <td>Search/filtering prohibited</td>
                            <td>Hide search function</td>
                        </tr>
                        <tr>
                            <td><code>UX_RESTRICTIONS_LIMIT_STRING_LENGTH</code></td>
                            <td>Text length limited</td>
                            <td>Truncate long text (...)</td>
                        </tr>
                        <tr>
                            <td><code>UX_RESTRICTIONS_NO_KEYBOARD</code></td>
                            <td>Keyboard input prohibited</td>
                            <td>Disable text input fields</td>
                        </tr>
                        <tr>
                            <td><code>UX_RESTRICTIONS_NO_VIDEO</code></td>
                            <td>Video playback prohibited</td>
                            <td>Pause video, audio only</td>
                        </tr>
                        <tr>
                            <td><code>UX_RESTRICTIONS_LIMIT_CONTENT</code></td>
                            <td>Content count limited</td>
                            <td>Use maxContentDepth value</td>
                        </tr>
                        <tr>
                            <td><code>UX_RESTRICTIONS_NO_SETUP</code></td>
                            <td>Settings screen prohibited</td>
                            <td>Disable settings menu</td>
                        </tr>
                        <tr>
                            <td><code>UX_RESTRICTIONS_NO_TEXT_MESSAGE</code></td>
                            <td>Text messaging read/write prohibited</td>
                            <td>Block messaging features</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 10: Android Auto vs AAOS -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">10</span>
                Android Auto vs AAOS Comparison
            </h2>
            <p class="section-description">
                Differences between Android Auto (projection) and Android Automotive OS (native).
            </p>

            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Android Auto</th>
                            <th>Android Automotive OS (AAOS)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Execution Environment</td>
                            <td>Smartphone (projection)</td>
                            <td>Vehicle embedded system</td>
                        </tr>
                        <tr>
                            <td>Connection Method</td>
                            <td>USB cable or wireless</td>
                            <td>Standalone (no connection needed)</td>
                        </tr>
                        <tr>
                            <td>OS</td>
                            <td>Phone's Android OS</td>
                            <td>Vehicle's Android OS (AOSP-based)</td>
                        </tr>
                        <tr>
                            <td>App Installation Location</td>
                            <td>Smartphone</td>
                            <td>Vehicle system</td>
                        </tr>
                        <tr>
                            <td>Media Service</td>
                            <td>MediaBrowserService (phone)</td>
                            <td>MediaBrowserService (vehicle) + CarMediaService</td>
                        </tr>
                        <tr>
                            <td>Audio Routing</td>
                            <td>Phone ‚Üí Vehicle audio system (Bluetooth/USB)</td>
                            <td>CarAudioService (native HAL)</td>
                        </tr>
                        <tr>
                            <td>UI Rendering</td>
                            <td>Rendered on phone, then transmitted</td>
                            <td>Rendered directly on vehicle</td>
                        </tr>
                        <tr>
                            <td>Performance</td>
                            <td>Depends on phone performance, possible latency</td>
                            <td>High performance (native)</td>
                        </tr>
                        <tr>
                            <td>Multi-zone Audio</td>
                            <td>Not supported</td>
                            <td>Supported (driver/rear independent)</td>
                        </tr>
                        <tr>
                            <td>Vehicle Data Access</td>
                            <td>Limited (template API only)</td>
                            <td>Full access (Vehicle HAL)</td>
                        </tr>
                        <tr>
                            <td>Google Services</td>
                            <td>Phone's Google Play Services</td>
                            <td>GAS (Google Automotive Services)</td>
                        </tr>
                        <tr>
                            <td>App Development</td>
                            <td>Media App Template (limited)</td>
                            <td>Full Android App (flexible)</td>
                        </tr>
                        <tr>
                            <td>Distribution</td>
                            <td>Google Play Store</td>
                            <td>Google Play Store (Automotive)</td>
                        </tr>
                        <tr>
                            <td>Use Case</td>
                            <td>Existing vehicles (aftermarket)</td>
                            <td>New vehicles (OEM integration)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph AA["Android Auto (Projection)"]
                    PHONE[Smartphone]
                    AA_APP[Media App]
                    AA_FW[Android Framework]

                    AA_APP --> AA_FW
                    AA_FW --> PHONE
                    end

                    subgraph VEHICLE_AA["Vehicle (Display Only)"]
                    CAR_DISPLAY[Car Display]
                    CAR_AUDIO[Car Audio System]
                    end

                    PHONE -->|USB/Wireless| CAR_DISPLAY
                    PHONE -->|Bluetooth/USB Audio| CAR_AUDIO

                    subgraph AAOS["Android Automotive OS"]
                    CAR_OS[Android OS<br />(Embedded)]
                    CAR_APPS[Media Apps<br />(Native)]
                    CAR_SERVICE[CarService<br />CarMediaService<br />CarAudioService]
                    VEHICLE_HAL[Vehicle HAL]

                    CAR_APPS --> CAR_SERVICE
                    CAR_SERVICE --> CAR_OS
                    CAR_OS --> VEHICLE_HAL
                    end

                    style AA fill:#e3f2fd
                    style AAOS fill:#f3e5f5
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üì± App Development Differences</h3>
            <div class="code-block">
                <pre><code>// Android Auto: Template-based (limited)
// AndroidManifest.xml
&lt;application&gt;
    &lt;service android:name=".MyMediaBrowserService"
             android:exported="true"&gt;
        &lt;intent-filter&gt;
            &lt;action android:name="android.media.browse.MediaBrowserService"/&gt;
        &lt;/intent-filter&gt;
    &lt;/service&gt;
&lt;/application&gt;

// - Only template APIs available
// - No custom UI
// - Limited vehicle data access

// ========================================

// AAOS: Full Android (flexible)
// AndroidManifest.xml
&lt;application&gt;
    &lt;!-- Same as regular Android app --&gt;
    &lt;activity android:name=".MainActivity"
              android:exported="true"&gt;
        &lt;intent-filter&gt;
            &lt;action android:name="android.intent.action.MAIN"/&gt;
            &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
        &lt;/intent-filter&gt;
    &lt;/activity&gt;

    &lt;service android:name=".MyMediaBrowserService"
             android:exported="true"&gt;
        &lt;intent-filter&gt;
            &lt;action android:name="android.media.browse.MediaBrowserService"/&gt;
        &lt;/intent-filter&gt;
    &lt;/service&gt;

    &lt;!-- CarService available --&gt;
    &lt;uses-library android:name="android.car" android:required="false"/&gt;
&lt;/application&gt;

// - Custom UI possible
// - Use CarService API
// - Vehicle HAL access (permission required)
// - Multi-zone audio control</code></pre>
            </div>
        </section>

        <!-- Section 11: Volume Groups -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">11</span>
                Volume Groups
            </h2>
            <p class="section-description">
                CarAudioService's context-based volume group management system.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîä</span>
                        Volume Group Concept
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Grouping</strong>: Audio contexts bundled into groups</li>
                            <li><strong>Independent Control</strong>: Independent volume per group</li>
                            <li><strong>Zone-specific Settings</strong>: Different groups per Zone</li>
                            <li><strong>Device Mapping</strong>: Group ‚Üí Physical output</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéöÔ∏è</span>
                        Common Groups
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Group 0</strong>: Media, Game</li>
                            <li><strong>Group 1</strong>: Navigation</li>
                            <li><strong>Group 2</strong>: Voice Call</li>
                            <li><strong>Group 3</strong>: Alarm, Notification</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Configuration File
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>car_audio_configuration.xml</li>
                            <li>Zone and VolumeGroup definitions</li>
                            <li>Context ‚Üí Group mapping</li>
                            <li>Device Address assignment</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìã Volume Groups Configuration Example</h3>
            <div class="code-block">
                <pre><code>&lt;!-- car_audio_configuration.xml: Volume groups configuration --&gt;
&lt;carAudioConfiguration version="2"&gt;
    &lt;!-- Zone 0: Driver --&gt;
    &lt;zone name="primary zone" audioZoneId="0" isPrimary="true"&gt;
        &lt;volumeGroups&gt;
            &lt;!-- Group 0: Media & Game --&gt;
            &lt;group&gt;
                &lt;device address="bus0_media_out"&gt;
                    &lt;context context="music"/&gt;
                    &lt;context context="game"/&gt;
                &lt;/device&gt;
            &lt;/group&gt;

            &lt;!-- Group 1: Navigation --&gt;
            &lt;group&gt;
                &lt;device address="bus1_navigation_out"&gt;
                    &lt;context context="navigation"/&gt;
                &lt;/device&gt;
            &lt;/group&gt;

            &lt;!-- Group 2: Voice Call --&gt;
            &lt;group&gt;
                &lt;device address="bus2_call_out"&gt;
                    &lt;context context="call"/&gt;
                    &lt;context context="call_ring"/&gt;
                &lt;/device&gt;
            &lt;/group&gt;

            &lt;!-- Group 3: Notification --&gt;
            &lt;group&gt;
                &lt;device address="bus3_notification_out"&gt;
                    &lt;context context="alarm"/&gt;
                    &lt;context context="notification"/&gt;
                &lt;/device&gt;
            &lt;/group&gt;
        &lt;/volumeGroups&gt;
    &lt;/zone&gt;

    &lt;!-- Zone 1: Rear --&gt;
    &lt;zone name="rear seat zone" audioZoneId="1"&gt;
        &lt;volumeGroups&gt;
            &lt;!-- Rear has Media only --&gt;
            &lt;group&gt;
                &lt;device address="bus100_rear_media_out"&gt;
                    &lt;context context="music"/&gt;
                    &lt;context context="game"/&gt;
                &lt;/device&gt;
            &lt;/group&gt;
        &lt;/volumeGroups&gt;
    &lt;/zone&gt;
&lt;/carAudioConfiguration&gt;</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üéõÔ∏è Volume Groups API Usage</h3>
            <div class="code-block">
                <pre><code>// Controlling volume groups with CarAudioManager
class VolumeGroupController(private val context: Context) {
    private lateinit var carAudioManager: CarAudioManager

    fun initialize() {
        val car = Car.createCar(context)
        carAudioManager = car.getCarManager(Car.AUDIO_SERVICE) as CarAudioManager
    }

    fun getVolumeGroupInfo(zoneId: Int) {
        // Get all volume groups for Zone
        val groupCount = carAudioManager.getVolumeGroupCount(zoneId)

        for (groupId in 0 until groupCount) {
            val currentVolume = carAudioManager.getGroupVolume(zoneId, groupId)
            val maxVolume = carAudioManager.getGroupMaxVolume(zoneId, groupId)
            val minVolume = carAudioManager.getGroupMinVolume(zoneId, groupId)

            Log.d("VolumeGroup", "Zone $zoneId, Group $groupId:")
            Log.d("VolumeGroup", "  Current: $currentVolume")
            Log.d("VolumeGroup", "  Range: $minVolume - $maxVolume")
        }
    }

    fun setMediaVolume(zoneId: Int, volume: Int) {
        // Media is typically Group 0
        val mediaGroupId = 0
        carAudioManager.setGroupVolume(zoneId, mediaGroupId, volume, 0)
    }

    fun setNavigationVolume(zoneId: Int, volume: Int) {
        // Navigation is typically Group 1
        val navGroupId = 1
        carAudioManager.setGroupVolume(zoneId, navGroupId, volume, 0)
    }

    // Find volume group by Usage
    fun getVolumeGroupForUsage(zoneId: Int, usage: Int): Int {
        return carAudioManager.getVolumeGroupIdForUsage(zoneId, usage)
    }

    fun adjustMediaVolumeUp(zoneId: Int) {
        val mediaGroupId = 0
        val currentVolume = carAudioManager.getGroupVolume(zoneId, mediaGroupId)
        val maxVolume = carAudioManager.getGroupMaxVolume(zoneId, mediaGroupId)

        if (currentVolume < maxVolume) {
            carAudioManager.setGroupVolume(zoneId, mediaGroupId, currentVolume + 1, 0)
        }
    }

    fun adjustMediaVolumeDown(zoneId: Int) {
        val mediaGroupId = 0
        val currentVolume = carAudioManager.getGroupVolume(zoneId, mediaGroupId)
        val minVolume = carAudioManager.getGroupMinVolume(zoneId, mediaGroupId)

        if (currentVolume > minVolume) {
            carAudioManager.setGroupVolume(zoneId, mediaGroupId, currentVolume - 1, 0)
        }
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìä AudioContext ‚Üí VolumeGroup Mapping</h3>
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Audio Context</th>
                            <th>Usage</th>
                            <th>Typical Group ID</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>music</td>
                            <td>USAGE_MEDIA</td>
                            <td>Group 0</td>
                            <td>Music, podcasts</td>
                        </tr>
                        <tr>
                            <td>game</td>
                            <td>USAGE_GAME</td>
                            <td>Group 0</td>
                            <td>Game audio</td>
                        </tr>
                        <tr>
                            <td>navigation</td>
                            <td>USAGE_ASSISTANCE_NAVIGATION_GUIDANCE</td>
                            <td>Group 1</td>
                            <td>Navigation guidance</td>
                        </tr>
                        <tr>
                            <td>call</td>
                            <td>USAGE_VOICE_COMMUNICATION</td>
                            <td>Group 2</td>
                            <td>Phone calls</td>
                        </tr>
                        <tr>
                            <td>call_ring</td>
                            <td>USAGE_NOTIFICATION_RINGTONE</td>
                            <td>Group 2</td>
                            <td>Phone ringtone</td>
                        </tr>
                        <tr>
                            <td>alarm</td>
                            <td>USAGE_ALARM</td>
                            <td>Group 3</td>
                            <td>Alarms</td>
                        </tr>
                        <tr>
                            <td>notification</td>
                            <td>USAGE_NOTIFICATION</td>
                            <td>Group 3</td>
                            <td>Notification sounds</td>
                        </tr>
                        <tr>
                            <td>system_sound</td>
                            <td>USAGE_ASSISTANCE_SONIFICATION</td>
                            <td>Group 3</td>
                            <td>System sounds</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 12: Debugging & Troubleshooting -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">12</span>
                Debugging & Troubleshooting
            </h2>
            <p class="section-description">
                Tools and methodologies for diagnosing and resolving Car Media Service issues.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîç</span>
                        Key Debugging Tools
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><code>dumpsys car_service</code></li>
                            <li><code>dumpsys media_session</code></li>
                            <li><code>dumpsys audio</code></li>
                            <li><code>adb logcat -s CarMediaService:V</code></li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö†Ô∏è</span>
                        Common Issues
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Media source not changing</li>
                            <li>LMS restoration failure</li>
                            <li>Audio Focus conflicts</li>
                            <li>Multi-zone routing issues</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üõ†Ô∏è</span>
                        Log Analysis
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Track Media Source changes</li>
                            <li>Audio Focus request/release</li>
                            <li>MediaSession state changes</li>
                            <li>Audio routing per Zone</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üîß Key dumpsys Commands</h3>
            <div class="code-block">
                <pre><code># Check CarMediaService status
adb shell dumpsys car_service --services CarMediaService

# Example output:
# Active Media Source: com.spotify.music/.MainActivity
# Last Media Source: com.spotify.music/.MainActivity
# Auto-resume: enabled
# Media Source Change History:
#   [2024-01-20 10:15:30] Spotify
#   [2024-01-20 09:45:12] Radio

# Check CarAudioService status
adb shell dumpsys car_service --services CarAudioService

# Example output:
# Audio Zones: 2
# Zone 0 (Primary):
#   Volume Groups: 4
#   Group 0 (Media): 15/25
#   Group 1 (Navigation): 20/25
#   Group 2 (Call): 18/25
#   Group 3 (Notification): 12/25
#
# Zone 1 (Rear):
#   Volume Groups: 1
#   Group 0 (Media): 10/25

# Check MediaSession status
adb shell dumpsys media_session

# Check Audio Focus status
adb shell dumpsys audio | grep -A 20 "Audio Focus"

# Full Car Service status
adb shell dumpsys car_service</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìã logcat Filtering</h3>
            <div class="code-block">
                <pre><code># CarMediaService logs only
adb logcat -s CarMediaService:V

# CarAudioService logs only
adb logcat -s CarAudioService:V

# All Media-related logs
adb logcat -s CarMediaService:V CarAudioService:V MediaSessionService:V

# Track media source changes
adb logcat | grep -i "media source"

# Track Audio Focus changes
adb logcat | grep -i "audio focus"

# Specific app's MediaSession logs
adb logcat | grep "com.spotify.music"

# Zone routing logs
adb logcat -s CarAudioService:V | grep -i "zone"</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">‚ö†Ô∏è Troubleshooting Guide</h3>
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Symptom</th>
                            <th>Possible Cause</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Media source not changing</td>
                            <td>
                                - MediaBrowserService not implemented<br />
                                - onGetRoot() returns null<br />
                                - App crash
                            </td>
                            <td>
                                - Verify MediaBrowserService implementation<br />
                                - Check onGetRoot() logs<br />
                                - Track crash in logcat
                            </td>
                        </tr>
                        <tr>
                            <td>LMS not restoring</td>
                            <td>
                                - App uninstalled<br />
                                - SharedPreferences deleted<br />
                                - Boot sequence issue
                            </td>
                            <td>
                                - Check LMS with dumpsys<br />
                                - Reinstall app<br />
                                - Analyze boot logs
                            </td>
                        </tr>
                        <tr>
                            <td>Auto-play not starting</td>
                            <td>
                                - Auto-resume disabled<br />
                                - Audio Focus not acquired<br />
                                - onPlaybackResumption() not implemented
                            </td>
                            <td>
                                - Check auto-resume settings<br />
                                - Verify Audio Focus logs<br />
                                - Validate callback implementation
                            </td>
                        </tr>
                        <tr>
                            <td>Audio Focus conflict</td>
                            <td>
                                - Interaction Matrix config error<br />
                                - Wrong Usage used<br />
                                - Focus not released
                            </td>
                            <td>
                                - Check audio_focus_configuration.xml<br />
                                - Verify AudioAttributes Usage<br />
                                - Confirm abandonAudioFocus() call
                            </td>
                        </tr>
                        <tr>
                            <td>Multi-zone audio not playing</td>
                            <td>
                                - car_audio_configuration.xml error<br />
                                - Wrong Zone ID<br />
                                - Device Address mismatch
                            </td>
                            <td>
                                - Validate XML config<br />
                                - Check Zone with dumpsys car_service<br />
                                - Verify Audio HAL logs
                            </td>
                        </tr>
                        <tr>
                            <td>Volume control not working</td>
                            <td>
                                - Wrong Volume Group ID<br />
                                - Zone ID mismatch<br />
                                - Insufficient permissions
                            </td>
                            <td>
                                - Use getVolumeGroupIdForUsage()<br />
                                - Verify Zone ID<br />
                                - Check permission (MODIFY_AUDIO_ROUTING)
                            </td>
                        </tr>
                        <tr>
                            <td>MediaBrowser connection failure</td>
                            <td>
                                - Service not exported<br />
                                - Intent Filter missing<br />
                                - Package name typo
                            </td>
                            <td>
                                - Validate AndroidManifest.xml<br />
                                - Confirm exported="true"<br />
                                - Verify ComponentName accuracy
                            </td>
                        </tr>
                        <tr>
                            <td>UX Restrictions not applying</td>
                            <td>
                                - CarUxRestrictionsManager not used<br />
                                - Listener not registered<br />
                                - Driving State detection failure
                            </td>
                            <td>
                                - Verify registerListener() call<br />
                                - Check Restrictions with dumpsys car_service<br />
                                - Analyze Vehicle HAL logs
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üîç Tracking Media Source Changes</h3>
            <div class="code-block">
                <pre><code># Real-time media source change monitoring
adb logcat -s CarMediaService:V | grep -E "setMediaSource|onMediaSourceChanged"

# Example output:
# CarMediaService: setMediaSource: com.spotify.music/.MainActivity
# CarMediaService: Updating active source
# CarMediaService: onMediaSourceChanged: com.spotify.music/.MainActivity
# CarMediaService: Saving LMS: com.spotify.music

# Track MediaSession state changes
adb logcat -s MediaSessionService:V | grep -E "PlaybackState|Metadata"

# Track Audio Focus request/release
adb logcat -s AudioManager:V | grep -E "requestAudioFocus|abandonAudioFocus"

# Track zone audio routing
adb logcat -s CarAudioService:V | grep -E "zone|routing"</code></pre>
            </div>
        </section>

        <!-- Section 13: AOSP Source Reference -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">13</span>
                AOSP Source Code Reference
            </h2>
            <p class="section-description">
                Core source code locations and key files for Car Media Service.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì∫</span>
                        CarMediaService
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>CarMediaService.java</strong></li>
                            <li>packages/services/Car/service/src/com/android/car/media/</li>
                            <li>Active Media Source management</li>
                            <li>Last Media Source save/restore</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîä</span>
                        CarAudioService
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>CarAudioService.java</strong></li>
                            <li>packages/services/Car/service/src/com/android/car/audio/</li>
                            <li>Audio Focus & Routing</li>
                            <li>Volume Groups, Multi-zone</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöó</span>
                        Car API
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>CarMediaManager.java</strong></li>
                            <li>packages/services/Car/car-lib/src/android/car/media/</li>
                            <li>Public API for apps</li>
                            <li>MediaSource management</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üìÇ Key Directory Structure</h3>
            <div class="code-block">
                <pre><code># CarMediaService source
packages/services/Car/service/src/com/android/car/media/
‚îú‚îÄ‚îÄ CarMediaService.java                # Main service
‚îú‚îÄ‚îÄ MediaSourceChangedListener.java     # Listener interface
‚îî‚îÄ‚îÄ PlaybackState.java                  # Playback state management

# CarAudioService source
packages/services/Car/service/src/com/android/car/audio/
‚îú‚îÄ‚îÄ CarAudioService.java                # Main audio service
‚îú‚îÄ‚îÄ CarAudioZone.java                   # Zone management
‚îú‚îÄ‚îÄ CarVolumeGroup.java                 # Volume Group
‚îú‚îÄ‚îÄ CarAudioFocus.java                  # Audio Focus management
‚îú‚îÄ‚îÄ CarAudioContext.java                # Audio Context definitions
‚îú‚îÄ‚îÄ FocusInteraction.java               # Interaction Matrix
‚îî‚îÄ‚îÄ CarAudioPlaybackCallback.java       # Playback callback

# Car API (Public)
packages/services/Car/car-lib/src/android/car/media/
‚îú‚îÄ‚îÄ CarMediaManager.java                # Media Manager API
‚îú‚îÄ‚îÄ MediaSourceChangedListener.java     # Public listener
‚îî‚îÄ‚îÄ PlaybackStateCallback.java          # Playback state callback

packages/services/Car/car-lib/src/android/car/
‚îî‚îÄ‚îÄ CarAudioManager.java                # Audio Manager API

# XML configuration files
hardware/[vendor]/[device]/audio/
‚îú‚îÄ‚îÄ car_audio_configuration.xml         # Audio Zone and Volume Groups
‚îî‚îÄ‚îÄ audio_focus_configuration.xml       # Focus Interaction Matrix

# UX Restrictions
packages/services/Car/service/src/com/android/car/uxr/
‚îî‚îÄ‚îÄ CarUxRestrictionsManagerService.java

# Vehicle HAL
hardware/interfaces/automotive/vehicle/
‚îî‚îÄ‚îÄ 2.0/
    ‚îî‚îÄ‚îÄ IVehicle.hal                    # Vehicle interface</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üîç Key Class Details</h3>
            <div class="code-block">
                <pre><code>// CarMediaService.java - Core methods
public class CarMediaService extends ICarMedia.Stub {
    // Set Active Media Source
    public void setMediaSource(ComponentName componentName, int mode);

    // Get current Media Source
    public ComponentName getMediaSource();

    // Get Last Media Source
    public List&lt;ComponentName&gt; getLastMediaSources(int mode);

    // Register listener
    public void addMediaSourceListener(IMediaSourceListener listener);

    // Remove listener
    public void removeMediaSourceListener(IMediaSourceListener listener);
}

// CarAudioService.java - Core methods
public class CarAudioService extends ICarAudio.Stub {
    // Zone Volume control
    public void setGroupVolume(int zoneId, int groupId, int index, int flags);
    public int getGroupVolume(int zoneId, int groupId);
    public int getGroupMaxVolume(int zoneId, int groupId);

    // Volume Group query
    public int getVolumeGroupCount(int zoneId);
    public int getVolumeGroupIdForUsage(int zoneId, int usage);

    // Audio Focus management
    public int requestAudioFocusForUsage(int usage, int zoneId, int focusGain);
    public void abandonAudioFocusForUsage(int usage, int zoneId);

    // Zone information
    public int[] getAudioZoneIds();
    public boolean isAudioFeatureEnabled(int feature);
}

// CarAudioZone.java - Zone management
public class CarAudioZone {
    private final int mId;
    private final String mName;
    private final List&lt;CarVolumeGroup&gt; mVolumeGroups;

    public int getId();
    public String getName();
    public List&lt;CarVolumeGroup&gt; getVolumeGroups();
    public CarVolumeGroup getVolumeGroup(int groupId);
}

// CarVolumeGroup.java - Volume Group
public class CarVolumeGroup {
    private final int mId;
    private final int mZoneId;
    private final SparseArray&lt;String&gt; mContextToAddress;  // Context ‚Üí Device Address

    public int getId();
    public void setCurrentGainIndex(int gainIndex);
    public int getCurrentGainIndex();
    public int getMaxGainIndex();
    public int getMinGainIndex();
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); margin: 30px 0 20px 0; font-size: 1.5rem;">üåê Useful AOSP Links</h3>
            <div class="code-block">
                <pre><code># CarMediaService source
https://cs.android.com/android/platform/superproject/main/+/main:packages/services/Car/service/src/com/android/car/media/

# CarAudioService source
https://cs.android.com/android/platform/superproject/main/+/main:packages/services/Car/service/src/com/android/car/audio/

# Car API (Public)
https://cs.android.com/android/platform/superproject/main/+/main:packages/services/Car/car-lib/src/android/car/media/

# AAOS official documentation
https://source.android.com/docs/automotive

# Car Audio documentation
https://source.android.com/docs/automotive/audio

# UX Restrictions
https://source.android.com/docs/automotive/hmi/ux-restrictions</code></pre>
            </div>
        </section>

        <!-- Section 14: Related Documentation -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">14</span>
                Related Documentation
            </h2>
            <p class="section-description">
                Other key documentation and resources related to Car Media Service.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîä</span>
                        <a href="audio-framework.html" style="color: inherit; text-decoration: none;">
                            Audio Framework
                        </a>
                    </h3>
                    <div class="card-description">
                        Integration of AudioFlinger, AudioPolicyService, Audio HAL with CarAudioService
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéµ</span>
                        <a href="mediasession.html" style="color: inherit; text-decoration: none;">
                            MediaSession
                        </a>
                    </h3>
                    <div class="card-description">
                        MediaSession framework and CarMediaService Active Source management integration
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöó</span>
                        <a href="aaos.html" style="color: inherit; text-decoration: none;">
                            Android Automotive OS
                        </a>
                    </h3>
                    <div class="card-description">
                        AAOS overall architecture, CarService, Vehicle HAL integration
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üé¨</span>
                        <a href="media-playback.html" style="color: inherit; text-decoration: none;">
                            Media Playback Pipeline
                        </a>
                    </h3>
                    <div class="card-description">
                        MediaPlayer, ExoPlayer and CarAudioService audio routing pipeline
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîã</span>
                        <a href="power-policy-suspend.html" style="color: inherit; text-decoration: none;">
                            Power Policy & Suspend
                        </a>
                    </h3>
                    <div class="card-description">
                        Vehicle power management, Deep Sleep and Last Media Source restoration timing
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéØ</span>
                        <a href="aaos-last-media.html" style="color: inherit; text-decoration: none;">
                            Last Media Source & Autoplay
                        </a>
                    </h3>
                    <div class="card-description">
                        Detailed LMS mechanism, autoplay policies, user settings
                    </div>
                </div>
            </div>

            <div class="highlight-box" style="margin-top: 30px;">
                <strong>Additional Resources:</strong> Android official documentation
                <a href="https://source.android.com/docs/automotive" target="_blank"
                   style="color: var(--accent-primary);">AOSP Automotive</a>,
                <a href="https://source.android.com/docs/automotive/audio" target="_blank"
                   style="color: var(--accent-primary);">Car Audio System</a>
            </div>
        </section>

        <!-- Footer -->
        <footer
            style="text-align: center; padding: 40px 20px; color: var(--text-muted); border-top: 1px solid var(--border-color); margin-top: 60px;">
            <p>Android Automotive OS Media Architecture</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                CarMediaService & CarAudioService Deep Dive
            </p>
            <p style="margin-top: 20px;">
                <a href="index.html" style="color: var(--accent-car); text-decoration: none;">
                    ‚Üê Back to AOSP Media Framework
                </a>
            </p>
        </footer>
    </div>

    <script src="../scripts/mermaid-theme.js"></script>
    <script>
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.section').forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(30px)';
            section.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
            observer.observe(section);
        });
    </script>
    <!-- Navigation & Copy Features -->
    <script src="../scripts/copy-code.js"></script>
    <script src="../scripts/toc-generator.js"></script>
    <script src="../scripts/page-navigation.js"></script>
    <!-- Interactive Diagram Features -->
    <script src="../scripts/diagram-data.js"></script>
    <script src="../scripts/diagram-data-en-partial.js"></script>
    <script src="../scripts/diagram-interactive.js"></script>

    <script src="../scripts/theme-toggle.js"></script>
    <script src="../scripts/lang-switch.js"></script>
</body>

</html>
