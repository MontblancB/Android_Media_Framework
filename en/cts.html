<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google CTS Testing Framework</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=IBM+Plex+Mono:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/design-system.css">

        <style>
        /* Page-specific styles loaded from design-system.css */
    </style>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-button">
            ‚Üê AOSP Media Framework
        </a>
    </nav>

    <div class="container">
        <header>
            <h1 class="page-title">‚úÖ Google CTS</h1>
            <p class="page-subtitle">Android Compatibility Test Suite</p>
        </header>

        <!-- Section 1: Overview -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">1</span>
                Overview: What is CTS?
            </h2>
            <p class="section-description">
                CTS (Compatibility Test Suite) is a free testing tool that verifies whether Android devices meet platform compatibility requirements.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéØ</span>
                        Key Objectives
                    </h3>
                    <div class="card-description">
                        <p><strong>Ensuring Platform Compatibility</strong></p>
                        <ul>
                            <li>Ensures consistent app behavior</li>
                            <li>Verifies accurate Android API implementation</li>
                            <li>Early detection of incompatibilities</li>
                            <li>Required for GMS certification</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìã</span>
                        Compatibility Requirements
                    </h3>
                    <div class="card-description">
                        <p><strong>Android Compatible Device Conditions</strong></p>
                        <ul>
                            <li>CDD (Compatibility Definition Document) compliance</li>
                            <li>Pass all CTS tests</li>
                            <li>Run on User Build</li>
                            <li>Test all ABIs when supporting multiple ABIs</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîß</span>
                        Test Framework
                    </h3>
                    <div class="card-description">
                        <p><strong>Automated Test Harness</strong></p>
                        <ul>
                            <li>Test Harness runs on desktop</li>
                            <li>Test Cases run on device</li>
                            <li>JUnit-based Java tests</li>
                            <li>Packaged as APK</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì±</span>
                        GMS Certification
                    </h3>
                    <div class="card-description">
                        <p><strong>Google Mobile Services</strong></p>
                        <ul>
                            <li>Pre-installed Play Store, Gmail, YouTube</li>
                            <li>CTS pass required</li>
                            <li>Required for commercial devices</li>
                            <li>Consistent user experience</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Test Categories -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">2</span>
                CTS Test Categories
            </h2>
            <p class="section-description">
                CTS includes a wide range of tests covering various areas of the Android platform.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    CTS[CTS Test Suite]

                    CTS --> API[API Compatibility<br />Testing]
                    CTS --> SYSTEM[System Behavior<br />Testing]
                    CTS --> HW[Hardware Functionality<br />Testing]
                    CTS --> UI[User Interface<br />Testing]
                    CTS --> APP[Application Compatibility<br />Testing]
                    CTS --> NET[Network & Connectivity<br />Testing]

                    API --> API1[Signature Tests]
                    API --> API2[Platform API Tests]
                    API --> API3[Core Libraries]

                    SYSTEM --> SYS1[Power Management]
                    SYSTEM --> SYS2[Memory Management]
                    SYSTEM --> SYS3[Process Lifecycle]

                    HW --> HW1[Camera]
                    HW --> HW2[Sensors]
                    HW --> HW3[Audio/Video]

                    UI --> UI1[Layout & Navigation]
                    UI --> UI2[Touchscreen]
                    UI --> UI3[Input Devices]

                    APP --> APP1[Third-party Apps]
                    APP --> APP2[Screen Sizes]
                    APP --> APP3[Resolutions]

                    NET --> NET1[Wi-Fi]
                    NET --> NET2[Bluetooth]
                    NET --> NET3[Mobile Networks]

                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üìä Test Types
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üî¨</span>
                        Unit Tests
                    </h3>
                    <div class="card-description">
                        <p><strong>Atomic Code Unit Verification</strong></p>
                        <ul>
                            <li>Single class testing</li>
                            <li>Method behavior verification</li>
                            <li>Error handling validation</li>
                            <li>Runs in isolated environment</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Functional Tests
                    </h3>
                    <div class="card-description">
                        <p><strong>API Combination Testing</strong></p>
                        <ul>
                            <li>High-level use cases</li>
                            <li>API interactions</li>
                            <li>Integration scenarios</li>
                            <li>Real-world usage patterns</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üí™</span>
                        Robustness Tests
                    </h3>
                    <div class="card-description">
                        <p><strong>System Durability Evaluation</strong></p>
                        <ul>
                            <li>Stress testing</li>
                            <li>Exception handling</li>
                            <li>Resource shortage scenarios</li>
                            <li>Long-term stability</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö°</span>
                        Performance Tests
                    </h3>
                    <div class="card-description">
                        <p><strong>Performance Benchmarks</strong></p>
                        <ul>
                            <li>FPS rendering measurement</li>
                            <li>Response time verification</li>
                            <li>Throughput evaluation</li>
                            <li>Meeting performance criteria</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Media CTS Tests -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Media CTS Tests
            </h2>
            <p class="section-description">
                This section describes CTS tests for media framework components such as MediaCodec, MediaExtractor, and MediaPlayer.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 20px;">
                üé¨ MediaCodec CTS
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéØ</span>
                        Codec Functionality Tests
                    </h3>
                    <div class="card-description">
                        <p><strong>Encoding/Decoding Verification</strong></p>
                        <ul>
                            <li>Test all codecs in MediaCodecList</li>
                            <li>Various resolutions (720p, QCIF, QVGA)</li>
                            <li>Profile and level support</li>
                            <li>Color format handling</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ö°</span>
                        Performance & Capabilities
                    </h3>
                    <div class="card-description">
                        <p><strong>MediaCodecCapabilities Verification</strong></p>
                        <ul>
                            <li>Supported resolution range</li>
                            <li>Bitrate range</li>
                            <li>Framerate range</li>
                            <li>Performance class requirements</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÑ</span>
                        Asynchronous Mode
                    </h3>
                    <div class="card-description">
                        <p><strong>Callback-based Processing</strong></p>
                        <ul>
                            <li>onInputBufferAvailable</li>
                            <li>onOutputBufferAvailable</li>
                            <li>onError handling</li>
                            <li>onOutputFormatChanged</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìπ</span>
                        Test Vectors
                    </h3>
                    <div class="card-description">
                        <p><strong>Standard Media Files</strong></p>
                        <ul>
                            <li>Big Buck Bunny (8-bit)</li>
                            <li>Cosmos Laundromat (10-bit)</li>
                            <li>Various codecs and formats</li>
                            <li>Automatic download</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üì¶ MediaExtractor CTS
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìÇ</span>
                        Data Source Handling
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>File Path</li>
                            <li>HTTP URL</li>
                            <li>FileDescriptor</li>
                            <li>MediaDataSource</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéµ</span>
                        Track Selection & Format
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Track count verification</li>
                            <li>MediaFormat info validation</li>
                            <li>MIME type verification</li>
                            <li>Track selection/deselection</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Sample Extraction
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Sample data reading</li>
                            <li>Presentation Time verification</li>
                            <li>Track index verification</li>
                            <li>Flags (SYNC, ENCRYPTED)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîí</span>
                        DRM Support
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>PSSH info extraction</li>
                            <li>Encrypted sample handling</li>
                            <li>DRM scheme verification</li>
                            <li>Protected content testing</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                ‚ñ∂Ô∏è MediaPlayer CTS
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÑ</span>
                        Lifecycle Management
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>create() ‚Üí start() ‚Üí pause()</li>
                            <li>stop() ‚Üí reset() ‚Üí release()</li>
                            <li>State transition verification</li>
                            <li>Invalid state handling</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéÆ</span>
                        Playback Control
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>start/pause/stop</li>
                            <li>seekTo() accuracy</li>
                            <li>Playback speed control</li>
                            <li>Looping functionality</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üé≠</span>
                        A/V Synchronization
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Audio-video sync</li>
                            <li>Lip-sync tolerance</li>
                            <li>Timestamp accuracy</li>
                            <li>Drift correction</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì¢</span>
                        Event Handling
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>OnCompletionListener</li>
                            <li>OnErrorListener</li>
                            <li>OnSeekCompleteListener</li>
                            <li>OnInfoListener</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: xTS Comparison -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">4</span>
                xTS Comparison: CTS vs VTS vs GTS
            </h2>
            <p class="section-description">
                A comparison of three major test suites used in the Android certification process.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    subgraph CTS_BOX ["CTS - Compatibility Test Suite"]
                    CTS_DESC[Platform Compatibility<br />Framework APIs<br />App Compatibility]
                    end

                    subgraph VTS_BOX ["VTS - Vendor Test Suite"]
                    VTS_DESC[HAL Implementation<br />Kernel Tests<br />Hardware Compatibility]
                    end

                    subgraph GTS_BOX ["GTS - GMS Test Suite"]
                    GTS_DESC[GMS App Compatibility<br />Google Play Services<br />Multimedia Performance]
                    end

                    DEVICE[Android Device] --> CTS_BOX
                    DEVICE --> VTS_BOX
                    DEVICE --> GTS_BOX

                    CTS_BOX --> CERT[GMS Certification]
                    VTS_BOX --> CERT
                    GTS_BOX --> CERT

                    CERT --> GMS[Google Mobile Services<br />Play Store, Gmail, YouTube]

                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚úÖ</span>
                        CTS
                    </h3>
                    <div class="card-description">
                        <p><strong>Compatibility Test Suite</strong></p>
                        <ul>
                            <li><strong>Purpose</strong>: Android platform compatibility</li>
                            <li><strong>Target</strong>: Framework APIs, system behavior</li>
                            <li><strong>Language</strong>: Java (JUnit)</li>
                            <li><strong>Execution</strong>: On device as APK</li>
                            <li><strong>Scope</strong>: App-level compatibility</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîß</span>
                        VTS
                    </h3>
                    <div class="card-description">
                        <p><strong>Vendor Test Suite</strong></p>
                        <ul>
                            <li><strong>Purpose</strong>: Vendor implementation verification</li>
                            <li><strong>Target</strong>: HAL, kernel, VNDK</li>
                            <li><strong>Language</strong>: C++ (GTest), Python</li>
                            <li><strong>Execution</strong>: Device native</li>
                            <li><strong>Scope</strong>: Hardware-level compatibility</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì±</span>
                        GTS
                    </h3>
                    <div class="card-description">
                        <p><strong>GMS Test Suite</strong></p>
                        <ul>
                            <li><strong>Purpose</strong>: GMS license acquisition</li>
                            <li><strong>Target</strong>: Google apps and services</li>
                            <li><strong>Language</strong>: Java, various</li>
                            <li><strong>Execution</strong>: GMS app testing</li>
                            <li><strong>Scope</strong>: Google ecosystem integration</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <strong>üí° xTS Pass Required:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Commercial Android devices must pass CTS, VTS, and GTS to obtain GMS certification</li>
                    <li>CTS verifies app compatibility, VTS verifies hardware compatibility, GTS verifies Google service integration</li>
                    <li>Each test suite is complementary and ensures overall system quality</li>
                </ul>
            </div>
        </section>

        <!-- Section 5: Certification Process -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">5</span>
                Certification Process
            </h2>
            <p class="section-description">
                This section describes the complete process for Android devices to obtain GMS certification.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant OEM as OEM/ODM
                    participant DEV as Device Under Test
                    participant HARNESS as Test Harness
                    participant GOOGLE as Google

                    OEM->>DEV: Implement CDD requirements
                    OEM->>DEV: Create User Build

                    OEM->>HARNESS: Start CTS execution
                    HARNESS->>DEV: Push APK
                    HARNESS->>DEV: Execute tests
                    DEV-->>HARNESS: Test results
                    HARNESS->>HARNESS: Generate XML report

                    OEM->>HARNESS: Start VTS execution
                    HARNESS->>DEV: Execute HAL tests
                    DEV-->>HARNESS: Test results

                    OEM->>HARNESS: Start GTS execution
                    HARNESS->>DEV: Test GMS apps
                    DEV-->>HARNESS: Test results

                    alt All tests pass
                    OEM->>GOOGLE: Submit test report
                    GOOGLE->>GOOGLE: Review results
                    GOOGLE-->>OEM: Approve GMS certification
                    OEM->>DEV: Pre-install GMS apps
                    else Tests fail
                    HARNESS-->>OEM: Failure report
                    OEM->>DEV: Fix issues
                    OEM->>HARNESS: Retest
                    end
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üìù Certification Steps
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">1Ô∏è‚É£</span>
                        CDD Compliance
                    </h3>
                    <div class="card-description">
                        <p><strong>Compatibility Definition Document</strong></p>
                        <ul>
                            <li>Implement software requirements</li>
                            <li>Implement hardware features</li>
                            <li>Meet performance criteria</li>
                            <li>Comply with security requirements</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">2Ô∏è‚É£</span>
                        xTS Execution
                    </h3>
                    <div class="card-description">
                        <p><strong>Test Suite Execution</strong></p>
                        <ul>
                            <li>CTS: Platform compatibility</li>
                            <li>VTS: Vendor implementation</li>
                            <li>GTS: GMS integration</li>
                            <li>Continuous self-testing</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">3Ô∏è‚É£</span>
                        Submit Results
                    </h3>
                    <div class="card-description">
                        <p><strong>Submit Report to Google</strong></p>
                        <ul>
                            <li>XML test report</li>
                            <li>Compressed results directory</li>
                            <li>Device information</li>
                            <li>Build information</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">4Ô∏è‚É£</span>
                        GMS Approval
                    </h3>
                    <div class="card-description">
                        <p><strong>Obtain Certification</strong></p>
                        <ul>
                            <li>Google review and approval</li>
                            <li>GMS license issuance</li>
                            <li>Permission to pre-install Google apps</li>
                            <li>Commercial release enabled</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="success-box">
                <strong>‚úÖ Benefits of Successful Certification:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Ability to pre-install Google apps like Play Store, Gmail, YouTube</li>
                    <li>Access to Google Play Services APIs</li>
                    <li>Permission to use Android brand and logo</li>
                    <li>Consistent Android experience for users</li>
                </ul>
            </div>
        </section>

        <!-- Section 6: CTS Execution -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">6</span>
                How to Run CTS
            </h2>
            <p class="section-description">
                This section describes how to run CTS tests and analyze the results.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üíª</span>
                        Environment Setup
                    </h3>
                    <div class="card-description">
                        <p><strong>Prerequisites</strong></p>
                        <ul>
                            <li>Desktop (Windows/Ubuntu)</li>
                            <li>Download CTS package</li>
                            <li>ADB (Android Debug Bridge)</li>
                            <li>User Build device</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ñ∂Ô∏è</span>
                        Execution Commands
                    </h3>
                    <div class="card-description">
                        <p><strong>Running CTS</strong></p>
                        <ul>
                            <li><code>./cts-tradefed</code>: Start harness</li>
                            <li><code>run cts</code>: Full test</li>
                            <li><code>run cts --module [name]</code>: Specific module</li>
                            <li><code>run cts --plan [name]</code>: Test plan</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Results Analysis
                    </h3>
                    <div class="card-description">
                        <p><strong>Report Review</strong></p>
                        <ul>
                            <li>XML report generation</li>
                            <li>Viewable in browser</li>
                            <li>Pass/fail status by module</li>
                            <li>Failure cause logs</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÑ</span>
                        Retest
                    </h3>
                    <div class="card-description">
                        <p><strong>Re-run Failed Cases</strong></p>
                        <ul>
                            <li><code>run retry</code>: Failed cases only</li>
                            <li>Re-run after fixing issues</li>
                            <li>Partial testing available</li>
                            <li>Continuous integration support</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Important Notes:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>CTS only runs on User Build (eng/userdebug builds not allowed)</li>
                    <li>Test execution time can be very long (hours to days)</li>
                    <li>Device must remain charged</li>
                    <li>Network connection required (for test vector downloads)</li>
                </ul>
            </div>
        </section>

        <!-- Section 7: CTS Test Code Examples -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">7</span>
                CTS Test Code Examples
            </h2>
            <p class="section-description">
                This section describes how to write and run JUnit-based CTS test cases.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 20px;">
                üíª Basic CTS Test Case
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">MediaCodecTest.java</span>
                    <span class="code-lang">Java</span>
                </div>
                <pre><code>package android.media.cts;

import android.media.MediaCodec;
import android.media.MediaCodecInfo;
import android.media.MediaCodecList;
import android.media.MediaFormat;
import android.test.AndroidTestCase;
import android.util.Log;

public class MediaCodecTest extends AndroidTestCase {
    private static final String TAG = "MediaCodecTest";

    // Test if H.264 decoder exists
    public void testH264DecoderExists() {
        MediaCodecList codecList = new MediaCodecList(MediaCodecList.REGULAR_CODECS);
        MediaCodecInfo[] infos = codecList.getCodecInfos();

        boolean h264DecoderFound = false;
        for (MediaCodecInfo info : infos) {
            if (!info.isEncoder()) {
                String[] types = info.getSupportedTypes();
                for (String type : types) {
                    if (type.equalsIgnoreCase("video/avc")) {
                        h264DecoderFound = true;
                        Log.i(TAG, "H.264 decoder found: " + info.getName());
                        break;
                    }
                }
            }
        }

        assertTrue("H.264 decoder must be supported", h264DecoderFound);
    }

    // Test H.264 decoder Capabilities
    public void testH264DecoderCapabilities() throws Exception {
        MediaCodec codec = MediaCodec.createDecoderByType("video/avc");
        MediaCodecInfo codecInfo = codec.getCodecInfo();

        MediaCodecInfo.CodecCapabilities caps =
            codecInfo.getCapabilitiesForType("video/avc");
        MediaCodecInfo.VideoCapabilities videoCaps = caps.getVideoCapabilities();

        // Must support at least 720p
        assertTrue("Must support at least 1280x720",
            videoCaps.isSizeSupported(1280, 720));

        codec.release();
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üéØ Instrumentation Test
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">MediaPlayerInstrumentationTest.java</span>
                    <span class="code-lang">Java</span>
                </div>
                <pre><code>package android.media.cts;

import android.media.MediaPlayer;
import android.test.InstrumentationTestCase;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;

public class MediaPlayerInstrumentationTest extends InstrumentationTestCase {

    public void testPlayback() throws Exception {
        MediaPlayer player = new MediaPlayer();
        final CountDownLatch latch = new CountDownLatch(1);

        player.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {
            @Override
            public void onPrepared(MediaPlayer mp) {
                mp.start();
            }
        });

        player.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {
            @Override
            public void onCompletion(MediaPlayer mp) {
                latch.countDown();
            }
        });

        // Play test media file
        player.setDataSource("/data/local/tmp/test_video.mp4");
        player.prepareAsync();

        // Wait for playback completion (max 30 seconds)
        assertTrue("Playback should complete",
            latch.await(30, TimeUnit.SECONDS));

        player.release();
    }
}</code></pre>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì¶</span>
                        Test Build
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Android.mk
LOCAL_PATH := $(call my-dir)
include $(CLEAR_VARS)

LOCAL_MODULE := CtsMediaTestCases
LOCAL_PACKAGE_NAME := CtsMediaTestCases
LOCAL_MODULE_TAGS := optional

LOCAL_SRC_FILES := $(call all-java-files-under, src)
LOCAL_STATIC_JAVA_LIBRARIES := \
    compatibility-device-util-axt \
    androidx.test.rules \
    junit

LOCAL_COMPATIBILITY_SUITE := cts
include $(BUILD_CTS_PACKAGE)</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üî®</span>
                        Build Commands
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Build CTS package
m cts

# Build specific module only
m CtsMediaTestCases

# Run CTS harness
cts-tradefed

# Install module and test
adb install -r CtsMediaTestCases.apk
adb shell am instrument -w \
  android.media.cts/androidx.test.runner.AndroidJUnitRunner</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 8: cts-tradefed Detailed Execution -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">8</span>
                cts-tradefed Execution Details
            </h2>
            <p class="section-description">
                This section describes the specific usage and options of the CTS Trade Federation harness.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöÄ</span>
                        Basic Execution Commands
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Start CTS harness
./cts-tradefed

# Run full CTS
cts-tf > run cts

# Run specific module
cts-tf > run cts --module CtsMediaTestCases

# Run specific test case
cts-tf > run cts -m CtsMediaTestCases \
  -t android.media.cts.MediaCodecTest#testH264DecoderExists

# Run test plan
cts-tf > run cts --plan CTS-Media</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Advanced Options
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Specify ABI (32-bit/64-bit)
cts-tf > run cts --abi arm64-v8a

# Sharding (run on multiple devices simultaneously)
cts-tf > run cts --shard-count 4

# Set log level
cts-tf > run cts --log-level VERBOSE

# Re-run failed tests only
cts-tf > run retry --retry 0

# Set timeout
cts-tf > run cts --test-timeout 60000</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Execution Log Sample
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem;">
<code>cts-tradefed > run cts --module CtsMediaTestCases
05-20 10:30:15 I/TestInvocation: Starting invocation for 'cts'
05-20 10:30:20 I/ModuleDefinition: Running module CtsMediaTestCases
05-20 10:30:25 I/ModuleDefinition: CtsMediaTestCases: 145 test cases
05-20 10:32:10 I/InstrumentationTest: PASSED: testH264DecoderExists
05-20 10:32:15 I/InstrumentationTest: PASSED: testH264DecoderCapabilities
...
05-20 10:45:30 I/TestInvocation: Invocation completed
Results: 145 Passed, 0 Failed, 0 Not Executed</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìÅ</span>
                        Results Directory
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code>android-cts/results/
‚îî‚îÄ‚îÄ 2024.05.20_10.30.15/
    ‚îú‚îÄ‚îÄ test_result.xml          # Main result XML
    ‚îú‚îÄ‚îÄ test_result.html         # HTML report
    ‚îú‚îÄ‚îÄ compatibility_result.css
    ‚îú‚îÄ‚îÄ logo.png
    ‚îú‚îÄ‚îÄ CtsMediaTestCases.reportlog.json
    ‚îî‚îÄ‚îÄ logs/
        ‚îú‚îÄ‚îÄ host_log.txt
        ‚îú‚îÄ‚îÄ device_logcat.txt
        ‚îî‚îÄ‚îÄ invocation_summary.txt</code></pre>
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <strong>üí° Execution Tips:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Use <code>--module CtsMediaTestCases</code> to quickly test only media modules</li>
                    <li>When debugging failed tests, check detailed logs with <code>--log-level VERBOSE</code></li>
                    <li>If you have multiple devices, use <code>--shard-count</code> for parallel execution to save time</li>
                    <li>User Build required! Some tests fail on eng/userdebug builds</li>
                </ul>
            </div>
        </section>

        <!-- Section 9: Common Failure Cases -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">9</span>
                Common Failure Cases and Solutions
            </h2>
            <p class="section-description">
                This section summarizes common failure causes and solutions in media CTS tests.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 20px;">
                üî¥ MediaCodec Failure TOP 10
            </h3>

            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--accent-primary);">
                            <th style="padding: 15px; text-align: left; font-weight: 600;">#</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600;">Failure Cause</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600;">Symptom</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600;">Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">1</td>
                            <td style="padding: 15px;"><strong>Resolution Not Supported</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">isSizeSupported(1920, 1080) fails</td>
                            <td style="padding: 15px;">Check and modify max resolution in media_codecs.xml</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">2</td>
                            <td style="padding: 15px;"><strong>Framerate Not Supported</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">areSizeAndRateSupported(1280, 720, 60) fails</td>
                            <td style="padding: 15px;">Add 60fps support in codec driver</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">3</td>
                            <td style="padding: 15px;"><strong>Color Format Mismatch</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">FORMAT_CHANGED on dequeueOutputBuffer</td>
                            <td style="padding: 15px;">Verify YUV420 Planar/Semi-Planar format</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">4</td>
                            <td style="padding: 15px;"><strong>DRM License Failure</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">ERROR_DRM_NO_LICENSE</td>
                            <td style="padding: 15px;">Verify Widevine L1/L3 certification and provisioning</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">5</td>
                            <td style="padding: 15px;"><strong>Codec Initialization Failure</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">configure() throws IllegalStateException</td>
                            <td style="padding: 15px;">Validate MediaFormat parameters (width, height, mime)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">6</td>
                            <td style="padding: 15px;"><strong>Timestamp Mismatch</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">PTS order reversal (negative delta)</td>
                            <td style="padding: 15px;">Fix encoder/decoder timestamp handling logic</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">7</td>
                            <td style="padding: 15px;"><strong>Buffer Shortage</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">dequeueInputBuffer timeout</td>
                            <td style="padding: 15px;">Increase codec buffer count or use async mode</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">8</td>
                            <td style="padding: 15px;"><strong>Performance Class Not Met</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">4K@30fps dual session fails</td>
                            <td style="padding: 15px;">Improve hardware performance or lower class level</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;">9</td>
                            <td style="padding: 15px;"><strong>HDR Metadata Missing</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">HDR10 test fails</td>
                            <td style="padding: 15px;">Set HDR_STATIC_INFO in MediaFormat</td>
                        </tr>
                        <tr>
                            <td style="padding: 15px;">10</td>
                            <td style="padding: 15px;"><strong>Codec 2.0 HAL Missing</strong></td>
                            <td style="padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">hardware.google.media.c2 service not found</td>
                            <td style="padding: 15px;">Implement Codec 2.0 HAL or keep legacy OMX</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üõ†Ô∏è Debugging Steps
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">1Ô∏è‚É£</span>
                        Check Logs
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Filter failed test logs
adb logcat | grep -E "CtsMedia|MediaCodec|ERROR"

# Dump codec capabilities
adb shell dumpsys media.codec

# Check MediaCodecList
adb shell "dumpsys media.player | grep -A 20 CodecList"</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">2Ô∏è‚É£</span>
                        Verify Config Files
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Check media_codecs.xml
adb pull /vendor/etc/media_codecs.xml
adb pull /vendor/etc/media_codecs_performance.xml

# Validate XML syntax
xmllint --noout media_codecs.xml</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">3Ô∏è‚É£</span>
                        Manual Reproduction
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Re-run failed tests only
cts-tf > run retry --retry 0

# Run specific test case only
cts-tf > run cts -m CtsMediaTestCases \
  -t android.media.cts.MediaCodecTest#testH264DecoderCapabilities</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">4Ô∏è‚É£</span>
                        Code Fix and Retest
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Build system image after fix
m -j

# Flash device
fastboot flashall -w

# Re-run CTS
cts-tf > run cts --module CtsMediaTestCases</code></pre>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Important Notes:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Always validate syntax before applying media_codecs.xml changes</li>
                    <li>Over-claiming codec performance (declaring higher than actual) may cause app crashes</li>
                    <li>DRM tests require verifying provisioning status (Widevine CDM)</li>
                    <li>Performance Class can be selectively implemented based on hardware capabilities</li>
                </ul>
            </div>
        </section>

        <!-- Section 10: Performance Class Requirements -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">10</span>
                Performance Class Detailed Requirements
            </h2>
            <p class="section-description">
                This section describes the tier-specific requirements of Media Performance Class introduced in Android 12.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 20px;">
                üìä Performance Class Comparison Table
            </h3>

            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--accent-primary);">
                            <th style="padding: 15px; text-align: left; font-weight: 600;">Item</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600;">Class 11 (R)</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600;">Class 12 (S)</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600;">Class 13 (T)</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600;">Class 14 (U)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>RAM</strong></td>
                            <td style="padding: 15px; text-align: center;">6 GB</td>
                            <td style="padding: 15px; text-align: center;">8 GB</td>
                            <td style="padding: 15px; text-align: center;">8 GB</td>
                            <td style="padding: 15px; text-align: center;">12 GB</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Storage</strong></td>
                            <td style="padding: 15px; text-align: center;">128 GB</td>
                            <td style="padding: 15px; text-align: center;">256 GB</td>
                            <td style="padding: 15px; text-align: center;">256 GB</td>
                            <td style="padding: 15px; text-align: center;">256 GB (UFS 3.1+)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Display</strong></td>
                            <td style="padding: 15px; text-align: center;">1080p</td>
                            <td style="padding: 15px; text-align: center;">1080p</td>
                            <td style="padding: 15px; text-align: center;">1080p</td>
                            <td style="padding: 15px; text-align: center;">1080p (HDR10+)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Video Decode</strong></td>
                            <td style="padding: 15px; text-align: center;">4K@30fps (2 streams)</td>
                            <td style="padding: 15px; text-align: center;">4K@30fps (3 streams)</td>
                            <td style="padding: 15px; text-align: center;">4K@60fps (3 streams)</td>
                            <td style="padding: 15px; text-align: center;">4K@60fps + 8K@30fps</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Video Encode</strong></td>
                            <td style="padding: 15px; text-align: center;">4K@30fps (1 stream)</td>
                            <td style="padding: 15px; text-align: center;">4K@30fps + 1080p@30fps</td>
                            <td style="padding: 15px; text-align: center;">4K@60fps</td>
                            <td style="padding: 15px; text-align: center;">4K@60fps (AV1)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Camera</strong></td>
                            <td style="padding: 15px; text-align: center;">12 MP (30fps)</td>
                            <td style="padding: 15px; text-align: center;">12 MP (30fps)</td>
                            <td style="padding: 15px; text-align: center;">12 MP (60fps)</td>
                            <td style="padding: 15px; text-align: center;">200 MP (30fps)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Concurrent Sessions</strong></td>
                            <td style="padding: 15px; text-align: center;">6 codec sessions</td>
                            <td style="padding: 15px; text-align: center;">6 codec sessions</td>
                            <td style="padding: 15px; text-align: center;">8 codec sessions</td>
                            <td style="padding: 15px; text-align: center;">12 codec sessions</td>
                        </tr>
                        <tr>
                            <td style="padding: 15px;"><strong>Audio Latency</strong></td>
                            <td style="padding: 15px; text-align: center;">‚â§ 100 ms</td>
                            <td style="padding: 15px; text-align: center;">‚â§ 80 ms</td>
                            <td style="padding: 15px; text-align: center;">‚â§ 80 ms</td>
                            <td style="padding: 15px; text-align: center;">‚â§ 60 ms</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üíª Runtime Query
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">PerformanceClassQuery.kt</span>
                    <span class="code-lang">Kotlin</span>
                </div>
                <pre><code>import android.os.Build

fun checkPerformanceClass() {
    // Only available on Android 12 (API 31) and above
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {
        val perfClass = Build.VERSION.MEDIA_PERFORMANCE_CLASS

        when {
            perfClass >= 14 -> {
                Log.i(TAG, "Performance Class 14 (Android 14+)")
                // 8K@30fps decoding, AV1 encoding, 200MP camera
                enableHighEndFeatures()
            }
            perfClass >= 13 -> {
                Log.i(TAG, "Performance Class 13 (Android 13)")
                // 4K@60fps decoding/encoding, 12MP@60fps camera
                enableMidHighFeatures()
            }
            perfClass >= 12 -> {
                Log.i(TAG, "Performance Class 12 (Android 12L)")
                // 4K@30fps 3 streams, 8GB RAM
                enableMidFeatures()
            }
            perfClass >= 11 -> {
                Log.i(TAG, "Performance Class 11 (Android 12)")
                // 4K@30fps 2 streams, 6GB RAM
                enableBaselineFeatures()
            }
            else -> {
                Log.w(TAG, "No Performance Class certification")
                // Use basic media features only
                enableBasicFeatures()
            }
        }
    } else {
        Log.w(TAG, "Performance Class API not available (API < 31)")
    }
}

fun enableHighEndFeatures() {
    // 8K video playback
    // AV1 encoding
    // Ultra HDR (JPEG_R)
    // 200MP photo capture
}

fun enableMidHighFeatures() {
    // 4K@60fps video playback/recording
    // 12MP@60fps burst capture
    // HDR10+ support
}

fun enableMidFeatures() {
    // 4K@30fps multi-stream
    // 12MP@30fps burst capture
    // HDR10 support
}

fun enableBaselineFeatures() {
    // 4K@30fps dual stream
    // 12MP photos
}

fun enableBasicFeatures() {
    // 1080p playback
    // Basic camera features
}</code></pre>
            </div>

            <div class="success-box">
                <strong>‚úÖ Benefits of Performance Class:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>App developers can accurately determine device performance at runtime</li>
                    <li>Solves performance fragmentation issues (safely enable high-end features)</li>
                    <li>Provides consistent premium experience to users</li>
                    <li>Google clearly defines performance standards as OEM guidelines</li>
                </ul>
            </div>

            <div class="highlight-box">
                <strong>üí° CTS Testing:</strong>
                <p style="margin-top: 10px;">
                    Devices declaring Performance Class must pass all tests in the <code>CtsMediaPerformanceClassTestCases</code> module.
                    Tests perform concurrent decoding/encoding with actual media files, measuring frame drops, buffering, and latency.
                </p>
            </div>
        </section>

        <!-- Section 11: CTS Result XML Analysis -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">11</span>
                CTS Result XML Report Analysis
            </h2>
            <p class="section-description">
                This section describes the structure and analysis method of the test_result.xml file generated after CTS execution.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 20px;">
                üìÑ test_result.xml Structure
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">test_result.xml</span>
                    <span class="code-lang">XML</span>
                </div>
                <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Result start="1621504800000" end="1621520000000"
        suite_name="CTS" suite_version="14.0_r1"
        suite_plan="cts" suite_build_number="9876543"&gt;

  &lt;Build build_reference_fingerprint="google/sdk_gphone64_x86_64/..."/&gt;

  &lt;Summary pass="18520" failed="12" modules_done="165" modules_total="165"/&gt;

  &lt;Module name="CtsMediaTestCases" abi="arm64-v8a"
          runtime="1234567" done="true" pass="145" total_tests="147"&gt;

    &lt;TestCase name="android.media.cts.MediaCodecTest"&gt;

      &lt;Test result="pass" name="testH264DecoderExists"&gt;
        &lt;Summary&gt;Test passed&lt;/Summary&gt;
      &lt;/Test&gt;

      &lt;Test result="pass" name="testH264DecoderCapabilities"&gt;
        &lt;Summary&gt;Test passed&lt;/Summary&gt;
      &lt;/Test&gt;

      &lt;Test result="fail" name="testHevcDecoderCapabilities"&gt;
        &lt;Failure message="java.lang.AssertionError: Must support 4K resolution"&gt;
          &lt;StackTrace&gt;
            at android.media.cts.MediaCodecTest.testHevcDecoderCapabilities(MediaCodecTest.java:152)
          &lt;/StackTrace&gt;
        &lt;/Failure&gt;
      &lt;/Test&gt;

    &lt;/TestCase&gt;

  &lt;/Module&gt;

&lt;/Result&gt;</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üìä Key Field Descriptions
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìù</span>
                        Summary
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><code>pass</code>: Number of passed tests (18520)</li>
                            <li><code>failed</code>: Number of failed tests (12)</li>
                            <li><code>modules_done</code>: Completed modules (165)</li>
                            <li><code>modules_total</code>: Total modules (165)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üèóÔ∏è</span>
                        Build Info
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><code>build_reference_fingerprint</code>: Device fingerprint</li>
                            <li>Example: google/sdk_gphone64_x86_64/sdk_gphone64_x86_64:14/UE1A.230829.036/10819315:userdebug/dev-keys</li>
                            <li>Used for verification during Google submission</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì¶</span>
                        Module
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><code>name</code>: Module name (CtsMediaTestCases)</li>
                            <li><code>abi</code>: Architecture (arm64-v8a, armeabi-v7a)</li>
                            <li><code>runtime</code>: Execution time (ms)</li>
                            <li><code>done</code>: Completion status (true/false)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ùå</span>
                        Failure
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><code>message</code>: Failure message</li>
                            <li><code>StackTrace</code>: Java stack trace</li>
                            <li>Most important info for debugging</li>
                            <li>Enables tracing failure cause</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üîç XML Parsing Script
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">parse_cts_result.py</span>
                    <span class="code-lang">Python</span>
                </div>
                <pre><code>import xml.etree.ElementTree as ET
import sys

def parse_cts_result(xml_file):
    tree = ET.parse(xml_file)
    root = tree.getroot()

    # Parse Summary
    summary = root.find('Summary')
    pass_count = int(summary.get('pass', 0))
    fail_count = int(summary.get('failed', 0))
    total = pass_count + fail_count
    pass_rate = (pass_count / total * 100) if total > 0 else 0

    print(f"=== CTS Test Summary ===")
    print(f"Total Tests: {total}")
    print(f"Passed: {pass_count}")
    print(f"Failed: {fail_count}")
    print(f"Pass Rate: {pass_rate:.2f}%\n")

    # Extract failed tests
    failures = []
    for module in root.findall('.//Module'):
        module_name = module.get('name')
        for test_case in module.findall('.//TestCase'):
            case_name = test_case.get('name')
            for test in test_case.findall('.//Test[@result="fail"]'):
                test_name = test.get('name')
                failure = test.find('Failure')
                if failure is not None:
                    message = failure.get('message', 'No message')
                    failures.append({
                        'module': module_name,
                        'case': case_name,
                        'test': test_name,
                        'message': message
                    })

    if failures:
        print(f"=== Failed Tests ({len(failures)}) ===")
        for i, f in enumerate(failures, 1):
            print(f"{i}. {f['module']} > {f['case']} > {f['test']}")
            print(f"   Error: {f['message']}\n")
    else:
        print("‚úÖ All tests passed!")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: python parse_cts_result.py test_result.xml")
        sys.exit(1)

    parse_cts_result(sys.argv[1])</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                ‚úÖ Pre-Submission Checklist for Google
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">1Ô∏è‚É£</span>
                        Verify User Build
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Build fingerprint must not contain "userdebug"
adb shell getprop ro.build.fingerprint

# Correct example:
# google/product/device:14/.../user/release-keys

# Incorrect example:
# google/product/device:14/.../userdebug/dev-keys</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">2Ô∏è‚É£</span>
                        Test All ABIs
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>64-bit: arm64-v8a required</li>
                            <li>32-bit: armeabi-v7a (optional)</li>
                            <li>Test both ABIs if supported</li>
                            <li>Include both ABI results in XML</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">3Ô∏è‚É£</span>
                        100% Pass Rate
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>All tests must pass</li>
                            <li>Cannot submit with even 1 failure</li>
                            <li>Not Executed is allowed (HW not present)</li>
                            <li>Exceptions only with approved Waiver</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">4Ô∏è‚É£</span>
                        Compress Report
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Compress results directory
cd android-cts/results/
zip -r cts_result_2024.05.20.zip 2024.05.20_10.30.15/

# Upload to Google Partner Console
# https://www.google.com/android/partner/</code></pre>
                    </div>
                </div>
            </div>

            <div class="success-box">
                <strong>‚úÖ Certification Success Tips:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Run CTS internally multiple times before first submission to ensure stability</li>
                    <li>Thoroughly analyze failed cases and fix root causes (no workarounds)</li>
                    <li>Discuss with Google in advance for special hardware configurations</li>
                    <li>Review CDD document alongside CTS results to prevent requirement gaps</li>
                </ul>
            </div>
        </section>

        <!-- Section 12: CI/CD Automation -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">12</span>
                CI/CD Automation
            </h2>
            <p class="section-description">
                This section describes how to automate CTS testing by integrating with Jenkins and GitLab CI/CD.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 20px;">
                üîß Jenkins Pipeline
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">Jenkinsfile</span>
                    <span class="code-lang">Groovy</span>
                </div>
                <pre><code>pipeline {
    agent any

    environment {
        ANDROID_HOME = '/opt/android-sdk'
        CTS_PATH = '/home/jenkins/android-cts'
        DEVICE_SERIAL = '1A2B3C4D5E6F'
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main', url: 'https://github.com/company/android-device.git'
            }
        }

        stage('Build System Image') {
            steps {
                sh '''
                    source build/envsetup.sh
                    lunch product-user
                    m -j$(nproc)
                '''
            }
        }

        stage('Flash Device') {
            steps {
                sh '''
                    adb -s ${DEVICE_SERIAL} reboot bootloader
                    fastboot -s ${DEVICE_SERIAL} flashall -w
                    fastboot -s ${DEVICE_SERIAL} reboot
                    adb -s ${DEVICE_SERIAL} wait-for-device
                '''
            }
        }

        stage('Run CTS - Media Module') {
            steps {
                sh '''
                    cd ${CTS_PATH}
                    ./cts-tradefed run cts \
                        --module CtsMediaTestCases \
                        --serial ${DEVICE_SERIAL} \
                        --logcat-on-failure
                '''
            }
        }

        stage('Parse Results') {
            steps {
                script {
                    def resultXml = sh(
                        script: "find ${CTS_PATH}/results -name 'test_result.xml' | head -1",
                        returnStdout: true
                    ).trim()

                    sh "python3 scripts/parse_cts_result.py ${resultXml}"
                }
            }
        }
    }

    post {
        always {
            archiveArtifacts artifacts: 'android-cts/results/**/*', fingerprint: true
            junit 'android-cts/results/**/test_result.xml'
        }
        success {
            emailext (
                subject: "CTS PASSED: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                body: "CTS test completed successfully. Check ${env.BUILD_URL}",
                to: 'team@company.com'
            )
        }
        failure {
            emailext (
                subject: "CTS FAILED: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                body: "CTS test failed. Check ${env.BUILD_URL}console",
                to: 'team@company.com'
            )
        }
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                ü¶ä GitLab CI/CD
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">.gitlab-ci.yml</span>
                    <span class="code-lang">YAML</span>
                </div>
                <pre><code>stages:
  - build
  - test
  - report

variables:
  ANDROID_SDK: "/opt/android-sdk"
  CTS_PATH: "/opt/android-cts"
  DEVICE_SERIAL: "1A2B3C4D5E6F"

build_system:
  stage: build
  tags:
    - android-build-server
  script:
    - source build/envsetup.sh
    - lunch product-user
    - m -j$(nproc)
  artifacts:
    paths:
      - out/target/product/*/system.img
      - out/target/product/*/vendor.img
    expire_in: 1 week

flash_device:
  stage: build
  dependencies:
    - build_system
  tags:
    - device-farm
  script:
    - adb -s $DEVICE_SERIAL reboot bootloader
    - fastboot -s $DEVICE_SERIAL flashall -w
    - fastboot -s $DEVICE_SERIAL reboot
    - adb -s $DEVICE_SERIAL wait-for-device
    - sleep 60  # Wait for boot

run_cts_media:
  stage: test
  dependencies:
    - flash_device
  tags:
    - device-farm
  script:
    - cd $CTS_PATH
    - |
      ./cts-tradefed run cts \
        --module CtsMediaTestCases \
        --serial $DEVICE_SERIAL \
        --logcat-on-failure \
        --skip-device-info \
        --disable-reboot
  artifacts:
    paths:
      - $CTS_PATH/results/
    expire_in: 1 month
  allow_failure: false

parse_results:
  stage: report
  dependencies:
    - run_cts_media
  script:
    - |
      RESULT_XML=$(find $CTS_PATH/results -name 'test_result.xml' | head -1)
      python3 scripts/parse_cts_result.py $RESULT_XML > cts_summary.txt
      cat cts_summary.txt
  artifacts:
    reports:
      junit: $CTS_PATH/results/*/test_result.xml
    paths:
      - cts_summary.txt

nightly_full_cts:
  stage: test
  only:
    - schedules
  script:
    - cd $CTS_PATH
    - ./cts-tradefed run cts --serial $DEVICE_SERIAL
  timeout: 24h</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üìä Automation Best Practices
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üåô</span>
                        Nightly Builds
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Automatically build latest code every night</li>
                            <li>Run CTS Media module (1-2 hours)</li>
                            <li>Notify results via Slack/Email</li>
                            <li>Early detection of regression bugs</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÑ</span>
                        Pre-submit Testing
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Automatic test before code review</li>
                            <li>Quick verification of core tests (30 min)</li>
                            <li>Allow merge only when passed</li>
                            <li>Acts as quality gate</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìÖ</span>
                        Weekly Full CTS
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Run full CTS on weekends (10-20 hours)</li>
                            <li>Ensure coverage of all modules</li>
                            <li>Final verification before release</li>
                            <li>Trend analysis (pass rate trends)</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìà</span>
                        Metrics & Reporting
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Visualize results in dashboard (Grafana)</li>
                            <li>Monitor failure rate trends</li>
                            <li>Compare pass rates by module</li>
                            <li>Track history (Git commit integration)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="success-box">
                <strong>‚úÖ Automation Benefits:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>10x efficiency improvement compared to manual testing</li>
                    <li>Reduced fix costs through early regression bug detection</li>
                    <li>Developers can check test results immediately</li>
                    <li>Improved release quality and reduced certification failure rate</li>
                </ul>
            </div>
        </section>

        <!-- Section 13: Debugging Guide -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">13</span>
                Debugging Guide
            </h2>
            <p class="section-description">
                This section describes systematic debugging methods when CTS tests fail.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîç</span>
                        logcat Filtering
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># View CTS related logs only
adb logcat | grep -E "CtsMedia|TestRunner"

# Filter MediaCodec errors only
adb logcat | grep -E "MediaCodec.*ERROR"

# Specific test case logs
adb logcat | grep "testH264DecoderCapabilities"

# Save real-time logs to file
adb logcat > cts_debug.log &

# Increase buffer size (prevent log loss)
adb logcat -G 16M</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì±</span>
                        adb Commands
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Manually install test APK
adb install -r CtsMediaTestCases.apk

# Run test
adb shell am instrument -w \
  -e class android.media.cts.MediaCodecTest#testH264DecoderExists \
  android.media.cts/androidx.test.runner.AndroidJUnitRunner

# Pull test results
adb pull /sdcard/cts_result/ ./

# Check codec info with dumpsys
adb shell dumpsys media.codec

# Check system properties
adb shell getprop | grep media</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üêõ</span>
                        Test Reproduction
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Re-run failed tests only
cts-tf > run retry --retry 0

# Run specific test case repeatedly (10 times)
for i in {1..10}; do
  cts-tf > run cts -m CtsMediaTestCases \
    -t android.media.cts.MediaCodecTest#testH264DecoderCapabilities
  echo "Run $i completed"
done

# Set log level to VERBOSE
cts-tf > run cts --log-level VERBOSE \
  --module CtsMediaTestCases</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Systrace Analysis
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto;">
<code># Capture Systrace (media codec tracing)
python systrace.py -t 10 \
  -o trace.html \
  gfx view sched freq idle load \
  dalvik camera hal input res

# Detailed tracing with Perfetto
adb shell perfetto \
  -c - --txt \
  -o /data/misc/perfetto-traces/trace \
  &lt; config.pbtxt

adb pull /data/misc/perfetto-traces/trace .
# Analyze at https://ui.perfetto.dev</code></pre>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üîß Step-by-Step Debugging Process
            </h3>

            <div class="mermaid-container">
                <div class="mermaid">
                    flowchart TD
                    START[CTS Test Failure] --> CHECK_LOG[Check test_result.xml]
                    CHECK_LOG --> IDENTIFY[Identify Failed Tests]
                    IDENTIFY --> LOGCAT[Filter logcat]
                    LOGCAT --> REPRODUCE[Manual Reproduction]

                    REPRODUCE --> |Success| ANALYZE[Code Analysis]
                    REPRODUCE --> |Failure| INTERMITTENT[Intermittent Failure]

                    ANALYZE --> CHECK_CONFIG[Check Config Files]
                    CHECK_CONFIG --> |media_codecs.xml| FIX_CONFIG[Fix Config]
                    CHECK_CONFIG --> |Code Bug| FIX_CODE[Fix Code]

                    INTERMITTENT --> REPEAT[Repeat Test 10x]
                    REPEAT --> TRACE[Capture Systrace]
                    TRACE --> TIMING[Analyze Timing Issues]

                    FIX_CONFIG --> BUILD[Build & Flash]
                    FIX_CODE --> BUILD
                    TIMING --> BUILD

                    BUILD --> RETEST[Re-run CTS]
                    RETEST --> |Pass| DONE[Complete]
                    RETEST --> |Fail| LOGCAT
                </div>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Debugging Notes:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Some bugs only reproduce on User Build, so avoid testing only on userdebug</li>
                    <li>For intermittent failures, verify reproduction rate with 10+ repeated tests</li>
                    <li>Always validate XML syntax (xmllint) after modifying config files</li>
                    <li>Fixing root causes is better than workarounds in the long run</li>
                </ul>
            </div>
        </section>

        <!-- Section 14: VTS Architecture Details -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">14</span>
                VTS Architecture Details
            </h2>
            <p class="section-description">
                This section describes the structure of Vendor Test Suite (VTS) and HAL testing methods.
            </p>

            <div class="mermaid-container">
                <div class="mermaid">
                    graph TB
                    VTS[VTS Test Suite]

                    VTS --> CORE[VTS-Core]
                    VTS --> KERNEL[VTS-Kernel]

                    CORE --> HIDL[HIDL HAL Tests]
                    CORE --> AIDL[AIDL HAL Tests]
                    CORE --> VNDK[VNDK Tests]

                    HIDL --> MEDIA_HIDL[media.c2@1.0<br />media.omx@1.0]
                    AIDL --> MEDIA_AIDL[hardware.media.c2<br />AIDL interface]

                    KERNEL --> KCONFIG[Kernel Config]
                    KERNEL --> KSELFTEST[Kernel Selftests]
                    KERNEL --> LTP[Linux Test Project]

                    MEDIA_HIDL --> CODEC_HAL[IComponentStore<br />IComponent]
                    MEDIA_AIDL --> CODEC_HAL_AIDL[IComponentStore.aidl<br />IComponent.aidl]
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üîß VTS-Core: HAL Tests
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì°</span>
                        HIDL HAL (Legacy)
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Interface</strong>: hardware.google.media.c2@1.0</li>
                            <li><strong>Tests</strong>: IComponentStore, IComponent</li>
                            <li><strong>Execution</strong>: adb shell /data/nativetest64/VtsHalMediaC2V1_0TargetTest</li>
                            <li>Used in Android 11 and below</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöÄ</span>
                        AIDL HAL (Latest)
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li><strong>Interface</strong>: android.hardware.media.c2</li>
                            <li><strong>Tests</strong>: IComponentStore.aidl</li>
                            <li><strong>Execution</strong>: atest VtsHalMediaC2TargetTest</li>
                            <li>Recommended for Android 12+</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîó</span>
                        VNDK Tests
                    </h3>
                    <div class="card-description">
                        <ul>
                            <li>Vendor NDK library compatibility</li>
                            <li>libbinder, libui, libgui, etc.</li>
                            <li>ABI stability verification</li>
                            <li>Cross-version compatibility</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üß™</span>
                        Test Example
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem;">
<code># Run VTS
vts-tradefed

# Media C2 HAL test
vts-tf > run vts --module VtsHalMediaC2V1_0Target

# Specific HAL interface test
vts-tf > run vts -m VtsHalMediaC2V1_0Target \
  -t ComponentStoreTest#testQueryComponents</code></pre>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üíª Media HAL Test Example
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">VtsHalMediaC2Test.cpp</span>
                    <span class="code-lang">C++</span>
                </div>
                <pre><code>#include <android/hardware/media/c2/1.0/IComponentStore.h>
#include <gtest/gtest.h>

using android::sp;
using android::hardware::media::c2::V1_0::IComponentStore;
using android::hardware::media::c2::V1_0::IComponent;

class MediaC2HalTest : public ::testing::Test {
protected:
    void SetUp() override {
        // Get C2 ComponentStore
        store = IComponentStore::getService("default");
        ASSERT_NE(store, nullptr);
    }

    sp<IComponentStore> store;
};

TEST_F(MediaC2HalTest, TestListComponents) {
    // List all available components
    store->listComponents([](const auto& traits) {
        for (const auto& trait : traits) {
            ALOGD("Component: %s, domain=%d, kind=%d",
                  trait.name.c_str(), trait.domain, trait.kind);

            // Check if H.264 decoder exists
            if (trait.name.find("c2.android.avc.decoder") != std::string::npos) {
                ASSERT_EQ(trait.domain, C2Component::DOMAIN_VIDEO);
                ASSERT_EQ(trait.kind, C2Component::KIND_DECODER);
            }
        }
    });
}

TEST_F(MediaC2HalTest, TestCreateComponent) {
    sp<IComponent> component;

    // Create H.264 decoder component
    auto status = store->createComponent(
        "c2.android.avc.decoder",
        nullptr,
        nullptr,
        [&component](Status s, const sp<IComponent>& c) {
            ASSERT_EQ(s, Status::OK);
            component = c;
        });

    ASSERT_TRUE(status.isOk());
    ASSERT_NE(component, nullptr);
}</code></pre>
            </div>

            <div class="highlight-box">
                <strong>üí° VTS vs CTS:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li><strong>CTS</strong>: Framework API level testing (Java, JUnit)</li>
                    <li><strong>VTS</strong>: HAL interface level testing (C++, GTest)</li>
                    <li><strong>Relationship</strong>: CTS is higher level than VTS, both must pass</li>
                    <li><strong>Debugging</strong>: VTS failure - check HAL impl, CTS failure - check both Framework and HAL</li>
                </ul>
            </div>
        </section>

        <!-- Section 15: Android Version CTS Changes -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">15</span>
                CTS Changes by Android Version
            </h2>
            <p class="section-description">
                This section summarizes CTS tests added or changed as Android versions progress.
            </p>

            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--accent-primary);">
                            <th style="padding: 15px; text-align: left; font-weight: 600;">Android Version</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600;">Major CTS Changes</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600;">New Test Modules</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600;">Deprecated</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Android 14 (U)</strong></td>
                            <td style="padding: 15px;">
                                ‚Ä¢ AV1 encoder mandatory<br>
                                ‚Ä¢ Ultra HDR (JPEG_R) support<br>
                                ‚Ä¢ Performance Class 14<br>
                                ‚Ä¢ OpenJDK 17 based
                            </td>
                            <td style="padding: 15px;">
                                CtsMediaUltraHdrTestCases<br>
                                CtsPerformanceClass14TestCases
                            </td>
                            <td style="padding: 15px;">
                                Android 10 and below APIs removed
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Android 13 (T)</strong></td>
                            <td style="padding: 15px;">
                                ‚Ä¢ Photo Picker API<br>
                                ‚Ä¢ Themed Icons support<br>
                                ‚Ä¢ Performance Class 13<br>
                                ‚Ä¢ Predictive Back Gesture
                            </td>
                            <td style="padding: 15px;">
                                CtsPhotoPickerTestCases<br>
                                CtsPerformanceClass13TestCases
                            </td>
                            <td style="padding: 15px;">
                                ScopedStorage exceptions removed
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Android 12 (S)</strong></td>
                            <td style="padding: 15px;">
                                ‚Ä¢ Performance Class introduced<br>
                                ‚Ä¢ Codec 2.0 mandatory<br>
                                ‚Ä¢ AIDL HAL support<br>
                                ‚Ä¢ MediaMetrics enhanced
                            </td>
                            <td style="padding: 15px;">
                                CtsMediaPerformanceClassTestCases<br>
                                CtsCodec2TestCases
                            </td>
                            <td style="padding: 15px;">
                                OMX codec deprecated
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Android 11 (R)</strong></td>
                            <td style="padding: 15px;">
                                ‚Ä¢ Scoped Storage mandatory<br>
                                ‚Ä¢ HEIF image support<br>
                                ‚Ä¢ Low-latency decoding<br>
                                ‚Ä¢ MediaParser API
                            </td>
                            <td style="padding: 15px;">
                                CtsMediaParserTestCases<br>
                                CtsScopedStorageTestCases
                            </td>
                            <td style="padding: 15px;">
                                Legacy Storage removed
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px;"><strong>Android 10 (Q)</strong></td>
                            <td style="padding: 15px;">
                                ‚Ä¢ AV1 decoder recommended<br>
                                ‚Ä¢ MediaCodec low-latency mode<br>
                                ‚Ä¢ APEX modules introduced<br>
                                ‚Ä¢ Dynamic Color
                            </td>
                            <td style="padding: 15px;">
                                CtsAv1TestCases<br>
                                CtsApexTestCases
                            </td>
                            <td style="padding: 15px;">
                                Android 8 and below APIs removed
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px;"><strong>Android 9 (P)</strong></td>
                            <td style="padding: 15px;">
                                ‚Ä¢ HDR VP9 Profile 2 mandatory<br>
                                ‚Ä¢ ImageDecoder API<br>
                                ‚Ä¢ Neural Networks API<br>
                                ‚Ä¢ Multi-camera support
                            </td>
                            <td style="padding: 15px;">
                                CtsNNAPITestCases<br>
                                CtsImageDecoderTestCases
                            </td>
                            <td style="padding: 15px;">
                                Apache HTTP Client removed
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üìà CTS Module Count Trend
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">Android 9 (P)</h3>
                    <div class="card-description">
                        <p style="font-size: 2rem; font-weight: 700; color: var(--accent-primary); text-align: center;">~120</p>
                        <p style="text-align: center; margin-top: 10px;">Modules</p>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Android 10 (Q)</h3>
                    <div class="card-description">
                        <p style="font-size: 2rem; font-weight: 700; color: var(--accent-primary); text-align: center;">~135</p>
                        <p style="text-align: center; margin-top: 10px;">Modules</p>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Android 12 (S)</h3>
                    <div class="card-description">
                        <p style="font-size: 2rem; font-weight: 700; color: var(--accent-primary); text-align: center;">~155</p>
                        <p style="text-align: center; margin-top: 10px;">Modules</p>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Android 14 (U)</h3>
                    <div class="card-description">
                        <p style="font-size: 2rem; font-weight: 700; color: var(--accent-primary); text-align: center;">~170</p>
                        <p style="text-align: center; margin-top: 10px;">Modules</p>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Notes for Version Upgrades:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Review CDD document for new version first to identify added mandatory requirements</li>
                    <li>Stop using deprecated APIs and migrate to replacement APIs</li>
                    <li>Performance Class is optional, but must meet all requirements if declared</li>
                    <li>Plan transition to AIDL HAL (Android 12+)</li>
                </ul>
            </div>
        </section>

        <!-- Section 16: AOSP Source Code & Custom Tests -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">16</span>
                AOSP Source Code & Custom Tests
            </h2>
            <p class="section-description">
                This section describes CTS source code locations and how to write custom test cases.
            </p>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 20px;">
                üìÇ AOSP CTS Source Paths
            </h3>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üé¨</span>
                        Media CTS
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem;">
<code># Media test cases
cts/tests/tests/media/

# Main files
‚îú‚îÄ‚îÄ src/android/media/cts/
‚îÇ   ‚îú‚îÄ‚îÄ MediaCodecTest.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaExtractorTest.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaPlayerTest.java
‚îÇ   ‚îú‚îÄ‚îÄ MediaRecorderTest.java
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ res/raw/               # Test media files
‚îî‚îÄ‚îÄ AndroidManifest.xml</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì¶</span>
                        Codec 2.0 CTS
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem;">
<code># Codec 2.0 specific tests
cts/tests/tests/media/codec/

# Main files
‚îú‚îÄ‚îÄ src/android/media/codec/cts/
‚îÇ   ‚îú‚îÄ‚îÄ MediaCodecBlockModelTest.java
‚îÇ   ‚îú‚îÄ‚îÄ EncodeDecodeTest.java
‚îÇ   ‚îú‚îÄ‚îÄ VideoEncoderDecoderTest.java
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ res/               # Test vectors</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîß</span>
                        CTS Harness
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem;">
<code># Trade Federation framework
tools/tradefederation/core/

# CTS specific config
cts/tools/cts-tradefed/

# Test plan XML
cts/tools/cts-tradefed/res/config/
‚îî‚îÄ‚îÄ cts.xml
‚îî‚îÄ‚îÄ cts-media.xml</code></pre>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Build Configuration
                    </h3>
                    <div class="card-description">
                        <pre style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem;">
<code># Android.bp (Soong)
cts/tests/tests/media/Android.bp

# Legacy Android.mk
cts/tests/tests/media/Android.mk

# Test configuration
cts/tests/tests/media/AndroidTest.xml</code></pre>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üõ†Ô∏è Adding Custom Test Cases
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">CustomMediaCodecTest.java</span>
                    <span class="code-lang">Java</span>
                </div>
                <pre><code>package android.media.cts;

import android.media.MediaCodec;
import android.media.MediaFormat;
import android.test.AndroidTestCase;
import android.util.Log;

/**
 * Custom media codec test
 * Verify specific vendor extension features
 */
public class CustomMediaCodecTest extends AndroidTestCase {
    private static final String TAG = "CustomMediaCodecTest";

    // Test if custom codec exists
    public void testCustomH265EncoderExists() {
        String codecName = "OMX.qcom.video.encoder.hevc";  // Qualcomm example

        try {
            MediaCodec codec = MediaCodec.createByCodecName(codecName);
            assertNotNull("Custom HEVC encoder must exist", codec);
            codec.release();
        } catch (Exception e) {
            fail("Failed to create custom codec: " + e.getMessage());
        }
    }

    // Test custom parameters
    public void testCustomEncodingParameters() throws Exception {
        MediaCodec encoder = MediaCodec.createEncoderByType("video/hevc");

        MediaFormat format = MediaFormat.createVideoFormat("video/hevc", 1920, 1080);
        format.setInteger(MediaFormat.KEY_COLOR_FORMAT,
            MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Flexible);
        format.setInteger(MediaFormat.KEY_BIT_RATE, 10000000);
        format.setInteger(MediaFormat.KEY_FRAME_RATE, 30);
        format.setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, 1);

        // Vendor-specific parameters (Qualcomm QP range example)
        format.setInteger("vendor.qti-ext-enc-qp-range.qp-i-min", 10);
        format.setInteger("vendor.qti-ext-enc-qp-range.qp-i-max", 40);

        try {
            encoder.configure(format, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE);
            encoder.start();

            // Verify settings were applied
            MediaFormat outputFormat = encoder.getOutputFormat();
            Log.i(TAG, "Output format: " + outputFormat);

            encoder.stop();
            encoder.release();
        } catch (Exception e) {
            fail("Custom parameters not supported: " + e.getMessage());
        }
    }
}</code></pre>
            </div>

            <h3 style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px;">
                üî® Build and Run
            </h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-title">Build and Run Custom CTS</span>
                    <span class="code-lang">Bash</span>
                </div>
                <pre><code># 1. Add source code
cd $ANDROID_BUILD_TOP/cts/tests/tests/media/src/android/media/cts/
vi CustomMediaCodecTest.java

# 2. Add to Android.bp (optional, not needed if already included in existing module)
# cts/tests/tests/media/Android.bp
# srcs: ["src/**/*.java"]  # Already includes all .java

# 3. Build CTS
cd $ANDROID_BUILD_TOP
source build/envsetup.sh
lunch aosp_arm64-user
m cts

# 4. Build specific module only
m CtsMediaTestCases

# 5. Install and run on device
adb install -r out/host/linux-x86/cts/android-cts/testcases/CtsMediaTestCases.apk

adb shell am instrument -w \
  -e class android.media.cts.CustomMediaCodecTest \
  android.media.cts/androidx.test.runner.AndroidJUnitRunner

# 6. Run via CTS harness
cts-tradefed
cts-tf > run cts -m CtsMediaTestCases \
  -t android.media.cts.CustomMediaCodecTest#testCustomH265EncoderExists</code></pre>
            </div>

            <div class="success-box">
                <strong>‚úÖ Benefits of Custom Tests:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>Verify vendor-specific features (Qualcomm, MediaTek extension parameters, etc.)</li>
                    <li>Quality control through internal regression testing</li>
                    <li>Pre-verification before CTS submission</li>
                    <li>Learn test writing by referencing AOSP CTS source</li>
                </ul>
            </div>

            <div class="highlight-box">
                <strong>üí° GitHub Mirror:</strong>
                <p style="margin-top: 10px;">
                    AOSP CTS source code can be found at <a href="https://android.googlesource.com/platform/cts/" target="_blank" style="color: var(--accent-primary);">android.googlesource.com/platform/cts/</a>.
                    GitHub mirror is also available at <a href="https://github.com/aosp-mirror/platform_cts" target="_blank" style="color: var(--accent-primary);">github.com/aosp-mirror/platform_cts</a>.
                </p>
            </div>
        </section>

        <!-- Section 17: Related Documents -->
        <section class="content-section section">
            <h2 class="section-title">
                <span class="section-number">17</span>
                Related Documentation
            </h2>
            <p class="section-description">
                Links to other documents related to CTS testing.
            </p>

            <div class="content-grid">
                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üìú</span>
                        CDD Policy
                    </h3>
                    <div class="card-description">
                        <p>Android Compatibility Definition Document - Requirements validated by CTS</p>
                        <a href="cdd.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View CDD Document ‚Üí
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üé¨</span>
                        Codec 2.0
                    </h3>
                    <div class="card-description">
                        <p>Next-generation media codec framework - CTS test target</p>
                        <a href="codec2.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View Codec 2.0 Document ‚Üí
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üì¶</span>
                        Media Extractor
                    </h3>
                    <div class="card-description">
                        <p>Media container parsing - MediaExtractor CTS tests</p>
                        <a href="media-extractor.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View Media Extractor Document ‚Üí
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">‚ñ∂Ô∏è</span>
                        Media Playback
                    </h3>
                    <div class="card-description">
                        <p>Media playback pipeline - MediaPlayer CTS tests</p>
                        <a href="media-playback.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View Media Playback Document ‚Üí
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üîí</span>
                        Widevine DRM
                    </h3>
                    <div class="card-description">
                        <p>DRM security framework - DRM CTS tests</p>
                        <a href="widevine.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View Widevine DRM Document ‚Üí
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üéµ</span>
                        Audio Framework
                    </h3>
                    <div class="card-description">
                        <p>Audio system architecture - Audio CTS tests</p>
                        <a href="audio-framework.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View Audio Framework Document ‚Üí
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üöó</span>
                        AAOS
                    </h3>
                    <div class="card-description">
                        <p>Android Automotive OS - Automotive-specific CTS tests</p>
                        <a href="aaos.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View AAOS Document ‚Üí
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">
                        <span class="card-icon">üèóÔ∏è</span>
                        AOSP Architecture
                    </h3>
                    <div class="card-description">
                        <p>Android full system architecture - Complete stack verified by CTS</p>
                        <a href="aosp.html" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">
                            View AOSP Document ‚Üí
                        </a>
                    </div>
                </div>
            </div>

            <div class="highlight-box" style="margin-top: 40px;">
                <strong>üîó External Reference Links:</strong>
                <ul style="margin-top: 15px; padding-left: 20px;">
                    <li>
                        <a href="https://source.android.com/docs/compatibility/cts" target="_blank" style="color: var(--accent-primary);">
                            Android CTS Official Documentation
                        </a>
                    </li>
                    <li>
                        <a href="https://source.android.com/docs/compatibility/cdd" target="_blank" style="color: var(--accent-primary);">
                            Android CDD Official Documentation
                        </a>
                    </li>
                    <li>
                        <a href="https://android.googlesource.com/platform/cts/" target="_blank" style="color: var(--accent-primary);">
                            CTS AOSP Source Code
                        </a>
                    </li>
                    <li>
                        <a href="https://developer.android.com/topic/performance/performance-class" target="_blank" style="color: var(--accent-primary);">
                            Performance Class Developer Guide
                        </a>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Footer -->
        <footer
            style="text-align: center; padding: 40px 20px; color: var(--text-muted); border-top: 1px solid var(--border-color); margin-top: 60px;">
            <p>Google CTS Testing Framework</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Android Compatibility Test Suite
            </p>
            <p style="margin-top: 20px;">
                <a href="index.html" style="color: var(--accent-primary); text-decoration: none;">
                    ‚Üê Back to AOSP Media Framework
                </a>
            </p>
        </footer>
    </div>

    <script src="../scripts/mermaid-theme.js"></script>
    <script>
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.section').forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(30px)';
            section.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
            observer.observe(section);
        });
    </script>
    <!-- Navigation & Copy Features -->
    <script src="../scripts/copy-code.js"></script>
    <script src="../scripts/toc-generator.js"></script>
    <script src="../scripts/page-navigation.js"></script>
    <!-- Interactive Diagram Features -->
    <script src="../scripts/diagram-data.js"></script>
    <script src="../scripts/diagram-data-en-partial.js"></script>
    <script src="../scripts/diagram-interactive.js"></script>

    <script src="../scripts/theme-toggle.js"></script>
    <script src="../scripts/lang-switch.js"></script>
</body>

</html>